<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of look4</title>
  <meta name="keywords" content="look4">
  <meta name="description" content="LOOK4 Quick-search M-files with keywords using a database.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">applications</a> &gt; <a href="index.html">common</a> &gt; look4.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for applications\common&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>look4
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>LOOK4 Quick-search M-files with keywords using a database.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = look4(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">LOOK4 Quick-search M-files with keywords using a database.
   LOOK4 ABC XYZ ... looks through a database of help files (H1 lines
   in m-files) for keywords ABC, XYZ, ... There can be as many keywords
   as desired. For all files in which a match occurs, the H1 line is
   displayed. CLASS METHODS will be indented by one space, and PRIVATE
   function will be indented by two spaces.

   LOOK4 is very similar to LOOKFOR, except that it searches through a
   database file named mfileDatabase#.mat (where # is the version
   number), so it is much faster.  Also, unlike LOOKFOR it accepts
   multiple keywords. The search is case-insensitive.

   mfileDatabase#.mat is created the first time LOOK4 is executed. It
   catalogs help texts of all m-files in the MATLABPATH (including class
   methods and private functions). The database file is stored in the same
   directory as this file. The generation of the database file may take
   a few minutes depending on the number of m-files and the speed of the
   computer.

   [H, P] = LOOK4('ABC', 'XYZ', ...) returns the H1 lines and the paths of
   the corresponding m-files, respectively.

   LOOK4 by itself invokes a GUI version of the search program. The GUI
   incorporates a &quot;key stroke&quot; search feature. Each key stroke updates the
   search result, but only after 0.5 seconds of non-keypress. This allows
   fast, continuous typing. Only alphabets and numbers (and quotes) are
   allowed in the GUI version. Click on results list, or use arrow keys to
   navigate through results. The full help text is displayed in the bottom
   panel.

  Search options:
   LOOK4 ABC XYZ ... -all  searches the entire first comment block of
                           m-files.
   LOOK4 ... -link         displays the results with hyperlinks to full
                           help texts

  Database creation/update:
   LOOK4 -new              re-creates the database file.
   LOOK4 -new -noverbose   does not show the name of the directory in
                           progress.
   LOOK4 -update           updates the database file for the current
                           directory. This is useful for updating personal
                           m-files.
   LOOK4 -autoupdate       sets up auto-updating feature.

   How Auto-Updating of Database Works:
     The database can be set to automatically update (re-hash) daily or
     weekly. LOOK4 accomplishes this by creating a function called
     look4_autoUpdateFcn.m that gets run during startup (The function call
     is appended to startup.m. If startup.m does not exist, it creates
     one). look4_autoUpdateFcn creates a TIMER object (tagged
     'look4AutoUpdateTimer') that gets executed at the appropriate time
     and interval. Matlab needs to be running at the time of TimerFcn
     execution. If Matlab is launched after the scheduled update time,
     then the TimerFcn will be scheduled to execute at the next update
     time.

     Every time LOOK4 loads the database into memory (it saves as a
     PERSISTENT variable), it also checks the age of the database file by
     checking the modification date, and gives a warning when 2 weeks has
     passed since the last modification. This feature creates a dummy file
     &quot;mfileDatabase#_vt.txt&quot; which is used to store the time when the
     warning was displayed.

   Examples:
     look4 root locus
     look4 root locus -all


   See also LOOKFOR, HELP, DOC.

   e-mail bug reports/comments to &lt;a href=&quot;mailto:jiro.doke@gmail.com&quot;&gt;jiro&lt;/a&gt;</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function createDatabase(d, datFile, isVerbose)</a></li><li><a href="#_sub2" class="code">function [dat, dat2_char, len] = loadData(datFile)</a></li><li><a href="#_sub3" class="code">function touchFile(fname)</a></li><li><a href="#_sub4" class="code">function [datout, ids] = look4Engine(datFile, searchType, varargin)</a></li><li><a href="#_sub5" class="code">function look4GUI(datFile)</a></li><li><a href="#_sub6" class="code">function clearSearchFieldFcn(varargin)</a></li><li><a href="#_sub7" class="code">function activateKeyPressMode(varargin)</a></li><li><a href="#_sub8" class="code">function keyPressFcn(varargin)</a></li><li><a href="#_sub9" class="code">function endKeyTimerFcn(varargin)</a></li><li><a href="#_sub10" class="code">function timerErrorFcn(varargin)</a></li><li><a href="#_sub11" class="code">function words=parseWords(blah)</a></li><li><a href="#_sub12" class="code">function varargin = parseWords_Int(varargin)</a></li><li><a href="#_sub13" class="code">function ln = GUIsearchResultCallback(varargin)</a></li><li><a href="#_sub14" class="code">function GUIuimenuCallback(varargin)</a></li><li><a href="#_sub15" class="code">function GUIradioButtonCallback(varargin)</a></li><li><a href="#_sub16" class="code">function setupAutoUpdate</a></li><li><a href="#_sub17" class="code">function out = modifyStartupFile(fname, result, opt)</a></li><li><a href="#_sub18" class="code">function autoUpdateBtnCallback(varargin)</a></li><li><a href="#_sub19" class="code">function autoUpdateEditCallback(varargin)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = look4(varargin)</a>
0002 
0003 <span class="comment">%LOOK4 Quick-search M-files with keywords using a database.</span>
0004 <span class="comment">%   LOOK4 ABC XYZ ... looks through a database of help files (H1 lines</span>
0005 <span class="comment">%   in m-files) for keywords ABC, XYZ, ... There can be as many keywords</span>
0006 <span class="comment">%   as desired. For all files in which a match occurs, the H1 line is</span>
0007 <span class="comment">%   displayed. CLASS METHODS will be indented by one space, and PRIVATE</span>
0008 <span class="comment">%   function will be indented by two spaces.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%   LOOK4 is very similar to LOOKFOR, except that it searches through a</span>
0011 <span class="comment">%   database file named mfileDatabase#.mat (where # is the version</span>
0012 <span class="comment">%   number), so it is much faster.  Also, unlike LOOKFOR it accepts</span>
0013 <span class="comment">%   multiple keywords. The search is case-insensitive.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%   mfileDatabase#.mat is created the first time LOOK4 is executed. It</span>
0016 <span class="comment">%   catalogs help texts of all m-files in the MATLABPATH (including class</span>
0017 <span class="comment">%   methods and private functions). The database file is stored in the same</span>
0018 <span class="comment">%   directory as this file. The generation of the database file may take</span>
0019 <span class="comment">%   a few minutes depending on the number of m-files and the speed of the</span>
0020 <span class="comment">%   computer.</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%   [H, P] = LOOK4('ABC', 'XYZ', ...) returns the H1 lines and the paths of</span>
0023 <span class="comment">%   the corresponding m-files, respectively.</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%   LOOK4 by itself invokes a GUI version of the search program. The GUI</span>
0026 <span class="comment">%   incorporates a &quot;key stroke&quot; search feature. Each key stroke updates the</span>
0027 <span class="comment">%   search result, but only after 0.5 seconds of non-keypress. This allows</span>
0028 <span class="comment">%   fast, continuous typing. Only alphabets and numbers (and quotes) are</span>
0029 <span class="comment">%   allowed in the GUI version. Click on results list, or use arrow keys to</span>
0030 <span class="comment">%   navigate through results. The full help text is displayed in the bottom</span>
0031 <span class="comment">%   panel.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%  Search options:</span>
0034 <span class="comment">%   LOOK4 ABC XYZ ... -all  searches the entire first comment block of</span>
0035 <span class="comment">%                           m-files.</span>
0036 <span class="comment">%   LOOK4 ... -link         displays the results with hyperlinks to full</span>
0037 <span class="comment">%                           help texts</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%  Database creation/update:</span>
0040 <span class="comment">%   LOOK4 -new              re-creates the database file.</span>
0041 <span class="comment">%   LOOK4 -new -noverbose   does not show the name of the directory in</span>
0042 <span class="comment">%                           progress.</span>
0043 <span class="comment">%   LOOK4 -update           updates the database file for the current</span>
0044 <span class="comment">%                           directory. This is useful for updating personal</span>
0045 <span class="comment">%                           m-files.</span>
0046 <span class="comment">%   LOOK4 -autoupdate       sets up auto-updating feature.</span>
0047 <span class="comment">%</span>
0048 <span class="comment">%   How Auto-Updating of Database Works:</span>
0049 <span class="comment">%     The database can be set to automatically update (re-hash) daily or</span>
0050 <span class="comment">%     weekly. LOOK4 accomplishes this by creating a function called</span>
0051 <span class="comment">%     look4_autoUpdateFcn.m that gets run during startup (The function call</span>
0052 <span class="comment">%     is appended to startup.m. If startup.m does not exist, it creates</span>
0053 <span class="comment">%     one). look4_autoUpdateFcn creates a TIMER object (tagged</span>
0054 <span class="comment">%     'look4AutoUpdateTimer') that gets executed at the appropriate time</span>
0055 <span class="comment">%     and interval. Matlab needs to be running at the time of TimerFcn</span>
0056 <span class="comment">%     execution. If Matlab is launched after the scheduled update time,</span>
0057 <span class="comment">%     then the TimerFcn will be scheduled to execute at the next update</span>
0058 <span class="comment">%     time.</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%     Every time LOOK4 loads the database into memory (it saves as a</span>
0061 <span class="comment">%     PERSISTENT variable), it also checks the age of the database file by</span>
0062 <span class="comment">%     checking the modification date, and gives a warning when 2 weeks has</span>
0063 <span class="comment">%     passed since the last modification. This feature creates a dummy file</span>
0064 <span class="comment">%     &quot;mfileDatabase#_vt.txt&quot; which is used to store the time when the</span>
0065 <span class="comment">%     warning was displayed.</span>
0066 <span class="comment">%</span>
0067 <span class="comment">%   Examples:</span>
0068 <span class="comment">%     look4 root locus</span>
0069 <span class="comment">%     look4 root locus -all</span>
0070 <span class="comment">%</span>
0071 <span class="comment">%</span>
0072 <span class="comment">%   See also LOOKFOR, HELP, DOC.</span>
0073 <span class="comment">%</span>
0074 <span class="comment">%   e-mail bug reports/comments to &lt;a href=&quot;mailto:jiro.doke@gmail.com&quot;&gt;jiro&lt;/a&gt;</span>
0075 
0076 
0077 <span class="comment">%   VERSIONS:</span>
0078 <span class="comment">%     v1.0 - first version</span>
0079 <span class="comment">%     v1.1 - fix GUI window size (use normalized to fit to any screen)</span>
0080 <span class="comment">%            (Feb 13, 2006)</span>
0081 <span class="comment">%     v1.2 - fix the use of multi-word search (use single quotes)</span>
0082 <span class="comment">%            (Feb 13, 2006)</span>
0083 <span class="comment">%     v1.2.1 - always re-process CLASS and PRIVATE subdirectories.</span>
0084 <span class="comment">%              (Feb 16, 2006)</span>
0085 <span class="comment">%     v1.3 - added &quot;key stroke&quot; search feature. display hyperlink in</span>
0086 <span class="comment">%            command line. (March 24, 2006)</span>
0087 <span class="comment">%     v1.4 - added feature: auto-update of database. allow daily or weekly</span>
0088 <span class="comment">%            update of the database file. display warning when the database</span>
0089 <span class="comment">%            is old. (March 28, 2006)</span>
0090 <span class="comment">%     v1.4.1 - minor help text and code change for elegance.</span>
0091 <span class="comment">%              (March 29, 2006)</span>
0092 <span class="comment">%     v1.4.2 - bug fix (March 30, 2006)</span>
0093 <span class="comment">%</span>
0094 <span class="comment">%   Jiro Doke</span>
0095 <span class="comment">%   Feb 2, 2006</span>
0096 
0097 <span class="comment">%--------------------------------------------------------------------------</span>
0098 <span class="comment">% Error checking of input arguments</span>
0099 <span class="comment">%--------------------------------------------------------------------------</span>
0100 
0101 <span class="comment">% Check to see if input arguments are strings</span>
0102 iS = cellfun(<span class="string">'isclass'</span>, varargin, <span class="string">'char'</span>);
0103 <span class="keyword">if</span> ~all(iS)
0104   error(<span class="string">'Arguments must be strings.'</span>);
0105 <span class="keyword">end</span>
0106 
0107 <span class="comment">% If no input argument, assign empty cell to VARARGIN (will start GUI)</span>
0108 <span class="keyword">if</span> isempty(varargin)
0109   varargin = {<span class="string">''</span>};
0110 <span class="keyword">end</span>
0111 
0112 <span class="comment">%--------------------------------------------------------------------------</span>
0113 <span class="comment">% Check to see if database exists. If not, create one.</span>
0114 <span class="comment">%--------------------------------------------------------------------------</span>
0115 
0116 <span class="comment">% Determine the appropriate database file for this MATLAB version</span>
0117 v       = version;
0118 v       = strrep(strtok(v), <span class="string">'.'</span>, <span class="string">'_'</span>);
0119 datFile = fullfile(fileparts(which(mfilename)), <span class="keyword">...</span>
0120   sprintf(<span class="string">'mfileDatabase%s.mat'</span>, v));
0121 
0122 <span class="keyword">if</span> ~exist(datFile, <span class="string">'file'</span>) &amp;&amp; ~strcmpi(varargin{1}, <span class="string">'-new'</span>)
0123   fprintf(<span class="string">'Database file not found. Creating new database...\n'</span>);
0124   varargin = {<span class="string">'-new'</span>, <span class="string">'-noverbose'</span>};
0125 <span class="keyword">end</span>
0126 
0127 <span class="comment">%--------------------------------------------------------------------------</span>
0128 <span class="comment">% Perform appropriate process based on first argument</span>
0129 <span class="comment">%--------------------------------------------------------------------------</span>
0130 
0131 <span class="keyword">switch</span> lower(varargin{1})
0132   <span class="keyword">case</span> <span class="string">''</span>         <span class="comment">% Start GUI</span>
0133     <span class="keyword">if</span> nargout &gt; 0
0134       error(<span class="string">'Too many output arguments'</span>);
0135     <span class="keyword">end</span>
0136     <a href="#_sub5" class="code" title="subfunction look4GUI(datFile)">look4GUI</a>(datFile);
0137     <span class="keyword">return</span>;
0138     
0139   <span class="keyword">case</span> <span class="string">'-update'</span>  <span class="comment">% Update database for this directory</span>
0140     <a href="#_sub1" class="code" title="subfunction createDatabase(d, datFile, isVerbose)">createDatabase</a>(pwd, datFile, true);
0141     <span class="keyword">if</span> nargout &gt; 0
0142       error(<span class="string">'Too many output arguments'</span>);
0143     <span class="keyword">end</span>
0144     <span class="keyword">return</span>;
0145     
0146   <span class="keyword">case</span> <span class="string">'-new'</span>     <span class="comment">% (Re)Create new database</span>
0147     <span class="keyword">if</span> length(varargin) == 2 &amp;&amp; strcmpi(varargin{2}, <span class="string">'-noverbose'</span>)
0148       <a href="#_sub1" class="code" title="subfunction createDatabase(d, datFile, isVerbose)">createDatabase</a>(<span class="string">''</span>, datFile, false)
0149     <span class="keyword">else</span>
0150       <a href="#_sub1" class="code" title="subfunction createDatabase(d, datFile, isVerbose)">createDatabase</a>(<span class="string">''</span>, datFile, true);
0151     <span class="keyword">end</span>
0152     <span class="keyword">if</span> nargout &gt; 0
0153       error(<span class="string">'Too many output arguments'</span>);
0154     <span class="keyword">end</span>
0155     <span class="keyword">return</span>;
0156     
0157   <span class="keyword">case</span> <span class="string">'-autoupdate'</span>
0158     <a href="#_sub16" class="code" title="subfunction setupAutoUpdate">setupAutoUpdate</a>;
0159     <span class="keyword">return</span>;
0160     
0161   <span class="keyword">otherwise</span>       <span class="comment">% Perform keyword search</span>
0162     varargin = lower(varargin);
0163 
0164     id1 = strmatch(<span class="string">'-link'</span>, varargin, <span class="string">'exact'</span>);
0165     <span class="keyword">if</span> isempty(id1)
0166       showLink = false;
0167     <span class="keyword">else</span>
0168       showLink = true;
0169       varargin(id1) = <span class="string">''</span>;
0170     <span class="keyword">end</span>
0171     
0172     id2 = strmatch(<span class="string">'-all'</span>, varargin, <span class="string">'exact'</span>);
0173     <span class="keyword">if</span> isempty(id2)  <span class="comment">% If no '-all' flag, perform H1 line search</span>
0174       dat = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(datFile, 2, varargin{:});
0175       
0176     <span class="keyword">else</span>             <span class="comment">% Search through all help text</span>
0177       varargin(id2) = <span class="string">''</span>; <span class="comment">% Remove '-all' from search words</span>
0178       dat = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(datFile, 3, varargin{:});
0179     <span class="keyword">end</span>
0180 <span class="keyword">end</span>
0181 
0182 <span class="comment">%--------------------------------------------------------------------------</span>
0183 <span class="comment">% Process output</span>
0184 <span class="comment">%--------------------------------------------------------------------------</span>
0185 
0186 <span class="keyword">if</span> nargout &gt; 2
0187   error(<span class="string">'Too many output arguments.'</span>);
0188 <span class="keyword">elseif</span> nargout
0189   varargout{1} = dat(:, 2);
0190   varargout{2} = dat(:, 1);
0191 <span class="keyword">else</span>
0192   <span class="keyword">if</span> isempty(dat)
0193     fprintf(<span class="string">'\nNone found.\n\n'</span>);
0194   <span class="keyword">else</span>
0195     fprintf(<span class="string">'\n'</span>);
0196     <span class="keyword">if</span> showLink
0197       ddat=dat(:,[1, 1, 2])';
0198       fprintf(<span class="string">'&lt;a href=&quot;matlab:help(''%s'');disp(''%s'')&quot;&gt;?&lt;/a&gt; %s\n'</span>, <span class="keyword">...</span>
0199               ddat{:});
0200       fprintf(<span class="string">'\nClick on ? to get full help.\n'</span>);
0201     <span class="keyword">else</span>
0202       fprintf(<span class="string">'%s\n'</span>, dat{:, 2});
0203       fprintf(<span class="string">'\n'</span>);
0204     <span class="keyword">end</span>
0205     fprintf(<span class="string">'%d found.\n\n'</span>, size(dat, 1));
0206   <span class="keyword">end</span>
0207 <span class="keyword">end</span>
0208 
0209 
0210 <span class="comment">%--------------------------------------------------------------------------</span>
0211 <span class="comment">%--------------------------------------------------------------------------</span>
0212 <span class="comment">% createDatabase - create/update m-file database for quick-searching</span>
0213 <span class="comment">%--------------------------------------------------------------------------</span>
0214 <span class="comment">%--------------------------------------------------------------------------</span>
0215 <a name="_sub1" href="#_subfunctions" class="code">function createDatabase(d, datFile, isVerbose)</a>
0216 <span class="comment">% d         - directory name. '' for creating new database.</span>
0217 <span class="comment">% datFile   - full path to database file.</span>
0218 <span class="comment">% isVerbose - TRUE to display the directory names.</span>
0219 
0220 <span class="comment">% Database file is a n-by-3 cell array:</span>
0221 <span class="comment">%   Column 1: m-file paths</span>
0222 <span class="comment">%   Column 2: H1 lines</span>
0223 <span class="comment">%   Column 3: Full help text</span>
0224 
0225 <span class="keyword">if</span> isempty(d)
0226   createNew = true;
0227 <span class="keyword">else</span>
0228   createNew = false;
0229 <span class="keyword">end</span>
0230 
0231 fprintf(<span class="string">'Running %s...\n'</span>, upper(mfilename));
0232 
0233 <span class="keyword">if</span> createNew  <span class="comment">% (Re)Create new database</span>
0234   tic;
0235   <span class="comment">% Retrieve directories in the path</span>
0236   fprintf(<span class="string">'Retrieving path... '</span>);
0237   w = what(<span class="string">''</span>);
0238   fprintf(<span class="string">'Done\n'</span>);
0239   [idx, idx] = unique(lower({w.path}));
0240   w = w(idx);
0241   
0242   <span class="comment">% Total number of m-files</span>
0243   numFiles = sum(cellfun(<span class="string">'length'</span>, {w.m}));
0244   iFile = 1;
0245   
0246   <span class="comment">% Preallocate</span>
0247   dat = cell(numFiles, 3);
0248   
0249   fprintf(<span class="string">'Creating database...\n'</span>);
0250   
0251 <span class="keyword">else</span>          <span class="comment">% Update database</span>
0252 
0253   dat = load(datFile);
0254   dat = dat.dat;
0255   
0256   w = what(d); w = w(1);
0257   
0258   <span class="comment">%------------------------------------------------------------------------</span>
0259   <span class="comment">% Remove entries from the database before updating</span>
0260   <span class="comment">%------------------------------------------------------------------------</span>
0261   
0262   idM = strmatch([lower(w.path) filesep], lower(dat(:, 1)));
0263   
0264   <span class="keyword">if</span> ~isempty(idM)
0265     <span class="comment">% Ignore subdirectories</span>
0266     tmp = char(lower(dat(idM, 1)));
0267     tmp(:, 1:length(w.path)+1) = <span class="string">''</span>;
0268     rmID = sum(tmp == filesep, 2) &gt; 0;
0269     idM(rmID) = [];
0270     
0271     <span class="comment">%----------------------------------------------------------------------</span>
0272     <span class="comment">% Reprocess CLASSES and PRIVATE sub-directories</span>
0273     <span class="comment">%----------------------------------------------------------------------</span>
0274     
0275     <span class="comment">% Find PRIVATE directories in the database</span>
0276     idP = strmatch(fullfile(lower(w.path), <span class="string">'private'</span>, filesep), <span class="keyword">...</span>
0277       lower(dat(:, 1)));
0278     
0279     <span class="comment">% If PRIVATE directory exists, then add it to 'w'</span>
0280     <span class="keyword">if</span> isdir(fullfile(w.path, <span class="string">'private'</span>))
0281       ww = what(fullfile(w.path, <span class="string">'private'</span>));
0282       w(end + 1) = ww(1);
0283     <span class="keyword">end</span>
0284     
0285     <span class="comment">% Loop through CLASSES</span>
0286     idC = [];
0287     <span class="keyword">for</span> iC = 1:length(w(1).classes)
0288       <span class="comment">% Add CLASS directory to 'w'</span>
0289       ww = what(fullfile(w(1).path, [<span class="string">'@'</span> w(1).classes{iC}]));
0290       w(end + 1) = ww(1);
0291       
0292       <span class="comment">% Find CLASS directory in the database</span>
0293       idC = [idC; strmatch(fullfile(lower(w(1).path), <span class="keyword">...</span>
0294           [<span class="string">'@'</span> w(1).classes{iC}], filesep), lower(dat(:, 1)))];
0295       
0296       <span class="comment">% Find PRIVATE directory under CLASS in the database</span>
0297       idP = [idP; strmatch(fullfile(lower(w(1).path), <span class="keyword">...</span>
0298           [<span class="string">'@'</span> w(1).classes{iC}], <span class="string">'private'</span>, filesep), lower(dat(:, 1)))];
0299       
0300       <span class="comment">% if @CLASS/PRIVATE exists, then add it to 'w'</span>
0301       <span class="keyword">if</span> isdir(fullfile(w(1).path, [<span class="string">'@'</span> w(1).classes{iC}], <span class="string">'private'</span>))
0302         ww = what(fullfile(w(1).path, [<span class="string">'@'</span> w(1).classes{iC}], <span class="string">'private'</span>));
0303         w(end + 1) = ww(1);
0304       <span class="keyword">end</span>
0305       
0306     <span class="keyword">end</span>
0307     
0308     <span class="comment">% These are ideces of entries to be deleted from the database</span>
0309     idM = [idM; idC; idP];
0310   <span class="keyword">end</span>
0311   
0312   <span class="comment">% Delete entries from database</span>
0313   dat(idM, :) = <span class="string">''</span>;
0314   
0315   <span class="comment">% Total number of m-files</span>
0316   numFiles = sum(cellfun(<span class="string">'length'</span>, {w.m}));
0317   iFile = size(dat, 1) + 1;
0318   
0319   <span class="comment">% Preallocate</span>
0320   dat = [dat; cell(numFiles, 3)];
0321   
0322   fprintf(<span class="string">'Updating database...\n'</span>);
0323 <span class="keyword">end</span>
0324 
0325 <span class="comment">%--------------------------------------------------------------------------</span>
0326 <span class="comment">% Get help text for each m-file</span>
0327 <span class="comment">%--------------------------------------------------------------------------</span>
0328 
0329 <span class="comment">% Prepare for commandline progress display</span>
0330 <span class="comment">%c = max(cellfun('length', {w.path}));</span>
0331 <span class="comment">%delChar = repmat(char(8), 1, c+9);</span>
0332 <span class="comment">%fmtStr = ['%5.1f %% %-' num2str(c) 's\n'];</span>
0333 
0334 newlineChar = sprintf(<span class="string">'\n'</span>);
0335 
0336 hCancel = msgbox(sprintf(<span class="string">'%s: Click OK to stop'</span>, upper(mfilename)), <span class="string">'0 %'</span>);
0337 
0338 <span class="comment">% Loop through each directory</span>
0339 <span class="keyword">for</span> ii = 1:length(w)
0340   drawnow;
0341   <span class="keyword">if</span> ~ishandle(hCancel)
0342     fprintf(<span class="string">'Canceled.\n'</span>);
0343     <span class="keyword">return</span>;
0344   <span class="keyword">end</span>
0345   <span class="keyword">if</span> createNew
0346     set(hCancel, <span class="string">'name'</span>, sprintf(<span class="string">'%0.1f %%'</span>, iFile/numFiles*100));
0347     <span class="keyword">if</span> isVerbose
0348       disp(w(ii).path);
0349     <span class="keyword">end</span>
0350   <span class="keyword">else</span>
0351     fprintf(<span class="string">'%s ...\n'</span>, w(ii).path);
0352   <span class="keyword">end</span>
0353   
0354   <span class="comment">% Loop through each m-file in the directory</span>
0355   <span class="keyword">for</span> id = 1:length(w(ii).m)
0356     dat{iFile, 1} = [w(ii).path filesep w(ii).m{id}];
0357     
0358     <span class="comment">% Retrieve help text</span>
0359     s = help(dat{iFile, 1});
0360     
0361     <span class="keyword">if</span> ~isempty(s)
0362       <span class="comment">% Removing leading spaces</span>
0363       letterID = find(~isspace(s));
0364       <span class="keyword">if</span> ~isempty(letterID) <span class="comment">% empty means there's no help text!!</span>
0365         <span class="comment">% Full help text</span>
0366         s_Full = s(letterID(1):end);
0367         
0368         <span class="comment">% Find new line characters</span>
0369         nID    = strfind(s_Full, newlineChar);
0370         
0371         <span class="keyword">if</span> isempty(nID) <span class="comment">% there's only one line</span>
0372           s    = s_Full;
0373         <span class="keyword">else</span>            <span class="comment">% get the first line</span>
0374           s    = s_Full(1:nID(1));
0375         <span class="keyword">end</span>
0376         
0377         <span class="comment">% Remove trailing spaces</span>
0378         letterID = find(~isspace(s));
0379         <span class="keyword">if</span> ~isempty(letterID)
0380           s = s(1:letterID(end));
0381           
0382           [p, n] = fileparts(w(ii).path);
0383           <span class="keyword">if</span> isempty(n) <span class="comment">% in case path name ends in FILESEP</span>
0384             [n, n] = fileparts(p);
0385           <span class="keyword">end</span>
0386           <span class="keyword">if</span> ~isempty(n)  <span class="comment">% if still empty, means root (e.g. c:\)</span>
0387             <span class="keyword">if</span> n(1) == <span class="string">'@'</span>
0388               <span class="comment">% Class Method</span>
0389               s = [<span class="string">' '</span>, s];
0390             <span class="keyword">elseif</span> strcmpi(n, <span class="string">'private'</span>)
0391               <span class="comment">% Private Function</span>
0392               s = [<span class="string">'  '</span>, s];
0393             <span class="keyword">end</span>
0394           <span class="keyword">end</span>
0395           
0396           dat{iFile, 2} = s;
0397           dat{iFile, 3} = s_Full;
0398         <span class="keyword">end</span>
0399       <span class="keyword">end</span>
0400     <span class="keyword">end</span>
0401     
0402     iFile = iFile + 1;
0403   <span class="keyword">end</span>
0404 
0405 <span class="comment">%   if createNew</span>
0406 <span class="comment">%     fprintf('%s', delChar);</span>
0407 <span class="comment">%   end</span>
0408 <span class="keyword">end</span>
0409 
0410 delete(hCancel);
0411 
0412 <span class="comment">% Convert [] empty cells to '' empty cells</span>
0413 iE = cellfun(<span class="string">'isempty'</span>, dat(:, 2));
0414 dat(iE, 2:3) = {<span class="string">''</span>};
0415 
0416 <span class="comment">% Save database file. Save as V6 format (no compression) for faster loading</span>
0417 [p, n, e] = fileparts(datFile);
0418 verifiedTimeFile = fullfile(p, [n <span class="string">'_vt.txt'</span>]);
0419 v = version;
0420 <span class="keyword">if</span> str2double(v(1)) &gt; 6
0421   save(datFile, <span class="string">'dat'</span>, <span class="string">'-v6'</span>);
0422 <span class="keyword">else</span>
0423   save(datFile, <span class="string">'dat'</span>);
0424 <span class="keyword">end</span>  
0425 <a href="#_sub3" class="code" title="subfunction touchFile(fname)">touchFile</a>(verifiedTimeFile);
0426 
0427 <span class="comment">% Update PERSISTENT variable</span>
0428 <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(dat);
0429 
0430 <span class="keyword">if</span> createNew
0431   fprintf(<span class="string">'Elapsed time: %d sec ...'</span>, round(toc));
0432 <span class="keyword">end</span>
0433 fprintf(<span class="string">'Done\n'</span>);
0434 
0435 
0436 <span class="comment">%--------------------------------------------------------------------------</span>
0437 <span class="comment">%--------------------------------------------------------------------------</span>
0438 <span class="comment">% loadData - loads database. this is subfunction of look4Engine because it</span>
0439 <span class="comment">%            is called twice.</span>
0440 <span class="comment">%--------------------------------------------------------------------------</span>
0441 <span class="comment">%--------------------------------------------------------------------------</span>
0442 <a name="_sub2" href="#_subfunctions" class="code">function [dat, dat2_char, len] = loadData(datFile)</a>
0443 
0444 dat = load(datFile);
0445 dat = dat.dat;
0446 
0447 <span class="comment">% Check modified time of $$_vt.txt file.</span>
0448 <span class="comment">% This variable stores the last time out-of-date-database warning was</span>
0449 <span class="comment">% displayed. This prevents the warning from showing everytime this is run.</span>
0450 <span class="comment">% After a week, it will display the warning again if the database has not</span>
0451 <span class="comment">% be updated</span>
0452 [p, n, e] = fileparts(datFile);
0453 verifiedTimeFile = fullfile(p, [n <span class="string">'_vt.txt'</span>]);
0454 <span class="keyword">if</span> exist(verifiedTimeFile, <span class="string">'file'</span>)
0455   dd1 = dir(verifiedTimeFile);
0456 
0457 <span class="keyword">else</span>
0458   <a href="#_sub3" class="code" title="subfunction touchFile(fname)">touchFile</a>(verifiedTimeFile);
0459 
0460   dd1.date = datestr(0, 0);
0461 <span class="keyword">end</span>
0462 
0463 <span class="comment">% check the age of the database</span>
0464 dd2 = dir(datFile);
0465 tt = etime(clock, datevec(dd2.date))/(24*60*60);
0466 <span class="keyword">if</span> tt &gt; 14  <span class="comment">% give warning after 14 days</span>
0467   tt2 = etime(clock, datevec(dd1.date));
0468   <span class="keyword">if</span> tt2 &gt; 7*24*60*60 <span class="comment">% has been a week since last warning</span>
0469     warndlg(<span class="keyword">...</span>
0470       {sprintf(<span class="string">'It has been %d days since the database has been updated'</span>, <span class="keyword">...</span>
0471       round(tt)), <span class="keyword">...</span>
0472       <span class="string">'You may want to update the database.'</span>, <span class="keyword">...</span>
0473       <span class="string">''</span>, <span class="keyword">...</span>
0474       sprintf(<span class="string">'%s(''-new'')   OR    %s(''-update'')'</span>, <span class="keyword">...</span>
0475       mfilename, mfilename)}, <span class="keyword">...</span>
0476       sprintf(<span class="string">'%s: Old Database Warning'</span>, upper(mfilename)));
0477 
0478     <a href="#_sub3" class="code" title="subfunction touchFile(fname)">touchFile</a>(verifiedTimeFile);
0479 
0480   <span class="keyword">end</span>
0481 <span class="keyword">end</span>
0482 
0483 <span class="comment">% sort alphabetically</span>
0484 [ii, ii] = sortrows(strjust(char(dat(:, 2)), <span class="string">'left'</span>));
0485 dat = dat(ii, :);
0486 
0487 dat2_char=char(lower(dat(:, 2)));
0488 dat2_char=[blanks(size(dat, 1))', dat2_char, blanks(size(dat, 1))'];
0489 
0490 len = size(dat2_char, 2);
0491 
0492 
0493 <span class="comment">%--------------------------------------------------------------------------</span>
0494 <span class="comment">%--------------------------------------------------------------------------</span>
0495 <span class="comment">% touchFile</span>
0496 <span class="comment">%    Subfunction for 'touching' a file to update its file modification time</span>
0497 <span class="comment">%--------------------------------------------------------------------------</span>
0498 <span class="comment">%--------------------------------------------------------------------------</span>
0499 <a name="_sub3" href="#_subfunctions" class="code">function touchFile(fname)</a>
0500 
0501 [p, n, e] = fileparts(fname);
0502 fid = fopen(fname, <span class="string">'w'</span>);
0503 <span class="keyword">if</span> fid &gt; 0
0504   fclose(fid);
0505 <span class="keyword">else</span>
0506   fprintf(<span class="string">'Warning: Could not create %s.'</span>, [n, e]);
0507 <span class="keyword">end</span>
0508 
0509 
0510 <span class="comment">%--------------------------------------------------------------------------</span>
0511 <span class="comment">%--------------------------------------------------------------------------</span>
0512 <span class="comment">% look4Engine</span>
0513 <span class="comment">%    Main engine for searching</span>
0514 <span class="comment">%--------------------------------------------------------------------------</span>
0515 <span class="comment">%--------------------------------------------------------------------------</span>
0516 <a name="_sub4" href="#_subfunctions" class="code">function [datout, ids] = look4Engine(datFile, searchType, varargin)</a>
0517 <span class="comment">% datFile    - file name of database</span>
0518 <span class="comment">% searchType - 2 for H1 line only, 3 for full help search</span>
0519 <span class="comment">% varargin   - search keywords</span>
0520 
0521 <span class="keyword">persistent</span> dat dat2_char len
0522 
0523 <span class="keyword">if</span> nargin == 0 <span class="comment">% check whether persistent variable exists</span>
0524   <span class="keyword">if</span> isempty(dat)
0525     datout = false;
0526   <span class="keyword">else</span>
0527     datout = true;
0528   <span class="keyword">end</span>
0529   <span class="keyword">return</span>;
0530 <span class="keyword">elseif</span> nargin == 1
0531   <span class="keyword">switch</span> class(datFile)
0532     <span class="keyword">case</span> <span class="string">'cell'</span>
0533       dat = datFile;
0534       
0535       <span class="comment">% sort alphabetically</span>
0536       [ii, ii] = sortrows(strjust(char(dat(:, 2)), <span class="string">'left'</span>));
0537       dat = dat(ii, :);
0538 
0539       dat2_char=char(lower(dat(:, 2)));
0540       dat2_char=[blanks(size(dat, 1))', dat2_char, blanks(size(dat, 1))'];
0541 
0542       len = size(dat2_char, 2);
0543 
0544     <span class="keyword">case</span> <span class="string">'char'</span>
0545       [dat, dat2_char, len] = <a href="#_sub2" class="code" title="subfunction [dat, dat2_char, len] = loadData(datFile)">loadData</a>(datFile);
0546 
0547     <span class="keyword">case</span> <span class="string">'double'</span>
0548       datout = dat(datFile, :);
0549 
0550     <span class="keyword">otherwise</span>
0551       error(<span class="string">'Bad use of look4Engine'</span>);
0552 
0553   <span class="keyword">end</span>
0554   
0555   <span class="keyword">return</span>;
0556   
0557 <span class="keyword">end</span>
0558 
0559 <span class="comment">% If 'dat' not defined, load it from file (may have been cleared)</span>
0560 <span class="keyword">if</span> isempty(dat)
0561   [dat, dat2_char, len] = <a href="#_sub2" class="code" title="subfunction [dat, dat2_char, len] = loadData(datFile)">loadData</a>(datFile);
0562 <span class="keyword">end</span>
0563 
0564 
0565 <span class="comment">%--------------------------------------------------------------------------</span>
0566 <span class="comment">% Perform keyword search</span>
0567 <span class="comment">%--------------------------------------------------------------------------</span>
0568 
0569 <span class="comment">% For empty search words</span>
0570 allEmpty = true;
0571 
0572 <span class="comment">% Start off with all non-empty entries</span>
0573 ids = 1:size(dat, 1);
0574 ids(cellfun(<span class="string">'isempty'</span>, dat(:, 2))) = [];
0575 
0576 <span class="comment">% Loop through each keyword</span>
0577 <span class="keyword">for</span> iVar = 1:length(varargin)
0578 
0579   <span class="comment">% Break out of loop if 'ids' is empty, meaning that there are no matching</span>
0580   <span class="comment">% entries. -&gt; No need to continue.</span>
0581   <span class="keyword">if</span> isempty(ids)
0582     <span class="keyword">break</span>;
0583   <span class="keyword">end</span>
0584 
0585   wd = varargin{iVar};
0586   <span class="keyword">if</span> isempty(wd)
0587     <span class="keyword">continue</span>;
0588   <span class="keyword">else</span>
0589     allEmpty = false;
0590   <span class="keyword">end</span>
0591 
0592   <span class="keyword">if</span> searchType == 3
0593     <span class="comment">% Preallocate</span>
0594     a = false(length(ids), 1);
0595 
0596     <span class="comment">% Loop through each database entry</span>
0597     <span class="keyword">for</span> id = 1:length(ids)
0598       a(id) = ~isempty(strfind([<span class="string">' '</span>, lower(dat{ids(id), searchType}), <span class="string">' '</span>], wd));
0599     <span class="keyword">end</span>
0600 
0601     <span class="comment">% Update 'ids' to ones that only contain current keyword, so that the</span>
0602     <span class="comment">% next loop will be a smaller subset</span>
0603     ids = ids(a);
0604 
0605   <span class="keyword">else</span>  <span class="comment">% searchType == 2. This is faster for smaller search</span>
0606 
0607     temp_str=reshape(dat2_char(ids,:)',1,[]);
0608     id_files=strfind(temp_str,lower(wd));
0609     id_files=unique(ceil(id_files/len));
0610     ids=ids(id_files);
0611 
0612   <span class="keyword">end</span>
0613 <span class="keyword">end</span>
0614 
0615 <span class="keyword">if</span> allEmpty
0616   ids = [];
0617 <span class="keyword">end</span>  
0618 
0619 <span class="comment">% Return results</span>
0620 datout = dat(ids, 1:2);
0621 
0622 
0623 <span class="comment">%--------------------------------------------------------------------------</span>
0624 <span class="comment">%--------------------------------------------------------------------------</span>
0625 <span class="comment">% look4GUI - GUI initialization</span>
0626 <span class="comment">%--------------------------------------------------------------------------</span>
0627 <span class="comment">%--------------------------------------------------------------------------</span>
0628 <a name="_sub5" href="#_subfunctions" class="code">function look4GUI(datFile)</a>
0629 
0630 figH = findobj(<span class="string">'type'</span>, <span class="string">'figure'</span>, <span class="string">'tag'</span>, <span class="string">'look4MainGUI'</span>);
0631 <span class="keyword">if</span> ishandle(figH)
0632   close(figH);
0633 <span class="keyword">end</span>
0634 
0635 bgcolor1 = [.85 .85 .85];
0636 bgcolor2 = [1 1 1];
0637 bgcolor3 = [.7 .7 1];
0638 fgcolor1 = [0 0 0];
0639 fgcolor2 = [.5 .5 .5];
0640 
0641 <span class="comment">% Normalized figure size</span>
0642 figSize  = [.1 .05 .8 .9];
0643 
0644 figH = figure(                                                         <span class="keyword">...</span>
0645   <span class="string">'name'</span>                               , sprintf(<span class="string">'%s: M-File Search'</span>,  <span class="keyword">...</span>
0646                                          upper(mfilename)), <span class="keyword">...</span>
0647   <span class="string">'units'</span>                              , <span class="string">'normalized'</span>,                 <span class="keyword">...</span>
0648   <span class="string">'position'</span>                           , figSize,                      <span class="keyword">...</span>
0649   <span class="string">'resize'</span>                             , <span class="string">'off'</span>,                        <span class="keyword">...</span>
0650   <span class="string">'color'</span>                              , bgcolor1,                     <span class="keyword">...</span>
0651   <span class="string">'menubar'</span>                            , <span class="string">'none'</span>,                       <span class="keyword">...</span>
0652   <span class="string">'tag'</span>                                , <span class="string">'look4MainGUI'</span>,               <span class="keyword">...</span>
0653   <span class="string">'interruptible'</span>                      , <span class="string">'off'</span>,                        <span class="keyword">...</span>
0654   <span class="string">'numbertitle'</span>                        , <span class="string">'off'</span>,                        <span class="keyword">...</span>
0655   <span class="string">'visible'</span>                            , <span class="string">'off'</span>,                        <span class="keyword">...</span>
0656   <span class="string">'deletefcn'</span>                          , <span class="string">'delete(get(gcbf, ''us''));'</span>, <span class="keyword">...</span>
0657   <span class="string">'defaultuicontrolbackgroundcolor'</span>    , bgcolor1,                     <span class="keyword">...</span>
0658   <span class="string">'defaultuicontrolforegroundcolor'</span>    , fgcolor1,                     <span class="keyword">...</span>
0659   <span class="string">'defaultuicontrolfontname'</span>           , <span class="string">'verdana'</span>,                    <span class="keyword">...</span>
0660   <span class="string">'defaultuicontrolfontunits'</span>          , <span class="string">'points'</span>,                     <span class="keyword">...</span>
0661   <span class="string">'defaultuicontrolfontsize'</span>           , 9,                            <span class="keyword">...</span>
0662   <span class="string">'defaultuicontrolhorizontalalignment'</span>, <span class="string">'center'</span>,                     <span class="keyword">...</span>
0663   <span class="string">'defaultuicontrolunits'</span>              , <span class="string">'points'</span>,                     <span class="keyword">...</span>
0664   <span class="string">'defaultuicontrolenable'</span>             , <span class="string">'on'</span>);
0665 
0666 <span class="comment">% Convert and get figure position in POINTS</span>
0667 set(figH, <span class="string">'units'</span>, <span class="string">'points'</span>);
0668 figSizePt = get(figH, <span class="string">'position'</span>);
0669 fw        = figSizePt(3);
0670 fh        = figSizePt(4);
0671 fr        = round(fh/2);
0672 
0673 uicontrol(                                                       <span class="keyword">...</span>
0674   <span class="string">'style'</span>               , <span class="string">'frame'</span>,                               <span class="keyword">...</span>
0675   <span class="string">'position'</span>            , [0 0 fw fh]);
0676 uicontrol(                                                       <span class="keyword">...</span>
0677   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0678   <span class="string">'position'</span>            , [150 fh-30 80 18],                     <span class="keyword">...</span>
0679   <span class="string">'string'</span>              , <span class="string">'Search:'</span>,                             <span class="keyword">...</span>
0680   <span class="string">'fontsize'</span>            , 10,                                    <span class="keyword">...</span>
0681   <span class="string">'fontweight'</span>          , <span class="string">'bold'</span>,                                <span class="keyword">...</span>
0682   <span class="string">'horizontalalignment'</span> , <span class="string">'right'</span>);
0683 
0684 uicontrol(                                                       <span class="keyword">...</span>
0685   <span class="string">'style'</span>               , <span class="string">'edit'</span>,                                <span class="keyword">...</span>
0686   <span class="string">'tag'</span>                 , <span class="string">'SearchField'</span>,                         <span class="keyword">...</span>
0687   <span class="string">'position'</span>            , [235 fh-30 fw-290 18],                 <span class="keyword">...</span>
0688   <span class="string">'string'</span>              , <span class="string">'_'</span>,                                   <span class="keyword">...</span>
0689   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub7" class="code" title="subfunction activateKeyPressMode(varargin)">activateKeyPressMode</a>,                 <span class="keyword">...</span>
0690   <span class="string">'backgroundcolor'</span>     , bgcolor3,                              <span class="keyword">...</span>
0691   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>,                                <span class="keyword">...</span>
0692   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0693   <span class="string">'fontsize'</span>            , 10,                                    <span class="keyword">...</span>
0694   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0695   <span class="string">'tooltipstring'</span>       , sprintf(<span class="string">'%s\n%s'</span>,                      <span class="keyword">...</span>
0696                           <span class="string">'Type in search keywords. Use single'</span>, <span class="keyword">...</span>
0697                           <span class="string">'quotes to group multiple words.'</span>));
0698 
0699 uicontrol(                                                       <span class="keyword">...</span>
0700   <span class="string">'style'</span>               , <span class="string">'pushbutton'</span>,                          <span class="keyword">...</span>
0701   <span class="string">'tag'</span>                 , <span class="string">'ClearSearchField'</span>,                    <span class="keyword">...</span>
0702   <span class="string">'position'</span>            , [fw-55 fh-30 34 18],                   <span class="keyword">...</span>
0703   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub6" class="code" title="subfunction clearSearchFieldFcn(varargin)">clearSearchFieldFcn</a>,                  <span class="keyword">...</span>
0704   <span class="string">'fontsize'</span>            , 8,                                     <span class="keyword">...</span>
0705   <span class="string">'string'</span>              , <span class="string">'Clear'</span>,                               <span class="keyword">...</span>
0706   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0707   <span class="string">'tooltipstring'</span>       , <span class="string">'Clear search field. (&lt;ESC&gt;)'</span>);
0708                         
0709 uicontrol(                                                       <span class="keyword">...</span>
0710   <span class="string">'style'</span>               , <span class="string">'frame'</span>,                               <span class="keyword">...</span>
0711   <span class="string">'tag'</span>                 , <span class="string">'SearchScopeFrame'</span>,                    <span class="keyword">...</span>
0712   <span class="string">'position'</span>            , [20 fh-65 120 50]);
0713 
0714 uicontrol(                                                       <span class="keyword">...</span>
0715   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0716   <span class="string">'tag'</span>                 , <span class="string">'SearchScopeLabel'</span>,                    <span class="keyword">...</span>
0717   <span class="string">'position'</span>            , [25 fh-25 110 15],                     <span class="keyword">...</span>
0718   <span class="string">'fontweight'</span>          , <span class="string">'bold'</span>,                                <span class="keyword">...</span>
0719   <span class="string">'horizontalalignment'</span> , <span class="string">'center'</span>,                              <span class="keyword">...</span>
0720   <span class="string">'string'</span>              , <span class="string">'Search Scope'</span>);
0721 
0722 uicontrol(                                                       <span class="keyword">...</span>
0723   <span class="string">'style'</span>               , <span class="string">'radiobutton'</span>,                         <span class="keyword">...</span>
0724   <span class="string">'tag'</span>                 , <span class="string">'H1Search'</span>,                            <span class="keyword">...</span>
0725   <span class="string">'position'</span>            , [25 fh-40 110 18],                     <span class="keyword">...</span>
0726   <span class="string">'string'</span>              , <span class="string">'H1 Line Only (F1)'</span>,                   <span class="keyword">...</span>
0727   <span class="string">'value'</span>               , true,                                  <span class="keyword">...</span>
0728   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub15" class="code" title="subfunction GUIradioButtonCallback(varargin)">GUIradioButtonCallback</a>,               <span class="keyword">...</span>
0729   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0730   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0731 
0732 uicontrol(                                                       <span class="keyword">...</span>
0733   <span class="string">'style'</span>               , <span class="string">'radiobutton'</span>,                         <span class="keyword">...</span>
0734   <span class="string">'tag'</span>                 , <span class="string">'FullSearch'</span>,                          <span class="keyword">...</span>
0735   <span class="string">'position'</span>            , [25 fh-60 110 18],                     <span class="keyword">...</span>
0736   <span class="string">'string'</span>              , <span class="string">'Full Help (F2)'</span>,                      <span class="keyword">...</span>
0737   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub15" class="code" title="subfunction GUIradioButtonCallback(varargin)">GUIradioButtonCallback</a>,               <span class="keyword">...</span>
0738   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0739   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0740 
0741 uicontrol(                                                       <span class="keyword">...</span>
0742   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0743   <span class="string">'tag'</span>                 , <span class="string">'SearchWordsCaption'</span>,                  <span class="keyword">...</span>
0744   <span class="string">'position'</span>            , [150 fh-50 80 15],                     <span class="keyword">...</span>
0745   <span class="string">'string'</span>              , <span class="string">'Search Words:'</span>,                       <span class="keyword">...</span>
0746   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0747   <span class="string">'horizontalalignment'</span> , <span class="string">'right'</span>);
0748 
0749 uicontrol(                                                       <span class="keyword">...</span>
0750   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0751   <span class="string">'tag'</span>                 , <span class="string">'SearchWords'</span>,                         <span class="keyword">...</span>
0752   <span class="string">'position'</span>            , [235 fh-65 fw-255 30],                 <span class="keyword">...</span>
0753   <span class="string">'string'</span>              , <span class="string">''</span>,                                    <span class="keyword">...</span>
0754   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0755   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0756 
0757 uicontrol(                                                       <span class="keyword">...</span>
0758   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0759   <span class="string">'tag'</span>                 , <span class="string">'SearchFoundCaption'</span>,                  <span class="keyword">...</span>
0760   <span class="string">'position'</span>            , [20 fh-102 fw-40 12],                  <span class="keyword">...</span>
0761   <span class="string">'string'</span>              , <span class="string">'Entries Found: 0'</span>,                    <span class="keyword">...</span>
0762   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0763   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0764 
0765 uicontrol(                                                       <span class="keyword">...</span>
0766   <span class="string">'style'</span>               , <span class="string">'listbox'</span>,                             <span class="keyword">...</span>
0767   <span class="string">'tag'</span>                 , <span class="string">'SearchResults'</span>,                       <span class="keyword">...</span>
0768   <span class="string">'position'</span>            , [20 fr-20 fw-40 fh-fr-82],             <span class="keyword">...</span>
0769   <span class="string">'backgroundcolor'</span>     , bgcolor2,                              <span class="keyword">...</span>
0770   <span class="string">'interruptible'</span>       , <span class="string">'off'</span>,                                 <span class="keyword">...</span>
0771   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0772   <span class="string">'fontsize'</span>            , 8,                                     <span class="keyword">...</span>
0773   <span class="string">'callback'</span>            , @<a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>,              <span class="keyword">...</span>
0774   <span class="string">'max'</span>                 , 1,                                     <span class="keyword">...</span>
0775   <span class="string">'min'</span>                 , 1,                                     <span class="keyword">...</span>
0776   <span class="string">'tooltipstring'</span>       , <span class="string">'Double-click to view file in Editor.'</span>);
0777 
0778 uicontrol(                                                       <span class="keyword">...</span>
0779   <span class="string">'style'</span>               , <span class="string">'Text'</span>,                                <span class="keyword">...</span>
0780   <span class="string">'tag'</span>                 , <span class="string">'HelpTextCaption'</span>,                     <span class="keyword">...</span>
0781   <span class="string">'position'</span>            , [20 fr-40 fw-40 12],                   <span class="keyword">...</span>
0782   <span class="string">'string'</span>              , <span class="string">'Full Help:'</span>,                          <span class="keyword">...</span>
0783   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>);
0784 
0785 uicontrol(                                                       <span class="keyword">...</span>
0786   <span class="string">'style'</span>               , <span class="string">'listbox'</span>,                             <span class="keyword">...</span>
0787   <span class="string">'tag'</span>                 , <span class="string">'HelpText'</span>,                            <span class="keyword">...</span>
0788   <span class="string">'position'</span>            , [20 20 fw-40 fr-60],                   <span class="keyword">...</span>
0789   <span class="string">'backgroundcolor'</span>     , bgcolor2,                              <span class="keyword">...</span>
0790   <span class="string">'buttondownfcn'</span>       , @<a href="#_sub7" class="code" title="subfunction activateKeyPressMode(varargin)">activateKeyPressMode</a>,                 <span class="keyword">...</span>
0791   <span class="string">'fontname'</span>            , <span class="string">'FixedWidth'</span>,                          <span class="keyword">...</span>
0792   <span class="string">'fontsize'</span>            , 8,                                     <span class="keyword">...</span>
0793   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>,                                <span class="keyword">...</span>
0794   <span class="string">'enable'</span>              , <span class="string">'inactive'</span>,                            <span class="keyword">...</span>
0795   <span class="string">'visible'</span>             , <span class="string">'on'</span>);
0796 
0797 uiCmenuH = uicontextmenu;
0798 uimenu(                                                          <span class="keyword">...</span>
0799   <span class="string">'parent'</span>              , uiCmenuH,                              <span class="keyword">...</span>
0800   <span class="string">'label'</span>               , <span class="string">'Change directory'</span>,                    <span class="keyword">...</span>
0801   <span class="string">'tag'</span>                 , <span class="string">'ChangeDirMenu'</span>,                       <span class="keyword">...</span>
0802   <span class="string">'callback'</span>            , @<a href="#_sub14" class="code" title="subfunction GUIuimenuCallback(varargin)">GUIuimenuCallback</a>);
0803 uimenu(                                                          <span class="keyword">...</span>
0804   <span class="string">'parent'</span>              , uiCmenuH,                              <span class="keyword">...</span>
0805   <span class="string">'label'</span>               , <span class="string">'Copy to Clipboard'</span>,                   <span class="keyword">...</span>
0806   <span class="string">'tag'</span>                 , <span class="string">'ClipboardMenu'</span>,                       <span class="keyword">...</span>
0807   <span class="string">'callback'</span>            , @<a href="#_sub14" class="code" title="subfunction GUIuimenuCallback(varargin)">GUIuimenuCallback</a>);
0808 
0809 uicontrol(                                                       <span class="keyword">...</span>
0810   <span class="string">'style'</span>               , <span class="string">'text'</span>,                                <span class="keyword">...</span>
0811   <span class="string">'tag'</span>                 , <span class="string">'FileLocation'</span>,                        <span class="keyword">...</span>
0812   <span class="string">'position'</span>            , [20 fh-90 fw-40 12],                   <span class="keyword">...</span>
0813   <span class="string">'string'</span>              , <span class="string">'File location:'</span>,                      <span class="keyword">...</span>
0814   <span class="string">'fontsize'</span>            , 8,                                     <span class="keyword">...</span>
0815   <span class="string">'horizontalalignment'</span> , <span class="string">'left'</span>,                                <span class="keyword">...</span>
0816   <span class="string">'foregroundcolor'</span>     , <span class="string">'blue'</span>,                                <span class="keyword">...</span>
0817   <span class="string">'uicontextmenu'</span>       , uiCmenuH,                              <span class="keyword">...</span>
0818   <span class="string">'tooltipstring'</span>       , sprintf(<span class="string">'%s\n%s'</span>,                      <span class="keyword">...</span>
0819                           <span class="string">'Right-click to change directory'</span>,     <span class="keyword">...</span>
0820                           <span class="string">'or copy file path to clipboard.'</span>));
0821 
0822 <span class="comment">% Get handles structure</span>
0823 handles          = guihandles(figH);
0824 handles.datFile  = datFile;
0825 handles.bgcolor1 = bgcolor1;
0826 handles.bgcolor2 = bgcolor2;
0827 handles.bgcolor3 = bgcolor3;
0828 handles.fgcolor1 = fgcolor1;
0829 handles.fgcolor2 = fgcolor2;
0830 
0831 pos = get(handles.SearchResults, <span class="string">'position'</span>);
0832 handles.numLines = round(pos(4) / <span class="keyword">...</span>
0833   (get(handles.SearchResults, <span class="string">'fontsize'</span>)+2));
0834 
0835 handles.endKeyTimer = timer(<span class="keyword">...</span>
0836   <span class="string">'name'</span>      , <span class="string">'look4Timer'</span>, <span class="keyword">...</span>
0837   <span class="string">'startdelay'</span>, 0.5, <span class="keyword">...</span>
0838   <span class="string">'tag'</span>       , <span class="string">'look4Timer'</span>);
0839 
0840 guidata(figH, handles);
0841 set(handles.endKeyTimer, <span class="keyword">...</span>
0842   <span class="string">'timerfcn'</span>, {@<a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>, handles}, <span class="keyword">...</span>
0843   <span class="string">'errorfcn'</span>, {@<a href="#_sub10" class="code" title="subfunction timerErrorFcn(varargin)">timerErrorFcn</a>, handles});
0844 set(figH, <span class="keyword">...</span>
0845   <span class="string">'keypressfcn'</span> , {@<a href="#_sub8" class="code" title="subfunction keyPressFcn(varargin)">keyPressFcn</a>, handles}, <span class="keyword">...</span>
0846   <span class="string">'userdata'</span>    , handles.endKeyTimer);
0847 
0848 <span class="comment">% Make GUI visible</span>
0849 set(figH, <span class="string">'visible'</span>, <span class="string">'on'</span>);
0850 
0851 <span class="comment">% Load datFile as PERSISTENT in look4Engine (if not already defined)</span>
0852 <span class="keyword">if</span> ~<a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>
0853   <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(datFile);
0854   <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>([]);
0855 <span class="keyword">end</span>
0856 
0857 
0858 <span class="comment">%--------------------------------------------------------------------------</span>
0859 <span class="comment">%--------------------------------------------------------------------------</span>
0860 <span class="comment">% clearSearchFieldFcn</span>
0861 <span class="comment">%    Clears the search field.</span>
0862 <span class="comment">%--------------------------------------------------------------------------</span>
0863 <span class="comment">%--------------------------------------------------------------------------</span>
0864 <a name="_sub6" href="#_subfunctions" class="code">function clearSearchFieldFcn(varargin)</a>
0865 
0866 obj     = varargin{1};
0867 handles = guidata(obj);
0868 
0869 set(handles.SearchField, <span class="string">'string'</span>, <span class="string">'_'</span>);
0870 <a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>([], [], handles);
0871 <a href="#_sub7" class="code" title="subfunction activateKeyPressMode(varargin)">activateKeyPressMode</a>(obj);
0872 
0873 
0874 <span class="comment">%--------------------------------------------------------------------------</span>
0875 <span class="comment">%--------------------------------------------------------------------------</span>
0876 <span class="comment">% activateKeyPressMode</span>
0877 <span class="comment">%    When clicked on the search field or help window, it changes the</span>
0878 <span class="comment">%    background color and adds '_' (if not already present) to indicate</span>
0879 <span class="comment">%    that key input is allowed.</span>
0880 <span class="comment">%--------------------------------------------------------------------------</span>
0881 <span class="comment">%--------------------------------------------------------------------------</span>
0882 <a name="_sub7" href="#_subfunctions" class="code">function activateKeyPressMode(varargin)</a>
0883 
0884 handles = guidata(varargin{1});
0885 
0886 str = get(handles.SearchField, <span class="string">'string'</span>);
0887 <span class="keyword">if</span> isempty(strmatch(<span class="string">'_'</span>, fliplr(str)))
0888   str = [str, <span class="string">'_'</span>];
0889 <span class="keyword">end</span>
0890 set(handles.SearchField, <span class="keyword">...</span>
0891   <span class="string">'string'</span>          , str, <span class="keyword">...</span>
0892   <span class="string">'backgroundcolor'</span> , handles.bgcolor3, <span class="keyword">...</span>
0893   <span class="string">'foregroundcolor'</span> , handles.fgcolor1);
0894 
0895 
0896 <span class="comment">%--------------------------------------------------------------------------</span>
0897 <span class="comment">%--------------------------------------------------------------------------</span>
0898 <span class="comment">% keyPressFcn</span>
0899 <span class="comment">%    Pressing alpha-numeric keys results in appending the character to the</span>
0900 <span class="comment">%    search text in the search field. &lt;ESC&gt; clears the search field. &lt;DEL&gt;</span>
0901 <span class="comment">%    &lt;BACKSPACE&gt; deletes previous character. Arrow keys navigates through</span>
0902 <span class="comment">%    search results, displaying the full text in the bottom field.</span>
0903 <span class="comment">%--------------------------------------------------------------------------</span>
0904 <span class="comment">%--------------------------------------------------------------------------</span>
0905 <a name="_sub8" href="#_subfunctions" class="code">function keyPressFcn(varargin)</a>
0906 
0907 obj = varargin{1};
0908 handles = varargin{3};
0909 stop(handles.endKeyTimer);
0910 
0911 k = get(obj, <span class="string">'currentkey'</span>);
0912 k_d = double(k);
0913 
0914 str = get(handles.SearchField, <span class="string">'string'</span>);
0915 <span class="keyword">if</span> isempty(strmatch(<span class="string">'_'</span>, fliplr(str)))
0916   str = [str, <span class="string">'_'</span>];
0917 <span class="keyword">end</span>
0918 set(handles.SearchField, <span class="keyword">...</span>
0919   <span class="string">'backgroundcolor'</span>, handles.bgcolor3, <span class="keyword">...</span>
0920   <span class="string">'foregroundcolor'</span>, handles.fgcolor1);
0921 
0922 <span class="keyword">if</span> length(k) == 1 &amp;&amp; ismember(k_d, [48:57, 97:122])
0923   str = [str(1:end-1), k, <span class="string">'_'</span>];
0924 <span class="keyword">else</span>
0925   <span class="keyword">switch</span> k
0926     <span class="keyword">case</span> <span class="string">'space'</span>
0927       str = [str(1:end-1), <span class="string">' _'</span>];
0928       
0929     <span class="keyword">case</span> <span class="string">'quote'</span>
0930       str = [str(1:end-1), <span class="string">'''_'</span>];
0931       
0932     <span class="keyword">case</span> {<span class="string">'delete'</span>, <span class="string">'backspace'</span>}
0933       <span class="keyword">if</span> ~strcmp(str, <span class="string">'_'</span>)
0934         str = [str(1:end-2), <span class="string">'_'</span>];
0935       <span class="keyword">end</span>
0936       
0937     <span class="keyword">case</span> <span class="string">'hyphen'</span>
0938       str = [str(1:end-1), <span class="string">'-_'</span>];
0939       
0940     <span class="keyword">case</span> <span class="string">'period'</span>
0941       str = [str(1:end-1), <span class="string">'._'</span>];
0942       
0943     <span class="keyword">case</span> <span class="string">'escape'</span>
0944       set(handles.SearchField, <span class="string">'string'</span>, <span class="string">'_'</span>);
0945       <a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>([], [], handles);
0946       <span class="keyword">return</span>;
0947       
0948     <span class="keyword">case</span> <span class="string">'uparrow'</span>
0949       <span class="keyword">if</span> <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>
0950         val = get(handles.SearchResults, <span class="string">'value'</span>);
0951         set(handles.SearchResults, <span class="string">'value'</span>, max([1, val-1]));
0952         set(handles.look4MainGUI, <span class="string">'selectiontype'</span>, <span class="string">'normal'</span>);
0953         <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(handles.SearchResults);
0954       <span class="keyword">end</span>
0955       <span class="keyword">return</span>;
0956     
0957     <span class="keyword">case</span> <span class="string">'downarrow'</span>
0958       ln = <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>;
0959       <span class="keyword">if</span> ln
0960         val = get(handles.SearchResults, <span class="string">'value'</span>);
0961         set(handles.SearchResults, <span class="string">'value'</span>, min([ln, val+1]));
0962         set(handles.look4MainGUI, <span class="string">'selectiontype'</span>, <span class="string">'normal'</span>);
0963         <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(handles.SearchResults);
0964       <span class="keyword">end</span>
0965       <span class="keyword">return</span>;
0966     
0967     <span class="keyword">case</span> <span class="string">'return'</span>
0968       set(handles.look4MainGUI, <span class="string">'selectiontype'</span>, <span class="string">'open'</span>);
0969       <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(handles.SearchResults);
0970       <span class="keyword">return</span>;
0971     
0972     <span class="keyword">case</span> <span class="string">'f1'</span>
0973       <a href="#_sub15" class="code" title="subfunction GUIradioButtonCallback(varargin)">GUIradioButtonCallback</a>(handles.H1Search);
0974       <span class="keyword">return</span>;
0975       
0976     <span class="keyword">case</span> <span class="string">'f2'</span>
0977       <a href="#_sub15" class="code" title="subfunction GUIradioButtonCallback(varargin)">GUIradioButtonCallback</a>(handles.FullSearch);
0978       <span class="keyword">return</span>;
0979       
0980     <span class="keyword">otherwise</span>
0981       <span class="keyword">return</span>;
0982   
0983   <span class="keyword">end</span>
0984 <span class="keyword">end</span>
0985 
0986 set(handles.SearchField, <span class="string">'string'</span>, str);
0987 
0988 start(handles.endKeyTimer);
0989 
0990 
0991 <span class="comment">%--------------------------------------------------------------------------</span>
0992 <span class="comment">%--------------------------------------------------------------------------</span>
0993 <span class="comment">% endKeyTimerFcn</span>
0994 <span class="comment">%    This function gets called a preset time (t sec) after a key stroke.</span>
0995 <span class="comment">%    It performs the search using the words in the search field. The timer</span>
0996 <span class="comment">%    is used to prevent searching after each key stroke. It would only get</span>
0997 <span class="comment">%    executed when there is a pause (t sec) in key inputs. Everytime a key</span>
0998 <span class="comment">%    is pressed, the timer is stopped. Only when t seconds have passed</span>
0999 <span class="comment">%    without key presses, does this function get executed.</span>
1000 <span class="comment">%--------------------------------------------------------------------------</span>
1001 <span class="comment">%--------------------------------------------------------------------------</span>
1002 <a name="_sub9" href="#_subfunctions" class="code">function endKeyTimerFcn(varargin)</a>
1003 
1004 handles = varargin{3};
1005 set(handles.FileLocation, <span class="string">'string'</span>, <span class="string">'Searching ...'</span>);
1006 drawnow;
1007 
1008 str = get(handles.SearchField, <span class="string">'string'</span>);
1009 <span class="keyword">if</span> ~isempty(str) &amp;&amp; strcmp(str(end), <span class="string">'_'</span>)
1010   str = str(1:end-1);
1011 <span class="keyword">end</span>
1012 
1013 <span class="comment">% initialize</span>
1014 words = {};
1015 dat = cell(0, 2);
1016 idx = [];
1017 
1018 <span class="keyword">if</span> ~isempty(str)
1019   
1020   <span class="keyword">try</span>
1021     words=<a href="#_sub11" class="code" title="subfunction words=parseWords(blah)">parseWords</a>(deblank(str));
1022   <span class="keyword">catch</span>
1023     <span class="comment">% possibly a mis-matching quotes. In that case, append a quote at the</span>
1024     <span class="comment">% end</span>
1025     words=<a href="#_sub11" class="code" title="subfunction words=parseWords(blah)">parseWords</a>([deblank(str) <span class="string">''''</span>]);
1026   <span class="keyword">end</span>
1027   
1028   <span class="keyword">if</span> ~isempty(words)
1029     <span class="comment">% perform appropriate search based on search type</span>
1030     <span class="keyword">if</span> get(handles.H1Search, <span class="string">'value'</span>)
1031       [dat, idx] = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(handles.datFile, 2, words{:});
1032     <span class="keyword">else</span>
1033       [dat, idx] = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(handles.datFile, 3, words{:});
1034     <span class="keyword">end</span>
1035 
1036   <span class="keyword">end</span>
1037 <span class="keyword">end</span>
1038 
1039 <span class="comment">% update the indices</span>
1040 <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(idx);
1041 
1042 <span class="keyword">if</span> isempty(dat)
1043   set(handles.SearchResults , <span class="string">'string'</span>, <span class="string">''</span>, <span class="keyword">...</span>
1044                               <span class="string">'value'</span> , 0);
1045   set(handles.FileLocation  , <span class="string">'string'</span>, <span class="string">'File location:'</span>);
1046   set(handles.HelpText      , <span class="string">'string'</span>, <span class="string">''</span>);
1047 
1048   <span class="keyword">if</span> isempty(words)
1049     set(handles.SearchWords       , <span class="string">'string'</span>, <span class="string">''</span>);
1050     set(handles.SearchFoundCaption, <span class="string">'string'</span>, <span class="string">'Entries Found: 0'</span>);
1051   <span class="keyword">else</span>
1052     searchwords = sprintf(<span class="string">'[%s], '</span>, words{:});
1053     set(handles.SearchWords, <span class="keyword">...</span>
1054       <span class="string">'string'</span>, sprintf(<span class="string">'%s'</span>, searchwords(1:end-2)));
1055     set(handles.SearchFoundCaption, <span class="keyword">...</span>
1056       <span class="string">'string'</span>, <span class="string">'Entries Found: 0'</span>);
1057   <span class="keyword">end</span>
1058 <span class="keyword">else</span>
1059   <span class="keyword">if</span> size(dat, 1) &gt; handles.numLines
1060     set(handles.SearchResults, <span class="keyword">...</span>
1061       <span class="string">'string'</span>, [dat(1:handles.numLines-1, 2); {<span class="string">'&lt;show all...&gt;'</span>}], <span class="keyword">...</span>
1062       <span class="string">'value'</span> , 1);
1063   <span class="keyword">else</span>
1064     set(handles.SearchResults, <span class="keyword">...</span>
1065       <span class="string">'string'</span>, dat(:, 2), <span class="keyword">...</span>
1066       <span class="string">'value'</span> , 1);
1067   <span class="keyword">end</span>
1068   
1069   searchwords = sprintf(<span class="string">'[%s], '</span>, words{:});
1070   set(handles.SearchWords, <span class="keyword">...</span>
1071     <span class="string">'string'</span>, sprintf(<span class="string">'%s'</span>, searchwords(1:end-2)));
1072   set(handles.SearchFoundCaption, <span class="keyword">...</span>
1073     <span class="string">'string'</span>, sprintf(<span class="string">'Entries Found: %d'</span>, size(dat, 1)));
1074   
1075   set(handles.look4MainGUI, <span class="string">'SelectionType'</span>, <span class="string">'normal'</span>);
1076   <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>(handles.SearchResults);
1077 <span class="keyword">end</span>
1078 
1079 
1080 <span class="comment">%--------------------------------------------------------------------------</span>
1081 <span class="comment">%--------------------------------------------------------------------------</span>
1082 <span class="comment">% timerErrorFcn</span>
1083 <span class="comment">%    This is called when an error occurs during timer fcn calls. It resets</span>
1084 <span class="comment">%    all properties.</span>
1085 <span class="comment">%--------------------------------------------------------------------------</span>
1086 <span class="comment">%--------------------------------------------------------------------------</span>
1087 <a name="_sub10" href="#_subfunctions" class="code">function timerErrorFcn(varargin)</a>
1088 
1089 handles = varargin{3};
1090 errordlg(sprintf(<span class="string">'Sorry, an internal error occurred.\nResetting GUI...'</span>), <span class="keyword">...</span>
1091   <span class="string">'error'</span>, <span class="string">'modal'</span>);
1092 
1093 set(handles.SearchField, <span class="keyword">...</span>
1094   <span class="string">'string'</span>          , <span class="string">'_'</span>, <span class="keyword">...</span>
1095   <span class="string">'backgroundcolor'</span> , handles.bgcolor3, <span class="keyword">...</span>
1096   <span class="string">'foregroundcolor'</span> , handles.fgcolor1);
1097 set(handles.SearchResults     , <span class="string">'string'</span>, <span class="string">''</span>, <span class="keyword">...</span>
1098                                 <span class="string">'value'</span> , 0);
1099 set(handles.FileLocation      , <span class="string">'string'</span>, <span class="string">'File location:'</span>);
1100 set(handles.HelpText          , <span class="string">'string'</span>, <span class="string">''</span>);
1101 set(handles.SearchWords       , <span class="string">'string'</span>, <span class="string">''</span>);
1102 set(handles.SearchFoundCaption, <span class="string">'string'</span>, <span class="string">'Entries Found: 0'</span>);
1103 <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(handles.datFile);
1104 <a href="#_sub13" class="code" title="subfunction ln = GUIsearchResultCallback(varargin)">GUIsearchResultCallback</a>([]);
1105 
1106 
1107 <span class="comment">%--------------------------------------------------------------------------</span>
1108 <span class="comment">%--------------------------------------------------------------------------</span>
1109 <span class="comment">% parseWords</span>
1110 <span class="comment">%    This parses a string into words. It calls parseWords_Int.</span>
1111 <span class="comment">%--------------------------------------------------------------------------</span>
1112 <span class="comment">%--------------------------------------------------------------------------</span>
1113 <a name="_sub11" href="#_subfunctions" class="code">function words=parseWords(blah)</a>
1114 
1115 eval(sprintf(<span class="string">'parseWords_Int %s;'</span>, blah));
1116 <span class="comment">% the above line will create 'ans'</span>
1117 words = ans;
1118 
1119 <span class="comment">% delete empty words</span>
1120 words(cellfun(<span class="string">'isempty'</span>, words)) = <span class="string">''</span>;
1121 
1122 <span class="keyword">if</span> length(words) == 1 &amp;&amp; isempty(words{1})
1123   words = {};
1124 <span class="keyword">end</span>
1125 
1126 
1127 <span class="comment">%--------------------------------------------------------------------------</span>
1128 <span class="comment">%--------------------------------------------------------------------------</span>
1129 <span class="comment">% parseWords_Int</span>
1130 <span class="comment">%    This is a dummy function that just converts multiple string inputs</span>
1131 <span class="comment">%    into cell array of words.</span>
1132 <span class="comment">%--------------------------------------------------------------------------</span>
1133 <span class="comment">%--------------------------------------------------------------------------</span>
1134 <a name="_sub12" href="#_subfunctions" class="code">function varargin = parseWords_Int(varargin)</a>
1135 
1136 
1137 <span class="comment">%--------------------------------------------------------------------------</span>
1138 <span class="comment">%--------------------------------------------------------------------------</span>
1139 <span class="comment">% GUIsearchResultCallback</span>
1140 <span class="comment">%    This function is called when an entry in the results listbox is</span>
1141 <span class="comment">%    clicked. It recalls the full help text (from the database) and</span>
1142 <span class="comment">%    displays it in the help window (bottom). If double-clicked, it will</span>
1143 <span class="comment">%    open the file in the editor.</span>
1144 <span class="comment">%--------------------------------------------------------------------------</span>
1145 <span class="comment">%--------------------------------------------------------------------------</span>
1146 <a name="_sub13" href="#_subfunctions" class="code">function ln = GUIsearchResultCallback(varargin)</a>
1147 
1148 <span class="keyword">persistent</span> idx tmp
1149 
1150 <span class="keyword">if</span> nargin == 0
1151   ln = length(idx);
1152   <span class="keyword">return</span>;
1153   
1154 <span class="keyword">elseif</span> nargin == 1
1155   obj = varargin{1};
1156   <span class="keyword">if</span> isempty(obj) || length(obj) &gt; 1
1157     idx = obj;
1158     tmp = true;
1159     <span class="keyword">return</span>;
1160 
1161   <span class="keyword">elseif</span> ~ishandle(obj)
1162     idx = obj;
1163     tmp = true;
1164     <span class="keyword">return</span>;
1165   
1166   <span class="keyword">end</span>
1167 
1168   handles = guidata(obj);
1169   
1170 <span class="keyword">else</span> <span class="comment">% nargin==2 (listbox callback)</span>
1171   obj     = varargin{1};
1172   handles = guidata(obj);
1173   sf      = get(handles.SearchField, <span class="string">'string'</span>);
1174   <span class="keyword">if</span> isempty(sf)
1175     sf    = <span class="string">'_'</span>;
1176   <span class="keyword">elseif</span> ~strcmp(sf(end), <span class="string">'_'</span>)
1177     sf    = [sf, <span class="string">'_'</span>];
1178   <span class="keyword">end</span>
1179   set(handles.SearchField, <span class="keyword">...</span>
1180     <span class="string">'string'</span>          , sf(1:end-1), <span class="keyword">...</span>
1181     <span class="string">'backgroundcolor'</span> , handles.bgcolor1, <span class="keyword">...</span>
1182     <span class="string">'foregroundcolor'</span> , handles.fgcolor2);
1183   
1184   <span class="keyword">if</span> isempty(tmp) <span class="comment">% persistent not defined</span>
1185     
1186     set(handles.SearchField, <span class="string">'string'</span>, sf);
1187     <span class="keyword">try</span>
1188       <a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>([], [], handles);
1189     <span class="keyword">catch</span>
1190       <a href="#_sub10" class="code" title="subfunction timerErrorFcn(varargin)">timerErrorFcn</a>([], [], handles);
1191     <span class="keyword">end</span>
1192     set(handles.SearchField, <span class="string">'string'</span>, sf(1:end-1));
1193     
1194   <span class="keyword">end</span>
1195   
1196 <span class="keyword">end</span>
1197 
1198 str = get(obj, <span class="string">'string'</span>);
1199 <span class="keyword">if</span> ~isempty(str)
1200   <span class="keyword">if</span> ischar(str)
1201     str = {str};
1202   <span class="keyword">end</span>
1203   val = get(obj, <span class="string">'value'</span>);
1204   <span class="keyword">if</span> strcmp(str{val}, <span class="string">'&lt;show all...&gt;'</span>)
1205     dat = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(idx);
1206     set(obj, <span class="string">'string'</span>, dat(:,2));
1207   <span class="keyword">end</span>
1208   dat = <a href="#_sub4" class="code" title="subfunction [datout, ids] = look4Engine(datFile, searchType, varargin)">look4Engine</a>(idx(val));
1209   
1210   <span class="keyword">switch</span> get(handles.look4MainGUI, <span class="string">'selectiontype'</span>)
1211     
1212     <span class="keyword">case</span> <span class="string">'normal'</span> <span class="comment">% Single-click</span>
1213       <span class="comment">% Get help text</span>
1214       tmp = dat{3};
1215       <span class="keyword">if</span> ~isempty(tmp)
1216         <span class="comment">% Convert to | delimited string</span>
1217         tmp = strrep(tmp, sprintf(<span class="string">'\n'</span>), <span class="string">'|'</span>);
1218       <span class="keyword">end</span>
1219       set(handles.HelpText, <span class="keyword">...</span>
1220         <span class="string">'string'</span>, tmp, <span class="keyword">...</span>
1221         <span class="string">'value'</span> , 1);
1222       set(handles.FileLocation, <span class="keyword">...</span>
1223         <span class="string">'string'</span>, sprintf(<span class="string">'File location: %s'</span>, dat{1}));
1224       
1225     <span class="keyword">case</span> <span class="string">'open'</span>   <span class="comment">% Double-click</span>
1226       <span class="keyword">try</span>
1227         open(dat{1});
1228       <span class="keyword">catch</span>
1229         errordlg(<span class="string">'Error opening file.'</span>);
1230       <span class="keyword">end</span>
1231       
1232   <span class="keyword">end</span>
1233 <span class="keyword">end</span>
1234 
1235 
1236 <span class="comment">%--------------------------------------------------------------------------</span>
1237 <span class="comment">%--------------------------------------------------------------------------</span>
1238 <span class="comment">% GUIuimenuCallback</span>
1239 <span class="comment">%    This is the callback for UI context menu.</span>
1240 <span class="comment">%--------------------------------------------------------------------------</span>
1241 <span class="comment">%--------------------------------------------------------------------------</span>
1242 <a name="_sub14" href="#_subfunctions" class="code">function GUIuimenuCallback(varargin)</a>
1243 
1244 obj     = varargin{1};
1245 handles = guidata(obj);
1246 
1247 str = get(handles.FileLocation, <span class="string">'string'</span>);
1248 <span class="keyword">if</span> strcmp(str, <span class="string">'File location:'</span>)
1249   str = <span class="string">''</span>;
1250 <span class="keyword">else</span>
1251   str = str(16:end);
1252 <span class="keyword">end</span>
1253 <span class="keyword">if</span> ~isempty(str)
1254   <span class="keyword">switch</span> get(obj, <span class="string">'tag'</span>)
1255     <span class="keyword">case</span> <span class="string">'ChangeDirMenu'</span>
1256       pathname = fileparts(str);
1257       cd(pathname);
1258     
1259     <span class="keyword">case</span> <span class="string">'ClipboardMenu'</span>
1260       clipboard(<span class="string">'copy'</span>, str);
1261   <span class="keyword">end</span>
1262 <span class="keyword">end</span>
1263 
1264 
1265 <span class="comment">%--------------------------------------------------------------------------</span>
1266 <span class="comment">%--------------------------------------------------------------------------</span>
1267 <span class="comment">% GUIradioButtonCallback</span>
1268 <span class="comment">%    This is the callback for the search scope radio buttons</span>
1269 <span class="comment">%--------------------------------------------------------------------------</span>
1270 <span class="comment">%--------------------------------------------------------------------------</span>
1271 <a name="_sub15" href="#_subfunctions" class="code">function GUIradioButtonCallback(varargin)</a>
1272 
1273 obj     = varargin{1};
1274 handles = guidata(obj);
1275 
1276 <span class="keyword">if</span> ~get(obj, <span class="string">'value'</span>)
1277 
1278   set([handles.FullSearch, handles.H1Search], <span class="string">'value'</span>, false);
1279   set(obj, <span class="string">'value'</span>, true);
1280 
1281   <span class="comment">% Perform new search</span>
1282   <span class="keyword">try</span>
1283     <a href="#_sub9" class="code" title="subfunction endKeyTimerFcn(varargin)">endKeyTimerFcn</a>(handles.SearchField, [], handles);
1284   <span class="keyword">catch</span>
1285     <a href="#_sub10" class="code" title="subfunction timerErrorFcn(varargin)">timerErrorFcn</a>([], [], handles);
1286   <span class="keyword">end</span>
1287 
1288 <span class="keyword">end</span>
1289 
1290 <span class="comment">% make sure key press mode is active</span>
1291 <a href="#_sub7" class="code" title="subfunction activateKeyPressMode(varargin)">activateKeyPressMode</a>(obj);
1292 
1293 
1294 <span class="comment">%--------------------------------------------------------------------------</span>
1295 <span class="comment">%--------------------------------------------------------------------------</span>
1296 <span class="comment">% setupAutoUpdate</span>
1297 <span class="comment">%--------------------------------------------------------------------------</span>
1298 <span class="comment">%--------------------------------------------------------------------------</span>
1299 <a name="_sub16" href="#_subfunctions" class="code">function setupAutoUpdate</a>
1300 
1301 un = get(0, <span class="string">'units'</span>);
1302 set(0, <span class="string">'units'</span>, <span class="string">'pixels'</span>);
1303 screenSize = get(0, <span class="string">'ScreenSize'</span>);
1304 set(0, <span class="string">'units'</span>, un);
1305 wd = 300;
1306 ht = 160;
1307 
1308 bgcolor1 = [.7, .7, .7];
1309 bgcolor2 = [ 1,  1,  1];
1310 bgcolor3 = [.9, .9, .9];
1311 bgcolor4 = [ 1, .5, .5];
1312 bgcolor5 = [.4, .4,  1];
1313 
1314 fH = figure(<span class="keyword">...</span>
1315   <span class="string">'integerHandle'</span>                   , <span class="string">'off'</span>, <span class="keyword">...</span>
1316   <span class="string">'name'</span>                            , <span class="string">'Auto Update'</span>, <span class="keyword">...</span>
1317   <span class="string">'numbertitle'</span>                     , <span class="string">'off'</span>, <span class="keyword">...</span>
1318   <span class="string">'menubar'</span>                         , <span class="string">'none'</span>, <span class="keyword">...</span>
1319   <span class="string">'units'</span>                           , <span class="string">'pixels'</span>, <span class="keyword">...</span>
1320   <span class="string">'position'</span>                        , [round((screenSize(3)-wd)/2), <span class="keyword">...</span>
1321                                        round((screenSize(4)-ht)/2), <span class="keyword">...</span>
1322                                        wd, ht], <span class="keyword">...</span>
1323   <span class="string">'color'</span>                           , bgcolor1, <span class="keyword">...</span>
1324   <span class="string">'resize'</span>                          , <span class="string">'off'</span>, <span class="keyword">...</span>
1325   <span class="string">'windowstyle'</span>                     , <span class="string">'modal'</span>, <span class="keyword">...</span>
1326   <span class="string">'tag'</span>                             , <span class="string">'autoUpdateMain'</span>, <span class="keyword">...</span>
1327   <span class="string">'defaultaxesunits'</span>                , <span class="string">'pixels'</span>, <span class="keyword">...</span>
1328   <span class="string">'defaultuicontrolbackgroundcolor'</span> , bgcolor3, <span class="keyword">...</span>
1329   <span class="string">'defaultuicontrolunits'</span>           , <span class="string">'pixels'</span>, <span class="keyword">...</span>
1330   <span class="string">'defaultuicontrolfontname'</span>        , <span class="string">'verdana'</span>, <span class="keyword">...</span>
1331   <span class="string">'defaultuicontrolfontsize'</span>        , 8, <span class="keyword">...</span>
1332   <span class="string">'defaultuicontrolfontweight'</span>      , <span class="string">'normal'</span>);
1333 
1334 uicontrol(<span class="keyword">...</span>
1335   <span class="string">'style'</span>              , <span class="string">'text'</span>, <span class="keyword">...</span>
1336   <span class="string">'backgroundcolor'</span>    , bgcolor1, <span class="keyword">...</span>
1337   <span class="string">'position'</span>           , [5, ht-25, wd-5, 20], <span class="keyword">...</span>
1338   <span class="string">'string'</span>             , <span class="string">'Specify database update interval:'</span>, <span class="keyword">...</span>
1339   <span class="string">'horizontalalignment'</span>, <span class="string">'left'</span>);
1340 
1341 uicontrol(<span class="keyword">...</span>
1342   <span class="string">'style'</span>              , <span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1343   <span class="string">'position'</span>           , [105, ht-50, 84, 22], <span class="keyword">...</span>
1344   <span class="string">'string'</span>             , <span class="string">'Weekly'</span>, <span class="keyword">...</span>
1345   <span class="string">'fontweight'</span>         , <span class="string">'bold'</span>, <span class="keyword">...</span>
1346   <span class="string">'enable'</span>             , <span class="string">'inactive'</span>, <span class="keyword">...</span>
1347   <span class="string">'buttondownfcn'</span>      , {@<a href="#_sub18" class="code" title="subfunction autoUpdateBtnCallback(varargin)">autoUpdateBtnCallback</a>, 2}, <span class="keyword">...</span>
1348   <span class="string">'tag'</span>                , <span class="string">'wkT'</span>);
1349 uicontrol(<span class="keyword">...</span>
1350   <span class="string">'style'</span>              , <span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1351   <span class="string">'position'</span>           , [20, ht-47, 84, 19], <span class="keyword">...</span>
1352   <span class="string">'string'</span>             , <span class="string">'Daily'</span>, <span class="keyword">...</span>
1353   <span class="string">'enable'</span>             , <span class="string">'inactive'</span>, <span class="keyword">...</span>
1354   <span class="string">'buttondownfcn'</span>      , {@<a href="#_sub18" class="code" title="subfunction autoUpdateBtnCallback(varargin)">autoUpdateBtnCallback</a>, 1}, <span class="keyword">...</span>
1355   <span class="string">'tag'</span>                , <span class="string">'daT'</span>);
1356 
1357 uicontrol(<span class="keyword">...</span>
1358   <span class="string">'style'</span>              , <span class="string">'frame'</span>, <span class="keyword">...</span>
1359   <span class="string">'enable'</span>             , <span class="string">'inactive'</span>, <span class="keyword">...</span>
1360   <span class="string">'backgroundcolor'</span>    , bgcolor3, <span class="keyword">...</span>
1361   <span class="string">'foregroundcolor'</span>    , bgcolor3, <span class="keyword">...</span>
1362   <span class="string">'position'</span>           , [5, ht-125, wd-10, 77], <span class="keyword">...</span>
1363   <span class="string">'tag'</span>                , <span class="string">'panel1'</span>);
1364 
1365 uicontrol(<span class="keyword">...</span>
1366   <span class="string">'style'</span>              , <span class="string">'text'</span>, <span class="keyword">...</span>
1367   <span class="string">'backgroundcolor'</span>    , bgcolor3, <span class="keyword">...</span>
1368   <span class="string">'position'</span>           , [10, ht-75, 140, 15], <span class="keyword">...</span>
1369   <span class="string">'string'</span>             , <span class="string">'What time? (HH:MM)  '</span>, <span class="keyword">...</span>
1370   <span class="string">'horizontalalignment'</span>, <span class="string">'right'</span>, <span class="keyword">...</span>
1371   <span class="string">'tag'</span>                , <span class="string">'DailyQuestionCaption'</span>);
1372 uicontrol(<span class="keyword">...</span>
1373   <span class="string">'style'</span>              , <span class="string">'edit'</span>, <span class="keyword">...</span>
1374   <span class="string">'position'</span>           , [150, ht-75, wd-160, 20], <span class="keyword">...</span>
1375   <span class="string">'backgroundcolor'</span>    , bgcolor4, <span class="keyword">...</span>
1376   <span class="string">'horizontalalignment'</span>, <span class="string">'left'</span>, <span class="keyword">...</span>
1377   <span class="string">'callback'</span>           , @<a href="#_sub19" class="code" title="subfunction autoUpdateEditCallback(varargin)">autoUpdateEditCallback</a>, <span class="keyword">...</span>
1378   <span class="string">'tag'</span>                , <span class="string">'DailyUpdateTimeEdit'</span>);
1379 
1380 uicontrol(<span class="keyword">...</span>
1381   <span class="string">'style'</span>              , <span class="string">'text'</span>, <span class="keyword">...</span>
1382   <span class="string">'backgroundcolor'</span>    , bgcolor3, <span class="keyword">...</span>
1383   <span class="string">'position'</span>           , [10, ht-100, wd-20, 15], <span class="keyword">...</span>
1384   <span class="string">'string'</span>             , <span class="string">'Which day of the week?'</span>, <span class="keyword">...</span>
1385   <span class="string">'horizontalalignment'</span>, <span class="string">'left'</span>, <span class="keyword">...</span>
1386   <span class="string">'visible'</span>            , <span class="string">'on'</span>, <span class="keyword">...</span>
1387   <span class="string">'tag'</span>                , <span class="string">'WeeklyQuestionCaption'</span>);
1388 
1389 days = {<span class="string">'Sun'</span>, <span class="string">'Mon'</span>, <span class="string">'Tue'</span>, <span class="string">'Wed'</span>, <span class="string">'Thu'</span>, <span class="string">'Fri'</span>, <span class="string">'Sat'</span>};
1390 btnW = round((280-2*6)/7);
1391 <span class="keyword">for</span> id = 1:7
1392   uicontrol(<span class="keyword">...</span>
1393     <span class="string">'style'</span>            , <span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1394     <span class="string">'position'</span>         , [10+(id-1)*(btnW+2), ht-120, btnW, 20], <span class="keyword">...</span>
1395     <span class="string">'string'</span>           , days{id}, <span class="keyword">...</span>
1396     <span class="string">'enable'</span>           , <span class="string">'inactive'</span>, <span class="keyword">...</span>
1397     <span class="string">'backgroundcolor'</span>  , bgcolor4, <span class="keyword">...</span>
1398     <span class="string">'buttondownfcn'</span>    , {@<a href="#_sub18" class="code" title="subfunction autoUpdateBtnCallback(varargin)">autoUpdateBtnCallback</a>, 3}, <span class="keyword">...</span>
1399     <span class="string">'tag'</span>              , <span class="string">'dayBtns'</span>);
1400 <span class="keyword">end</span>
1401 
1402 callbackOpt = [4, 5, 0];
1403 stringVals  = {<span class="string">'OK'</span>, <span class="string">'No Update'</span>, <span class="string">'Cancel'</span>};
1404 tagNames    = {<span class="string">'OKBtn'</span>, <span class="string">'NoUpdateBtn'</span>, <span class="string">'CancelBtn'</span>};
1405 btnW        = round((280-5*2)/3);
1406 <span class="keyword">for</span> id = 1:3
1407 uicontrol(<span class="keyword">...</span>
1408   <span class="string">'style'</span>              , <span class="string">'pushbutton'</span>, <span class="keyword">...</span>
1409   <span class="string">'position'</span>           , [10+(id-1)*(btnW+5), ht-150, btnW, 20], <span class="keyword">...</span>
1410   <span class="string">'string'</span>             , stringVals{id}, <span class="keyword">...</span>
1411   <span class="string">'backgroundcolor'</span>    , bgcolor1, <span class="keyword">...</span>
1412   <span class="string">'callback'</span>           , {@<a href="#_sub18" class="code" title="subfunction autoUpdateBtnCallback(varargin)">autoUpdateBtnCallback</a>, callbackOpt(id)}, <span class="keyword">...</span>
1413   <span class="string">'tag'</span>                , tagNames{id});
1414 <span class="keyword">end</span>
1415 
1416 handles             = guihandles(fH);
1417 handles.result.type = <span class="string">'weekly'</span>;
1418 handles.result.val  = {[], <span class="string">''</span>};
1419 handles.bgcolor1    = bgcolor1;
1420 handles.bgcolor2    = bgcolor2;
1421 handles.bgcolor3    = bgcolor3;
1422 handles.bgcolor4    = bgcolor4;
1423 handles.bgcolor5    = bgcolor5;
1424 
1425 <span class="keyword">if</span> exist(<span class="string">'startup.m'</span>, <span class="string">'file'</span>)
1426   fname   = which(<span class="string">'startup.m'</span>);
1427   result  = <a href="#_sub17" class="code" title="subfunction out = modifyStartupFile(fname, result, opt)">modifyStartupFile</a>(fname, [], <span class="string">'retrieve'</span>);
1428   <span class="keyword">if</span> ~isempty(result)
1429     <span class="keyword">switch</span> result.type
1430       <span class="keyword">case</span> <span class="string">'daily'</span>
1431         set(handles.panel1  , <span class="string">'position'</span>, [5, 80, 290, 32]);
1432         
1433         set([handles.wkT, handles.daT], <span class="keyword">...</span>
1434           {<span class="string">'fontweight'</span>, <span class="string">'position'</span>}, <span class="keyword">...</span>
1435           {<span class="string">'normal'</span>, [105, 113, 84, 19]; <span class="keyword">...</span>
1436             <span class="string">'bold'</span>, [20, 110, 84, 22]});
1437         set(handles.WeeklyQuestionCaption, <span class="keyword">...</span>
1438           <span class="string">'visible'</span>         , <span class="string">'off'</span>);
1439         set(handles.dayBtns, <span class="keyword">...</span>
1440           <span class="string">'visible'</span>         , <span class="string">'off'</span>);
1441         set(handles.DailyUpdateTimeEdit, <span class="keyword">...</span>
1442           <span class="string">'visible'</span>         , <span class="string">'on'</span>, <span class="keyword">...</span>
1443           <span class="string">'string'</span>          , sprintf(<span class="string">'%d:%02d'</span>, result.val{1}), <span class="keyword">...</span>
1444           <span class="string">'backgroundcolor'</span> , bgcolor2);
1445         
1446       <span class="keyword">case</span> <span class="string">'weekly'</span>
1447         set(handles.panel1  , <span class="string">'position'</span>, [5, 35, 290, 77]);
1448 
1449         set([handles.wkT, handles.daT], <span class="keyword">...</span>
1450           {<span class="string">'fontweight'</span>, <span class="string">'position'</span>}, <span class="keyword">...</span>
1451           {<span class="string">'bold'</span>, [105, 110, 84, 22]; <span class="keyword">...</span>
1452             <span class="string">'normal'</span>, [20, 113, 84, 19]});
1453         set(handles.DailyUpdateTimeEdit, <span class="keyword">...</span>
1454           <span class="string">'visible'</span>         , <span class="string">'on'</span>, <span class="keyword">...</span>
1455           <span class="string">'string'</span>          , sprintf(<span class="string">'%d:%02d'</span>, result.val{1}), <span class="keyword">...</span>
1456           <span class="string">'backgroundcolor'</span> , bgcolor2);
1457         set(handles.dayBtns, <span class="keyword">...</span>
1458           <span class="string">'visible'</span>         , <span class="string">'on'</span>, <span class="keyword">...</span>
1459           <span class="string">'backgroundcolor'</span> , bgcolor1);
1460         set(handles.WeeklyQuestionCaption, <span class="keyword">...</span>
1461           <span class="string">'visible'</span>         , <span class="string">'on'</span>);
1462         set(findobj(handles.dayBtns, <span class="string">'string'</span>, result.val{2}), <span class="keyword">...</span>
1463           <span class="string">'fontweight'</span>      , <span class="string">'bold'</span>);
1464         
1465     <span class="keyword">end</span>
1466     
1467     handles.result = result;
1468     
1469   <span class="keyword">end</span>
1470 <span class="keyword">end</span>
1471 
1472 guidata(fH, handles);
1473 setappdata(0, <span class="string">'look4_autoUpdateResults'</span>, []);
1474 
1475 <span class="comment">% wait until the dialog box is closed</span>
1476 waitfor(fH);
1477 
1478 result = getappdata(0, <span class="string">'look4_autoUpdateResults'</span>);
1479 rmappdata(0, <span class="string">'look4_autoUpdateResults'</span>);
1480 
1481 <span class="keyword">if</span> isempty(result)
1482   <span class="keyword">return</span>;
1483 <span class="keyword">else</span>
1484   <span class="keyword">if</span> exist(<span class="string">'startup.m'</span>, <span class="string">'file'</span>)
1485     fname = which(<span class="string">'startup.m'</span>);
1486     <a href="#_sub17" class="code" title="subfunction out = modifyStartupFile(fname, result, opt)">modifyStartupFile</a>(fname, result, <span class="string">'modify'</span>);
1487   <span class="keyword">else</span>
1488     <span class="keyword">if</span> strcmp(result.type, <span class="string">'reset'</span>)
1489       <span class="keyword">return</span>;
1490     <span class="keyword">else</span>
1491       p = lower(strread(path, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, pathsep));
1492       [sel, ok] = listdlg(<span class="keyword">...</span>
1493         <span class="string">'promptstring'</span>  , {<span class="string">'STARTUP.m does not exist.'</span>, <span class="keyword">...</span>
1494                            <span class="string">'Select a directory to create STARTUP.m'</span>}, <span class="keyword">...</span>
1495         <span class="string">'selectionmode'</span> , <span class="string">'single'</span>, <span class="keyword">...</span>
1496         <span class="string">'listsize'</span>      , [500 500], <span class="keyword">...</span>
1497         <span class="string">'liststring'</span>    , p);
1498       <span class="keyword">if</span> isequal(ok, 0)
1499         errordlg(<span class="string">'Canceled...'</span>);
1500         <span class="keyword">return</span>;
1501       <span class="keyword">else</span>
1502         fname = fullfile(p{sel}, <span class="string">'startup.m'</span>);
1503       <span class="keyword">end</span>
1504     <span class="keyword">end</span>
1505     <a href="#_sub17" class="code" title="subfunction out = modifyStartupFile(fname, result, opt)">modifyStartupFile</a>(fname, result, <span class="string">'new'</span>);
1506   <span class="keyword">end</span>
1507 <span class="keyword">end</span>
1508 
1509 
1510 <span class="comment">%--------------------------------------------------------------------------</span>
1511 <span class="comment">%--------------------------------------------------------------------------</span>
1512 <span class="comment">% modifyStartupFile</span>
1513 <span class="comment">%    This function creates the startup file. If one already exists, it</span>
1514 <span class="comment">%    modifies it. If it doesn't, it creates one.</span>
1515 <span class="comment">%--------------------------------------------------------------------------</span>
1516 <span class="comment">%--------------------------------------------------------------------------</span>
1517 <a name="_sub17" href="#_subfunctions" class="code">function out = modifyStartupFile(fname, result, opt)</a>
1518 
1519 <span class="keyword">switch</span> opt
1520   <span class="keyword">case</span> <span class="string">'new'</span>
1521     str = {};
1522     
1523   <span class="keyword">case</span> <span class="string">'modify'</span>
1524     str = textread(fname, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, <span class="string">'\n'</span>);
1525     [p, n] = fileparts(fname);
1526     copyfile(fname, fullfile(p, [n <span class="string">'_backup.m'</span>]));
1527     
1528   <span class="keyword">case</span> <span class="string">'retrieve'</span>
1529     str = textread(fname, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, <span class="string">'\n'</span>);
1530     id = strmatch(sprintf(<span class="string">'%s_autoUpdateFcn;'</span>, mfilename), str, <span class="string">'exact'</span>);
1531     <span class="keyword">if</span> isempty(id)
1532       out = [];
1533     <span class="keyword">else</span>
1534       update_fname = fullfile(fileparts(fname), <span class="keyword">...</span>
1535         sprintf(<span class="string">'%s_autoUpdateFcn.m'</span>, mfilename));
1536       <span class="keyword">if</span> exist(update_fname, <span class="string">'file'</span>)
1537         str = textread(update_fname, <span class="string">'%s'</span>, <span class="string">'delimiter'</span>, <span class="string">'\n'</span>);
1538         id = strmatch(<span class="string">'% out.'</span>, str);
1539         <span class="keyword">if</span> length(id) == 2
1540           eval(str{id(1)}(3:end));
1541           eval(str{id(2)}(3:end));
1542         <span class="keyword">else</span>
1543           out = [];
1544         <span class="keyword">end</span>
1545       <span class="keyword">else</span>
1546         out = [];
1547       <span class="keyword">end</span>
1548     <span class="keyword">end</span>
1549     <span class="keyword">return</span>;
1550     
1551 <span class="keyword">end</span>
1552 
1553 <span class="comment">% open startup file for writing (create if necessary)</span>
1554 fid = fopen(fname, <span class="string">'w'</span>);
1555 <span class="keyword">if</span> fid &lt; 0
1556   errordlg(<span class="string">'Could not open or create startup.m'</span>);
1557   <span class="keyword">return</span>;
1558 <span class="keyword">end</span>
1559 
1560 <span class="comment">% wrap everything by try ... catch, in case an error occurs. then restore</span>
1561 <span class="comment">% startup file.</span>
1562 <span class="keyword">try</span>
1563 
1564   <span class="comment">% first part of the text</span>
1565   tmp1 = {
1566     sprintf(<span class="string">'function %s_autoUpdateFcn'</span>, mfilename)
1567     <span class="string">''</span>
1568     sprintf(<span class="string">'%% %s_AUTOUPDATEFCN Auto-Update Function for %s'</span>, <span class="keyword">...</span>
1569       upper(mfilename), mfilename)
1570     sprintf(<span class="string">'%%   This is auto generated by %s.'</span>, <span class="keyword">...</span>
1571       upper(mfilename))
1572     sprintf(<span class="string">'%%   Do not modify manually. Use %s(''-autoupdate'') to change.'</span>, <span class="keyword">...</span>
1573       upper(mfilename))
1574     <span class="string">'%'</span>
1575     <span class="string">'%   Jiro Doke'</span>
1576     <span class="string">'%   Mar 2006'</span>
1577     <span class="string">''</span>
1578     <span class="string">'tm = timerfind(''tag'', ''look4AutoUpdateTimer'');'</span>
1579     <span class="string">'if ~isempty(tm)'</span>
1580     <span class="string">'  disp(''deleting old update timer...'');'</span>
1581     <span class="string">'  stop(tm);'</span>
1582     <span class="string">'  delete(tm);'</span>
1583     <span class="string">'end'</span>
1584     <span class="string">''</span>
1585     <span class="string">'c = clock;'</span>
1586     <span class="string">''</span>
1587     };
1588 
1589   tmp3 = {
1590     <span class="string">''</span>
1591     <span class="string">'delayTime = round(delayTime);'</span>
1592     <span class="string">''</span>
1593     <span class="string">'tm = timer(...'</span>
1594     <span class="string">'  ''name''          , sprintf(''Next database update: %s'', ...'</span>
1595     <span class="string">'                            datestr(now+delayTime/86400)), ...'</span>
1596     <span class="string">'  ''tag''           , ''look4AutoUpdateTimer'', ...'</span>
1597     <span class="string">'  ''startdelay''    , delayTime, ...'</span>
1598     <span class="string">'  ''executionmode'' , ''fixedrate'', ...'</span>
1599     <span class="string">'  ''timerfcn''      , {@databaseUpdateTimerFcn, periodVal}, ...'</span>
1600     <span class="string">'  ''period''        , periodVal);'</span>
1601     <span class="string">''</span>
1602     <span class="string">'start(tm);'</span>
1603     <span class="string">''</span>
1604     <span class="string">'%--------------------------------------------------------------------------'</span>
1605     <span class="string">'function databaseUpdateTimerFcn(obj, edata, periodVal)'</span>
1606     <span class="string">''</span>
1607     <span class="string">'set(obj, ''name'', ...'</span>
1608     <span class="string">'  sprintf(''Next database update: %s'', datestr(now+periodVal/86400)));'</span>
1609     sprintf(<span class="string">'%s(''-new'', ''-noverbose'');'</span>, mfilename)
1610     <span class="string">''</span>
1611     };
1612   
1613   <span class="keyword">switch</span> result.type
1614     <span class="keyword">case</span> <span class="string">'daily'</span>
1615       tmp2 = {
1616         sprintf(<span class="string">'c2 = [0, 0, 0, %d, %d, 0];'</span>, result.val{1})
1617         <span class="string">'if datenum([0, 0, 0, c(4:end)]) &gt; datenum(c2)  % go to next day'</span>
1618         <span class="string">'  c3 = datevec(datenum([c(1:3), c2(4:end)])+1);'</span>
1619         <span class="string">'else'</span>
1620         <span class="string">'  c3 = [c(1:3), c2(4:end)];'</span>
1621         <span class="string">'end'</span>
1622         <span class="string">'delayTime = etime(c3, c);'</span>
1623         <span class="string">'periodVal = 24*60*60; % update daily'</span>
1624         };
1625 
1626       tmp4 = {
1627         <span class="string">'% out.type = ''daily'';'</span>
1628         sprintf(<span class="string">'%% out.val = {[%d, %d], ''''};'</span>, result.val{1})
1629         };
1630 
1631     <span class="keyword">case</span> <span class="string">'weekly'</span>
1632       days  = {<span class="string">'sun'</span>, <span class="string">'mon'</span>, <span class="string">'tue'</span>, <span class="string">'wed'</span>, <span class="string">'thu'</span>, <span class="string">'fri'</span>, <span class="string">'sat'</span>};
1633       wd2   = strmatch(lower(result.val{2}), days, <span class="string">'exact'</span>);
1634       tmp2  = {
1635         sprintf(<span class="string">'updateTime = [%d, %d, 0];'</span>, result.val{1})
1636         <span class="string">'wd  = weekday(datenum(c));'</span>
1637         sprintf(<span class="string">'wd2 = %d; %% update weekday: %s'</span>, wd2, result.val{2})
1638         <span class="string">'wd3 = wd2 - wd;'</span>
1639         <span class="string">'if (wd3 == 0 &amp;&amp; ...'</span>
1640         <span class="string">'    datenum([0, 0, 0, c(4:end)]) &gt; datenum([0, 0, 0, updateTime])) || ...'</span>
1641         <span class="string">'    wd3 &lt; 0'</span>
1642         <span class="string">'  wd3 = wd3 + 7;'</span>
1643         <span class="string">'end'</span>
1644         <span class="string">'delayTime = etime(datevec(datenum([c(1:3), updateTime])+wd3), c);'</span>
1645         <span class="string">'periodVal = 7*24*60*60; % update weekly'</span>
1646         };
1647 
1648       tmp4 = {
1649         <span class="string">'% out.type = ''weekly'';'</span>
1650         sprintf(<span class="string">'%% out.val = {[%d, %d], ''%s''};'</span>, result.val{1}, result.val{2})
1651         };
1652 
1653     <span class="keyword">case</span> <span class="string">'reset'</span>
1654 
1655       tmp2 = {};
1656 
1657   <span class="keyword">end</span>
1658 
1659   <span class="comment">% see if the call to the auto update function exists in startup.m</span>
1660   id = strmatch(sprintf(<span class="string">'%s_autoUpdateFcn;'</span>, mfilename), str, <span class="string">'exact'</span>);
1661 
1662   update_fname = fullfile(fileparts(fname), <span class="keyword">...</span>
1663     sprintf(<span class="string">'%s_autoUpdateFcn.m'</span>, mfilename));
1664 
1665   <span class="keyword">if</span> isempty(tmp2) <span class="comment">% reset</span>
1666 
1667     <span class="comment">% delete current update timer</span>
1668     tm = timerfind(<span class="string">'tag'</span>, <span class="string">'look4AutoUpdateTimer'</span>);
1669     <span class="keyword">if</span> ~isempty(tm)
1670       disp(<span class="string">'deleting old update timer...'</span>);
1671       stop(tm);
1672       delete(tm);
1673     <span class="keyword">end</span>
1674 
1675     <span class="comment">% delete call to auto update function</span>
1676     str(id) = <span class="string">''</span>;
1677 
1678     <span class="comment">% if auto update function exists, delete it.</span>
1679     <span class="keyword">if</span> exist(update_fname, <span class="string">'file'</span>)
1680       delete(update_fname);
1681     <span class="keyword">end</span>
1682 
1683   <span class="keyword">else</span>
1684 
1685     <span class="comment">% create auto update function</span>
1686     fid2 = fopen(update_fname, <span class="string">'w'</span>);
1687     tmp = [tmp1; tmp2; tmp3; tmp4];
1688     fprintf(fid2, <span class="string">'%s\n'</span>, tmp{:});
1689     fclose(fid2);
1690 
1691     <span class="comment">% get the name of the auto update function</span>
1692     [fname, fname] = fileparts(update_fname);
1693 
1694     <span class="comment">% flush from memory</span>
1695     clear(fname);
1696 
1697     <span class="comment">% run function</span>
1698     feval(fname);
1699 
1700     <span class="comment">% if the call to the function does not exist in startup.m, create one.</span>
1701     <span class="keyword">if</span> isempty(id)
1702       str = [str; {sprintf(<span class="string">'%s_autoUpdateFcn;'</span>, mfilename)}];
1703     <span class="keyword">end</span>
1704   <span class="keyword">end</span>
1705 
1706   <span class="comment">% create startup.m</span>
1707   fprintf(fid, <span class="string">'%s\n'</span>, str{:});
1708 
1709   fclose(fid);
1710 
1711 <span class="keyword">catch</span>
1712   
1713   <span class="comment">% if an error occurs, try to restore previouse startup files</span>
1714   
1715   fclose all;
1716   
1717   fprintf(<span class="string">'Error occurred. STARTUP files restored\n'</span>);
1718   <span class="keyword">switch</span> opt
1719     <span class="keyword">case</span> <span class="string">'new'</span>
1720       <span class="keyword">try</span>
1721         delete(fname);
1722       <span class="keyword">catch</span>
1723       <span class="keyword">end</span>
1724     <span class="keyword">case</span> <span class="string">'modify'</span>
1725       movefile(fullfile(p, [n <span class="string">'_backup.m'</span>]), fname);
1726   <span class="keyword">end</span>
1727 
1728   rethrow(lasterror);
1729   
1730 <span class="keyword">end</span>
1731 
1732 
1733 <span class="comment">%--------------------------------------------------------------------------</span>
1734 <span class="comment">%--------------------------------------------------------------------------</span>
1735 <span class="comment">% autoUpdateBtnCallback</span>
1736 <span class="comment">%    This is called when one of the buttons in the auto update window is</span>
1737 <span class="comment">%    pressed.</span>
1738 <span class="comment">%--------------------------------------------------------------------------</span>
1739 <span class="comment">%--------------------------------------------------------------------------</span>
1740 <a name="_sub18" href="#_subfunctions" class="code">function autoUpdateBtnCallback(varargin)</a>
1741 
1742 obj = varargin{1};
1743 
1744 handles = guidata(obj);
1745 opt = varargin{3};
1746 <span class="comment">%fprintf('au_btn_%d\n', opt);</span>
1747 <span class="keyword">switch</span> opt
1748   
1749   <span class="keyword">case</span> 0  <span class="comment">% cancel</span>
1750     setappdata(0, <span class="string">'look4_autoUpdateResults'</span>, []);
1751     close(handles.autoUpdateMain);
1752     <span class="keyword">return</span>;
1753     
1754   <span class="keyword">case</span> 1  <span class="comment">% daily tab</span>
1755     handles.result.type = <span class="string">'daily'</span>;
1756     
1757     set(handles.panel1, <span class="string">'position'</span>, [5, 80, 290, 32]);
1758     
1759     set([handles.wkT, handles.daT], <span class="keyword">...</span>
1760       {<span class="string">'fontweight'</span>, <span class="string">'position'</span>}, <span class="keyword">...</span>
1761       {<span class="string">'normal'</span>, [105, 113, 84, 19]; <span class="keyword">...</span>
1762         <span class="string">'bold'</span>, [20, 110, 84, 22]});
1763     set([handles.WeeklyQuestionCaption, <span class="keyword">...</span>
1764       handles.dayBtns], <span class="keyword">...</span>
1765       <span class="string">'visible'</span>   , <span class="string">'off'</span>);
1766     set(handles.DailyUpdateTimeEdit, <span class="keyword">...</span>
1767       <span class="string">'visible'</span>   , <span class="string">'on'</span>);
1768     
1769   <span class="keyword">case</span> 2  <span class="comment">% weekly tab</span>
1770     handles.result.type = <span class="string">'weekly'</span>;
1771 
1772     set(handles.panel1, <span class="string">'position'</span>, [5, 35, 290, 77]);
1773     
1774     set([handles.wkT, handles.daT], <span class="keyword">...</span>
1775       {<span class="string">'fontweight'</span>, <span class="string">'position'</span>}, <span class="keyword">...</span>
1776       {<span class="string">'bold'</span>, [105, 110, 84, 22]; <span class="keyword">...</span>
1777         <span class="string">'normal'</span>, [20, 113, 84, 19]});
1778     set([handles.DailyUpdateTimeEdit, <span class="keyword">...</span>
1779       handles.dayBtns, <span class="keyword">...</span>
1780       handles.WeeklyQuestionCaption], <span class="keyword">...</span>
1781       <span class="string">'visible'</span>   , <span class="string">'on'</span>);
1782     
1783   <span class="keyword">case</span> 3  <span class="comment">% weekday button</span>
1784     handles.result.val{2} = get(obj, <span class="string">'string'</span>);
1785     
1786     set(handles.dayBtns, <span class="keyword">...</span>
1787       <span class="string">'backgroundcolor'</span> , handles.bgcolor1, <span class="keyword">...</span>
1788       <span class="string">'fontweight'</span>      , <span class="string">'normal'</span>);
1789     set(obj, <span class="keyword">...</span>
1790       <span class="string">'fontweight'</span>      , <span class="string">'bold'</span>);
1791     
1792     
1793   <span class="keyword">case</span> 4  <span class="comment">% ok</span>
1794     <span class="comment">% check whether entry is valid</span>
1795     isError = false;
1796     <span class="keyword">if</span> strcmp(handles.result.type, <span class="string">'daily'</span>)
1797       <span class="keyword">if</span> isempty(handles.result.val{1})
1798         isError = true;
1799       <span class="keyword">end</span>
1800     <span class="keyword">else</span>
1801       <span class="keyword">if</span> isempty(handles.result.val{1}) || isempty(handles.result.val{2})
1802         isError = true;
1803       <span class="keyword">end</span>
1804     <span class="keyword">end</span>
1805     
1806     <span class="keyword">if</span> isError
1807       errordlg(<span class="string">'Incomplete...'</span>);
1808     <span class="keyword">else</span>
1809       setappdata(0, <span class="string">'look4_autoUpdateResults'</span>, handles.result);
1810       close(handles.autoUpdateMain);
1811     <span class="keyword">end</span>
1812     <span class="keyword">return</span>;
1813     
1814   <span class="keyword">case</span> 5 <span class="comment">% no update</span>
1815     handles.result.type = <span class="string">'reset'</span>;
1816     handles.result.val  = [];
1817     setappdata(0, <span class="string">'look4_autoUpdateResults'</span>, handles.result);
1818     close(handles.autoUpdateMain);
1819     <span class="keyword">return</span>;
1820     
1821 <span class="keyword">end</span>
1822 
1823 guidata(obj, handles);
1824 
1825 
1826 <span class="comment">%--------------------------------------------------------------------------</span>
1827 <span class="comment">%--------------------------------------------------------------------------</span>
1828 <span class="comment">% autoUpdateEditCallback</span>
1829 <span class="comment">%    This is called when the edit box (time) is entered. It checks the</span>
1830 <span class="comment">%    validity of the entry.</span>
1831 <span class="comment">%--------------------------------------------------------------------------</span>
1832 <span class="comment">%--------------------------------------------------------------------------</span>
1833 <a name="_sub19" href="#_subfunctions" class="code">function autoUpdateEditCallback(varargin)</a>
1834 
1835 <span class="comment">%fprintf('au_edit\n');</span>
1836 
1837 obj = varargin{1};
1838 bgcolor1 = [1,  1,  1];
1839 bgcolor2 = [1, .5, .5];
1840 
1841 handles = guidata(obj);
1842 
1843 str = get(obj, <span class="string">'string'</span>);
1844 
1845 isError = false;
1846 <span class="keyword">try</span>
1847   s = strread(str, <span class="string">'%d'</span>, <span class="string">'delimiter'</span>, <span class="string">':'</span>)';
1848   <span class="keyword">if</span> length(s) == 2
1849     <span class="keyword">if</span> s(1) &lt; 0 || s(1) &gt; 23 || s(2) &lt; 0 || s(2) &gt; 59
1850       isError = true;
1851     <span class="keyword">end</span>
1852   <span class="keyword">else</span>
1853     isError = true;
1854   <span class="keyword">end</span>
1855 <span class="keyword">catch</span>
1856   isError = true;
1857 <span class="keyword">end</span>
1858 
1859 <span class="keyword">if</span> isError
1860   set(obj, <span class="string">'string'</span>, <span class="string">''</span>, <span class="string">'backgroundcolor'</span>, bgcolor2);
1861   handles.result.val{1} = [];
1862 
1863 <span class="keyword">else</span>
1864   set(obj, <span class="string">'string'</span>, sprintf(<span class="string">'%d:%02d'</span>, s), <span class="string">'backgroundcolor'</span>, bgcolor1);
1865   handles.result.val{1} = s;
1866 
1867 <span class="keyword">end</span>
1868 
1869 guidata(obj, handles);</pre></div>
<hr><address>Generated on Fri 01-Aug-2008 10:57:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>