<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of plotfamily</title>
  <meta name="keywords" content="plotfamily">
  <meta name="description" content="PLOTFAMILY - Plots by middle layer family name">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mml</a> &gt; plotfamily.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mml&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>plotfamily
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>PLOTFAMILY - Plots by middle layer family name</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = plotfamily(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">PLOTFAMILY - Plots by middle layer family name

  To restrict the families to certain MemberOf group use:
  plotfamily MemberName

  FACTS
  1. Clicking on a data point in the plot will select the device in the
     listbox.  Clicking in the listbox will allow for a setpoint change.

  2. The lattice plot can also be used to change the setpoint.
     Just click on an object in the lattice drawing.  To remove the 
     setpoint widget click on a drift pass or BPM.  Note that HCMs are
     drawn above the axis and VCMs below.

  3. The &quot;Common Tasks&quot; menu is a launch pad menu.  It actually has nothing
     to do with of the plotfamily application.  Many of the typical
     tasks for setup of storage rings are listed in this menu. 

  4. Use plotfamilystartup to customize it for a particular accelerator.
     (Look at the ALS for an example.)

  5. This application can be compiled to run standalone.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="checkforao.html" class="code" title="function checkforao">checkforao</a>	CHECKFORAO - Run aoinit if no middle layer is present</li><li><a href="family2channel.html" class="code" title="function [ChannelNames, ErrorFlag] = family2channel(varargin)">family2channel</a>	FAMILY2CHANNEL - Converts the family name to a channel name</li><li><a href="family2common.html" class="code" title="function [CommonNames, ErrorFlag] = family2common(Family, DeviceList)">family2common</a>	FAMILY2COMMON - Convert a family name, device list to a common name list</li><li><a href="family2datastruct.html" class="code" title="function [DataStruct, ErrorFlag] = family2datastruct(varargin)">family2datastruct</a>	FAMILY2DATASTRUCTURE</li><li><a href="family2dev.html" class="code" title="function DeviceList = family2dev(Family, varargin)">family2dev</a>	FAMILY2DEV - Return the device list for a family</li><li><a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>	GETDATA - Searches through a file (or group of files) for a data structure which matches the family name</li><li><a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>	GETFAMILYDATA - Gets data associated with the accelerator control</li><li><a href="getfamilylist.html" class="code" title="function  [Families, AO] = getfamilylist(OutputFlag)">getfamilylist</a>	GETFAMILYLIST - Returns a list of all the family names</li><li><a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>	GETGOLDEN - Returns the golden values for a family</li><li><a href="gethcmfamily.html" class="code" title="function Family = gethcmfamily(OneHit)">gethcmfamily</a>	GETHCMFAMILY - Returns the default horizontal corrector family</li><li><a href="getoffset.html" class="code" title="function Data = getoffset(varargin)">getoffset</a>	GETOFFSET - Returns the offset values for a family</li><li><a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>	GETPV - Returns a variable from the online system or the model</li><li><a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>	GETSP - Gets setpoint channels</li><li><a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>	GETSPOS - Returns the longitudinal position in meters</li><li><a href="getvcmfamily.html" class="code" title="function Family = getvcmfamily(OneHit)">getvcmfamily</a>	GETVCMFAMILY - Returns the default vertical corrector family</li><li><a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>	HW2PHYSICS - Converts from 'Hardware' units to 'Physics' units</li><li><a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>	ISFAMILY - True for family names</li><li><a href="ismemberof.html" class="code" title="function  [IsTest, Index] = ismemberof(FamilyName, Field, MemberString)">ismemberof</a>	ISMEMBEROF - Returns turn if the membership information of a family (cell of strings)</li><li><a href="machine2sim.html" class="code" title="function machine2sim(ZeroCMFlag)">machine2sim</a>	MACHINE2SIM - loads online machine configuration to AT configuration</li><li><a href="maxpv.html" class="code" title="function [Data, ErrorFlag] = maxpv(varargin)">maxpv</a>	MAXPV - Maximum value of a process variable</li><li><a href="minpv.html" class="code" title="function [Data, ErrorFlag] = minpv(varargin)">minpv</a>	MinPV - Maximum value of a process variable</li><li><a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>	PHYSICS2HW - Converts from 'Physics' units to 'Hardware' units</li><li><a href="plotfamily.html" class="code" title="function varargout = plotfamily(varargin)">plotfamily</a>	PLOTFAMILY - Plots by middle layer family name</li><li><a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>	SETFAMILYDATA - Sets data associated with accelerator control</li><li><a href="setpv.html" class="code" title="function ErrorFlag = setpv(varargin)">setpv</a>	SETPV - Setpoint change of the online system or model</li><li><a href="sim2machine.html" class="code" title="function sim2machine">sim2machine</a>	SIM2MACHINE - Sets the AT configuration to the online machine</li><li><a href="switch2hw.html" class="code" title="function ErrorFlag = switch2hw(varargin)">switch2hw</a>	SWITCH2HW - Switch a family to hardware units</li><li><a href="switch2online.html" class="code" title="function ErrorFlag = switch2online(Family, DisplayFlag)">switch2online</a>	SWITCH2ONLINE - Switch family to online mode</li><li><a href="switch2physics.html" class="code" title="function ErrorFlag = switch2physics(Family)">switch2physics</a>	SWITCH2PHYSICS - Switch family to physics units</li><li><a href="switch2sim.html" class="code" title="function ErrorFlag = switch2sim(Family, DisplayFlag)">switch2sim</a>	SWITCH2SIM - Switch family to simulator mode if the family is in online mode.</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="plotfamily.html" class="code" title="function varargout = plotfamily(varargin)">plotfamily</a>	PLOTFAMILY - Plots by middle layer family name</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function figure1_CloseRequestFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub2" class="code">function plotfamily_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub3" class="code">function SetFigureTitle(h_fig, ModeString)</a></li><li><a href="#_sub4" class="code">function Resize_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function varargout = plotfamily_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function EditMiddleLayer_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function Delete_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function Timer_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function OnOff_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function OneShot_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function plotappdatalocal(handles)</a></li><li><a href="#_sub12" class="code">function RawOrbit1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function GoldenOrbit1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function OffsetOrbit1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function SaveOrbit1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function FileOrbit1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function RawOrbit2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub18" class="code">function GoldenOrbit2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function OffsetOrbit2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function SaveOrbit2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function FileOrbit2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function SaveOrbit1Now_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function LoadOrbit1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function UpdateFileDisplayLocal(handles)</a></li><li><a href="#_sub25" class="code">function Display1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function Display2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub27" class="code">function DisplayDiff_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub28" class="code">function Trace2A_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub29" class="code">function Trace2B_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub30" class="code">function Trace2A_B_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub31" class="code">function Trace2Off_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub32" class="code">function DataList1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub33" class="code">function DataList2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub34" class="code">function PopPlot_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub35" class="code">function PopPlot1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub36" class="code">function PopPlot2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub37" class="code">function Axis1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub38" class="code">function Axis2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub39" class="code">function HorizontalAxis_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub40" class="code">function HorizontalAxisSector_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub41" class="code">function YScaleLog1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub42" class="code">function YScaleLinear1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub43" class="code">function YScaleLog2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub44" class="code">function YScaleLinear2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub45" class="code">function DataStruct = CreateListboxString(DataStruct)</a></li><li><a href="#_sub46" class="code">function BPMxFamily_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub47" class="code">function BPMyFamily_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub48" class="code">function BPMxList_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub49" class="code">function BPMyList_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub50" class="code">function UpdatePeriod_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub51" class="code">function PhysicsUnits_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub52" class="code">function HardwareUnits_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub53" class="code">function MicronFlag_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub54" class="code">function SaveOrbitToFile_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub55" class="code">function Online_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub56" class="code">function Simulate_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub57" class="code">function Sim2Machine_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub58" class="code">function Machine2Sim_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub59" class="code">function HorizontalAxesScaling(hObject, eventdata, handles)</a></li><li><a href="#_sub60" class="code">function AddPlot_Nothing_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub61" class="code">function AddPlot_Beta_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub62" class="code">function AddPlot_Dispersion_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub63" class="code">function DrawLattice_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub64" class="code">function Graph1_ButtonDown(hObject, eventdata, handles)</a></li><li><a href="#_sub65" class="code">function Graph2_ButtonDown(hObject, eventdata, handles)</a></li><li><a href="#_sub66" class="code">function AutoScale1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub67" class="code">function AutoScale2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub68" class="code">function AutoScaleVertical(h_axis, ScaleFactor)</a></li><li><a href="#_sub69" class="code">function AutoScaleH_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub70" class="code">function AutoScaleYLocal(handles)</a></li><li><a href="#_sub71" class="code">function Graph1ZoomInVertical_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub72" class="code">function Graph1ZoomOutVertical_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub73" class="code">function Graph2ZoomInVertical_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub74" class="code">function Graph2ZoomOutVertical_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub75" class="code">function Graph1OffsetUpVertical_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub76" class="code">function Graph1OffsetDownVertical_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub77" class="code">function Graph2OffsetUpVertical_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub78" class="code">function Graph2OffsetDownVertical_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub79" class="code">function HorizontalOffsetRight_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub80" class="code">function HorizontalOffsetLeft_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub81" class="code">function Graph1ZoomInHorizontal_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub82" class="code">function Graph1ZoomOutHorizontal_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub83" class="code">function Switch2HW_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub84" class="code">function Switch2Physics_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub85" class="code">function Switch2Online_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub86" class="code">function Switch2Sim_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub87" class="code">function Lattice_ButtonDown(hObject, eventdata, handles)</a></li><li><a href="#_sub88" class="code">function SetpointGUI_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub89" class="code">function SetpointRange_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub90" class="code">function SetpointSlider_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub91" class="code">function SetpointEditBox_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub92" class="code">function SetpointPushButton_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub93" class="code">function ChangeSetpointPlotfamily(hObject, eventdata, handles)</a></li><li><a href="#_sub94" class="code">function Graph1Line_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub95" class="code">function Graph1Bar_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub96" class="code">function Graph2Line_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub97" class="code">function Graph2Bar_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub98" class="code">function DisabledSetpointChanges_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub99" class="code">function TurnOffSetpointGUI_Callback(hObject, eventdata, handles)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = plotfamily(varargin)</a>
0002 <span class="comment">%PLOTFAMILY - Plots by middle layer family name</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  To restrict the families to certain MemberOf group use:</span>
0005 <span class="comment">%  plotfamily MemberName</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%  FACTS</span>
0008 <span class="comment">%  1. Clicking on a data point in the plot will select the device in the</span>
0009 <span class="comment">%     listbox.  Clicking in the listbox will allow for a setpoint change.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%  2. The lattice plot can also be used to change the setpoint.</span>
0012 <span class="comment">%     Just click on an object in the lattice drawing.  To remove the</span>
0013 <span class="comment">%     setpoint widget click on a drift pass or BPM.  Note that HCMs are</span>
0014 <span class="comment">%     drawn above the axis and VCMs below.</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%  3. The &quot;Common Tasks&quot; menu is a launch pad menu.  It actually has nothing</span>
0017 <span class="comment">%     to do with of the plotfamily application.  Many of the typical</span>
0018 <span class="comment">%     tasks for setup of storage rings are listed in this menu.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%  4. Use plotfamilystartup to customize it for a particular accelerator.</span>
0021 <span class="comment">%     (Look at the ALS for an example.)</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%  5. This application can be compiled to run standalone.</span>
0024 
0025 <span class="comment">%  Written by Greg Portmann</span>
0026 
0027 
0028 <span class="comment">% Last Modified by GUIDE v2.5 26-Aug-2007 09:07:25</span>
0029 
0030 
0031 <span class="comment">% For the compiler</span>
0032 <span class="comment">%#function plotfamilystartup</span>
0033 <span class="comment">%#function aoinit setao setoperationalmode srinit</span>
0034 <span class="comment">%#function srcycle getmachineconfig setmachineconfig</span>
0035 <span class="comment">%#function setorbitdefault findrf findrf2 rmdisp setgolden setoffset</span>
0036 <span class="comment">%#function settune steptune setchro stepchro</span>
0037 <span class="comment">%#function plotorbit plotorbitdata plotcm plotgoldenorbit plotoffsetorbit</span>
0038 <span class="comment">%#function plotorbit plotdata plotbpmresp plotbpmrespsym</span>
0039 <span class="comment">%#function plotlattice plotdisp plotchro</span>
0040 <span class="comment">%#function monbpm getbpm monmags</span>
0041 <span class="comment">%#function gettune</span>
0042 <span class="comment">%#function measchro plotchro</span>
0043 <span class="comment">%#function measdisp plotdisp</span>
0044 <span class="comment">%#function measbpmresp meastuneresp quadcenter</span>
0045 <span class="comment">%#function copybpmrespfile</span>
0046 <span class="comment">%#function copybpmsigmafile</span>
0047 <span class="comment">%#function copychrorespfile</span>
0048 <span class="comment">%#function copydispersionfile</span>
0049 <span class="comment">%#function copydisprespfile</span>
0050 <span class="comment">%#function copyinjectionconfigfile</span>
0051 <span class="comment">%#function copymachineconfigfile</span>
0052 <span class="comment">%#function copytunerespfile</span>
0053 <span class="comment">%#function measlocodata locogui buildlocoinput buildloco buildlocofitparameters</span>
0054 
0055 
0056 
0057 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0058 gui_Singleton = 0;
0059 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0060     <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0061     <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub2" class="code" title="subfunction plotfamily_OpeningFcn(hObject, eventdata, handles, varargin)">plotfamily_OpeningFcn</a>, <span class="keyword">...</span>
0062     <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub5" class="code" title="subfunction varargout = plotfamily_OutputFcn(hObject, eventdata, handles)">plotfamily_OutputFcn</a>, <span class="keyword">...</span>
0063     <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0064     <span class="string">'gui_Callback'</span>,   []);
0065 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0066     gui_State.gui_Callback = str2func(varargin{1});
0067 <span class="keyword">end</span>
0068 
0069 <span class="keyword">if</span> nargout
0070     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0071 <span class="keyword">else</span>
0072     gui_mainfcn(gui_State, varargin{:});
0073 <span class="keyword">end</span>
0074 <span class="comment">% End initialization code - DO NOT EDIT</span>
0075 
0076 
0077 <span class="comment">% --- Executes when user attempts to close figure1.</span>
0078 <a name="_sub1" href="#_subfunctions" class="code">function figure1_CloseRequestFcn(hObject, eventdata, handles)</a>
0079 <span class="comment">% hObject    handle to figure1 (see GCBO)</span>
0080 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0081 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0082 
0083 <span class="comment">% Hint: delete(hObject) closes the figure</span>
0084 delete(hObject);
0085 
0086 
0087 <span class="comment">% --- Executes just before plotfamily is made visible.</span>
0088 <a name="_sub2" href="#_subfunctions" class="code">function plotfamily_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0089 <span class="comment">% This function has no output args, see OutputFcn.</span>
0090 <span class="comment">% hObject    handle to figure</span>
0091 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0092 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0093 <span class="comment">% varargin   command line arguments to plotfamily (see VARARGIN)</span>
0094 
0095 <span class="comment">% Choose default command line output for plotfamily</span>
0096 handles.output = hObject;
0097 
0098 <span class="comment">% Update handles structure</span>
0099 guidata(hObject, handles);
0100 
0101 <span class="comment">% UIWAIT makes plotfamily wait for user response (see UIRESUME)</span>
0102 <span class="comment">% uiwait(handles.figure1);</span>
0103 
0104 <span class="comment">%%%%%%%%%%%%%%%%</span>
0105 <span class="comment">% Set defaults %</span>
0106 <span class="comment">%%%%%%%%%%%%%%%%</span>
0107 UpdatePeriod = 1;
0108 set(handles.(<span class="string">'UpdatePeriod'</span>),<span class="string">'Label'</span>, sprintf(<span class="string">'Update Period = %.2f sec'</span>,UpdatePeriod));
0109 setappdata(handles.figure1, <span class="string">'UpdatePeriod'</span>, UpdatePeriod);
0110 
0111 <span class="comment">% Units  (This should get over written by the default for the BPM family)</span>
0112 setappdata(handles.figure1,<span class="string">'UnitsFlag'</span>, 2);
0113 set(handles.(<span class="string">'PhysicsUnitsFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0114 set(handles.(<span class="string">'HardwareUnitsFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0115 set(handles.(<span class="string">'MicronFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0116 
0117 setappdata(handles.figure1,<span class="string">'ChannelA'</span>,1);
0118 setappdata(handles.figure1,<span class="string">'ChannelB'</span>,2);
0119 
0120 <span class="comment">% Set the trace 1 defaults</span>
0121 <span class="comment">%setappdata(handles.figure1,'Trace1',1);</span>
0122 set(handles.(<span class="string">'DisplayDiff'</span>),<span class="string">'Value'</span>, 1);
0123 set(handles.(<span class="string">'Display1'</span>),<span class="string">'Value'</span>, 0);
0124 set(handles.(<span class="string">'Display2'</span>),<span class="string">'Value'</span>, 0);
0125 setappdata(handles.figure1,<span class="string">'Trace1'</span>,3);
0126 
0127 setappdata(handles.figure1,<span class="string">'Trace2'</span>,4);
0128 
0129 
0130 <span class="comment">% Run initialization if it has not been run (like standalone)</span>
0131 <a href="checkforao.html" class="code" title="function checkforao">checkforao</a>;
0132 
0133 
0134 <span class="keyword">if</span> isempty(varargin)
0135     MemberofField = <span class="string">'PlotFamily'</span>;
0136 <span class="keyword">else</span>
0137     MemberofField = varargin{1};
0138 <span class="keyword">end</span>
0139 
0140 <span class="comment">% Build Family menu</span>
0141 FoundOne = 0;
0142 FamilyName = <a href="getfamilylist.html" class="code" title="function  [Families, AO] = getfamilylist(OutputFlag)">getfamilylist</a>;
0143 <span class="keyword">for</span> i = 1:size(FamilyName,1)
0144     Family = deblank(FamilyName(i,:));
0145     
0146     <span class="keyword">try</span>
0147         spos = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(Family);
0148     <span class="keyword">catch</span>
0149         spos = [];
0150     <span class="keyword">end</span>
0151     
0152     <span class="comment">% Only include if there are S-position for the family</span>
0153     <span class="keyword">if</span> ~isempty(spos)
0154         FieldList = <span class="string">''</span>;
0155         <span class="keyword">if</span> <a href="ismemberof.html" class="code" title="function  [IsTest, Index] = ismemberof(FamilyName, Field, MemberString)">ismemberof</a>(Family, MemberofField)
0156             <span class="comment">%if ismemberof(Family, 'PlotFamily') | ismemberof(Family, 'MachineConfig') | ismemberof(Family, 'BPM') | ...</span>
0157             <span class="comment">%        ismemberof(Family, 'COR') | ismemberof(Family, 'QUAD') | ...</span>
0158             <span class="comment">%        ismemberof(Family, 'HCM') | ismemberof(Family, 'VCM') | ...</span>
0159             <span class="comment">%        ismemberof(Family, 'SEXT') | ismemberof(Family, 'BEND') | ...</span>
0160             <span class="comment">%        ismemberof(Family, 'SkewQuad') | ismemberof(Family, 'SQSF') | ismemberof(Family, 'SQSD')</span>
0161             FieldList = <span class="string">'Monitor'</span>;
0162             FoundOne = 1;
0163         <span class="keyword">end</span>
0164         
0165         <span class="comment">% Look if any other fields are part of the MachineConfig</span>
0166         AOFamily = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(Family);
0167         FieldNameCell = fieldnames(AOFamily);
0168         <span class="keyword">for</span> j = 1:size(FieldNameCell,1)
0169             <span class="keyword">if</span> isfield(AOFamily.(FieldNameCell{j}),<span class="string">'MemberOf'</span>)
0170                 <span class="keyword">if</span> any(strcmpi(AOFamily.(FieldNameCell{j}).MemberOf, MemberofField))
0171                     <span class="comment">%if any(strcmpi(AOFamily.(FieldNameCell{j}).MemberOf, MemberofField)) | any(strcmpi(AOFamily.(FieldNameCell{j}).MemberOf, 'MachineConfig'))</span>
0172                     FieldList = strvcat(FieldList,FieldNameCell{j});
0173                     FoundOne = 1;
0174                 <span class="keyword">end</span>
0175             <span class="keyword">end</span>
0176         <span class="keyword">end</span>
0177         
0178         <span class="comment">% Remove repeats but keep the row order</span>
0179         [FieldListUnique, ii, jj] = unique(FieldList, <span class="string">'rows'</span>);
0180         jj(find(diff(jj)==0)) = [];
0181         FieldList = FieldListUnique(jj,:);
0182         
0183         <span class="keyword">if</span> size(FieldList,1) == 1
0184             Menu1 = handles.(<span class="string">'BPMxFamily'</span>);
0185             Menu2 = handles.(<span class="string">'BPMyFamily'</span>);
0186             h1 = uimenu(Menu1, <span class="string">'Label'</span>,sprintf(<span class="string">'%s'</span>,Family), <span class="string">'Callback'</span>,<span class="string">'plotfamily(''BPMxFamily_Callback'',gcbo,[],guidata(gcbo))'</span>);
0187             h2 = uimenu(Menu2, <span class="string">'Label'</span>,sprintf(<span class="string">'%s'</span>,Family), <span class="string">'Callback'</span>,<span class="string">'plotfamily(''BPMyFamily_Callback'',gcbo,[],guidata(gcbo))'</span>);
0188             set(h1, <span class="string">'UserData'</span>, <a href="family2datastruct.html" class="code" title="function [DataStruct, ErrorFlag] = family2datastruct(varargin)">family2datastruct</a>(Family, deblank(FieldList)));
0189             set(h2, <span class="string">'UserData'</span>, <a href="family2datastruct.html" class="code" title="function [DataStruct, ErrorFlag] = family2datastruct(varargin)">family2datastruct</a>(Family, deblank(FieldList)));
0190             
0191         <span class="keyword">elseif</span> size(FieldList,1) &gt; 1
0192             <span class="comment">% Build off an extra menu</span>
0193             Menu1 = handles.(<span class="string">'BPMxFamily'</span>);
0194             Menu2 = handles.(<span class="string">'BPMyFamily'</span>);
0195             Menu1 = uimenu(Menu1, <span class="string">'Label'</span>, Family);
0196             Menu2 = uimenu(Menu2, <span class="string">'Label'</span>, Family);
0197             
0198             <span class="keyword">for</span> iField = 1:size(FieldList,1)
0199                 h1 = uimenu(Menu1, <span class="string">'Label'</span>,sprintf(<span class="string">'%s.%s'</span>,Family,deblank(FieldList(iField,:))), <span class="string">'Callback'</span>,<span class="string">'plotfamily(''BPMxFamily_Callback'',gcbo,[],guidata(gcbo))'</span>);
0200                 h2 = uimenu(Menu2, <span class="string">'Label'</span>,sprintf(<span class="string">'%s.%s'</span>,Family,deblank(FieldList(iField,:))), <span class="string">'Callback'</span>,<span class="string">'plotfamily(''BPMyFamily_Callback'',gcbo,[],guidata(gcbo))'</span>);
0201                 set(h1, <span class="string">'UserData'</span>, <a href="family2datastruct.html" class="code" title="function [DataStruct, ErrorFlag] = family2datastruct(varargin)">family2datastruct</a>(Family, deblank(FieldList(iField,:))));
0202                 set(h2, <span class="string">'UserData'</span>, <a href="family2datastruct.html" class="code" title="function [DataStruct, ErrorFlag] = family2datastruct(varargin)">family2datastruct</a>(Family, deblank(FieldList(iField,:))));
0203             <span class="keyword">end</span>
0204         <span class="keyword">else</span>
0205             <span class="comment">% Skip family</span>
0206         <span class="keyword">end</span>
0207     <span class="keyword">end</span>
0208 <span class="keyword">end</span>
0209 
0210 
0211 <span class="keyword">if</span> ~FoundOne
0212     <span class="comment">% if MemberOf came up empty, then put all the families in the menu</span>
0213     <span class="keyword">for</span> i = 1:size(FamilyName,1)
0214         <span class="keyword">try</span>
0215             Family = deblank(FamilyName(i,:));
0216             FamilyStruct = <a href="family2datastruct.html" class="code" title="function [DataStruct, ErrorFlag] = family2datastruct(varargin)">family2datastruct</a>(Family,<span class="string">'Monitor'</span>);
0217             spos = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(FamilyStruct);
0218             <span class="keyword">if</span> ~isempty(spos)
0219                 h1 = uimenu(handles.(<span class="string">'BPMxFamily'</span>), <span class="string">'Label'</span>,Family, <span class="string">'Callback'</span>,<span class="string">'plotfamily(''BPMxFamily_Callback'',gcbo,[],guidata(gcbo))'</span>);
0220                 h2 = uimenu(handles.(<span class="string">'BPMyFamily'</span>), <span class="string">'Label'</span>,Family, <span class="string">'Callback'</span>,<span class="string">'plotfamily(''BPMyFamily_Callback'',gcbo,[],guidata(gcbo))'</span>);
0221                 set(h1, <span class="string">'UserData'</span>, FamilyStruct);
0222                 set(h2, <span class="string">'UserData'</span>, FamilyStruct);
0223             <span class="keyword">end</span>
0224         <span class="keyword">catch</span>
0225             <span class="comment">% Skip family</span>
0226             <span class="comment">%fprintf('Skipping family %s',Family);</span>
0227         <span class="keyword">end</span>
0228     <span class="keyword">end</span>
0229 <span class="keyword">end</span>
0230 
0231 
0232 <span class="comment">% Initial families</span>
0233 <span class="keyword">try</span>
0234     <span class="comment">% Default orbit family names</span>
0235     <span class="comment">%BPMxFamily = gethbpmfamily;</span>
0236     <span class="comment">%</span>
0237     <span class="comment">%if isempty(BPMxFamily)</span>
0238     <span class="comment">%    FamilyList = getfamilylist;</span>
0239     <span class="comment">%    BPMxFamily = deblank(FamilyList(1,:));</span>
0240     <span class="comment">%end</span>
0241     <span class="comment">%BPMyFamily = getvbpmfamily;</span>
0242     <span class="comment">%if isempty(BPMyFamily)</span>
0243     <span class="comment">%    FamilyList = getfamilylist;</span>
0244     <span class="comment">%    BPMyFamily = deblank(FamilyList(2,:));</span>
0245     <span class="comment">%end</span>
0246     <span class="comment">%BPMxField = 'Monitor';</span>
0247     <span class="comment">%BPMyField = 'Monitor';</span>
0248     <span class="comment">%BPMxList = family2dev(BPMxFamily, 1);</span>
0249     <span class="comment">%BPMyList = family2dev(BPMyFamily, 1);</span>
0250     <span class="comment">%</span>
0251     <span class="comment">%set(handles.('BPMxFamily'),'Label',sprintf('Plot: %s', BPMxFamily));</span>
0252     <span class="comment">%set(handles.('BPMyFamily'),'Label',sprintf('Plot: %s', BPMyFamily));</span>
0253     <span class="comment">%</span>
0254     <span class="comment">%RawX = family2datastruct(BPMxFamily, BPMxField, BPMxList, UnitsFlag);</span>
0255     <span class="comment">%RawY = family2datastruct(BPMyFamily, BPMyField, BPMyList, UnitsFlag);</span>
0256     <span class="comment">%RawX.Data = zeros(size(BPMxList,1),1);</span>
0257     <span class="comment">%RawY.Data = zeros(size(BPMyList,1),1);</span>
0258     
0259     
0260     <span class="comment">% Base on first 2 families</span>
0261     FamilyHandles = get(handles.(<span class="string">'BPMxFamily'</span>),<span class="string">'Children'</span>);
0262     <span class="keyword">if</span> length(FamilyHandles) &gt;= 1
0263         RawX = get(FamilyHandles(end),<span class="string">'UserData'</span>);
0264         <span class="keyword">if</span> isempty(RawX)
0265             FamilyHandles2 = get(FamilyHandles(end),<span class="string">'Children'</span>);
0266             RawX = get(FamilyHandles2(end),<span class="string">'UserData'</span>);
0267         <span class="keyword">end</span>
0268         BPMxFamily = RawX.FamilyName;
0269     <span class="keyword">else</span>
0270         fprintf(<span class="string">'   No families in the MML.\n'</span>);
0271     <span class="keyword">end</span>
0272     <span class="keyword">if</span> length(FamilyHandles) &gt;= 2
0273         RawY = get(FamilyHandles(end-1),<span class="string">'UserData'</span>);
0274         <span class="keyword">if</span> isempty(RawY)
0275             FamilyHandles2 = get(FamilyHandles(end-1),<span class="string">'Children'</span>);
0276             RawY = get(FamilyHandles2(end),<span class="string">'UserData'</span>);
0277         <span class="keyword">end</span>
0278         BPMyFamily = RawY.FamilyName;
0279     <span class="keyword">else</span>
0280         RawY = RawX;
0281         BPMyFamily = RawX.FamilyName;
0282     <span class="keyword">end</span>
0283 
0284     <span class="comment">% Initialize Mode</span>
0285     <span class="comment">% if strcmpi(get(handles.Simulate,'Checked'),'On')</span>
0286     <span class="comment">%     Mode = 'Simulator';</span>
0287     <span class="comment">% else</span>
0288     <span class="comment">%     Mode = 'Online';</span>
0289     <span class="comment">% end</span>
0290     <span class="keyword">if</span> strcmpi(RawX.Mode,<span class="string">'SIMULATOR'</span>)
0291         set(handles.Online,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0292         set(handles.Simulate,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0293         Mode = <span class="string">'Simulator'</span>;
0294         <a href="#_sub3" class="code" title="subfunction SetFigureTitle(h_fig, ModeString)">SetFigureTitle</a>(handles.figure1, <span class="string">'Model'</span>);
0295     <span class="keyword">else</span>
0296         set(handles.Online,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0297         set(handles.Simulate,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0298         Mode = <span class="string">'Online'</span>;
0299         <a href="#_sub3" class="code" title="subfunction SetFigureTitle(h_fig, ModeString)">SetFigureTitle</a>(handles.figure1, <span class="string">'Online'</span>)
0300     <span class="keyword">end</span>
0301         
0302 
0303     <span class="comment">% Initialize Units</span>
0304     <span class="keyword">if</span> strcmpi(RawX.Units,<span class="string">'Physics'</span>)
0305         setappdata(handles.figure1,<span class="string">'UnitsFlag'</span>, 1);
0306         set(handles.(<span class="string">'PhysicsUnitsFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0307         set(handles.(<span class="string">'HardwareUnitsFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0308         set(handles.(<span class="string">'MicronFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0309         UnitsFlag = <span class="string">'Physics'</span>;
0310     <span class="keyword">else</span>
0311         setappdata(handles.figure1,<span class="string">'UnitsFlag'</span>, 2);
0312         set(handles.(<span class="string">'PhysicsUnitsFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0313         set(handles.(<span class="string">'HardwareUnitsFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'On'</span>);
0314         set(handles.(<span class="string">'MicronFlag'</span>),<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
0315         UnitsFlag = <span class="string">'Hardware'</span>;
0316     <span class="keyword">end</span>
0317 
0318     set(handles.BPMxFamily,<span class="string">'Label'</span>,sprintf(<span class="string">'Plot: %s'</span>, BPMxFamily));
0319     set(handles.BPMyFamily,<span class="string">'Label'</span>,sprintf(<span class="string">'Plot: %s'</span>, BPMyFamily));
0320 
0321     <span class="comment">% Create the list box string</span>
0322     RawX = <a href="#_sub45" class="code" title="subfunction DataStruct = CreateListboxString(DataStruct)">CreateListboxString</a>(RawX);
0323     RawY = <a href="#_sub45" class="code" title="subfunction DataStruct = CreateListboxString(DataStruct)">CreateListboxString</a>(RawY);
0324 
0325     setappdata(handles.figure1, <span class="string">'BPMxFamily'</span>, RawX);
0326     setappdata(handles.figure1, <span class="string">'BPMyFamily'</span>, RawY);
0327 
0328     setappdata(handles.figure1,<span class="string">'RawX'</span>, RawX);
0329     setappdata(handles.figure1,<span class="string">'RawY'</span>, RawY);
0330 
0331     setappdata(handles.figure1,<span class="string">'SaveX'</span>, RawX);
0332     setappdata(handles.figure1,<span class="string">'SaveY'</span>, RawY);
0333     set(handles.SaveTime,<span class="string">'String'</span>, <span class="string">''</span>);
0334 
0335     setappdata(handles.figure1,<span class="string">'FileX'</span>, RawX);
0336     setappdata(handles.figure1,<span class="string">'FileY'</span>, RawY);
0337 
0338     setappdata(handles.figure1,<span class="string">'FileNameX'</span>,<span class="string">''</span>);
0339     setappdata(handles.figure1,<span class="string">'FileNameY'</span>,<span class="string">''</span>);
0340     
0341     set(handles.FileNameX,<span class="string">'String'</span>, <span class="string">''</span>);
0342     set(handles.FileNameY,<span class="string">'String'</span>, <span class="string">''</span>);
0343 
0344     <span class="comment">%p = get(handles.FileNameX,'Position');</span>
0345     <span class="comment">%set(handles.FileNameX,'Position', [p(1) 4 p(3) p(4)]);    % Points</span>
0346     <span class="comment">%set(handles.FileNameX,'Position', [p(1) .8 p(3) p(4)]);   % Characters</span>
0347     <span class="comment">%set(handles.FileNameX,'Position', [p(1) 0.02 p(3) p(4)]); % Normalized</span>
0348     <span class="comment">%p = get(handles.SaveTime,'Position');</span>
0349     <span class="comment">%set(handles.SaveTime,'Position', [p(1) 16.5 p(3) p(4)]);  % Points</span>
0350     <span class="comment">%set(handles.SaveTime,'Position', [p(1) 1.6 p(3) p(4)]);   % Characters</span>
0351     <span class="comment">%set(handles.SaveTime,'Position', [p(1) 0.052 p(3) p(4)]); % Normalized</span>
0352     
0353     <span class="comment">% Look to see it the AT model needs to be changed for this family</span>
0354     ATModelNumber = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(BPMxFamily, <span class="string">'AT'</span>, <span class="string">'ATModel'</span>);
0355     <span class="keyword">if</span> ~isempty(ATModelNumber)
0356         <span class="keyword">global</span> THERING THERINGCELL
0357         THERING = THERINGCELL{ATModelNumber};
0358         <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(findspos(THERING,length(THERING)+1), <span class="string">'Circumference'</span>);
0359     <span class="keyword">end</span>
0360 
0361 <span class="keyword">catch</span>
0362 
0363     <span class="comment">% Starting units</span>
0364     UnitMenu = getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>);
0365     <span class="keyword">if</span> UnitMenu == 1
0366         UnitsFlag = <span class="string">'Physics'</span>;
0367     <span class="keyword">else</span>
0368         UnitsFlag = <span class="string">'Hardware'</span>;
0369     <span class="keyword">end</span>
0370 
0371     <span class="comment">% Initialize Mode</span>
0372     <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
0373         Mode = <span class="string">'Simulator'</span>;
0374     <span class="keyword">else</span>
0375         Mode = <span class="string">'Online'</span>;
0376     <span class="keyword">end</span>
0377 
0378 <span class="keyword">end</span>
0379 
0380 
0381 <span class="comment">% % Look for the golden values</span>
0382 <span class="comment">% try</span>
0383 <span class="comment">%     GoldenValues = getgolden(BPMxFamily, BPMxList, 'Struct');</span>
0384 <span class="comment">%     setappdata(handles.figure1,'GoldenX', GoldenValues);</span>
0385 <span class="comment">% catch</span>
0386 <span class="comment">%     setappdata(handles.figure1,'GoldenX', RawX);</span>
0387 <span class="comment">% end</span>
0388 <span class="comment">%</span>
0389 <span class="comment">% % Look for the offset values</span>
0390 <span class="comment">% try</span>
0391 <span class="comment">%     OffsetValues = getoffset(BPMxFamily, BPMxList, 'Struct');</span>
0392 <span class="comment">%     setappdata(handles.figure1,'OffsetX', OffsetValues);</span>
0393 <span class="comment">% catch</span>
0394 <span class="comment">%     if isempty(OffsetValues)</span>
0395 <span class="comment">%         try</span>
0396 <span class="comment">%             % If and offset does not exist than try using the setpoint</span>
0397 <span class="comment">%             setappdata(handles.figure1,'OffsetX', getsp(BPMxFamily, BPMxList, Mode, 'Struct'));</span>
0398 <span class="comment">%         catch</span>
0399 <span class="comment">%             % Use zeros</span>
0400 <span class="comment">%             setappdata(handles.figure1,'OffsetX', RawX);</span>
0401 <span class="comment">%         end</span>
0402 <span class="comment">%     end</span>
0403 <span class="comment">% end</span>
0404 <span class="comment">%</span>
0405 <span class="comment">% % Look for the golden values</span>
0406 <span class="comment">% try</span>
0407 <span class="comment">%     GoldenValues = getgolden(BPMyFamily, BPMyList, 'Struct');</span>
0408 <span class="comment">%     setappdata(handles.figure1,'GoldenY', GoldenValues);</span>
0409 <span class="comment">% catch</span>
0410 <span class="comment">%     setappdata(handles.figure1,'GoldenY', RawY);</span>
0411 <span class="comment">% end</span>
0412 <span class="comment">%</span>
0413 <span class="comment">% % Look for the offset values</span>
0414 <span class="comment">% try</span>
0415 <span class="comment">%     OffsetValues = getoffset(BPMyFamily, BPMyList, 'Struct');</span>
0416 <span class="comment">%     setappdata(handles.figure1,'OffsetY', OffsetValues);</span>
0417 <span class="comment">% catch</span>
0418 <span class="comment">%     try</span>
0419 <span class="comment">%         % If and offset does not exist than try using the setpoint</span>
0420 <span class="comment">%         setappdata(handles.figure1,'OffsetY', getsp(BPMyFamily, BPMyList, Mode, 'Struct'));</span>
0421 <span class="comment">%     catch</span>
0422 <span class="comment">%         % Use zeros</span>
0423 <span class="comment">%         setappdata(handles.figure1,'OffsetY', RawY);</span>
0424 <span class="comment">%     end</span>
0425 <span class="comment">% end</span>
0426 
0427 L = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Circumference'</span>);
0428 
0429 <span class="keyword">try</span>
0430     s = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(RawX);
0431     setappdata(handles.figure1, <span class="string">'SPosX'</span>, s);
0432     <span class="keyword">if</span> isempty(L)
0433         L = max(s);
0434     <span class="keyword">end</span>
0435     <span class="comment">%setappdata(handles.figure1, 'AxisRange1X', [min(s) max(s)]);</span>
0436 <span class="keyword">catch</span>
0437     <span class="comment">%setappdata(handles.figure1, 'SPosX', 1:size(RawX.DeviceList,1));</span>
0438 <span class="keyword">end</span>
0439 setappdata(handles.figure1, <span class="string">'AxisRange1X'</span>, [0 L]);
0440 
0441 <span class="keyword">try</span>
0442     s = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(RawY);
0443     setappdata(handles.figure1, <span class="string">'SPosY'</span>, s);
0444     <span class="comment">%setappdata(handles.figure1, 'AxisRange2X', [min(s) max(s)]);</span>
0445 <span class="keyword">catch</span>
0446     <span class="comment">%setappdata(handles.figure1, 'SPosY', 1:size(RawY.DeviceList,1));</span>
0447 <span class="keyword">end</span>
0448 setappdata(handles.figure1, <span class="string">'AxisRange2X'</span>, [0 L]);
0449 
0450 
0451 <span class="comment">% Update time</span>
0452 set(handles.Time, <span class="string">'String'</span>, <span class="string">''</span>);
0453 
0454 
0455 <span class="comment">% Initialize plots</span>
0456 set(handles.Graph1, <span class="string">'XLim'</span>, [0 L]);
0457 set(handles.Graph2, <span class="string">'XLim'</span>, [0 L]);
0458 
0459 p1 = [0.07    0.65    0.74    0.29];
0460 set(handles.Graph1, <span class="string">'Position'</span>, p1);
0461 set(handles.Graph3, <span class="string">'Position'</span>, p1);
0462 
0463 p2 = [0.07    0.27    0.74    0.29];
0464 set(handles.Graph2, <span class="string">'Position'</span>, p2);
0465 set(handles.Graph4, <span class="string">'Position'</span>, p2);
0466 
0467 plot(handles.Graph3, NaN, NaN);
0468 set(handles.Graph3, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0469 set(handles.Graph3, <span class="string">'color'</span>, <span class="string">'none'</span>);
0470 set(handles.Graph3, <span class="string">'XLim'</span>, [0 L]);
0471 
0472 plot(handles.Graph4, NaN,NaN);
0473 set(handles.Graph4, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0474 set(handles.Graph4, <span class="string">'color'</span>, <span class="string">'none'</span>);
0475 set(handles.Graph4, <span class="string">'XLim'</span>, [0 L]);
0476 
0477 
0478 <span class="comment">%axes(handles.LatticeAxes);</span>
0479 <span class="keyword">try</span>
0480     <span class="comment">% Add the lattice drawing</span>
0481     drawlattice(0, 1.1, handles.LatticeAxes);
0482 
0483     <span class="comment">% Match with DrawLattice_Callback</span>
0484     g = .01;
0485     p1 = [0.07    0.65+g    0.74    0.29-g];
0486     set(handles.Graph1, <span class="string">'Position'</span>, p1);
0487     set(handles.Graph3, <span class="string">'Position'</span>, p1);
0488 
0489     p2 = [0.07    0.27      0.74    0.29-g];
0490     set(handles.Graph2, <span class="string">'Position'</span>, p2);
0491     set(handles.Graph4, <span class="string">'Position'</span>, p2);
0492 
0493     set(handles.LatticeAxes, <span class="string">'Units'</span>, <span class="string">'Normalized'</span>);
0494     <span class="comment">%P = get(handles.LatticeAxes, 'Position');</span>
0495     set(handles.LatticeAxes, <span class="string">'Position'</span>, [0.07 0.5744-g 0.74 0.07+2*g]);  <span class="comment">% p4 was 0.065</span>
0496 <span class="keyword">catch</span>
0497     <span class="comment">% Remove the lattice drawing</span>
0498     d = .015;  <span class="comment">% Match with DrawLattice_Callback</span>
0499     p1 = [0.07    0.65-d    0.74    0.29+d];
0500     set(handles.Graph1, <span class="string">'Position'</span>, p1);
0501     set(handles.Graph3, <span class="string">'Position'</span>, p1);
0502 
0503     p2 = [0.07    0.27    0.74    0.29+d];
0504     set(handles.Graph2, <span class="string">'Position'</span>, p2);
0505     set(handles.Graph4, <span class="string">'Position'</span>, p2);
0506 
0507     set(handles.DrawLattice, <span class="string">'Checked'</span>, <span class="string">'Off'</span>);
0508     set(get(handles.LatticeAxes,<span class="string">'Children'</span>), <span class="string">'Visible'</span> , <span class="string">'Off'</span>);
0509 <span class="keyword">end</span>
0510 
0511 <span class="keyword">try</span>
0512     set(handles.LatticeAxes,<span class="string">'Visible'</span>,<span class="string">'Off'</span>);
0513     set(handles.LatticeAxes,<span class="string">'Color'</span>,<span class="string">'None'</span>);
0514     set(handles.LatticeAxes,<span class="string">'XMinorTick'</span>,<span class="string">'Off'</span>);
0515     set(handles.LatticeAxes,<span class="string">'XMinorGrid'</span>,<span class="string">'Off'</span>);
0516     set(handles.LatticeAxes,<span class="string">'YMinorTick'</span>,<span class="string">'Off'</span>);
0517     set(handles.LatticeAxes,<span class="string">'YMinorGrid'</span>,<span class="string">'Off'</span>);
0518     set(handles.LatticeAxes,<span class="string">'XTickLabel'</span>,[]);
0519     set(handles.LatticeAxes,<span class="string">'YTickLabel'</span>,[]);
0520     set(handles.LatticeAxes,<span class="string">'XLim'</span>, [0 L]);
0521     set(handles.LatticeAxes,<span class="string">'YLim'</span>, [-1.5 1.5]);
0522 
0523 
0524     <span class="comment">% Add callback on each lattice element</span>
0525     <span class="comment">% set(handles.LatticeAxes ,'ButtonDownFcn','plotfamily(''Lattice_ButtonDown'',gcbo,[],guidata(gcbo))');</span>
0526     h = get(handles.LatticeAxes,<span class="string">'Children'</span>);
0527     <span class="keyword">for</span> i = 1:length(h)
0528         <span class="comment">%ATIndex = get(h(i), 'UserData');</span>
0529         set(h(i), <span class="string">'ButtonDownFcn'</span>, <span class="string">'plotfamily(''Lattice_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
0530     <span class="keyword">end</span>
0531 <span class="keyword">catch</span>
0532 <span class="keyword">end</span>
0533 
0534 
0535 
0536 
0537 <span class="comment">% % Build middle layer edit menus</span>
0538 <span class="comment">% %h = addmenuao(handles.('EditMiddleLayerAO'));</span>
0539 <span class="comment">% %set(h, 'Label', 'Middle Layer Family Setup');</span>
0540 <span class="comment">%</span>
0541 <span class="comment">% hmenu = handles.('EditMiddleLayerAO');</span>
0542 <span class="comment">% LabelString = 'Middle Layer Family Setup';</span>
0543 <span class="comment">% ParentLabelString = 'MiddleLayer';</span>
0544 <span class="comment">% DataStructure0 = getao;</span>
0545 <span class="comment">% if isempty(DataStructure0)</span>
0546 <span class="comment">%     aoinit;</span>
0547 <span class="comment">% end</span>
0548 <span class="comment">%</span>
0549 <span class="comment">%</span>
0550 <span class="comment">% % Build middle menu tree</span>
0551 <span class="comment">% DataStructFieldName1 = fieldnames(DataStructure0);</span>
0552 <span class="comment">% for i = 1:length(DataStructFieldName1)</span>
0553 <span class="comment">%     DataStructure1 = DataStructure0.(DataStructFieldName1{i});</span>
0554 <span class="comment">%     if isstruct(DataStructure1)</span>
0555 <span class="comment">%         hmenu1 = uimenu(hmenu, 'Label',DataStructFieldName1{i}, 'Callback','');</span>
0556 <span class="comment">%         DataStructFieldName2 = fieldnames(DataStructure1);</span>
0557 <span class="comment">%         for j = 1:length(DataStructFieldName2)</span>
0558 <span class="comment">%             DataStructure2 = DataStructure1.(DataStructFieldName2{j});</span>
0559 <span class="comment">%             if isstruct(DataStructure2)</span>
0560 <span class="comment">%                 hmenu2 = uimenu(hmenu1, 'Label',DataStructFieldName2{j}, 'Callback','');</span>
0561 <span class="comment">%                 DataStructFieldName3 = fieldnames(DataStructure2);</span>
0562 <span class="comment">%                 for k = 1:length(DataStructFieldName3)</span>
0563 <span class="comment">%                     DataStructure3 = DataStructure2.(DataStructFieldName3{k});</span>
0564 <span class="comment">%                     if isstruct(DataStructure3)</span>
0565 <span class="comment">%                         hmenu3 = uimenu(hmenu2, 'Label',DataStructFieldName3{k}, 'Callback','');</span>
0566 <span class="comment">%                         DataStructFieldName4 = fieldnames(DataStructure3);</span>
0567 <span class="comment">%                         for l = 1:length(DataStructFieldName4)</span>
0568 <span class="comment">%                             hmenu4 = uimenu(hmenu3, 'Label', DataStructFieldName4{l});</span>
0569 <span class="comment">%                             set(hmenu4,'UserData', {DataStructure3.(DataStructFieldName4{l}) , DataStructFieldName1{l}, DataStructFieldName2{k}, DataStructFieldName3{k}, DataStructFieldName4{i}});</span>
0570 <span class="comment">%                             set(hmenu4,'Callback', 'plotfamily(''EditMiddleLayer_Callback'',gcbo,[],guidata(gcbo))');</span>
0571 <span class="comment">%                         end</span>
0572 <span class="comment">%                     else</span>
0573 <span class="comment">%                         hmenu3 = uimenu(hmenu2, 'Label',DataStructFieldName3{k});</span>
0574 <span class="comment">%                         set(hmenu3,'UserData', {DataStructure3, DataStructFieldName1{i}, DataStructFieldName2{j}, DataStructFieldName3{k}});</span>
0575 <span class="comment">%                         set(hmenu3,'Callback', 'plotfamily(''EditMiddleLayer_Callback'',gcbo,[],guidata(gcbo))');</span>
0576 <span class="comment">%                     end</span>
0577 <span class="comment">%                 end</span>
0578 <span class="comment">%             else</span>
0579 <span class="comment">%                 hmenu2 = uimenu(hmenu1, 'Label',DataStructFieldName2{j});</span>
0580 <span class="comment">%                 set(hmenu2,'UserData', {DataStructure2, DataStructFieldName1{i}, DataStructFieldName2{j}});</span>
0581 <span class="comment">%                 set(hmenu2,'Callback', 'plotfamily(''EditMiddleLayer_Callback'',gcbo,[],guidata(gcbo))');</span>
0582 <span class="comment">%             end</span>
0583 <span class="comment">%         end</span>
0584 <span class="comment">%     else</span>
0585 <span class="comment">%         hmenu1 = uimenu(hmenu, 'Label', DataStructFieldName1{i});</span>
0586 <span class="comment">%         set(hmenu1,'UserData', {DataStructure1, DataStructFieldName1{i}});</span>
0587 <span class="comment">%         set(hmenu1,'Callback', 'plotfamily(''EditMiddleLayer_Callback'',gcbo,[],guidata(gcbo))');</span>
0588 <span class="comment">%     end</span>
0589 <span class="comment">% end</span>
0590 
0591 
0592 <span class="comment">% % Build the AD menu</span>
0593 <span class="comment">% set(addmenuad(handles.EditMiddleLayerAD), 'Label', 'Middle Layer Parameter Setup');</span>
0594 set(handles.EditMiddleLayerAO, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0595 set(handles.EditMiddleLayerAD, <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
0596 
0597 
0598 <span class="comment">% Machine specific startup function</span>
0599 <span class="keyword">if</span> exist(<span class="string">'plotfamilystartup'</span>, <span class="string">'file'</span>)
0600     plotfamilystartup(handles);
0601 <span class="keyword">end</span>
0602 
0603 
0604 
0605 <span class="comment">% --------------------------------------------------------------------</span>
0606 <a name="_sub3" href="#_subfunctions" class="code">function SetFigureTitle(h_fig, ModeString)</a>
0607 
0608 MachineName     = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Machine'</span>);
0609 SubMachineName  = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'SubMachine'</span>);
0610 OperationalMode = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'OperationalMode'</span>);
0611 <span class="keyword">try</span>
0612     <span class="keyword">if</span> isdeployed
0613         TitleString = sprintf(<span class="string">'Plot Family:  %s  -  %s  -  %s  (%s - Standalone)'</span>, MachineName, SubMachineName, OperationalMode, ModeString);
0614     <span class="keyword">else</span>
0615         TitleString = sprintf(<span class="string">'Plot Family:  %s  -  %s  -  %s  (%s)'</span>, MachineName, SubMachineName, OperationalMode, ModeString);
0616     <span class="keyword">end</span>
0617 <span class="keyword">catch</span>
0618     TitleString = sprintf(<span class="string">'Plot Family:  %s  -  %s  -  %s  (%s)'</span>, MachineName, SubMachineName, OperationalMode, ModeString);
0619 <span class="keyword">end</span>
0620 
0621 set(h_fig,<span class="string">'Name'</span>,TitleString);
0622 
0623 
0624 
0625 <span class="comment">% --------------------------------------------------------------------</span>
0626 <a name="_sub4" href="#_subfunctions" class="code">function Resize_Callback(hObject, eventdata, handles)</a>
0627 
0628 <span class="comment">% SmallestPositionX = 174.800;</span>
0629 <span class="comment">% SmallestPositionY  = 39.7692;</span>
0630 <span class="comment">%</span>
0631 <span class="comment">% % Units should be characters anyways</span>
0632 <span class="comment">% Units = get(hObject,'Units');</span>
0633 <span class="comment">% set(hObject,'Units', 'Characters');</span>
0634 <span class="comment">% P = get(hObject, 'Position');</span>
0635 <span class="comment">%</span>
0636 <span class="comment">% if P(3) &lt; SmallestPositionX</span>
0637 <span class="comment">%    P(3) = SmallestPositionX;</span>
0638 <span class="comment">%</span>
0639 <span class="comment">%    if P(1)+P(3) &lt; 0</span>
0640 <span class="comment">%    end</span>
0641 <span class="comment">% end</span>
0642 <span class="comment">%</span>
0643 <span class="comment">%</span>
0644 <span class="comment">% if P(4) &lt; SmallestPositionY</span>
0645 <span class="comment">%    P(4) = SmallestPositionY;</span>
0646 <span class="comment">% end</span>
0647 <span class="comment">%</span>
0648 <span class="comment">% set(hObject, 'Position', P);</span>
0649 <span class="comment">% set(hObject, 'Units', Units);</span>
0650 
0651 
0652 
0653 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0654 <a name="_sub5" href="#_subfunctions" class="code">function varargout = plotfamily_OutputFcn(hObject, eventdata, handles)</a>
0655 <span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
0656 <span class="comment">% hObject    handle to figure</span>
0657 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0658 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0659 
0660 <span class="comment">% Get default command line output from handles structure</span>
0661 <span class="keyword">if</span> isfield(handles,<span class="string">'output'</span>)
0662     varargout{1} = handles.output;
0663 <span class="keyword">end</span>
0664 
0665 
0666 <span class="comment">% --- Executes onoff button press in OnOff.</span>
0667 <a name="_sub6" href="#_subfunctions" class="code">function EditMiddleLayer_Callback(hObject, eventdata, handles)</a>
0668 
0669 Data = get(hObject, <span class="string">'UserData'</span>);
0670 
0671 <span class="comment">% Get up-to-date data</span>
0672 Data{1} = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(Data{2:end});
0673 TitleString = sprintf(<span class="string">'%s '</span>,Data{2:end});
0674 AddOpts.Resize=<span class="string">'on'</span>;
0675 AddOpts.WindowStyle=<span class="string">'normal'</span>;
0676 AddOpts.Interpreter=<span class="string">'tex'</span>;
0677 
0678 <span class="keyword">if</span> length(Data) &gt;= 3 &amp;&amp; (strcmpi(deblank(Data{3}),<span class="string">'Status'</span>) || strcmpi(deblank(Data{3}),<span class="string">'DeviceList'</span>) || strcmpi(deblank(Data{3}),<span class="string">'ElementList'</span>)) 
0679     <span class="keyword">if</span> strcmpi(deblank(Data{3}),<span class="string">'ElementList'</span>)
0680         DeviceList = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(deblank(Data{2}), <span class="string">'ElementList'</span>);
0681     <span class="keyword">else</span>
0682         DeviceList = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(deblank(Data{2}), <span class="string">'DeviceList'</span>);
0683     <span class="keyword">end</span>
0684     Status = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(deblank(Data{2}), <span class="string">'Status'</span>);
0685     DeviceListNew = editlist(DeviceList, deblank(Data{2}), Status);
0686     
0687     [i, iNotFound] = findrowindex(DeviceListNew, DeviceList);
0688     
0689     <span class="keyword">if</span> size(Status,1) == 1
0690         DeviceListTotal = <a href="family2dev.html" class="code" title="function DeviceList = family2dev(Family, varargin)">family2dev</a>(Data{2}, 0);
0691         Status = zeros(size(DeviceListTotal,1),1);
0692     <span class="keyword">else</span>
0693         Status = 0 * Status;
0694     <span class="keyword">end</span>
0695     Status(i) = 1;
0696     <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(Status, deblank(Data{2}), <span class="string">'Status'</span>); 
0697     
0698 <span class="keyword">elseif</span> isnumeric(Data{1})
0699     answer = inputdlg({sprintf(<span class="string">'Change %s '</span>,TitleString)}, <span class="string">'Edit Middle Layer Family'</span>, size(Data{1},1), {num2str(Data{1})}, AddOpts);
0700     <span class="keyword">if</span> isempty(answer)
0701         <span class="keyword">return</span>
0702     <span class="keyword">end</span>
0703     Data{1} = str2num(answer{1});
0704     set(hObject, <span class="string">'UserData'</span>, Data);
0705     <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(Data{1:end});
0706 <span class="keyword">elseif</span> strcmpi(Data{2},<span class="string">'Directory'</span>)
0707     answer = uigetdir(Data{1}, sprintf(<span class="string">'Change directory location for %s'</span>, Data{3}));
0708     <span class="keyword">if</span> answer == 0
0709         <span class="keyword">return</span>
0710     <span class="keyword">end</span>
0711     Data{1} = answer;
0712     set(hObject, <span class="string">'UserData'</span>, Data);
0713     <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(Data{1:end});    
0714     
0715 <span class="keyword">elseif</span> ischar(Data{1})
0716     answer = inputdlg({sprintf(<span class="string">'Change %s '</span>,TitleString)}, <span class="string">'Edit Middle Layer Family'</span>, size(Data{1},1), {num2str(Data{1})}, AddOpts);
0717     <span class="keyword">if</span> isempty(answer)
0718         <span class="keyword">return</span>
0719     <span class="keyword">end</span>
0720     Data{1} = answer{1};
0721     set(hObject, <span class="string">'UserData'</span>, Data);
0722     <a href="setfamilydata.html" class="code" title="function setfamilydata(Data, Family, Field1, Field2, DeviceList)">setfamilydata</a>(Data{1:end});
0723 <span class="keyword">end</span>
0724 
0725 
0726 <span class="comment">% Reset graphs</span>
0727 <a href="#_sub46" class="code" title="subfunction BPMxFamily_Callback(hObject, eventdata, handles)">BPMxFamily_Callback</a>([], eventdata, handles);
0728 <a href="#_sub47" class="code" title="subfunction BPMyFamily_Callback(hObject, eventdata, handles)">BPMyFamily_Callback</a>([], eventdata, handles);
0729 
0730 
0731 
0732 <a name="_sub7" href="#_subfunctions" class="code">function Delete_Callback(hObject, eventdata, handles)</a>
0733 
0734 <span class="comment">% If timer is on, then turn it off by deleting the timer handle</span>
0735 <span class="keyword">try</span>
0736     <span class="comment">%h = get(gcbf, 'UserData');</span>
0737     h = get(handles.figure1, <span class="string">'UserData'</span>);
0738     <span class="keyword">if</span> isfield(h,<span class="string">'TimerHandle'</span>)
0739         stop(h.TimerHandle);
0740         delete(h.TimerHandle);
0741     <span class="keyword">end</span>
0742 <span class="keyword">catch</span>
0743     fprintf(<span class="string">'   Trouble stopping the timer on exit.\n'</span>);
0744 <span class="keyword">end</span>
0745 
0746 
0747 
0748 <span class="comment">% --- Executes onoff button press in OnOff.</span>
0749 <a name="_sub8" href="#_subfunctions" class="code">function Timer_Callback(hObject, eventdata, handles)</a>
0750 <span class="comment">% Timer method</span>
0751 
0752 <span class="comment">%disp('Timer executed.');</span>
0753 <span class="comment">%handles = get(eventdata, 'UserData');</span>
0754 handles = get(hObject, <span class="string">'UserData'</span>);
0755 <a href="plotfamily.html" class="code" title="function varargout = plotfamily(varargin)">plotfamily</a>(<span class="string">'OneShot_Callback'</span>, hObject, [], handles);
0756 
0757 
0758 <span class="comment">% --- Executes onoff button press in OnOff.</span>
0759 <a name="_sub9" href="#_subfunctions" class="code">function OnOff_Callback(hObject, eventdata, handles)</a>
0760 <span class="comment">% Timer method</span>
0761 
0762 <span class="comment">% % Update the title bar</span>
0763 <span class="comment">% if strcmpi(get(handles.Simulate,'Checked'),'On')</span>
0764 <span class="comment">%     SetFigureTitle(handles.figure1, 'Model');</span>
0765 <span class="comment">% else</span>
0766 <span class="comment">%     SetFigureTitle(handles.figure1, 'Online');</span>
0767 <span class="comment">% end</span>
0768 
0769 OnFlag = get(handles.OnOff, <span class="string">'Value'</span>);
0770 
0771 <span class="keyword">if</span> OnFlag
0772     <span class="comment">% Turn on updates</span>
0773     set(handles.OnOff, <span class="string">'String'</span>, <span class="string">'Running'</span>);    
0774         
0775     <span class="comment">% Setup timer</span>
0776     UpdatePeriod = getappdata(handles.figure1, <span class="string">'UpdatePeriod'</span>);    
0777     t = timer;
0778     set(t,<span class="string">'StartDelay'</span>,0);
0779     set(t,<span class="string">'Period'</span>, UpdatePeriod);
0780     <span class="comment">%set(t,'TimerFcn', 'plotfamily(''OneShot_Callback'', getfield(get(timerfind(''Tag'',''PlotFamilyTimer''),''Userdata''),''figure1''), [], get(timerfind(''Tag'',''PlotFamilyTimer''),''Userdata''));');</span>
0781     set(t,<span class="string">'TimerFcn'</span>, [<span class="string">'plotfamily(''Timer_Callback'','</span>, sprintf(<span class="string">'%.30f'</span>,handles.figure1), <span class="string">','</span>,sprintf(<span class="string">'%.30f'</span>,handles.figure1), <span class="string">', [])'</span>]);
0782     set(t,<span class="string">'UserData'</span>, handles);   
0783     set(t,<span class="string">'BusyMode'</span>, <span class="string">'drop'</span>);  <span class="comment">%'queue'</span>
0784     set(t,<span class="string">'TasksToExecute'</span>, Inf);
0785     set(t,<span class="string">'ExecutionMode'</span>, <span class="string">'FixedRate'</span>);
0786     set(t,<span class="string">'Tag'</span>, <span class="string">'PlotFamilyTimer'</span>);
0787 
0788     handles.TimerHandle = t;
0789     set(handles.figure1, <span class="string">'UserData'</span>, handles);
0790 
0791     start(t);
0792     
0793 <span class="keyword">else</span>
0794     <span class="keyword">try</span>
0795         <span class="comment">% Turn off updating by deleting timer handle</span>
0796         h = get(handles.figure1, <span class="string">'UserData'</span>);
0797         stop(h.TimerHandle);
0798         delete(h.TimerHandle);
0799         h = rmfield(h, <span class="string">'TimerHandle'</span>);
0800         set(handles.figure1, <span class="string">'UserData'</span>, h);
0801         
0802         <span class="comment">% Delete all timers</span>
0803         <span class="comment">%h = timerfind('Tag','PlotFamilyTimer');</span>
0804         <span class="comment">%for i = 1:length(h)</span>
0805         <span class="comment">%    stop(h(i));</span>
0806         <span class="comment">%    delete(h(i));</span>
0807         <span class="comment">%end</span>
0808 
0809         <span class="comment">% Change OnOff label string</span>
0810         set(handles.OnOff, <span class="string">'String'</span>, <span class="string">'Continuous'</span>);
0811     <span class="keyword">catch</span>
0812         fprintf(<span class="string">'   Trouble stopping the timer.\n'</span>);
0813     <span class="keyword">end</span>
0814 <span class="keyword">end</span>
0815 
0816 
0817 <span class="comment">% % --- Executes onoff button press in OnOff.</span>
0818 <span class="comment">% function OnOff_Callback(hObject, eventdata, handles)</span>
0819 <span class="comment">% % Uses delay (not Timer)</span>
0820 <span class="comment">%</span>
0821 <span class="comment">% OrbitFeedbackFlag = 0;</span>
0822 <span class="comment">%</span>
0823 <span class="comment">% % Turn lattice menu back off</span>
0824 <span class="comment">% set(handles.('LatticeMenu'),'enable','off');</span>
0825 <span class="comment">%</span>
0826 <span class="comment">% if strcmpi(get(handles.Simulate,'Checked'),'On')</span>
0827 <span class="comment">%     Mode = 'Simulator';</span>
0828 <span class="comment">% else</span>
0829 <span class="comment">%     Mode = 'Online';</span>
0830 <span class="comment">% end</span>
0831 <span class="comment">%</span>
0832 <span class="comment">% BPMxFamily = getappdata(handles.figure1, 'BPMxFamily');</span>
0833 <span class="comment">% BPMxList = getappdata(handles.figure1, 'BPMxList');</span>
0834 <span class="comment">% BPMyFamily = getappdata(handles.figure1, 'BPMyFamily');</span>
0835 <span class="comment">% BPMyList = getappdata(handles.figure1, 'BPMyList');</span>
0836 <span class="comment">%</span>
0837 <span class="comment">% OnFlag = get(handles.('OnOff'),'Value');</span>
0838 <span class="comment">% if OnFlag</span>
0839 <span class="comment">%     % Turn on updates</span>
0840 <span class="comment">%     set(handles.('OnOff'), 'String', 'Running')</span>
0841 <span class="comment">% end</span>
0842 <span class="comment">%</span>
0843 <span class="comment">% if OrbitFeedbackFlag</span>
0844 <span class="comment">%     [Nbpm, Tbpm] = getbpmaverages;</span>
0845 <span class="comment">%     Tbpm = max(Tbpm);</span>
0846 <span class="comment">% end</span>
0847 <span class="comment">%</span>
0848 <span class="comment">% while OnFlag</span>
0849 <span class="comment">%     t0 = gettime;</span>
0850 <span class="comment">%     OnFlag = get(handles.('OnOff'),'Value');</span>
0851 <span class="comment">%     UpdatePeriod = getappdata(handles.figure1, 'UpdatePeriod');</span>
0852 <span class="comment">%</span>
0853 <span class="comment">%     if OnFlag</span>
0854 <span class="comment">%         % Get new data</span>
0855 <span class="comment">%         try</span>
0856 <span class="comment">%             RawX = getam(BPMxFamily, BPMxList, Mode, 'Struct');</span>
0857 <span class="comment">%         catch</span>
0858 <span class="comment">%             RawX.Data = NaN*zeros(size(BPMxList,1),1);</span>
0859 <span class="comment">%             RawX.Units = 'Hardware';</span>
0860 <span class="comment">%             RawX.TimeStamp = clock;</span>
0861 <span class="comment">%             fprintf('   %s, GETAM trouble in family %s\n', sprintf('%s',datestr(RawX.TimeStamp,14)), BPMxFamily);</span>
0862 <span class="comment">%         end</span>
0863 <span class="comment">%         setappdata(handles.figure1, 'RawX', RawX);</span>
0864 <span class="comment">%</span>
0865 <span class="comment">%         try</span>
0866 <span class="comment">%             RawY = getam(BPMyFamily, BPMyList, Mode, 'Struct');</span>
0867 <span class="comment">%         catch</span>
0868 <span class="comment">%             RawY.Data = NaN*zeros(size(BPMyList,1),1);</span>
0869 <span class="comment">%             RawY.Units = 'Hardware';</span>
0870 <span class="comment">%             RawY.TimeStamp = clock;</span>
0871 <span class="comment">%             fprintf('   %s, GETAM trouble in family %s\n', sprintf('%s',datestr(RawY.TimeStamp,14)), BPMyFamily);</span>
0872 <span class="comment">%         end</span>
0873 <span class="comment">%         setappdata(handles.figure1, 'RawY', RawY);</span>
0874 <span class="comment">%</span>
0875 <span class="comment">%         % For non-BPM the offset (ie, the setpoint) may have changed</span>
0876 <span class="comment">%         if ~ismemberof(BPMxFamily,'BPM')</span>
0877 <span class="comment">%             % Update the offset to the setpoint</span>
0878 <span class="comment">%             setappdata(handles.figure1,'OffsetX', getsp(BPMxFamily, BPMxList, Mode));</span>
0879 <span class="comment">%         end</span>
0880 <span class="comment">%         if ~ismemberof(BPMyFamily,'BPM')</span>
0881 <span class="comment">%             % Update the offset to the setpoint</span>
0882 <span class="comment">%             setappdata(handles.figure1,'OffsetY', getsp(BPMyFamily, BPMyList, Mode));</span>
0883 <span class="comment">%         end</span>
0884 <span class="comment">%</span>
0885 <span class="comment">%         % Update time</span>
0886 <span class="comment">%         set(handles.('Time'),'String', sprintf('%s',datestr(RawY.TimeStamp,14)));</span>
0887 <span class="comment">%</span>
0888 <span class="comment">%         plotappdatalocal(handles);</span>
0889 <span class="comment">%         drawnow;</span>
0890 <span class="comment">%</span>
0891 <span class="comment">%</span>
0892 <span class="comment">%         if OrbitFeedbackFlag</span>
0893 <span class="comment">%             % One could easily add a orbit feedback step</span>
0894 <span class="comment">%             setorbitdefault([], 1, [], 'NoDisplay');</span>
0895 <span class="comment">%             pause(2.2*Tbpm);</span>
0896 <span class="comment">%         end</span>
0897 <span class="comment">%</span>
0898 <span class="comment">%     else</span>
0899 <span class="comment">%         set(handles.('OnOff'), 'String', 'Continuous');</span>
0900 <span class="comment">%</span>
0901 <span class="comment">%         % Turn lattice menu back on</span>
0902 <span class="comment">%         set(handles.('LatticeMenu'),'enable','on');</span>
0903 <span class="comment">%</span>
0904 <span class="comment">%         break</span>
0905 <span class="comment">%     end</span>
0906 <span class="comment">%</span>
0907 <span class="comment">%     % Pause</span>
0908 <span class="comment">%     T = UpdatePeriod-(gettime-t0);</span>
0909 <span class="comment">%     if T &gt; 0</span>
0910 <span class="comment">%         pause(T);</span>
0911 <span class="comment">%     end</span>
0912 <span class="comment">% end</span>
0913 
0914 
0915 
0916 <span class="comment">% --- Executes on button press in OneShot.</span>
0917 <a name="_sub10" href="#_subfunctions" class="code">function OneShot_Callback(hObject, eventdata, handles)</a>
0918 
0919 <span class="comment">% To break out of the continuous loop (if in it)</span>
0920 <span class="comment">%set(handles.('OnOff'),'Value', 0);  % Not turned off with timer!</span>
0921 
0922 
0923 <span class="comment">% Get Mode and update the title bar</span>
0924 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
0925     <a href="#_sub3" class="code" title="subfunction SetFigureTitle(h_fig, ModeString)">SetFigureTitle</a>(handles.figure1, <span class="string">'Model'</span>)
0926     Mode = <span class="string">'Simulator'</span>;
0927 <span class="keyword">else</span>
0928     <a href="#_sub3" class="code" title="subfunction SetFigureTitle(h_fig, ModeString)">SetFigureTitle</a>(handles.figure1, <span class="string">'Online'</span>)
0929     Mode = <span class="string">'Online'</span>;
0930 <span class="keyword">end</span>
0931 
0932 <span class="comment">% Get the structures</span>
0933 DataStruct1 = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
0934 DataStruct2 = getappdata(handles.figure1, <span class="string">'BPMyFamily'</span>);
0935 
0936 <span class="comment">% Get new data</span>
0937 <span class="keyword">try</span>
0938     RawX = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>(DataStruct1, Mode, <span class="string">'Struct'</span>);
0939     <span class="comment">%RawX = getpv(DataStruct1, Mode, UnitsFlag, 'Struct');</span>
0940 <span class="keyword">catch</span>
0941     RawX.Data = NaN*zeros(size(DataStruct1.Data,1),1);
0942     RawX.Units = DataStruct1.Units;
0943     RawX.UnitsString = DataStruct1.UnitsString;
0944     RawX.Mode = Mode;
0945     RawX.TimeStamp = clock;
0946     fprintf(<span class="string">'\n%s\n'</span>, lasterr);
0947     fprintf(<span class="string">'   %s, GETPV trouble in family %s\n'</span>, sprintf(<span class="string">'%s'</span>,datestr(RawX.TimeStamp,14)), DataStruct1.FamilyName);
0948 <span class="keyword">end</span>
0949 setappdata(handles.figure1, <span class="string">'RawX'</span>, RawX);
0950 
0951 <span class="keyword">try</span>
0952     RawY = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>(DataStruct2, Mode, <span class="string">'Struct'</span>);
0953     <span class="comment">%RawY = getpv(DataStruct2, Mode, UnitsFlag, 'Struct');</span>
0954 <span class="keyword">catch</span>
0955     RawY.Data = NaN*zeros(size(DataStruct2.Data,1),1);
0956     RawY.Units = DataStruct2.Units;
0957     RawY.UnitsString = DataStruct2.UnitsString;
0958     RawY.Mode = Mode;
0959     RawY.TimeStamp = clock;
0960     fprintf(<span class="string">'\n%s\n'</span>, lasterr);
0961     fprintf(<span class="string">'   %s, GETPV trouble in family %s\n'</span>, sprintf(<span class="string">'%s'</span>,datestr(RawY.TimeStamp,14)), DataStruct2.FamilyName);
0962 <span class="keyword">end</span>
0963 setappdata(handles.figure1, <span class="string">'RawY'</span>, RawY);
0964 
0965 
0966 <span class="comment">% % For non-BPM the offset (ie, the setpoint) may have changed</span>
0967 <span class="comment">% if ~isempty(getfamilydata(DataStruct1.FamilyName,'Setpoint'))</span>
0968 <span class="comment">%     % Update the offset to the setpoint</span>
0969 <span class="comment">%     setappdata(handles.figure1,'OffsetX', getsp(DataStruct1.FamilyName, Mode, DataStruct1.Units, 'Struct'));</span>
0970 <span class="comment">% end</span>
0971 <span class="comment">% if ~isempty(getfamilydata(DataStruct2.FamilyName,'Setpoint'))</span>
0972 <span class="comment">%     % Update the offset to the setpoint</span>
0973 <span class="comment">%     setappdata(handles.figure1,'OffsetY', getsp(DataStruct2.FamilyName, Mode, DataStruct2.Units, 'Struct'));</span>
0974 <span class="comment">% end</span>
0975 
0976 
0977 <span class="comment">% Update time</span>
0978 set(handles.Time, <span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>,datestr(RawY.TimeStamp,14)));
0979 
0980 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
0981 drawnow;
0982 
0983 
0984 
0985 <a name="_sub11" href="#_subfunctions" class="code">function plotappdatalocal(handles)  </a>
0986 
0987 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
0988     Mode = <span class="string">'Simulator'</span>;
0989 <span class="keyword">else</span>
0990     Mode = <span class="string">'Online'</span>;
0991 <span class="keyword">end</span>
0992 
0993 
0994 <span class="comment">% Get data from appdata</span>
0995 Trace1 = getappdata(handles.figure1,<span class="string">'Trace1'</span>);
0996 Trace2 = getappdata(handles.figure1,<span class="string">'Trace2'</span>);
0997 UnitsFlag = getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>);
0998 
0999 DataStruct1 = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
1000 DataStruct2 = getappdata(handles.figure1, <span class="string">'BPMyFamily'</span>);
1001 
1002 RawX = getappdata(handles.figure1, <span class="string">'RawX'</span>);
1003 RawY = getappdata(handles.figure1, <span class="string">'RawY'</span>);
1004 
1005 sx = getappdata(handles.figure1, <span class="string">'SPosX'</span>);
1006 sy = getappdata(handles.figure1, <span class="string">'SPosY'</span>);
1007 
1008 <span class="keyword">if</span> isempty(sx)
1009     error(sprintf(<span class="string">'Position along ring information not available for %s family.'</span>, RawX.FamilyName));
1010     <span class="comment">%sx = 1:size(RawX.Data,1);</span>
1011 <span class="keyword">end</span>
1012 <span class="keyword">if</span> isempty(sy)
1013     error(sprintf(<span class="string">'Position along ring information not available for %s family.'</span>, RawY.FamilyName));
1014     <span class="comment">%sy = 1:size(RawY.Data,1);</span>
1015 <span class="keyword">end</span>
1016 
1017 ChannelA = getappdata(handles.figure1, <span class="string">'ChannelA'</span>);
1018 ChannelB = getappdata(handles.figure1, <span class="string">'ChannelB'</span>);
1019 
1020 <span class="keyword">if</span> Trace1 == 1 || Trace1 == 3 || Trace2 == 1 || Trace2 == 3
1021     <span class="keyword">if</span> ChannelA == 1
1022         DataA1 = RawX.Data;
1023         DataA2 = RawY.Data;
1024     <span class="keyword">elseif</span> ChannelA == 2
1025         <span class="comment">%DataA1 = getappdata(handles.figure1,'GoldenX');</span>
1026         <span class="comment">%DataA1 = DataA1.Data;</span>
1027         <span class="comment">%DataA2 = getappdata(handles.figure1,'GoldenY');</span>
1028         <span class="comment">%DataA2 = DataA2.Data;</span>
1029 
1030         <span class="keyword">if</span> strcmpi(DataStruct1.Field, <span class="string">'Monitor'</span>) &amp;&amp; ~isempty(<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(DataStruct1.FamilyName,<span class="string">'Setpoint'</span>))
1031             <span class="comment">% Display the setpoint golden value</span>
1032             DataA1 = <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>(DataStruct1, <span class="string">'Setpoint'</span>, DataStruct1.Units, <span class="string">'Numeric'</span>);
1033         <span class="keyword">else</span>
1034             DataA1 = <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>(DataStruct1, DataStruct1.Units, <span class="string">'Numeric'</span>);
1035         <span class="keyword">end</span>
1036 
1037         <span class="keyword">if</span> strcmpi(DataStruct2.Field, <span class="string">'Monitor'</span>) &amp;&amp; ~isempty(<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(DataStruct2.FamilyName,<span class="string">'Setpoint'</span>))
1038             <span class="comment">% Display the setpoint golden value</span>
1039             DataA2 = <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>(DataStruct2, <span class="string">'Setpoint'</span>, DataStruct2.Units, <span class="string">'Numeric'</span>);
1040         <span class="keyword">else</span>
1041             DataA2 = <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>(DataStruct2, DataStruct2.Units, <span class="string">'Numeric'</span>);
1042         <span class="keyword">end</span>
1043 
1044     <span class="keyword">elseif</span> ChannelA == 3
1045         <span class="comment">%DataA1 = getappdata(handles.figure1,'OffsetX');</span>
1046         <span class="comment">%DataA1 = DataA1.Data;</span>
1047         <span class="comment">%DataA2 = getappdata(handles.figure1,'OffsetY');</span>
1048         <span class="comment">%DataA2 = DataA2.Data;</span>
1049         
1050         <span class="keyword">if</span> strcmpi(DataStruct1.Field, <span class="string">'Monitor'</span>) &amp;&amp; ~isempty(<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(DataStruct1.FamilyName,<span class="string">'Setpoint'</span>))
1051             <span class="comment">% Update the offset to the setpoint</span>
1052             DataA1 = <a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>(DataStruct1, Mode, DataStruct1.Units, <span class="string">'Numeric'</span>);
1053         <span class="keyword">else</span>
1054             DataA1 = <a href="getoffset.html" class="code" title="function Data = getoffset(varargin)">getoffset</a>(DataStruct1, DataStruct1.Units, <span class="string">'Numeric'</span>);
1055         <span class="keyword">end</span>
1056         
1057         <span class="keyword">if</span> strcmpi(DataStruct2.Field, <span class="string">'Monitor'</span>) &amp;&amp; ~isempty(<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(DataStruct2.FamilyName,<span class="string">'Setpoint'</span>))
1058             <span class="comment">% Update the offset to the setpoint</span>
1059             DataA2 = <a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>(DataStruct2, Mode, DataStruct2.Units, <span class="string">'Numeric'</span>);
1060         <span class="keyword">else</span>
1061             DataA2 = <a href="getoffset.html" class="code" title="function Data = getoffset(varargin)">getoffset</a>(DataStruct2, DataStruct2.Units, <span class="string">'Numeric'</span>);
1062         <span class="keyword">end</span>
1063 
1064     <span class="keyword">elseif</span> ChannelA == 4
1065         DataA1 = getappdata(handles.figure1,<span class="string">'SaveX'</span>);
1066         DataA1 = DataA1.Data;
1067         DataA2 = getappdata(handles.figure1,<span class="string">'SaveY'</span>);
1068         DataA2 = DataA2.Data;
1069     <span class="keyword">elseif</span> ChannelA == 5
1070         DataA1 = getappdata(handles.figure1,<span class="string">'FileX'</span>);
1071         DataA1 = DataA1.Data;
1072         DataA2 = getappdata(handles.figure1,<span class="string">'FileY'</span>);
1073         DataA2 = DataA2.Data;
1074     <span class="keyword">else</span> 
1075         DataA1 = zeros(size(BPMxList,1),1);
1076         DataA2 = zeros(size(BPMyList,1),1);
1077     <span class="keyword">end</span>
1078 <span class="keyword">end</span>
1079 
1080 <span class="keyword">if</span> Trace1 == 2 || Trace1 == 3 || Trace2 == 2 || Trace2 == 3
1081     <span class="keyword">if</span> ChannelB == 1
1082         DataB1 = RawX.Data;
1083         DataB2 = RawY.Data;
1084     <span class="keyword">elseif</span> ChannelB == 2
1085         <span class="comment">%DataB1 = getappdata(handles.figure1,'GoldenX');</span>
1086         <span class="comment">%DataB1 = DataB1.Data;</span>
1087         <span class="comment">%DataB2 = getappdata(handles.figure1,'GoldenY');</span>
1088         <span class="comment">%DataB2 = DataB2.Data;</span>
1089 
1090         <span class="keyword">if</span> strcmpi(DataStruct1.Field, <span class="string">'Monitor'</span>) &amp;&amp; ~isempty(<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(DataStruct1.FamilyName,<span class="string">'Setpoint'</span>))
1091             <span class="comment">% Display the setpoint golden value</span>
1092             DataB1 = <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>(DataStruct1, <span class="string">'Setpoint'</span>, DataStruct1.Units, <span class="string">'Numeric'</span>);
1093         <span class="keyword">else</span>
1094             DataB1 = <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>(DataStruct1, DataStruct1.Units, <span class="string">'Numeric'</span>);
1095         <span class="keyword">end</span>
1096 
1097         <span class="keyword">if</span> strcmpi(DataStruct2.Field, <span class="string">'Monitor'</span>) &amp;&amp; ~isempty(<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(DataStruct2.FamilyName,<span class="string">'Setpoint'</span>))
1098             <span class="comment">% Display the setpoint golden value</span>
1099             DataB2 = <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>(DataStruct2, <span class="string">'Setpoint'</span>, DataStruct2.Units, <span class="string">'Numeric'</span>);
1100         <span class="keyword">else</span>
1101             DataB2 = <a href="getgolden.html" class="code" title="function Data = getgolden(varargin)">getgolden</a>(DataStruct2, DataStruct2.Units, <span class="string">'Numeric'</span>);
1102         <span class="keyword">end</span>
1103 
1104     <span class="keyword">elseif</span> ChannelB == 3
1105         <span class="comment">%DataB1 = getappdata(handles.figure1,'OffsetX');</span>
1106         <span class="comment">%DataB1 = DataB1.Data;</span>
1107         <span class="comment">%DataB2 = getappdata(handles.figure1,'OffsetY');</span>
1108         <span class="comment">%DataB2 = DataB2.Data;</span>
1109 
1110         <span class="keyword">if</span> strcmpi(DataStruct1.Field, <span class="string">'Monitor'</span>) &amp;&amp; ~isempty(<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(DataStruct1.FamilyName,<span class="string">'Setpoint'</span>))
1111             <span class="comment">% Update the offset to the setpoint</span>
1112             DataB1 = <a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>(DataStruct1.FamilyName, DataStruct1.DeviceList, Mode, DataStruct1.Units, <span class="string">'Numeric'</span>);
1113         <span class="keyword">else</span>
1114             DataB1 = <a href="getoffset.html" class="code" title="function Data = getoffset(varargin)">getoffset</a>(DataStruct1, DataStruct1.DeviceList, DataStruct1.Units, <span class="string">'Numeric'</span>);
1115         <span class="keyword">end</span>
1116 
1117         <span class="keyword">if</span> strcmpi(DataStruct2.Field, <span class="string">'Monitor'</span>) &amp;&amp; ~isempty(<a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(DataStruct2.FamilyName,<span class="string">'Setpoint'</span>))
1118             <span class="comment">% Update the offset to the setpoint</span>
1119             DataB2 = <a href="getsp.html" class="code" title="function [SP, tout, DataTime, ErrorFlag] = getsp(Family, varargin)">getsp</a>(DataStruct2, Mode, DataStruct2.Units, <span class="string">'Numeric'</span>);
1120         <span class="keyword">else</span>
1121             DataB2 = <a href="getoffset.html" class="code" title="function Data = getoffset(varargin)">getoffset</a>(DataStruct2, DataStruct2.Units, <span class="string">'Numeric'</span>);
1122         <span class="keyword">end</span>
1123     <span class="keyword">elseif</span> ChannelB == 4
1124         DataB1 = getappdata(handles.figure1,<span class="string">'SaveX'</span>);
1125         DataB1 = DataB1.Data;
1126         
1127         DataB2 = getappdata(handles.figure1,<span class="string">'SaveY'</span>);
1128         DataB2 = DataB2.Data;
1129 
1130     <span class="keyword">elseif</span> ChannelB == 5
1131         DataB1 = getappdata(handles.figure1,<span class="string">'FileX'</span>);
1132         DataB1 = DataB1.Data;
1133         DataB2 = getappdata(handles.figure1,<span class="string">'FileY'</span>);
1134         DataB2 = DataB2.Data;
1135     <span class="keyword">else</span>
1136         DataB1 = zeros(size(BPMxList,1),1);
1137         DataB2 = zeros(size(BPMyList,1),1);
1138     <span class="keyword">end</span>
1139 <span class="keyword">end</span>
1140 
1141 
1142 <span class="comment">% First line</span>
1143 <span class="keyword">if</span> Trace1 == 1
1144     Data1 = DataA1;
1145     Data2 = DataA2;
1146 <span class="keyword">elseif</span> Trace1 == 2
1147     Data1 = DataB1;
1148     Data2 = DataB2;
1149 <span class="keyword">elseif</span> Trace1 == 3
1150     Data1 = DataA1 - DataB1;
1151     Data2 = DataA2 - DataB2;
1152 <span class="keyword">end</span>
1153 
1154 
1155 <span class="comment">% Second line</span>
1156 <span class="keyword">if</span> Trace2 == 4
1157     Data3 = NaN * Data1;
1158     Data4 = NaN * Data2;
1159 <span class="keyword">else</span>
1160     <span class="keyword">if</span> Trace2 == 1
1161         Data3 = DataA1;
1162         Data4 = DataA2;
1163     <span class="keyword">elseif</span> Trace2 == 2
1164         Data3 = DataB1;
1165         Data4 = DataB2;
1166     <span class="keyword">elseif</span> Trace2 == 3
1167         Data3 = DataA1 - DataB1;
1168         Data4 = DataA2 - DataB2;
1169     <span class="keyword">end</span>
1170 <span class="keyword">end</span>
1171 
1172 
1173 
1174 <span class="comment">% if UnitsFlag == 1 &amp;&amp; strcmpi(RawX.Units,'Hardware')</span>
1175 <span class="comment">%     % Physics units requested, data is in Hardware units</span>
1176 <span class="comment">%     Data1 = hw2physics(BPMxFamily, 'Monitor', Data1);</span>
1177 <span class="comment">%     Data2 = hw2physics(BPMyFamily, 'Monitor', Data2);</span>
1178 <span class="comment">%     Data3 = hw2physics(BPMxFamily, 'Monitor', Data3);</span>
1179 <span class="comment">%     Data4 = hw2physics(BPMyFamily, 'Monitor', Data4);</span>
1180 <span class="comment">% elseif (UnitsFlag==2 | UnitsFlag==3) &amp;&amp; strcmpi(RawX.Units,'Physics')</span>
1181 <span class="comment">%     % Hardware units requested, data is in Physics units</span>
1182 <span class="comment">%     Data1 = physics2hw(BPMxFamily, 'Monitor', Data1);</span>
1183 <span class="comment">%     Data2 = physics2hw(BPMyFamily, 'Monitor', Data2);</span>
1184 <span class="comment">%     Data3 = physics2hw(BPMxFamily, 'Monitor', Data3);</span>
1185 <span class="comment">%     Data4 = physics2hw(BPMyFamily, 'Monitor', Data4);</span>
1186 <span class="comment">% end</span>
1187 
1188 UnitsString1 = DataStruct1.UnitsString;
1189 UnitsString2 = DataStruct2.UnitsString;
1190 <span class="comment">% if UnitsFlag == 1</span>
1191 <span class="comment">%     % Physics units</span>
1192 <span class="comment">%     UnitsString1 = getfamilydata(DataStruct1.FamilyName, DataStruct1.Field, 'PhysicsUnits');</span>
1193 <span class="comment">%     UnitsString2 = getfamilydata(DataStruct2.FamilyName, DataStruct2.Field, 'PhysicsUnits');</span>
1194 <span class="comment">% elseif UnitsFlag == 2</span>
1195 <span class="comment">%     % Hardware units</span>
1196 <span class="comment">%     UnitsString1 = getfamilydata(DataStruct1.FamilyName, DataStruct1.Field, 'HWUnits');</span>
1197 <span class="comment">%     UnitsString2 = getfamilydata(DataStruct2.FamilyName, DataStruct2.Field, 'HWUnits');</span>
1198 <span class="keyword">if</span> UnitsFlag == 3
1199     <span class="comment">% Hardware units time 1000</span>
1200     Data1 = 1000 * Data1;
1201     Data2 = 1000 * Data2;
1202     Data3 = 1000 * Data3;
1203     Data4 = 1000 * Data4;
1204     <span class="comment">%UnitsString1 = getfamilydata(DataStruct1.FamilyName, DataStruct1.Field, 'HWUnits');</span>
1205     <span class="comment">%UnitsString2 = getfamilydata(DataStruct2.FamilyName, DataStruct2.Field, 'HWUnits');</span>
1206     <span class="keyword">if</span> strcmpi(UnitsString1,<span class="string">'mm'</span>)
1207         UnitsString1 = <span class="string">'\mum'</span>;
1208     <span class="keyword">else</span>
1209         <span class="comment">%UnitsString1 = ['1000x', UnitsString1];</span>
1210         UnitsString1 = [<span class="string">'milli'</span>, UnitsString1];
1211     <span class="keyword">end</span>
1212     <span class="keyword">if</span> strcmpi(UnitsString2,<span class="string">'mm'</span>)
1213         UnitsString2 = <span class="string">'\mum'</span>;
1214     <span class="keyword">else</span>
1215         <span class="comment">%UnitsString2 = ['1000x', UnitsString2];</span>
1216         UnitsString2 = [<span class="string">'milli'</span>, UnitsString2];
1217     <span class="keyword">end</span>
1218 <span class="keyword">end</span>
1219 
1220 
1221 <span class="comment">% Axes 1</span>
1222 h = get(handles.Graph1,<span class="string">'Children'</span>);
1223 AxisRange1X = getappdata(handles.figure1, <span class="string">'AxisRange1X'</span>);
1224 
1225 <span class="comment">% Bar graph setup</span>
1226 <span class="keyword">if</span> strcmpi(get(handles.Graph1Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1227     <span class="comment">%  #pts  BarWidth</span>
1228     Table = [
1229         0    .01
1230         24    .025
1231         48    .05
1232         120   .10
1233         1000  .3
1234         3000  .40
1235         1e5   .50
1236         ];
1237     L = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Circumference'</span>);
1238     WidthScaleFactor = interp1(Table(:,1), Table(:,2), length(Data1), <span class="string">'linear'</span>);
1239     WidthScaleFactor = WidthScaleFactor * (L/length(sx)) / min(diff(sx));
1240 <span class="keyword">end</span>
1241 
1242 <span class="comment">% Don't change the axis (unless it's the first time)</span>
1243 <span class="keyword">if</span> isempty(h)
1244     cla(handles.Graph1);
1245     <span class="keyword">if</span> strcmpi(get(handles.Graph1Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1246         <span class="comment">% Bar graph</span>
1247         h(1) = bar(handles.Graph1, sx, Data1(:), WidthScaleFactor);
1248         hold(handles.Graph1, <span class="string">'on'</span>);
1249         h(2) = bar(handles.Graph1, sx, Data3(:), WidthScaleFactor/2);
1250         hold(handles.Graph1, <span class="string">'off'</span>);
1251         set(h(1),<span class="string">'FaceColor'</span>,<span class="string">'b'</span>);
1252         set(h(1),<span class="string">'EdgeColor'</span>,<span class="string">'b'</span>);
1253         <span class="keyword">if</span> get(handles.Trace2Off, <span class="string">'Value'</span>)
1254             set(h(2),<span class="string">'FaceColor'</span>,<span class="string">'k'</span>);
1255             set(h(2),<span class="string">'EdgeColor'</span>,<span class="string">'k'</span>);
1256         <span class="keyword">else</span>
1257             set(h(2),<span class="string">'FaceColor'</span>,<span class="string">'r'</span>);
1258             set(h(2),<span class="string">'EdgeColor'</span>,<span class="string">'r'</span>);
1259         <span class="keyword">end</span>
1260     <span class="keyword">else</span>
1261         h = plot(handles.Graph1, sx, [Data1(:) Data3(:)],<span class="string">'.-'</span>);
1262         set(h(1),<span class="string">'Color'</span>,<span class="string">'b'</span>);
1263         set(h(2),<span class="string">'Color'</span>,<span class="string">'r'</span>);
1264     <span class="keyword">end</span>
1265 
1266     <span class="comment">% plot(handles.Graph1, sx, Data3,'squarer','MarkerSize',3);</span>
1267     <span class="comment">% plot(handles.Graph1, sx, Data1,'squareb','MarkerSize',3);</span>
1268 
1269     <span class="comment">% Set defaults</span>
1270     set(handles.Graph1, <span class="string">'Nextplot'</span>,      <span class="string">'Add'</span>);
1271     set(handles.Graph1, <span class="string">'YGrid'</span>,         <span class="string">'On'</span>);
1272     set(handles.Graph1, <span class="string">'YMinorTick'</span>,    <span class="string">'On'</span>);
1273     set(handles.Graph1, <span class="string">'XMinorTick'</span>,    <span class="string">'On'</span>);
1274     set(handles.Graph1, <span class="string">'XAxisLocation'</span>, <span class="string">'Bottom'</span>);
1275     set(handles.Graph1, <span class="string">'XTickLabel'</span>,    <span class="string">''</span>);
1276 
1277     a = axis(handles.Graph1);
1278     axis(handles.Graph1, [AxisRange1X(1) AxisRange1X(2) a(3) a(4)]);   
1279     
1280     <span class="keyword">if</span> strcmpi(get(handles.(<span class="string">'YScaleLog1'</span>),<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1281         set(handles.Graph1,<span class="string">'YScale'</span>,<span class="string">'Log'</span>);
1282     <span class="keyword">else</span>
1283         set(handles.Graph1,<span class="string">'YScale'</span>,<span class="string">'Linear'</span>);
1284     <span class="keyword">end</span>
1285     
1286     set(handles.Graph1 ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
1287     h = get(handles.Graph1,<span class="string">'Children'</span>);
1288     <span class="keyword">for</span> i = 1:length(h)
1289         set(h(i) ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
1290     <span class="keyword">end</span>
1291 <span class="keyword">else</span>
1292     <span class="comment">% This fixes a weird error with srcontrol</span>
1293     h = sort(h(end-1:end));
1294     
1295     a = axis(handles.Graph1);
1296     set(h(1), <span class="string">'XData'</span>, sx, <span class="string">'YData'</span>, Data1);
1297     set(h(2), <span class="string">'XData'</span>, sx, <span class="string">'YData'</span>, Data3);
1298 
1299     <span class="keyword">if</span> strcmpi(get(handles.Graph1Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1300         set(h(1),<span class="string">'BarWidth'</span>,WidthScaleFactor);
1301         set(h(2),<span class="string">'BarWidth'</span>,WidthScaleFactor/2);
1302         <span class="keyword">if</span> get(handles.Trace2Off, <span class="string">'Value'</span>)
1303             set(h(2),<span class="string">'FaceColor'</span>,<span class="string">'k'</span>);
1304             set(h(2),<span class="string">'EdgeColor'</span>,<span class="string">'k'</span>);
1305         <span class="keyword">else</span>
1306             set(h(2),<span class="string">'FaceColor'</span>,<span class="string">'r'</span>);
1307             set(h(2),<span class="string">'EdgeColor'</span>,<span class="string">'r'</span>);
1308         <span class="keyword">end</span>
1309     <span class="keyword">end</span>
1310     
1311     axis(handles.Graph1, [AxisRange1X(1) AxisRange1X(2) a(3) a(4)]);
1312 <span class="keyword">end</span>
1313 
1314 h_label=get(handles.Graph1,<span class="string">'ylabel'</span>);
1315 
1316 
1317 <span class="keyword">if</span> strcmpi(DataStruct1.Field,<span class="string">'Monitor'</span>)
1318     <span class="keyword">if</span> isempty(UnitsString1)
1319         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>,      DataStruct1.FamilyName), <span class="string">'Interpreter'</span>,<span class="string">'None'</span>);
1320     <span class="keyword">elseif</span> strcmpi(UnitsString1,<span class="string">'\mum'</span>)
1321         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s [%s]'</span>, DataStruct1.FamilyName, UnitsString1), <span class="string">'Interpreter'</span>,<span class="string">'Tex'</span>);
1322     <span class="keyword">else</span>
1323         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s [%s]'</span>, DataStruct1.FamilyName, UnitsString1), <span class="string">'Interpreter'</span>,<span class="string">'None'</span>);
1324     <span class="keyword">end</span>
1325 <span class="keyword">else</span>
1326     <span class="keyword">if</span> isempty(UnitsString1)
1327         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s.%s'</span>,      DataStruct1.FamilyName, DataStruct1.Field), <span class="string">'Interpreter'</span>,<span class="string">'None'</span>);
1328     <span class="keyword">elseif</span> strcmpi(UnitsString1,<span class="string">'\mum'</span>)
1329         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s.%s [%s]'</span>, DataStruct1.FamilyName, DataStruct1.Field, UnitsString1), <span class="string">'Interpreter'</span>,<span class="string">'Tex'</span>);
1330     <span class="keyword">else</span>
1331         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s.%s [%s]'</span>, DataStruct1.FamilyName, DataStruct1.Field, UnitsString1), <span class="string">'Interpreter'</span>,<span class="string">'None'</span>);
1332     <span class="keyword">end</span>
1333 <span class="keyword">end</span>
1334 
1335 
1336 <span class="comment">% Graph 3</span>
1337 <span class="keyword">if</span> strcmpi(get(handles.(<span class="string">'AddPlot1_Nothing'</span>),<span class="string">'Checked'</span>),<span class="string">'Off'</span>)
1338     <span class="comment">% Bring Graph 3 forward</span>
1339     axes(handles.Graph3);
1340 <span class="keyword">end</span>
1341 
1342 <span class="comment">% Remove NaN</span>
1343 i = find(~isnan(Data1));
1344 <span class="keyword">if</span> isempty(i)
1345     MeanString = <span class="string">''</span>;
1346     RMSString  = <span class="string">''</span>;
1347 <span class="keyword">else</span>
1348     MeanString = sprintf(<span class="string">'%+9.6e Mean'</span>, mean(Data1(i)));
1349     RMSString  = sprintf(<span class="string">'%+9.6e RMS'</span>, (length(Data1(i))-1)*std(Data1(i))/length(Data1(i)));
1350 <span class="keyword">end</span>
1351 set(handles.Trace1RMS,<span class="string">'String'</span>,{MeanString, RMSString});
1352 set(handles.Trace1RMS,<span class="string">'FontSize'</span>, 9);
1353 
1354 <span class="comment">% Set the list box</span>
1355 Value = get(handles.DataList1, <span class="string">'Value'</span>);
1356 set(handles.DataList1, <span class="string">'Value'</span>, Value);
1357 ListBoxTop = get(handles.DataList1, <span class="string">'ListBoxTop'</span>);
1358 set(handles.DataList1, <span class="string">'String'</span>, [DataStruct1.ListBoxString, num2str(Data1(:),<span class="string">'%+.4e'</span>)]);
1359 set(handles.DataList1, <span class="string">'ListBoxTop'</span>, ListBoxTop);
1360 
1361 
1362 <span class="comment">% Axes 2</span>
1363 h = get(handles.Graph2,<span class="string">'Children'</span>);
1364 AxisRange2X = getappdata(handles.figure1, <span class="string">'AxisRange2X'</span>);
1365 
1366 <span class="comment">% Bar graph setup</span>
1367 <span class="keyword">if</span> strcmpi(get(handles.Graph2Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1368     <span class="comment">%  #pts  BarWidth</span>
1369     Table = [
1370         0    .01
1371         24    .025
1372         48    .05
1373         120   .10
1374         1000  .3
1375         3000  .40
1376         1e5   .50
1377         ];
1378     L = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Circumference'</span>);
1379     WidthScaleFactor = interp1(Table(:,1), Table(:,2), length(Data2), <span class="string">'linear'</span>);
1380     WidthScaleFactor = WidthScaleFactor * (L/length(sy)) / min(diff(sy));
1381 <span class="keyword">end</span>
1382 
1383 
1384 <span class="keyword">if</span> isempty(h)
1385     cla(handles.Graph2);
1386     <span class="keyword">if</span> strcmpi(get(handles.Graph2Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1387         <span class="comment">% Bar graph</span>
1388         h(1) = bar(handles.Graph2, sy, Data2(:), WidthScaleFactor);
1389         hold(handles.Graph2, <span class="string">'on'</span>);
1390         h(2) = bar(handles.Graph2, sy, Data4(:), WidthScaleFactor/2);
1391         hold(handles.Graph2, <span class="string">'off'</span>);
1392         set(h(1),<span class="string">'FaceColor'</span>,<span class="string">'b'</span>);
1393         set(h(1),<span class="string">'EdgeColor'</span>,<span class="string">'b'</span>);
1394         <span class="keyword">if</span> get(handles.Trace2Off, <span class="string">'Value'</span>)
1395             set(h(2),<span class="string">'FaceColor'</span>,<span class="string">'k'</span>);
1396             set(h(2),<span class="string">'EdgeColor'</span>,<span class="string">'k'</span>);
1397         <span class="keyword">else</span>
1398             set(h(2),<span class="string">'FaceColor'</span>,<span class="string">'r'</span>);
1399             set(h(2),<span class="string">'EdgeColor'</span>,<span class="string">'r'</span>);
1400         <span class="keyword">end</span>
1401     <span class="keyword">else</span>
1402         h = plot(handles.Graph2, sy, [Data2(:) Data4(:)],<span class="string">'.-'</span>);
1403         set(h(1),<span class="string">'Color'</span>,<span class="string">'b'</span>);
1404         set(h(2),<span class="string">'Color'</span>,<span class="string">'r'</span>);
1405     <span class="keyword">end</span>
1406 
1407     <span class="comment">% Set defaults</span>
1408     set(handles.Graph2, <span class="string">'Nextplot'</span>,      <span class="string">'Add'</span>);
1409     set(handles.Graph2, <span class="string">'YGrid'</span>,         <span class="string">'On'</span>);
1410     set(handles.Graph2, <span class="string">'YMinorTick'</span>,    <span class="string">'On'</span>);
1411     set(handles.Graph2, <span class="string">'XMinorTick'</span>,    <span class="string">'On'</span>);
1412     set(handles.Graph2, <span class="string">'XAxisLocation'</span>, <span class="string">'Bottom'</span>);
1413     
1414     a = axis(handles.Graph2);
1415     axis(handles.Graph2, [AxisRange2X(1) AxisRange2X(2) a(3) a(4)])
1416     
1417     <span class="keyword">if</span> strcmpi(get(handles.(<span class="string">'YScaleLog2'</span>),<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1418         set(handles.Graph2,<span class="string">'YScale'</span>,<span class="string">'Log'</span>);
1419     <span class="keyword">else</span>
1420         set(handles.Graph2,<span class="string">'YScale'</span>,<span class="string">'Linear'</span>);
1421     <span class="keyword">end</span>
1422 
1423     set(handles.Graph2 ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph2_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
1424     h = get(handles.Graph2,<span class="string">'Children'</span>);
1425     <span class="keyword">for</span> i = 1:length(h)
1426         set(h(i) ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph2_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
1427     <span class="keyword">end</span>
1428 <span class="keyword">else</span>
1429     <span class="comment">% This fixes a weird error with srcontrol</span>
1430     h = sort(h(end-1:end));
1431     
1432     a = axis(handles.Graph2);
1433     set(h(1), <span class="string">'XData'</span>, sy, <span class="string">'YData'</span>, Data2);
1434     set(h(2), <span class="string">'XData'</span>, sy, <span class="string">'YData'</span>, Data4);
1435 
1436     <span class="keyword">if</span> strcmpi(get(handles.Graph2Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1437         set(h(1),<span class="string">'BarWidth'</span>,WidthScaleFactor);
1438         set(h(2),<span class="string">'BarWidth'</span>,WidthScaleFactor/2);
1439         <span class="keyword">if</span> get(handles.Trace2Off, <span class="string">'Value'</span>)
1440             set(h(2),<span class="string">'FaceColor'</span>,<span class="string">'k'</span>);
1441             set(h(2),<span class="string">'EdgeColor'</span>,<span class="string">'k'</span>);
1442         <span class="keyword">else</span>
1443             set(h(2),<span class="string">'FaceColor'</span>,<span class="string">'r'</span>);
1444             set(h(2),<span class="string">'EdgeColor'</span>,<span class="string">'r'</span>);
1445         <span class="keyword">end</span>
1446     <span class="keyword">end</span>
1447 
1448     <span class="comment">%% Add the model orbit to the plot</span>
1449     <span class="comment">%[x, y, sx, sy] = modeltwiss('x', 'All');</span>
1450     <span class="comment">%h4 = get(handles.Graph4,'children');</span>
1451     <span class="comment">%set(h4, 'XData', sx, 'YData', x);</span>
1452     <span class="comment">%axis(h4, [AxisRange2X(1) AxisRange2X(2) a(3) a(4)]);</span>
1453 
1454     axis(handles.Graph2, [AxisRange2X(1) AxisRange2X(2) a(3) a(4)]);
1455 <span class="keyword">end</span>
1456 
1457 h_label = get(handles.Graph2,<span class="string">'ylabel'</span>);
1458 <span class="keyword">if</span> strcmpi(DataStruct2.Field,<span class="string">'Monitor'</span>)
1459     <span class="keyword">if</span> isempty(UnitsString2)
1460         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>,      DataStruct2.FamilyName), <span class="string">'Interpreter'</span>,<span class="string">'None'</span>);
1461     <span class="keyword">elseif</span> strcmpi(UnitsString2,<span class="string">'\mum'</span>)
1462         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s [%s]'</span>, DataStruct2.FamilyName, UnitsString2), <span class="string">'Interpreter'</span>,<span class="string">'Tex'</span>);
1463     <span class="keyword">else</span>
1464         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s [%s]'</span>, DataStruct2.FamilyName, UnitsString2), <span class="string">'Interpreter'</span>,<span class="string">'None'</span>);
1465     <span class="keyword">end</span>
1466 <span class="keyword">else</span>
1467     <span class="keyword">if</span> isempty(UnitsString2)
1468         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s.%s'</span>,      DataStruct2.FamilyName, DataStruct2.Field), <span class="string">'Interpreter'</span>,<span class="string">'None'</span>);
1469     <span class="keyword">elseif</span> strcmpi(UnitsString2,<span class="string">'\mum'</span>)
1470         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s.%s [%s]'</span>, DataStruct2.FamilyName, DataStruct2.Field, UnitsString2), <span class="string">'Interpreter'</span>,<span class="string">'Tex'</span>);
1471     <span class="keyword">else</span>
1472         set(h_label, <span class="string">'String'</span>, sprintf(<span class="string">'%s.%s [%s]'</span>, DataStruct2.FamilyName, DataStruct2.Field, UnitsString2), <span class="string">'Interpreter'</span>,<span class="string">'None'</span>);
1473     <span class="keyword">end</span>
1474 <span class="keyword">end</span>
1475 
1476 
1477 <span class="comment">% Graph 4</span>
1478 <span class="keyword">if</span> strcmpi(get(handles.(<span class="string">'AddPlot2_Nothing'</span>),<span class="string">'Checked'</span>),<span class="string">'Off'</span>)
1479     <span class="comment">% Bring Graph 4 forward</span>
1480     axes(handles.Graph4);
1481 <span class="keyword">end</span>
1482 
1483 
1484 <span class="comment">% Set the list box header</span>
1485 i = find(~isnan(Data2));
1486 <span class="keyword">if</span> isempty(i)
1487     MeanString = <span class="string">''</span>;
1488     RMSString  = <span class="string">''</span>;
1489 <span class="keyword">else</span>
1490     MeanString = sprintf(<span class="string">'%+9.6e Mean'</span>, mean(Data2(i)));
1491     RMSString  = sprintf(<span class="string">'%+9.6e RMS'</span>, (length(Data2(i))-1)*std(Data2(i))/length(Data2(i)));
1492 <span class="keyword">end</span>
1493 set(handles.Trace2RMS,<span class="string">'String'</span>,{MeanString, RMSString});
1494 set(handles.Trace2RMS,<span class="string">'FontSize'</span>, 9);
1495 
1496 
1497 <span class="comment">% Set the list box</span>
1498 Value = get(handles.DataList2,<span class="string">'Value'</span>);
1499 set(handles.DataList2,<span class="string">'Value'</span>, Value);
1500 ListBoxTop = get(handles.DataList2,<span class="string">'ListBoxTop'</span>);
1501 set(handles.DataList2,<span class="string">'String'</span>, [DataStruct2.ListBoxString, num2str(Data2(:),<span class="string">'%+.4e'</span>)]);
1502 set(handles.DataList2, <span class="string">'ListBoxTop'</span>, ListBoxTop);
1503 
1504 
1505 
1506 <span class="comment">% --- Executes on button press in RawOrbit1.</span>
1507 <a name="_sub12" href="#_subfunctions" class="code">function RawOrbit1_Callback(hObject, eventdata, handles)</a>
1508 set(handles.RawOrbit1,<span class="string">'Value'</span>, 1);
1509 set(handles.GoldenOrbit1,<span class="string">'Value'</span>, 0);
1510 set(handles.OffsetOrbit1,<span class="string">'Value'</span>, 0);
1511 set(handles.SaveOrbit1,<span class="string">'Value'</span>, 0);
1512 set(handles.FileOrbit1,<span class="string">'Value'</span>, 0);
1513 setappdata(handles.figure1, <span class="string">'ChannelA'</span>, 1);
1514 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1515 <span class="comment">%AutoScaleYLocal(handles);</span>
1516 
1517 <span class="comment">% --- Executes on button press in GoldenOrbit1.</span>
1518 <a name="_sub13" href="#_subfunctions" class="code">function GoldenOrbit1_Callback(hObject, eventdata, handles)</a>
1519 set(handles.RawOrbit1,<span class="string">'Value'</span>, 0);
1520 set(handles.GoldenOrbit1,<span class="string">'Value'</span>, 1);
1521 set(handles.OffsetOrbit1,<span class="string">'Value'</span>, 0);
1522 set(handles.SaveOrbit1,<span class="string">'Value'</span>, 0);
1523 set(handles.FileOrbit1,<span class="string">'Value'</span>, 0);
1524 setappdata(handles.figure1, <span class="string">'ChannelA'</span>, 2);
1525 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1526 <span class="comment">%AutoScaleYLocal(handles);</span>
1527 
1528 <span class="comment">% --- Executes on button press in OffsetOrbit1.</span>
1529 <a name="_sub14" href="#_subfunctions" class="code">function OffsetOrbit1_Callback(hObject, eventdata, handles)</a>
1530 set(handles.RawOrbit1,<span class="string">'Value'</span>, 0);
1531 set(handles.GoldenOrbit1,<span class="string">'Value'</span>, 0);
1532 set(handles.OffsetOrbit1,<span class="string">'Value'</span>, 1);
1533 set(handles.SaveOrbit1,<span class="string">'Value'</span>, 0);
1534 set(handles.FileOrbit1,<span class="string">'Value'</span>, 0);
1535 setappdata(handles.figure1, <span class="string">'ChannelA'</span>, 3);
1536 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1537 <span class="comment">%AutoScaleYLocal(handles);</span>
1538 
1539 <span class="comment">% --- Executes on button press in SaveOrbit1.</span>
1540 <a name="_sub15" href="#_subfunctions" class="code">function SaveOrbit1_Callback(hObject, eventdata, handles)</a>
1541 set(handles.RawOrbit1,<span class="string">'Value'</span>, 0);
1542 set(handles.GoldenOrbit1,<span class="string">'Value'</span>, 0);
1543 set(handles.OffsetOrbit1,<span class="string">'Value'</span>, 0);
1544 set(handles.SaveOrbit1,<span class="string">'Value'</span>, 1);
1545 set(handles.FileOrbit1,<span class="string">'Value'</span>, 0);
1546 setappdata(handles.figure1, <span class="string">'ChannelA'</span>, 4);
1547 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1548 <span class="comment">%AutoScaleYLocal(handles);</span>
1549 
1550 <span class="comment">% --- Executes on button press in FileOrbit1.</span>
1551 <a name="_sub16" href="#_subfunctions" class="code">function FileOrbit1_Callback(hObject, eventdata, handles)</a>
1552 set(handles.RawOrbit1,<span class="string">'Value'</span>, 0);
1553 set(handles.GoldenOrbit1,<span class="string">'Value'</span>, 0);
1554 set(handles.OffsetOrbit1,<span class="string">'Value'</span>, 0);
1555 set(handles.SaveOrbit1,<span class="string">'Value'</span>, 0);
1556 set(handles.FileOrbit1,<span class="string">'Value'</span>, 1);
1557 setappdata(handles.figure1, <span class="string">'ChannelA'</span>, 5);
1558 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1559 <span class="comment">%AutoScaleYLocal(handles);</span>
1560 
1561 
1562 <span class="comment">% --- Executes on button press in RawOrbit2.</span>
1563 <a name="_sub17" href="#_subfunctions" class="code">function RawOrbit2_Callback(hObject, eventdata, handles)</a>
1564 set(handles.RawOrbit2,<span class="string">'Value'</span>, 1);
1565 set(handles.GoldenOrbit2,<span class="string">'Value'</span>, 0);
1566 set(handles.OffsetOrbit2,<span class="string">'Value'</span>, 0);
1567 set(handles.SaveOrbit2,<span class="string">'Value'</span>, 0);
1568 set(handles.FileOrbit2,<span class="string">'Value'</span>, 0);
1569 setappdata(handles.figure1, <span class="string">'ChannelB'</span>, 1);
1570 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1571 <span class="comment">%AutoScaleYLocal(handles);</span>
1572 
1573 <span class="comment">% --- Executes on button press in GoldenOrbit2.</span>
1574 <a name="_sub18" href="#_subfunctions" class="code">function GoldenOrbit2_Callback(hObject, eventdata, handles)</a>
1575 set(handles.RawOrbit2,<span class="string">'Value'</span>, 0);
1576 set(handles.GoldenOrbit2,<span class="string">'Value'</span>, 1);
1577 set(handles.OffsetOrbit2,<span class="string">'Value'</span>, 0);
1578 set(handles.SaveOrbit2,<span class="string">'Value'</span>, 0);
1579 set(handles.FileOrbit2,<span class="string">'Value'</span>, 0);
1580 setappdata(handles.figure1, <span class="string">'ChannelB'</span>, 2);
1581 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1582 <span class="comment">%AutoScaleYLocal(handles);</span>
1583 
1584 <span class="comment">% --- Executes on button press in OffsetOrbit2.</span>
1585 <a name="_sub19" href="#_subfunctions" class="code">function OffsetOrbit2_Callback(hObject, eventdata, handles)</a>
1586 set(handles.RawOrbit2,<span class="string">'Value'</span>, 0);
1587 set(handles.GoldenOrbit2,<span class="string">'Value'</span>, 0);
1588 set(handles.OffsetOrbit2,<span class="string">'Value'</span>, 1);
1589 set(handles.SaveOrbit2,<span class="string">'Value'</span>, 0);
1590 set(handles.FileOrbit2,<span class="string">'Value'</span>, 0);
1591 setappdata(handles.figure1, <span class="string">'ChannelB'</span>, 3);
1592 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1593 <span class="comment">%AutoScaleYLocal(handles);</span>
1594 
1595 <span class="comment">% --- Executes on button press in SaveOrbit2.</span>
1596 <a name="_sub20" href="#_subfunctions" class="code">function SaveOrbit2_Callback(hObject, eventdata, handles)</a>
1597 set(handles.RawOrbit2,<span class="string">'Value'</span>, 0);
1598 set(handles.GoldenOrbit2,<span class="string">'Value'</span>, 0);
1599 set(handles.OffsetOrbit2,<span class="string">'Value'</span>, 0);
1600 set(handles.SaveOrbit2,<span class="string">'Value'</span>, 1);
1601 set(handles.FileOrbit2,<span class="string">'Value'</span>, 0);
1602 setappdata(handles.figure1, <span class="string">'ChannelB'</span>, 4);
1603 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1604 <span class="comment">%AutoScaleYLocal(handles);</span>
1605 
1606 <span class="comment">% --- Executes on button press in FileOrbit2.</span>
1607 <a name="_sub21" href="#_subfunctions" class="code">function FileOrbit2_Callback(hObject, eventdata, handles)</a>
1608 set(handles.RawOrbit2,<span class="string">'Value'</span>, 0);
1609 set(handles.GoldenOrbit2,<span class="string">'Value'</span>, 0);
1610 set(handles.OffsetOrbit2,<span class="string">'Value'</span>, 0);
1611 set(handles.SaveOrbit2,<span class="string">'Value'</span>, 0);
1612 set(handles.FileOrbit2,<span class="string">'Value'</span>, 1);
1613 setappdata(handles.figure1, <span class="string">'ChannelB'</span>, 5);
1614 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1615 <span class="comment">%AutoScaleYLocal(handles);</span>
1616 
1617 <span class="comment">% --- Executes on button press in SaveOrbit1Now.</span>
1618 <a name="_sub22" href="#_subfunctions" class="code">function SaveOrbit1Now_Callback(hObject, eventdata, handles)</a>
1619 RawX = getappdata(handles.figure1,<span class="string">'RawX'</span>);
1620 RawY = getappdata(handles.figure1,<span class="string">'RawY'</span>);
1621 setappdata(handles.figure1,<span class="string">'SaveX'</span>, RawX);
1622 setappdata(handles.figure1,<span class="string">'SaveY'</span>, RawY);
1623 <span class="keyword">if</span> isfield(RawY,<span class="string">'TimeStamp'</span>)
1624     set(handles.SaveTime,<span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>,datestr(RawY.TimeStamp,0)));
1625 <span class="keyword">else</span>
1626     set(handles.SaveTime,<span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>,datestr(clock,0)));
1627 <span class="keyword">end</span>
1628 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1629 <span class="comment">%AutoScaleYLocal(handles);</span>
1630 
1631 
1632 <span class="comment">% --- Executes on button press in LoadOrbit1.</span>
1633 <a name="_sub23" href="#_subfunctions" class="code">function LoadOrbit1_Callback(hObject, eventdata, handles)</a>
1634 UnitMenu = getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>);
1635 <span class="keyword">if</span> UnitMenu == 1
1636     UnitsFlag = <span class="string">'Physics'</span>;
1637 <span class="keyword">else</span>
1638     UnitsFlag = <span class="string">'Hardware'</span>;
1639 <span class="keyword">end</span>
1640 
1641 DataStruct1 = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
1642 DataStruct2 = getappdata(handles.figure1, <span class="string">'BPMyFamily'</span>);
1643 
1644 DirectoryName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'DataRoot'</span>);
1645 <span class="comment">%DirectoryName = getfamilydata('Directory', 'BPMData');</span>
1646 <span class="comment">%FileNameX = getfamilydata('Default', 'BPMFile');</span>
1647 [FileName, DirectoryName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Select a File'</span>, DirectoryName);
1648 <span class="keyword">if</span> FileName == 0 
1649     <span class="keyword">return</span>
1650 <span class="keyword">end</span>
1651 
1652 <span class="comment">% Remove .mat</span>
1653 <span class="comment">%if strcmpi(FileNameX(end-3:end), '.mat')</span>
1654 <span class="comment">%    FileNameX = FileNameX(1:end-4);</span>
1655 <span class="comment">%end</span>
1656 
1657 <span class="comment">% Graph 1</span>
1658 <span class="keyword">try</span>
1659     DataStruct = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(DataStruct1, [DirectoryName FileName], <span class="string">'Struct'</span>);
1660     <span class="keyword">if</span> UnitMenu == 1 &amp;&amp; strcmpi(DataStruct.Units,<span class="string">'Hardware'</span>)
1661         <span class="comment">% Physics units requested</span>
1662         DataStruct = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(DataStruct);
1663     <span class="keyword">elseif</span> (UnitMenu==2 || UnitMenu==3) &amp;&amp; strcmpi(DataStruct.Units,<span class="string">'Physics'</span>)
1664         <span class="comment">% Hardware units requested, data is in Physics units</span>
1665         DataStruct = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(DataStruct);
1666     <span class="keyword">end</span>
1667     setappdata(handles.figure1, <span class="string">'FileX'</span>, DataStruct);
1668     setappdata(handles.figure1, <span class="string">'FileNameX'</span>, [DirectoryName FileName]);
1669 <span class="keyword">catch</span>
1670 <span class="keyword">end</span>
1671 
1672 <span class="comment">% Graph 2</span>
1673 <span class="keyword">try</span>
1674     DataStruct = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(DataStruct2, [DirectoryName FileName], <span class="string">'Struct'</span>);
1675     <span class="keyword">if</span> UnitMenu == 1 &amp;&amp; strcmpi(DataStruct.Units,<span class="string">'Hardware'</span>)
1676         <span class="comment">% Physics units requested</span>
1677         DataStruct = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(DataStruct);
1678     <span class="keyword">elseif</span> (UnitMenu==2 || UnitMenu==3) &amp;&amp; strcmpi(DataStruct.Units,<span class="string">'Physics'</span>)
1679         <span class="comment">% Hardware units requested, data is in Physics units</span>
1680         DataStruct = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(DataStruct);
1681     <span class="keyword">end</span>
1682     setappdata(handles.figure1, <span class="string">'FileY'</span>, DataStruct);
1683     setappdata(handles.figure1, <span class="string">'FileNameY'</span>, [DirectoryName FileName]);
1684 <span class="keyword">catch</span>
1685 <span class="keyword">end</span>
1686 
1687 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1688 <span class="comment">%AutoScaleYLocal(handles);</span>
1689 <a href="#_sub24" class="code" title="subfunction UpdateFileDisplayLocal(handles)">UpdateFileDisplayLocal</a>(handles);
1690 
1691 
1692 <span class="comment">% --- local function to update filenamex on the display.</span>
1693 <a name="_sub24" href="#_subfunctions" class="code">function UpdateFileDisplayLocal(handles)</a>
1694 
1695 FileNameX = getappdata(handles.figure1, <span class="string">'FileNameX'</span>);
1696 FileNameY = getappdata(handles.figure1, <span class="string">'FileNameY'</span>);
1697 
1698 <span class="keyword">if</span> isempty(FileNameX) &amp;&amp; isempty(FileNameY)
1699     set(handles.FileNameX,<span class="string">'String'</span>, <span class="string">''</span>);
1700     set(handles.FileNameY,<span class="string">'String'</span>, <span class="string">''</span>);
1701     drawnow;
1702     <span class="keyword">return</span>;
1703 <span class="keyword">end</span>
1704 
1705 <span class="keyword">if</span> ~isempty(FileNameX)
1706     <span class="comment">% Remove directories</span>
1707     i = findstr(FileNameX, filesep);
1708     <span class="keyword">if</span> ~isempty(i)
1709         FileNameX = FileNameX(i(end)+1:end);
1710     <span class="keyword">end</span>
1711     
1712     <span class="comment">% Shorten length</span>
1713     <span class="keyword">if</span> length(FileNameX) &gt;= 31
1714         <span class="comment">% Remove .mat</span>
1715         <span class="keyword">if</span> strcmpi(FileNameX(end-3:end),<span class="string">'.mat'</span>)
1716             FileNameX = FileNameX(1:end-4);  <span class="comment">% remove .mat</span>
1717         <span class="keyword">end</span>
1718         
1719         <span class="keyword">if</span> length(FileNameX) &gt;= 31
1720             FileNameX = FileNameX(1:31);
1721         <span class="keyword">end</span>
1722     <span class="keyword">end</span>
1723 
1724     <span class="comment">%set(handles.FileNameX,'String', sprintf('File 1: %s', FileNameX));</span>
1725     set(handles.FileNameX,<span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>, FileNameX));
1726 <span class="keyword">else</span>
1727     set(handles.FileNameX,<span class="string">'String'</span>, <span class="string">'File 1: no data'</span>);
1728 <span class="keyword">end</span>
1729 
1730 <span class="keyword">if</span> ~isempty(FileNameY)
1731     <span class="comment">% Remove directories</span>
1732     i = findstr(FileNameY,filesep);
1733     <span class="keyword">if</span> ~isempty(i)
1734         FileNameY = FileNameY(i(end)+1:end);
1735     <span class="keyword">end</span>
1736     
1737     <span class="comment">% Shorten length</span>
1738     <span class="keyword">if</span> length(FileNameY) &gt;= 31
1739         <span class="comment">% Remove .mat</span>
1740         <span class="keyword">if</span> strcmpi(FileNameY(end-3:end),<span class="string">'.mat'</span>)
1741             FileNameY = FileNameY(1:end-4);  <span class="comment">% remove .mat</span>
1742         <span class="keyword">end</span>
1743         <span class="keyword">if</span> length(FileNameY) &gt;= 31
1744             FileNameY = FileNameY(1:31);
1745         <span class="keyword">end</span>
1746     <span class="keyword">end</span>
1747     
1748     <span class="comment">%set(handles.FileNameY,'String', sprintf('File 2: %s', FileNameY));</span>
1749     set(handles.FileNameY,<span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>, FileNameY));
1750 <span class="keyword">else</span>
1751     set(handles.FileNameY,<span class="string">'String'</span>, <span class="string">'File 2: no data'</span>);
1752 <span class="keyword">end</span>
1753 
1754 <span class="keyword">if</span> strcmpi(FileNameX, FileNameY) &amp;&amp; ~isempty(FileNameX)
1755     set(handles.FileNameY,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
1756     set(handles.FileNameX,<span class="string">'String'</span>, sprintf(<span class="string">'%s'</span>, FileNameX));
1757     p = get(handles.FileNameX,<span class="string">'Position'</span>);
1758     <span class="comment">%set(handles.FileNameX,'Position', [p(1) 4 p(3) p(4)]);   % Points</span>
1759     <span class="comment">%set(handles.FileNameX,'Position', [p(1) .4 p(3) p(4)]);  % Characters</span>
1760     set(handles.FileNameX,<span class="string">'Position'</span>, [p(1) 0.02 p(3) p(4)]); <span class="comment">% Normalized</span>
1761     p = get(handles.SaveTime,<span class="string">'Position'</span>);
1762     <span class="comment">%set(handles.SaveTime,'Position', [p(1) 16.5 p(3) p(4)]);   % Points</span>
1763     <span class="comment">%set(handles.SaveTime,'Position', [p(1) 1.6 p(3) p(4)]);    % Characters</span>
1764     set(handles.SaveTime,<span class="string">'Position'</span>, [p(1) 0.052 p(3) p(4)]);   <span class="comment">% Normalized</span>
1765 <span class="keyword">else</span>
1766     p = get(handles.FileNameX,<span class="string">'Position'</span>);
1767     <span class="comment">%set(handles.FileNameX,'Position', [p(1) 10 p(3) p(4)]);  % Points</span>
1768     <span class="comment">%set(handles.FileNameX,'Position', [p(1) 1.1 p(3) p(4)]);  % Characters</span>
1769     set(handles.FileNameX,<span class="string">'Position'</span>, [p(1) 0.025 p(3) p(4)]);  <span class="comment">% Normalized</span>
1770     set(handles.FileNameY,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
1771     p = get(handles.SaveTime,<span class="string">'Position'</span>);
1772     <span class="comment">%set(handles.SaveTime,'Position', [p(1) 20 p(3) p(4)]);  % Points</span>
1773     <span class="comment">%set(handles.SaveTime,'Position', [p(1) 2.0 p(3) p(4)]);  % Characters</span>
1774     set(handles.SaveTime,<span class="string">'Position'</span>, [p(1) 0.055 p(3) p(4)]);  <span class="comment">% Normalized</span>
1775 <span class="keyword">end</span>
1776 
1777 drawnow;
1778 
1779 
1780 <span class="comment">% --- Executes on button press in Display1.</span>
1781 <a name="_sub25" href="#_subfunctions" class="code">function Display1_Callback(hObject, eventdata, handles)</a>
1782 set(handles.DisplayDiff,<span class="string">'Value'</span>, 0);
1783 set(handles.Display1,<span class="string">'Value'</span>, 1);
1784 set(handles.Display2,<span class="string">'Value'</span>, 0);
1785 setappdata(handles.figure1,<span class="string">'Trace1'</span>,1);
1786 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1787 <span class="comment">%AutoScaleYLocal(handles);</span>
1788 
1789 <span class="comment">% --- Executes on button press in Display2.</span>
1790 <a name="_sub26" href="#_subfunctions" class="code">function Display2_Callback(hObject, eventdata, handles)</a>
1791 set(handles.DisplayDiff,<span class="string">'Value'</span>, 0);
1792 set(handles.Display1,<span class="string">'Value'</span>, 0);
1793 set(handles.Display2,<span class="string">'Value'</span>, 1);
1794 setappdata(handles.figure1,<span class="string">'Trace1'</span>,2);
1795 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1796 <span class="comment">%AutoScaleYLocal(handles);</span>
1797 
1798 <span class="comment">% --- Executes on button press in DisplayDiff.</span>
1799 <a name="_sub27" href="#_subfunctions" class="code">function DisplayDiff_Callback(hObject, eventdata, handles)</a>
1800 set(handles.DisplayDiff,<span class="string">'Value'</span>, 1);
1801 set(handles.Display1,<span class="string">'Value'</span>, 0);
1802 set(handles.Display2,<span class="string">'Value'</span>, 0);
1803 setappdata(handles.figure1,<span class="string">'Trace1'</span>,3);
1804 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1805 <span class="comment">%AutoScaleYLocal(handles);</span>
1806 
1807 
1808 <span class="comment">% --- Executes on button press in Trace2A.</span>
1809 <a name="_sub28" href="#_subfunctions" class="code">function Trace2A_Callback(hObject, eventdata, handles)</a>
1810 set(handles.Trace2A,<span class="string">'Value'</span>, 1);
1811 set(handles.Trace2B,<span class="string">'Value'</span>, 0);
1812 set(handles.Trace2A_B,<span class="string">'Value'</span>, 0);
1813 set(handles.Trace2Off,<span class="string">'Value'</span>, 0);
1814 setappdata(handles.figure1,<span class="string">'Trace2'</span>,1);
1815 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1816 <span class="comment">%AutoScaleYLocal(handles);</span>
1817 
1818 <span class="comment">% --- Executes on button press in Trace2B.</span>
1819 <a name="_sub29" href="#_subfunctions" class="code">function Trace2B_Callback(hObject, eventdata, handles)</a>
1820 set(handles.Trace2A,<span class="string">'Value'</span>, 0);
1821 set(handles.Trace2B,<span class="string">'Value'</span>, 1);
1822 set(handles.Trace2A_B,<span class="string">'Value'</span>, 0);
1823 set(handles.Trace2Off,<span class="string">'Value'</span>, 0);
1824 setappdata(handles.figure1,<span class="string">'Trace2'</span>,2);
1825 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1826 <span class="comment">%AutoScaleYLocal(handles);</span>
1827 
1828 <span class="comment">% --- Executes on button press in Trace2A_B.</span>
1829 <a name="_sub30" href="#_subfunctions" class="code">function Trace2A_B_Callback(hObject, eventdata, handles)</a>
1830 set(handles.Trace2A,<span class="string">'Value'</span>, 0);
1831 set(handles.Trace2B,<span class="string">'Value'</span>, 0);
1832 set(handles.Trace2A_B,<span class="string">'Value'</span>, 1);
1833 set(handles.Trace2Off,<span class="string">'Value'</span>, 0);
1834 setappdata(handles.figure1,<span class="string">'Trace2'</span>,3);
1835 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1836 <span class="comment">%AutoScaleYLocal(handles);</span>
1837 
1838 <span class="comment">% --- Executes on button press in Trace2Off.</span>
1839 <a name="_sub31" href="#_subfunctions" class="code">function Trace2Off_Callback(hObject, eventdata, handles)</a>
1840 set(handles.Trace2A,<span class="string">'Value'</span>, 0);
1841 set(handles.Trace2B,<span class="string">'Value'</span>, 0);
1842 set(handles.Trace2A_B,<span class="string">'Value'</span>, 0);
1843 set(handles.Trace2Off,<span class="string">'Value'</span>, 1);
1844 setappdata(handles.figure1,<span class="string">'Trace2'</span>,4);
1845 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
1846 <span class="comment">%AutoScaleYLocal(handles);</span>
1847 
1848 
1849 <span class="comment">% --- Executes on selection change in DataList1.</span>
1850 <a name="_sub32" href="#_subfunctions" class="code">function DataList1_Callback(hObject, eventdata, handles)</a>
1851 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1852     Mode = <span class="string">'Simulator'</span>;
1853 <span class="keyword">else</span>
1854     Mode = <span class="string">'Online'</span>;
1855 <span class="keyword">end</span>
1856 
1857 i = get(hObject,<span class="string">'Value'</span>);
1858 DataStruct = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
1859 
1860 Family = DataStruct.FamilyName;
1861 Field = DataStruct.Field;
1862 List = DataStruct.DeviceList;
1863 [tmp,ao] = <a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>(Family);
1864 
1865 <span class="keyword">if</span> strcmpi(Field, <span class="string">'Monitor'</span>)
1866     Field = <span class="string">'Setpoint'</span>;
1867 <span class="keyword">end</span>
1868 
1869 <span class="keyword">if</span> isfield(ao, Field)
1870     <span class="keyword">if</span> getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>) == 1
1871         UnitsFlag = <span class="string">'Physics'</span>;
1872     <span class="keyword">else</span>
1873         UnitsFlag = <span class="string">'Hardware'</span>;
1874     <span class="keyword">end</span>
1875 
1876     <span class="comment">% Get/save the present setpoint then call the GUI for setpoint changes</span>
1877     <span class="keyword">try</span>
1878         SP = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>(Family, Field, List(i,:), Mode, UnitsFlag, <span class="string">'Struct'</span>);
1879         set(handles.SetpointSlider,     <span class="string">'UserData'</span>, SP);
1880         set(handles.SetpointPushButton, <span class="string">'UserData'</span>, SP);
1881 
1882         <a href="#_sub88" class="code" title="subfunction SetpointGUI_Callback(hObject, eventdata, handles)">SetpointGUI_Callback</a>(hObject, eventdata, handles);
1883     <span class="keyword">catch</span>
1884         fprintf(<span class="string">'   Trouble finding the present value of %s.%s(%d,%d)\n'</span>,Family, Field, List(i,:));
1885     <span class="keyword">end</span>
1886 <span class="keyword">end</span>
1887 
1888 
1889 <span class="comment">% --- Executes on selection change in DataList2.</span>
1890 <a name="_sub33" href="#_subfunctions" class="code">function DataList2_Callback(hObject, eventdata, handles)</a>
1891 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1892     Mode = <span class="string">'Simulator'</span>;
1893 <span class="keyword">else</span>
1894     Mode = <span class="string">'Online'</span>;
1895 <span class="keyword">end</span>
1896 
1897 i = get(hObject,<span class="string">'Value'</span>);
1898 DataStruct = getappdata(handles.figure1, <span class="string">'BPMyFamily'</span>);
1899 
1900 Family = DataStruct.FamilyName;
1901 Field = DataStruct.Field;
1902 List = DataStruct.DeviceList;
1903 [tmp,ao] = <a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>(Family);
1904 
1905 <span class="keyword">if</span> strcmpi(Field, <span class="string">'Monitor'</span>)
1906     Field = <span class="string">'Setpoint'</span>;
1907 <span class="keyword">end</span>
1908 
1909 <span class="keyword">if</span> isfield(ao, Field)
1910     <span class="keyword">if</span> getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>) == 1
1911         UnitsFlag = <span class="string">'Physics'</span>;
1912     <span class="keyword">else</span>
1913         UnitsFlag = <span class="string">'Hardware'</span>;
1914     <span class="keyword">end</span>
1915 
1916     <span class="comment">% Get/save the present setpoint then call the GUI for setpoint changes</span>
1917     <span class="keyword">try</span>
1918         SP = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>(Family, Field, List(i,:), Mode, UnitsFlag, <span class="string">'Struct'</span>);
1919         set(handles.SetpointSlider, <span class="string">'UserData'</span>, SP);
1920         set(handles.SetpointPushButton, <span class="string">'UserData'</span>, SP);
1921 
1922         <a href="#_sub88" class="code" title="subfunction SetpointGUI_Callback(hObject, eventdata, handles)">SetpointGUI_Callback</a>(hObject, eventdata, handles);
1923     <span class="keyword">catch</span>
1924         fprintf(<span class="string">'   Trouble finding the present value of %s.%s(%d,%d)\n'</span>,Family, Field, List(i,:));
1925     <span class="keyword">end</span>
1926 <span class="keyword">end</span>
1927 
1928 
1929 
1930 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
1931 <span class="comment">% MENU CALLBACKS %</span>
1932 <span class="comment">%%%%%%%%%%%%%%%%%%</span>
1933 
1934 <span class="comment">% --------------------------------------------------------------------</span>
1935 <a name="_sub34" href="#_subfunctions" class="code">function PopPlot_Callback(hObject, eventdata, handles)</a>
1936 a = figure;
1937 b = copyobj(handles.Graph1, a); 
1938 set(b, <span class="string">'Position'</span>, [0.1300    0.5811    0.7750    0.3439]);
1939 set(b, <span class="string">'ButtonDownFcn'</span>,<span class="string">''</span>);
1940 set(b, <span class="string">'XAxisLocation'</span>,<span class="string">'Bottom'</span>);
1941 
1942 b = copyobj(handles.Graph2, a); 
1943 set(b, <span class="string">'Position'</span>, [0.1300    0.1100    0.7750    0.3439]);
1944 set(b, <span class="string">'ButtonDownFcn'</span>,<span class="string">''</span>);
1945 xlabel(b, <span class="string">'Position [meters]'</span>);
1946 
1947 Data = getappdata(handles.figure1, <span class="string">'RawY'</span>);
1948 <span class="keyword">if</span> isfield(Data, <span class="string">'TimeStamp'</span>)
1949     addlabel(1,0,datestr(Data.TimeStamp,21));
1950 <span class="keyword">end</span>
1951 orient tall
1952 
1953 
1954 <span class="comment">% --------------------------------------------------------------------</span>
1955 <a name="_sub35" href="#_subfunctions" class="code">function PopPlot1_Callback(hObject, eventdata, handles)</a>
1956 <span class="comment">%set(handles.figure1, 'HandleVisibility','Callback');</span>
1957 
1958 a = figure;
1959 b = copyobj(handles.Graph1, a); 
1960 set(b, <span class="string">'Position'</span>,[0.13 0.11 0.775 0.815]); 
1961 set(b, <span class="string">'ButtonDownFcn'</span>,<span class="string">''</span>);
1962 set(b, <span class="string">'XAxisLocation'</span>,<span class="string">'Bottom'</span>);
1963 Axis1 = axis;
1964 
1965 <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_Nothing,<span class="string">'Checked'</span>),<span class="string">'Off'</span>)
1966     set(b, <span class="string">'Position'</span>,[0.13 0.11 0.775 0.7]); 
1967     c = copyobj(handles.Graph3, a); 
1968     
1969     <span class="comment">% Plot on top of each other</span>
1970     <span class="comment">%set(c, 'Position',[0.13 0.11 0.775 0.815]);</span>
1971     
1972     <span class="comment">% Separate plots</span>
1973     set(c, <span class="string">'Position'</span>,[0.13 0.11+.72 0.775 0.12]); 
1974     
1975     set(c,<span class="string">'color'</span>,[1 1 1]);
1976     set(c,<span class="string">'Visible'</span>,<span class="string">'On'</span>);   
1977     set(c,<span class="string">'XAxisLocation'</span>,<span class="string">'Top'</span>);
1978     set(c,<span class="string">'XTick'</span>,get(b,<span class="string">'XTick'</span>));
1979     <span class="comment">%set(c,'XTickLabel',get(b,'XTickLabel'));</span>
1980     set(c,<span class="string">'XTickLabel'</span>,[]);
1981     set(c,<span class="string">'XMinorTick'</span>,<span class="string">'On'</span>);
1982     set(c,<span class="string">'XMinorGrid'</span>,<span class="string">'Off'</span>);
1983     set(c,<span class="string">'XGrid'</span>,<span class="string">'Off'</span>);
1984     set(c,<span class="string">'YGrid'</span>,<span class="string">'Off'</span>);
1985     set(c,<span class="string">'XAxisLocation'</span>,<span class="string">'Bottom'</span>);
1986     set(c,<span class="string">'YAxisLocation'</span>,<span class="string">'Left'</span>);
1987     <span class="comment">%set(c,'YAxisLocation','Right');</span>
1988     set(c,<span class="string">'YTick'</span>,[]);
1989     set(c,<span class="string">'YMinorTick'</span>,<span class="string">'Off'</span>);
1990     set(c,<span class="string">'YMinorGrid'</span>,<span class="string">'Off'</span>);
1991     set(c,<span class="string">'YTickLabel'</span>,[]);
1992     axis(c,<span class="string">'tight'</span>);
1993     Axis2 = axis(c); 
1994     axis(c,[Axis1(1) Axis1(2) Axis2(3)-.2*(Axis2(4)-Axis2(3)) Axis2(4)+.2*(Axis2(4)-Axis2(3))]);
1995     
1996     set(c, <span class="string">'ButtonDownFcn'</span>,<span class="string">''</span>);
1997 
1998     <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_BetaX,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
1999         ylabel(c, <span class="string">'Beta X'</span>);
2000     <span class="keyword">end</span>
2001     <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_BetaY,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2002         ylabel(c, <span class="string">'Beta Y'</span>);
2003     <span class="keyword">end</span>
2004     <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_DispX,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2005         ylabel(c, <span class="string">'Disp X'</span>);
2006     <span class="keyword">end</span>
2007     <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_DispY,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2008         ylabel(c, <span class="string">'Disp Y'</span>);
2009     <span class="keyword">end</span>
2010 <span class="keyword">end</span>
2011 xlabel(b, <span class="string">'Position [meters]'</span>);
2012 Data = getappdata(handles.figure1, <span class="string">'RawX'</span>);
2013 <span class="keyword">if</span> isfield(Data, <span class="string">'TimeStamp'</span>) &amp;&amp; ~isempty(Data.TimeStamp)
2014     addlabel(1,0,datestr(Data.TimeStamp,21));
2015 <span class="keyword">end</span>
2016 orient portrait
2017 
2018 
2019 <span class="comment">% --------------------------------------------------------------------</span>
2020 <a name="_sub36" href="#_subfunctions" class="code">function PopPlot2_Callback(hObject, eventdata, handles)</a>
2021 set(handles.Graph2, <span class="string">'HandleVisibility'</span>, <span class="string">'Callback'</span>); 
2022 
2023 a = figure;
2024 b = copyobj(handles.Graph2, a); 
2025 set(b, <span class="string">'Position'</span>,[0.13 0.11 0.775 0.815]); 
2026 set(b, <span class="string">'ButtonDownFcn'</span>,<span class="string">''</span>);
2027 Axis1 = axis;
2028 
2029 <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_Nothing,<span class="string">'Checked'</span>),<span class="string">'Off'</span>)
2030     set(b, <span class="string">'Position'</span>,[0.13 0.11 0.775 0.7]); 
2031     c = copyobj(handles.Graph4, a); 
2032     
2033     <span class="comment">% Plot on top of each other</span>
2034     <span class="comment">%set(c, 'Position',[0.13 0.11 0.775 0.815]);</span>
2035     
2036     <span class="comment">% Separate plots</span>
2037     set(c, <span class="string">'Position'</span>,[0.13 0.11+.72 0.775 0.12]); 
2038     
2039     set(c,<span class="string">'color'</span>,[1 1 1]);
2040     set(c,<span class="string">'Visible'</span>,<span class="string">'On'</span>);   
2041     set(c,<span class="string">'XAxisLocation'</span>,<span class="string">'Top'</span>);
2042     set(c,<span class="string">'XTick'</span>,get(b,<span class="string">'XTick'</span>));
2043     set(c,<span class="string">'XTickLabel'</span>,get(b,<span class="string">'XTickLabel'</span>));
2044     <span class="comment">%set(c,'XTickLabel',[]);</span>
2045     set(c,<span class="string">'XMinorTick'</span>,<span class="string">'On'</span>);
2046     set(c,<span class="string">'XMinorGrid'</span>,<span class="string">'Off'</span>);
2047     set(c,<span class="string">'XGrid'</span>,<span class="string">'Off'</span>);
2048     set(c,<span class="string">'YGrid'</span>,<span class="string">'Off'</span>);
2049     set(c,<span class="string">'YAxisLocation'</span>,<span class="string">'Left'</span>);
2050 
2051     <span class="comment">% Turn y-axis on</span>
2052     set(c,<span class="string">'YTick'</span>,[]);
2053     set(c,<span class="string">'YMinorTick'</span>,<span class="string">'Off'</span>);
2054     set(c,<span class="string">'YMinorGrid'</span>,<span class="string">'Off'</span>);
2055     set(c,<span class="string">'YTickLabel'</span>,[]);
2056     axis(c,<span class="string">'tight'</span>);
2057     Axis2 = axis(c); 
2058     axis(c,[Axis1(1) Axis1(2) Axis2(3)-.2*(Axis2(4)-Axis2(3)) Axis2(4)+.2*(Axis2(4)-Axis2(3))]);
2059     
2060     set(c, <span class="string">'ButtonDownFcn'</span>,<span class="string">''</span>);
2061 
2062     <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_BetaX,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2063         ylabel(c,<span class="string">'Beta X'</span>);
2064     <span class="keyword">end</span>
2065     <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_BetaY,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2066         ylabel(c,<span class="string">'Beta Y'</span>);
2067     <span class="keyword">end</span>
2068     <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_DispX,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2069         ylabel(c,<span class="string">'Disp X'</span>);
2070     <span class="keyword">end</span>
2071     <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_DispY,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2072         ylabel(c,<span class="string">'Disp Y'</span>);
2073     <span class="keyword">end</span>
2074 <span class="keyword">end</span>
2075 xlabel(<span class="string">'Position [meters]'</span>);
2076 Data = getappdata(handles.figure1, <span class="string">'RawY'</span>);
2077 <span class="keyword">if</span> isfield(Data, <span class="string">'TimeStamp'</span>) &amp;&amp; ~isempty(Data.TimeStamp)
2078     addlabel(1,0,datestr(Data.TimeStamp,21));
2079 <span class="keyword">end</span>
2080 orient portrait
2081 
2082 
2083 <span class="comment">% --------------------------------------------------------------------</span>
2084 <a name="_sub37" href="#_subfunctions" class="code">function Axis1_Callback(hObject, eventdata, handles)</a>
2085 a = axis(handles.Graph1);
2086 a = a(3:4);
2087 answer = inputdlg(<span class="string">'New upper graph vertical axis [2 element vector]'</span>,<span class="string">''</span>,1,{sprintf(<span class="string">'[%s]'</span>,num2str(a))});
2088 <span class="keyword">if</span> ~isempty(answer)
2089     a = str2num(answer{1});
2090     <span class="keyword">if</span> length(a) == 2
2091         set(handles.Graph1, <span class="string">'YLim'</span>, a);
2092     <span class="keyword">else</span>
2093         fprintf(<span class="string">'   Vertical axis needs to be a 2 element vector.\n'</span>);
2094     <span class="keyword">end</span>
2095 <span class="keyword">end</span>
2096 
2097 
2098 <span class="comment">% --------------------------------------------------------------------</span>
2099 <a name="_sub38" href="#_subfunctions" class="code">function Axis2_Callback(hObject, eventdata, handles)</a>
2100 a = axis(handles.Graph2);
2101 a = a(3:4);
2102 answer = inputdlg(<span class="string">'New lower graph vertical axis [2 element vector]'</span>,<span class="string">''</span>,1,{sprintf(<span class="string">'[%s]'</span>,num2str(a))});
2103 <span class="keyword">if</span> ~isempty(answer)
2104     a = str2num(answer{1});
2105     <span class="keyword">if</span> length(a) == 2
2106         set(handles.Graph2, <span class="string">'YLim'</span>, a);
2107     <span class="keyword">else</span>
2108         fprintf(<span class="string">'   Vertical axis needs to be a 2 element vector.\n'</span>);
2109     <span class="keyword">end</span>
2110 <span class="keyword">end</span>
2111 
2112 
2113 <span class="comment">% --------------------------------------------------------------------</span>
2114 <a name="_sub39" href="#_subfunctions" class="code">function HorizontalAxis_Callback(hObject, eventdata, handles)</a>
2115 a = axis(handles.Graph2);
2116 a = a(1:2);
2117 answer = inputdlg(<span class="string">'New horizontal axis [2 element vector]'</span>,<span class="string">''</span>,1,{sprintf(<span class="string">'[%s]'</span>,num2str(a))});
2118 <span class="keyword">if</span> ~isempty(answer)
2119     a = str2num(answer{1});
2120     <span class="keyword">if</span> length(a) == 2
2121         set(handles.Graph1, <span class="string">'XLim'</span>, a);
2122         set(handles.Graph2, <span class="string">'XLim'</span>, a);
2123         set(handles.Graph3, <span class="string">'XLim'</span>, a);
2124         set(handles.Graph4, <span class="string">'XLim'</span>, a);
2125         set(handles.LatticeAxes, <span class="string">'XLim'</span>, a);
2126         setappdata(handles.figure1, <span class="string">'AxisRange1X'</span>, a(:)');
2127         setappdata(handles.figure1, <span class="string">'AxisRange2X'</span>, a(:)');
2128     <span class="keyword">else</span>
2129         fprintf(<span class="string">'   Horizontal axis needs to be a 2 element vector.\n'</span>);
2130     <span class="keyword">end</span>
2131 <span class="keyword">end</span>
2132 
2133 
2134 <span class="comment">% --------------------------------------------------------------------</span>
2135 <a name="_sub40" href="#_subfunctions" class="code">function HorizontalAxisSector_Callback(hObject, eventdata, handles)</a>
2136 a = eventdata;
2137 <span class="keyword">if</span> length(a) == 2
2138     set(handles.Graph1, <span class="string">'XLim'</span>, a);
2139     set(handles.Graph2, <span class="string">'XLim'</span>, a);
2140     set(handles.Graph3, <span class="string">'XLim'</span>, a);
2141     set(handles.Graph4, <span class="string">'XLim'</span>, a);
2142     set(handles.LatticeAxes, <span class="string">'XLim'</span>, a);
2143 
2144     setappdata(handles.figure1, <span class="string">'AxisRange1X'</span>, a(:)');
2145     setappdata(handles.figure1, <span class="string">'AxisRange2X'</span>, a(:)');
2146 <span class="keyword">else</span>
2147     fprintf(<span class="string">'   Horizontal axis needs to be a 2 element vector.\n'</span>);
2148 <span class="keyword">end</span>
2149 
2150 
2151 
2152 
2153 <span class="comment">% --------------------------------------------------------------------</span>
2154 <a name="_sub41" href="#_subfunctions" class="code">function YScaleLog1_Callback(hObject, eventdata, handles)</a>
2155 <span class="keyword">if</span> ~strcmpi(get(handles.Graph1Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2156     set(handles.Graph1,<span class="string">'YScale'</span>,<span class="string">'Log'</span>);
2157     set(handles.YScaleLog1,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2158     set(handles.YScaleLinear1,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2159     drawnow;
2160 <span class="keyword">else</span>
2161     fprintf(<span class="string">'   Log scale not allowed for bar graphs\n'</span>);
2162 <span class="keyword">end</span>
2163 
2164 <span class="comment">% --------------------------------------------------------------------</span>
2165 <a name="_sub42" href="#_subfunctions" class="code">function YScaleLinear1_Callback(hObject, eventdata, handles)</a>
2166 set(handles.Graph1,<span class="string">'YScale'</span>,<span class="string">'Linear'</span>);
2167 set(handles.YScaleLog1,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2168 set(handles.YScaleLinear1,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2169 drawnow;
2170 
2171 
2172 <span class="comment">% --------------------------------------------------------------------</span>
2173 <a name="_sub43" href="#_subfunctions" class="code">function YScaleLog2_Callback(hObject, eventdata, handles)</a>
2174 <span class="keyword">if</span> ~strcmpi(get(handles.Graph2Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2175     set(handles.Graph2,<span class="string">'YScale'</span>,<span class="string">'Log'</span>);
2176     set(handles.YScaleLog2,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2177     set(handles.YScaleLinear2,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2178     drawnow;
2179 <span class="keyword">else</span>
2180     fprintf(<span class="string">'   Log scale not allowed for bar graphs\n'</span>);
2181 <span class="keyword">end</span>
2182 
2183 <span class="comment">% --------------------------------------------------------------------</span>
2184 <a name="_sub44" href="#_subfunctions" class="code">function YScaleLinear2_Callback(hObject, eventdata, handles)</a>
2185 set(handles.Graph2,<span class="string">'YScale'</span>,<span class="string">'Linear'</span>);
2186 set(handles.YScaleLog2,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2187 set(handles.YScaleLinear2,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2188 drawnow;
2189 
2190 
2191 <span class="comment">% --------------------------------------------------------------------</span>
2192 <a name="_sub45" href="#_subfunctions" class="code">function DataStruct = CreateListboxString(DataStruct)</a>
2193 DataStruct.ListBoxString = strcat(<a href="family2common.html" class="code" title="function [CommonNames, ErrorFlag] = family2common(Family, DeviceList)">family2common</a>(DataStruct.FamilyName, DataStruct.DeviceList),<span class="string">'='</span>);
2194 <span class="comment">% DataStruct.ListBoxString = [];</span>
2195 <span class="comment">% for i = 1:size(DataStruct.DeviceList,1)</span>
2196 <span class="comment">%     DataStruct.ListBoxString = strvcat(DataStruct.ListBoxString, sprintf('%s(%d,%d) = ', DataStruct.FamilyName, DataStruct.DeviceList(i,1), DataStruct.DeviceList(i,2)));</span>
2197 <span class="comment">% end</span>
2198 
2199 <span class="comment">% --------------------------------------------------------------------</span>
2200 <a name="_sub46" href="#_subfunctions" class="code">function BPMxFamily_Callback(hObject, eventdata, handles)</a>
2201 UnitMenu = getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>);
2202 <span class="keyword">if</span> UnitMenu == 1
2203     UnitsFlag = <span class="string">'Physics'</span>;
2204 <span class="keyword">else</span>
2205     UnitsFlag = <span class="string">'Hardware'</span>;
2206 <span class="keyword">end</span>
2207 
2208 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2209     Mode = <span class="string">'Simulator'</span>;
2210 <span class="keyword">else</span>
2211     Mode = <span class="string">'Online'</span>;
2212 <span class="keyword">end</span>
2213 
2214 <span class="keyword">if</span> isempty(hObject)
2215     close(gcbf);
2216     error(<span class="string">'PLOTFAMILY:  Menu corrupted, restart application.'</span>);
2217 <span class="keyword">else</span>
2218     DataStruct = get(hObject, <span class="string">'UserData'</span>);
2219 <span class="keyword">end</span>
2220 
2221 <span class="comment">% Rebuild the data structure in case a status field was changed</span>
2222 DataStruct = <a href="family2datastruct.html" class="code" title="function [DataStruct, ErrorFlag] = family2datastruct(varargin)">family2datastruct</a>(DataStruct.FamilyName, DataStruct.Field);
2223 
2224 <span class="keyword">if</span> <a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>(DataStruct)
2225     <span class="comment">% Create the list box string</span>
2226     DataStruct = <a href="#_sub45" class="code" title="subfunction DataStruct = CreateListboxString(DataStruct)">CreateListboxString</a>(DataStruct);
2227 
2228     setappdata(handles.figure1, <span class="string">'BPMxFamily'</span>, DataStruct);
2229     
2230     s = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(DataStruct);
2231     setappdata(handles.figure1, <span class="string">'SPosX'</span>, s);
2232     
2233     <span class="comment">%L = getfamilydata('Circumference');</span>
2234     <span class="comment">%if isempty(L)</span>
2235     <span class="comment">%    setappdata(handles.figure1, 'AxisRange1X', [min(s) max(s)]);</span>
2236     <span class="comment">%else</span>
2237     <span class="comment">%    setappdata(handles.figure1, 'AxisRange1X', [0 L]);</span>
2238     <span class="comment">%end</span>
2239     
2240     ZeroData = DataStruct;
2241     ZeroData.Data = zeros(size(DataStruct.Data,1),1);
2242     
2243     <span class="comment">% Menu label</span>
2244     set(handles.BPMxFamily,<span class="string">'Label'</span>,sprintf(<span class="string">'Plot: %s.%s'</span>, DataStruct.FamilyName, DataStruct.Field));
2245     
2246     setappdata(handles.figure1,<span class="string">'SaveX'</span>, ZeroData);
2247     tmp = getappdata(handles.figure1,<span class="string">'SaveY'</span>);
2248     tmp.Data = 0 * tmp.Data;
2249     setappdata(handles.figure1,<span class="string">'SaveY'</span>, tmp);
2250     set(handles.SaveTime,<span class="string">'String'</span>, <span class="string">''</span>);
2251     
2252 <span class="comment">%     % Look for the golden values</span>
2253 <span class="comment">%     try</span>
2254 <span class="comment">%         if strcmpi(DataStruct.Field,'Monitor')</span>
2255 <span class="comment">%             % Use the golden setpoint</span>
2256 <span class="comment">%             GoldenValues = getgolden(DataStruct.FamilyName, DataStruct.DeviceList, 'Setpoint', UnitsFlag, 'Struct');</span>
2257 <span class="comment">%         else</span>
2258 <span class="comment">%             GoldenValues = getgolden(DataStruct, UnitsFlag, 'Struct');</span>
2259 <span class="comment">%         end</span>
2260 <span class="comment">%         setappdata(handles.figure1, 'GoldenX', GoldenValues);</span>
2261 <span class="comment">%     catch</span>
2262 <span class="comment">%         setappdata(handles.figure1, 'GoldenX', ZeroData);</span>
2263 <span class="comment">%     end</span>
2264 <span class="comment">%</span>
2265 <span class="comment">%     % Look for the offset values</span>
2266 <span class="comment">%     try</span>
2267 <span class="comment">%         OffsetValues = getoffset(DataStruct, UnitsFlag, 'Struct');</span>
2268 <span class="comment">%         setappdata(handles.figure1, 'OffsetX', OffsetValues);</span>
2269 <span class="comment">%     catch</span>
2270 <span class="comment">%         try</span>
2271 <span class="comment">%             % If and offset does not exist than try using the setpoint</span>
2272 <span class="comment">%             setappdata(handles.figure1, 'OffsetX', getsp(DataStruct.FamilyName, DataStruct.DeviceList, Mode, UnitsFlag, 'Struct'));</span>
2273 <span class="comment">%         catch</span>
2274 <span class="comment">%             % Use zeros</span>
2275 <span class="comment">%             setappdata(handles.figure1, 'OffsetX', ZeroData);</span>
2276 <span class="comment">%         end</span>
2277 <span class="comment">%     end</span>
2278     
2279     <span class="keyword">try</span>
2280         FileName = getappdata(handles.figure1, <span class="string">'FileName'</span>);
2281         <span class="keyword">if</span> isempty(FileName)
2282             FileName = getappdata(handles.figure1, <span class="string">'FileNameY'</span>);
2283         <span class="keyword">end</span>
2284         <span class="keyword">if</span> isempty(FileName)
2285             setappdata(handles.figure1,<span class="string">'FileX'</span>, ZeroData);
2286         <span class="keyword">else</span>
2287             tmp = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(DataStruct, FileName, <span class="string">'Struct'</span>);
2288             <span class="keyword">if</span> UnitMenu == 1 &amp;&amp; strcmpi(tmp.Units,<span class="string">'Hardware'</span>)
2289                 <span class="comment">% Physics units requested, data is in Hardware units</span>
2290                 tmp = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(tmp);
2291             <span class="keyword">else</span>
2292                 <span class="comment">% Hardware units requested, data is in Physics units</span>
2293                 tmp = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(tmp);
2294             <span class="keyword">end</span>
2295             setappdata(handles.figure1,<span class="string">'FileX'</span>, tmp);
2296             setappdata(handles.figure1,<span class="string">'FileNameX'</span>, FileName);
2297         <span class="keyword">end</span>
2298     <span class="keyword">catch</span>
2299         setappdata(handles.figure1,<span class="string">'FileX'</span>, ZeroData);
2300         setappdata(handles.figure1,<span class="string">'FileNameX'</span>,<span class="string">''</span>);
2301     <span class="keyword">end</span>
2302 
2303     <span class="comment">% Make sure the scale is linear for bar plots</span>
2304     <span class="keyword">if</span> strcmpi(get(handles.Graph1Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2305         set(handles.Graph1,<span class="string">'YScale'</span>,<span class="string">'Linear'</span>);
2306         set(handles.YScaleLog1,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2307         set(handles.YScaleLinear1,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2308     <span class="keyword">end</span>
2309 
2310     set(handles.DataList1,<span class="string">'Value'</span>, 1);
2311     set(handles.DataList1,<span class="string">'ListBoxTop'</span>, 1);
2312     <a href="#_sub24" class="code" title="subfunction UpdateFileDisplayLocal(handles)">UpdateFileDisplayLocal</a>(handles);
2313     <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);        
2314     
2315     <span class="comment">% Auto scale y-axis</span>
2316     <span class="comment">% AutoScaleYLocal(handles);</span>
2317     a = axis(handles.Graph1);
2318     axis(handles.Graph1, <span class="string">'auto'</span>);
2319     set(handles.Graph1, <span class="string">'XLim'</span>, a(1:2));
2320     
2321 <span class="keyword">else</span>
2322     fprintf(<span class="string">'   %s is not a known family\n'</span>, DataStruct.FamilyName);
2323 <span class="keyword">end</span>
2324 
2325 
2326 <span class="comment">% --------------------------------------------------------------------</span>
2327 <a name="_sub47" href="#_subfunctions" class="code">function BPMyFamily_Callback(hObject, eventdata, handles)</a>
2328 UnitMenu = getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>);
2329 <span class="keyword">if</span> UnitMenu == 1
2330     UnitsFlag = <span class="string">'Physics'</span>;
2331 <span class="keyword">else</span>
2332     UnitsFlag = <span class="string">'Hardware'</span>;
2333 <span class="keyword">end</span>
2334 
2335 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2336     Mode = <span class="string">'Simulator'</span>;
2337 <span class="keyword">else</span>
2338     Mode = <span class="string">'Online'</span>;
2339 <span class="keyword">end</span>
2340 
2341 <span class="keyword">if</span> isempty(hObject)
2342     close(gcbf);
2343     error(<span class="string">'PLOTFAMILY:  Menu corrupted, restart application.'</span>);
2344 <span class="keyword">else</span>
2345     DataStruct = get(hObject, <span class="string">'UserData'</span>);
2346 <span class="keyword">end</span>
2347 
2348 <span class="comment">% Rebuild the data structure in case a status field was changed</span>
2349 DataStruct = <a href="family2datastruct.html" class="code" title="function [DataStruct, ErrorFlag] = family2datastruct(varargin)">family2datastruct</a>(DataStruct.FamilyName, DataStruct.Field);
2350 
2351 <span class="keyword">if</span> <a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>(DataStruct)
2352     <span class="comment">% Create the list box string</span>
2353     DataStruct = <a href="#_sub45" class="code" title="subfunction DataStruct = CreateListboxString(DataStruct)">CreateListboxString</a>(DataStruct);
2354 
2355     setappdata(handles.figure1, <span class="string">'BPMyFamily'</span>, DataStruct);
2356     
2357     s = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(DataStruct);
2358     setappdata(handles.figure1, <span class="string">'SPosY'</span>, s);
2359     <span class="comment">%L = getfamilydata('Circumference');</span>
2360     <span class="comment">%if isempty(L)</span>
2361     <span class="comment">%    setappdata(handles.figure1, 'AxisRange2X', [min(s) max(s)]);</span>
2362     <span class="comment">%else</span>
2363     <span class="comment">%    setappdata(handles.figure1, 'AxisRange2X', [0 L]);</span>
2364     <span class="comment">%end</span>
2365     
2366     ZeroData = DataStruct;
2367     ZeroData.Data = zeros(size(DataStruct.Data,1),1);
2368     
2369     <span class="comment">% Menu label</span>
2370     set(handles.BPMyFamily,<span class="string">'Label'</span>,sprintf(<span class="string">'Plot: %s.%s'</span>, DataStruct.FamilyName, DataStruct.Field));
2371     
2372     setappdata(handles.figure1,<span class="string">'SaveY'</span>, ZeroData);
2373     tmp = getappdata(handles.figure1,<span class="string">'SaveX'</span>);
2374     tmp.Data = 0 * tmp.Data;
2375     setappdata(handles.figure1,<span class="string">'SaveX'</span>, tmp);
2376     set(handles.SaveTime,<span class="string">'String'</span>, <span class="string">''</span>);
2377     
2378 <span class="comment">%     % Look for the golden values</span>
2379 <span class="comment">%     try</span>
2380 <span class="comment">%         if strcmpi(DataStruct.Field,'Monitor')</span>
2381 <span class="comment">%             % Use the golden setpoint</span>
2382 <span class="comment">%             GoldenValues = getgolden(DataStruct.FamilyName, DataStruct.DeviceList, 'Setpoint', UnitsFlag, 'Struct');</span>
2383 <span class="comment">%         else</span>
2384 <span class="comment">%             GoldenValues = getgolden(DataStruct, UnitsFlag, 'Struct');</span>
2385 <span class="comment">%         end</span>
2386 <span class="comment">%         setappdata(handles.figure1,'GoldenY', GoldenValues);</span>
2387 <span class="comment">%     catch</span>
2388 <span class="comment">%         setappdata(handles.figure1, 'GoldenY', ZeroData);</span>
2389 <span class="comment">%     end</span>
2390 <span class="comment">%</span>
2391 <span class="comment">%     % Look for the offset values</span>
2392 <span class="comment">%     try</span>
2393 <span class="comment">%         OffsetValues = getoffset(DataStruct, UnitsFlag, 'Struct');</span>
2394 <span class="comment">%         setappdata(handles.figure1,'OffsetY', OffsetValues);</span>
2395 <span class="comment">%     catch</span>
2396 <span class="comment">%         try</span>
2397 <span class="comment">%             % If and offset does not exist than try using the setpoint</span>
2398 <span class="comment">%             setappdata(handles.figure1, 'OffsetY', getsp(DataStruct.FamilyName, DataStruct.DeviceList, Mode, UnitsFlag, 'Struct'));</span>
2399 <span class="comment">%         catch</span>
2400 <span class="comment">%             % Use zeros</span>
2401 <span class="comment">%             setappdata(handles.figure1, 'OffsetY', ZeroData);</span>
2402 <span class="comment">%         end</span>
2403 <span class="comment">%     end</span>
2404     
2405     <span class="comment">% Look for file data</span>
2406     <span class="keyword">try</span>
2407         FileName = getappdata(handles.figure1, <span class="string">'FileNameY'</span>);
2408         <span class="keyword">if</span> isempty(FileName)
2409             FileName = getappdata(handles.figure1, <span class="string">'FileName'</span>);
2410         <span class="keyword">end</span>
2411         <span class="keyword">if</span> isempty(FileName)
2412             setappdata(handles.figure1, <span class="string">'FileY'</span>, ZeroData);
2413         <span class="keyword">else</span>
2414             tmp = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(DataStruct, FileName, <span class="string">'Struct'</span>);
2415             <span class="keyword">if</span> UnitMenu == 1 &amp;&amp; strcmpi(tmp.Units,<span class="string">'Hardware'</span>)
2416                 <span class="comment">% Physics units requested, data is in Hardware units</span>
2417                 tmp = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(tmp);
2418             <span class="keyword">else</span>
2419                 <span class="comment">% Hardware units requested, data is in Physics units</span>
2420                 tmp = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(tmp);
2421             <span class="keyword">end</span>
2422             setappdata(handles.figure1, <span class="string">'FileY'</span>, tmp);
2423             setappdata(handles.figure1, <span class="string">'FileNameY'</span>, FileName);
2424         <span class="keyword">end</span>
2425     <span class="keyword">catch</span>
2426         setappdata(handles.figure1, <span class="string">'FileY'</span>, ZeroData);
2427         setappdata(handles.figure1, <span class="string">'FileNameY'</span>,<span class="string">''</span>);
2428     <span class="keyword">end</span>
2429     
2430     <span class="comment">% Make sure the scale is linear for bar plots</span>
2431     <span class="keyword">if</span> strcmpi(get(handles.Graph2Bar,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2432         set(handles.Graph2,<span class="string">'YScale'</span>,<span class="string">'Linear'</span>);
2433         set(handles.YScaleLog2,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2434         set(handles.YScaleLinear2,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2435     <span class="keyword">end</span>
2436 
2437     set(handles.DataList2, <span class="string">'Value'</span>, 1);
2438     set(handles.DataList2, <span class="string">'ListBoxTop'</span>, 1);
2439     <a href="#_sub24" class="code" title="subfunction UpdateFileDisplayLocal(handles)">UpdateFileDisplayLocal</a>(handles);    
2440     <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
2441 
2442     <span class="comment">% Auto scale y-axis</span>
2443     <span class="comment">% AutoScaleYLocal(handles);</span>
2444     a = axis(handles.Graph2);
2445     axis(handles.Graph2, <span class="string">'auto'</span>);
2446     set(handles.Graph2, <span class="string">'XLim'</span>, a(1:2));
2447 <span class="keyword">else</span>
2448     fprintf(<span class="string">'   %s is not a known family\n'</span>, DataStruct.FamilyName);
2449 <span class="keyword">end</span>
2450 
2451 
2452 <span class="comment">% --------------------------------------------------------------------</span>
2453 <a name="_sub48" href="#_subfunctions" class="code">function BPMxList_Callback(hObject, eventdata, handles)</a>
2454 UnitMenu = getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>);
2455 <span class="keyword">if</span> UnitMenu == 1
2456     UnitsFlag = <span class="string">'Physics'</span>;
2457 <span class="keyword">else</span>
2458     UnitsFlag = <span class="string">'Hardware'</span>;
2459 <span class="keyword">end</span>
2460 
2461 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2462     Mode = <span class="string">'Simulator'</span>;
2463 <span class="keyword">else</span>
2464     Mode = <span class="string">'Online'</span>;
2465 <span class="keyword">end</span>
2466 
2467 DataStruct = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
2468 Family = DataStruct.FamilyName;
2469 List = DataStruct.DeviceList;
2470 FullList = <a href="family2dev.html" class="code" title="function DeviceList = family2dev(Family, varargin)">family2dev</a>(Family);
2471 CheckList = zeros(size(FullList,1),1);
2472 i = findrowindex(List, FullList);
2473 CheckList(i) = 1;
2474 List = editlist(FullList, Family, CheckList);
2475 
2476 DataStruct.Data = NaN * ones(size(List,1),1);  <span class="comment">%DataStruct.Data(i);</span>
2477 DataStruct.DeviceList = List;
2478 DataStruct.Status = ones(size(List,1),1);
2479 
2480 <span class="comment">% Create the list box string</span>
2481 DataStruct = <a href="#_sub45" class="code" title="subfunction DataStruct = CreateListboxString(DataStruct)">CreateListboxString</a>(DataStruct);
2482 
2483 setappdata(handles.figure1, <span class="string">'BPMxFamily'</span>, DataStruct);
2484 
2485 s = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(DataStruct);
2486 setappdata(handles.figure1, <span class="string">'SPosX'</span>, s);
2487 
2488 ZeroData = DataStruct;
2489 ZeroData.Data = zeros(size(DataStruct.Data,1),1);
2490 
2491 <span class="comment">% % Look for the golden values</span>
2492 <span class="comment">% try</span>
2493 <span class="comment">%     if strcmpi(DataStruct.Field,'Monitor')</span>
2494 <span class="comment">%         % Use the golden setpoint</span>
2495 <span class="comment">%         GoldenValues = getgolden(DataStruct.FamilyName, DataStruct.DeviceList, 'Setpoint', UnitsFlag, 'Struct');</span>
2496 <span class="comment">%     else</span>
2497 <span class="comment">%         GoldenValues = getgolden(DataStruct, UnitsFlag, 'Struct');</span>
2498 <span class="comment">%     end</span>
2499 <span class="comment">%     setappdata(handles.figure1, 'GoldenX', GoldenValues);</span>
2500 <span class="comment">% catch</span>
2501 <span class="comment">%     setappdata(handles.figure1, 'GoldenX', ZeroData);</span>
2502 <span class="comment">% end</span>
2503 <span class="comment">%</span>
2504 <span class="comment">% % Look for the offset values</span>
2505 <span class="comment">% try</span>
2506 <span class="comment">%     OffsetValues = getoffset(DataStruct, UnitsFlag, 'Struct');</span>
2507 <span class="comment">%     setappdata(handles.figure1,'OffsetX', OffsetValues);</span>
2508 <span class="comment">% catch</span>
2509 <span class="comment">%     try</span>
2510 <span class="comment">%         % If and offset does not exist than try using the setpoint</span>
2511 <span class="comment">%         setappdata(handles.figure1, 'OffsetX', getsp(DataStruct.FamilyName, DataStruct.DeviceList, Mode, UnitsFlag, 'Struct'));</span>
2512 <span class="comment">%     catch</span>
2513 <span class="comment">%         % Use zeros</span>
2514 <span class="comment">%         setappdata(handles.figure1, 'OffsetX', ZeroData);</span>
2515 <span class="comment">%     end</span>
2516 <span class="comment">% end</span>
2517 
2518 
2519 <span class="comment">% Changing the list wipes out a save</span>
2520 setappdata(handles.figure1,<span class="string">'SaveX'</span>, ZeroData);
2521 tmp = getappdata(handles.figure1,<span class="string">'SaveY'</span>);
2522 tmp.Data = 0 * tmp.Data;
2523 setappdata(handles.figure1,<span class="string">'SaveY'</span>, tmp);
2524 set(handles.SaveTime,<span class="string">'String'</span>, <span class="string">''</span>);
2525 
2526 <span class="keyword">try</span>
2527     FileName = getappdata(handles.figure1, <span class="string">'FileNameX'</span>);
2528     <span class="keyword">if</span> isempty(FileName)
2529         FileName = getappdata(handles.figure1, <span class="string">'FileNameY'</span>);
2530     <span class="keyword">end</span>
2531     <span class="keyword">if</span> isempty(FileName)
2532         setappdata(handles.figure1,<span class="string">'FileX'</span>, ZeroData);
2533     <span class="keyword">else</span>
2534         tmp = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(DataStruct, FileName, <span class="string">'Struct'</span>);
2535         <span class="keyword">if</span> UnitMenu == 1 &amp;&amp; strcmpi(tmp.Units,<span class="string">'Hardware'</span>)
2536             <span class="comment">% Physics units requested, data is in Hardware units</span>
2537             tmp = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(tmp);
2538         <span class="keyword">else</span>
2539             <span class="comment">% Hardware units requested, data is in Physics units</span>
2540             tmp = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(tmp);
2541         <span class="keyword">end</span>
2542         setappdata(handles.figure1,<span class="string">'FileX'</span>, tmp);
2543         setappdata(handles.figure1,<span class="string">'FileNameX'</span>, FileName);
2544     <span class="keyword">end</span>
2545 <span class="keyword">catch</span>
2546     setappdata(handles.figure1,<span class="string">'FileX'</span>, ZeroData);
2547     setappdata(handles.figure1,<span class="string">'FileNameX'</span>,<span class="string">''</span>);
2548 <span class="keyword">end</span>
2549 
2550 set(handles.DataList1,<span class="string">'Value'</span>, 1);
2551 set(handles.DataList1,<span class="string">'ListBoxTop'</span>, 1);
2552 <a href="#_sub24" class="code" title="subfunction UpdateFileDisplayLocal(handles)">UpdateFileDisplayLocal</a>(handles);
2553 cla(handles.Graph1);
2554 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
2555 
2556 <span class="comment">% --------------------------------------------------------------------</span>
2557 <a name="_sub49" href="#_subfunctions" class="code">function BPMyList_Callback(hObject, eventdata, handles)</a>
2558 UnitMenu = getappdata(handles.figure1,<span class="string">'UnitsFlag'</span>);
2559 <span class="keyword">if</span> UnitMenu == 1
2560     UnitsFlag = <span class="string">'Physics'</span>;
2561 <span class="keyword">else</span>
2562     UnitsFlag = <span class="string">'Hardware'</span>;
2563 <span class="keyword">end</span>
2564 
2565 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
2566     Mode = <span class="string">'Simulator'</span>;
2567 <span class="keyword">else</span>
2568     Mode = <span class="string">'Online'</span>;
2569 <span class="keyword">end</span>
2570 
2571 DataStruct = getappdata(handles.figure1, <span class="string">'BPMyFamily'</span>);
2572 Family = DataStruct.FamilyName;
2573 List = DataStruct.DeviceList;
2574 FullList = <a href="family2dev.html" class="code" title="function DeviceList = family2dev(Family, varargin)">family2dev</a>(Family);
2575 CheckList = zeros(size(FullList,1),1);
2576 i = findrowindex(List, FullList);
2577 CheckList(i) = 1;
2578 List = editlist(FullList, Family, CheckList);
2579 
2580 DataStruct.Data = NaN * ones(size(List,1),1);  <span class="comment">%DataStruct.Data(i);</span>
2581 DataStruct.DeviceList = List;
2582 DataStruct.Status = ones(size(List,1),1);
2583 <span class="comment">%DataStruct.Data = DataStruct.Data(i);</span>
2584 
2585 <span class="comment">% Create the list box string</span>
2586 DataStruct = <a href="#_sub45" class="code" title="subfunction DataStruct = CreateListboxString(DataStruct)">CreateListboxString</a>(DataStruct);
2587 
2588 setappdata(handles.figure1, <span class="string">'BPMyFamily'</span>, DataStruct);
2589 
2590 s = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(DataStruct);
2591 setappdata(handles.figure1, <span class="string">'SPosY'</span>, s);
2592 
2593 ZeroData = DataStruct;
2594 ZeroData.Data = zeros(size(DataStruct.Data,1),1);
2595 
2596 
2597 <span class="comment">% % Look for the golden values</span>
2598 <span class="comment">% try</span>
2599 <span class="comment">%     if strcmpi(DataStruct.Field,'Monitor')</span>
2600 <span class="comment">%         % Use the golden setpoint</span>
2601 <span class="comment">%         GoldenValues = getgolden(DataStruct.FamilyName, DataStruct.DeviceList, 'Setpoint', UnitsFlag, 'Struct');</span>
2602 <span class="comment">%     else</span>
2603 <span class="comment">%         GoldenValues = getgolden(DataStruct, UnitsFlag, 'Struct');</span>
2604 <span class="comment">%     end</span>
2605 <span class="comment">%     setappdata(handles.figure1, 'GoldenY', GoldenValues);</span>
2606 <span class="comment">% catch</span>
2607 <span class="comment">%     setappdata(handles.figure1, 'GoldenY', ZeroData);</span>
2608 <span class="comment">% end</span>
2609 <span class="comment">%</span>
2610 <span class="comment">%</span>
2611 <span class="comment">% % Look for the offset values</span>
2612 <span class="comment">% try</span>
2613 <span class="comment">%     OffsetValues = getoffset(DataStruct, UnitsFlag, 'Struct');</span>
2614 <span class="comment">%     setappdata(handles.figure1,'OffsetY', OffsetValues);</span>
2615 <span class="comment">% catch</span>
2616 <span class="comment">%     try</span>
2617 <span class="comment">%         % If and offset does not exist than try using the setpoint</span>
2618 <span class="comment">%         setappdata(handles.figure1, 'OffsetY', getsp(DataStruct.FamilyName, DataStruct.DeviceList, Mode, UnitsFlag, 'Struct'));</span>
2619 <span class="comment">%     catch</span>
2620 <span class="comment">%         % Use zeros</span>
2621 <span class="comment">%         setappdata(handles.figure1, 'OffsetY', ZeroData);</span>
2622 <span class="comment">%     end</span>
2623 <span class="comment">% end</span>
2624 
2625 
2626 <span class="comment">% Changing the list wipes out a save</span>
2627 setappdata(handles.figure1,<span class="string">'SaveY'</span>, ZeroData);
2628 tmp = getappdata(handles.figure1,<span class="string">'SaveX'</span>);
2629 tmp.Data = 0 * tmp.Data;
2630 setappdata(handles.figure1,<span class="string">'SaveX'</span>, tmp);
2631 set(handles.SaveTime,<span class="string">'String'</span>, <span class="string">''</span>);
2632 
2633 
2634 <span class="keyword">try</span>
2635     FileName = getappdata(handles.figure1, <span class="string">'FileNameY'</span>);
2636     <span class="keyword">if</span> isempty(FileName)
2637         FileName = getappdata(handles.figure1, <span class="string">'FileName'</span>);
2638     <span class="keyword">end</span>
2639     <span class="keyword">if</span> isempty(FileName)
2640         setappdata(handles.figure1,<span class="string">'FileY'</span>, ZeroData);
2641     <span class="keyword">else</span>
2642             tmp = <a href="getdata.html" class="code" title="function [S, FileName] = getdata(varargin)">getdata</a>(DataStruct, FileName, <span class="string">'Struct'</span>);
2643         <span class="keyword">if</span> UnitMenu == 1 &amp;&amp; strcmpi(tmp.Units,<span class="string">'Hardware'</span>)
2644             <span class="comment">% Physics units requested, data is in Hardware units</span>
2645             tmp = <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(tmp);
2646         <span class="keyword">else</span>
2647             <span class="comment">% Hardware units requested, data is in Physics units</span>
2648             tmp = <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(tmp);
2649         <span class="keyword">end</span>
2650         setappdata(handles.figure1,<span class="string">'FileY'</span>, tmp);
2651         setappdata(handles.figure1,<span class="string">'FileNameY'</span>, FileName);
2652     <span class="keyword">end</span>
2653 <span class="keyword">catch</span>
2654     setappdata(handles.figure1,<span class="string">'FileY'</span>, ZeroData);
2655     setappdata(handles.figure1,<span class="string">'FileNameY'</span>,<span class="string">''</span>);
2656 <span class="keyword">end</span>
2657 
2658 set(handles.DataList2,<span class="string">'Value'</span>, 1);
2659 set(handles.DataList2,<span class="string">'ListBoxTop'</span>, 1);
2660 <a href="#_sub24" class="code" title="subfunction UpdateFileDisplayLocal(handles)">UpdateFileDisplayLocal</a>(handles);
2661 cla(handles.Graph2);
2662 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
2663 
2664 
2665 <span class="comment">% --------------------------------------------------------------------</span>
2666 <a name="_sub50" href="#_subfunctions" class="code">function UpdatePeriod_Callback(hObject, eventdata, handles)</a>
2667 answer = inputdlg(<span class="string">'Enter new update period [seconds]'</span>,<span class="string">''</span>,1,{num2str(getappdata(handles.figure1, <span class="string">'UpdatePeriod'</span>))});
2668 <span class="keyword">if</span> ~isempty(answer)
2669     UpdatePeriod = str2num(answer{1});
2670     <span class="keyword">if</span> ~isempty(UpdatePeriod) &amp;&amp; UpdatePeriod &gt;= 0
2671         <span class="keyword">if</span> UpdatePeriod &gt; 15
2672             UpdatePeriod = 15;
2673         <span class="keyword">end</span>
2674         set(handles.UpdatePeriod,<span class="string">'Label'</span>, sprintf(<span class="string">'Update Period = %.2f sec'</span>,UpdatePeriod));
2675         setappdata(handles.figure1, <span class="string">'UpdatePeriod'</span>, UpdatePeriod);
2676     <span class="keyword">end</span>
2677 <span class="keyword">end</span>
2678 
2679 <span class="comment">% --------------------------------------------------------------------</span>
2680 <a name="_sub51" href="#_subfunctions" class="code">function PhysicsUnits_Callback(hObject, eventdata, handles)</a>
2681 UnitMenu = 1;
2682 setappdata(handles.figure1,<span class="string">'UnitsFlag'</span>, UnitMenu);
2683 set(handles.PhysicsUnitsFlag,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2684 set(handles.HardwareUnitsFlag,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2685 set(handles.MicronFlag,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2686 
2687 RawX = getappdata(handles.figure1, <span class="string">'RawX'</span>);
2688 RawY = getappdata(handles.figure1, <span class="string">'RawY'</span>);
2689 
2690 <span class="keyword">if</span> strcmpi(RawX.Units,<span class="string">'Hardware'</span>)
2691     <span class="comment">% Physics units requested, data is in Hardware units</span>
2692     setappdata(handles.figure1, <span class="string">'RawX'</span>, <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(RawX));
2693     setappdata(handles.figure1, <span class="string">'RawY'</span>, <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(RawY));
2694 
2695 <span class="comment">%     setappdata(handles.figure1, 'OffsetX', hw2physics(getappdata(handles.figure1,'OffsetX')));</span>
2696 <span class="comment">%     setappdata(handles.figure1, 'OffsetY', hw2physics(getappdata(handles.figure1,'OffsetY')));</span>
2697 <span class="comment">%</span>
2698 <span class="comment">%     setappdata(handles.figure1, 'GoldenX', hw2physics(getappdata(handles.figure1,'GoldenX')));</span>
2699 <span class="comment">%     setappdata(handles.figure1, 'GoldenY', hw2physics(getappdata(handles.figure1,'GoldenY')));</span>
2700     
2701     setappdata(handles.figure1, <span class="string">'SaveX'</span>, <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(getappdata(handles.figure1,<span class="string">'SaveX'</span>)));
2702     setappdata(handles.figure1, <span class="string">'SaveY'</span>, <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(getappdata(handles.figure1,<span class="string">'SaveY'</span>)));
2703 
2704     setappdata(handles.figure1, <span class="string">'FileX'</span>, <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(getappdata(handles.figure1,<span class="string">'FileX'</span>)));
2705     setappdata(handles.figure1, <span class="string">'FileY'</span>, <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(getappdata(handles.figure1,<span class="string">'FileY'</span>)));
2706 <span class="keyword">end</span>
2707 
2708 DataStruct1 = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
2709 <span class="keyword">if</span> strcmpi(DataStruct1.Units,<span class="string">'Hardware'</span>)
2710     <span class="comment">% Physics units requested, data is in Hardware units</span>
2711     setappdata(handles.figure1, <span class="string">'BPMxFamily'</span>, <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(DataStruct1));
2712 <span class="keyword">end</span>
2713 
2714 DataStruct2 = getappdata(handles.figure1, <span class="string">'BPMyFamily'</span>);
2715 <span class="keyword">if</span> strcmpi(DataStruct2.Units,<span class="string">'Hardware'</span>)
2716     <span class="comment">% Physics units requested, data is in Hardware units</span>
2717     setappdata(handles.figure1, <span class="string">'BPMyFamily'</span>, <a href="hw2physics.html" class="code" title="function S = hw2physics(Family, Field, value, DeviceList, Energy)">hw2physics</a>(DataStruct2));
2718 <span class="keyword">end</span>
2719 
2720 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
2721 <a href="#_sub70" class="code" title="subfunction AutoScaleYLocal(handles)">AutoScaleYLocal</a>(handles);
2722 
2723 <span class="comment">% Turn off the setpoint GUI (or change it to physics units)</span>
2724 <a href="#_sub99" class="code" title="subfunction TurnOffSetpointGUI_Callback(hObject, eventdata, handles)">TurnOffSetpointGUI_Callback</a>(hObject, eventdata, handles);
2725 
2726 
2727 <span class="comment">% --------------------------------------------------------------------</span>
2728 <a name="_sub52" href="#_subfunctions" class="code">function HardwareUnits_Callback(hObject, eventdata, handles)</a>
2729 UnitMenu = 2;
2730 setappdata(handles.figure1,<span class="string">'UnitsFlag'</span>, UnitMenu);
2731 set(handles.PhysicsUnitsFlag,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2732 set(handles.HardwareUnitsFlag,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2733 set(handles.MicronFlag,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2734 
2735 RawX = getappdata(handles.figure1, <span class="string">'RawX'</span>);
2736 RawY = getappdata(handles.figure1, <span class="string">'RawY'</span>);
2737 
2738 <span class="keyword">if</span> strcmpi(RawX.Units,<span class="string">'Physics'</span>)
2739     <span class="comment">% Hardware units requested, data is in Physics units</span>
2740     setappdata(handles.figure1, <span class="string">'RawX'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(RawX));
2741     setappdata(handles.figure1, <span class="string">'RawY'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(RawY));
2742 
2743 <span class="comment">%     setappdata(handles.figure1, 'OffsetX', physics2hw(getappdata(handles.figure1,'OffsetX')));</span>
2744 <span class="comment">%     setappdata(handles.figure1, 'OffsetY', physics2hw(getappdata(handles.figure1,'OffsetY')));</span>
2745 <span class="comment">%</span>
2746 <span class="comment">%     setappdata(handles.figure1, 'GoldenX', physics2hw(getappdata(handles.figure1,'GoldenX')));</span>
2747 <span class="comment">%     setappdata(handles.figure1, 'GoldenY', physics2hw(getappdata(handles.figure1,'GoldenY')));</span>
2748     
2749     setappdata(handles.figure1, <span class="string">'SaveX'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(getappdata(handles.figure1,<span class="string">'SaveX'</span>)));
2750     setappdata(handles.figure1, <span class="string">'SaveY'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(getappdata(handles.figure1,<span class="string">'SaveY'</span>)));
2751 
2752     setappdata(handles.figure1, <span class="string">'FileX'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(getappdata(handles.figure1,<span class="string">'FileX'</span>)));
2753     setappdata(handles.figure1, <span class="string">'FileY'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(getappdata(handles.figure1,<span class="string">'FileY'</span>)));
2754 <span class="keyword">end</span>
2755 
2756 DataStruct1 = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
2757 <span class="keyword">if</span> strcmpi(DataStruct1.Units,<span class="string">'Physics'</span>)
2758     <span class="comment">% Hardware units requested, data is in Physics units</span>
2759     setappdata(handles.figure1, <span class="string">'BPMxFamily'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(DataStruct1));
2760 <span class="keyword">end</span>
2761 
2762 DataStruct2 = getappdata(handles.figure1, <span class="string">'BPMyFamily'</span>);
2763 <span class="keyword">if</span> strcmpi(DataStruct2.Units,<span class="string">'Physics'</span>)
2764     <span class="comment">% Hardware units requested, data is in Physics units</span>
2765     setappdata(handles.figure1, <span class="string">'BPMyFamily'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(DataStruct2));
2766 <span class="keyword">end</span>
2767 
2768 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
2769 <a href="#_sub70" class="code" title="subfunction AutoScaleYLocal(handles)">AutoScaleYLocal</a>(handles);
2770 
2771 <span class="comment">% Turn off the setpoint GUI (or change it to physics units)</span>
2772 <a href="#_sub99" class="code" title="subfunction TurnOffSetpointGUI_Callback(hObject, eventdata, handles)">TurnOffSetpointGUI_Callback</a>(hObject, eventdata, handles);
2773 
2774 
2775 <span class="comment">% --------------------------------------------------------------------</span>
2776 <a name="_sub53" href="#_subfunctions" class="code">function MicronFlag_Callback(hObject, eventdata, handles)</a>
2777 UnitMenu = 3;
2778 setappdata(handles.figure1,<span class="string">'UnitsFlag'</span>, UnitMenu);
2779 set(handles.PhysicsUnitsFlag,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2780 set(handles.HardwareUnitsFlag,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2781 set(handles.MicronFlag,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2782 
2783 RawX = getappdata(handles.figure1, <span class="string">'RawX'</span>);
2784 RawY = getappdata(handles.figure1, <span class="string">'RawY'</span>);
2785 
2786 <span class="keyword">if</span> strcmpi(RawX.Units,<span class="string">'Physics'</span>)
2787     <span class="comment">% Hardware units requested, data is in Physics units</span>
2788     setappdata(handles.figure1, <span class="string">'RawX'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(RawX));
2789     setappdata(handles.figure1, <span class="string">'RawY'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(RawY));
2790 
2791 <span class="comment">%     setappdata(handles.figure1, 'OffsetX', physics2hw(getappdata(handles.figure1,'OffsetX')));</span>
2792 <span class="comment">%     setappdata(handles.figure1, 'OffsetY', physics2hw(getappdata(handles.figure1,'OffsetY')));</span>
2793 <span class="comment">%</span>
2794 <span class="comment">%     setappdata(handles.figure1, 'GoldenX', physics2hw(getappdata(handles.figure1,'GoldenX')));</span>
2795 <span class="comment">%     setappdata(handles.figure1, 'GoldenY', physics2hw(getappdata(handles.figure1,'GoldenY')));</span>
2796     
2797     setappdata(handles.figure1, <span class="string">'SaveX'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(getappdata(handles.figure1,<span class="string">'SaveX'</span>)));
2798     setappdata(handles.figure1, <span class="string">'SaveY'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(getappdata(handles.figure1,<span class="string">'SaveY'</span>)));
2799 
2800     setappdata(handles.figure1, <span class="string">'FileX'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(getappdata(handles.figure1,<span class="string">'FileX'</span>)));
2801     setappdata(handles.figure1, <span class="string">'FileY'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(getappdata(handles.figure1,<span class="string">'FileY'</span>)));
2802 <span class="keyword">end</span>
2803 
2804 DataStruct1 = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
2805 <span class="keyword">if</span> strcmpi(DataStruct1.Units,<span class="string">'Physics'</span>)
2806     <span class="comment">% Hardware units requested, data is in Physics units</span>
2807     setappdata(handles.figure1, <span class="string">'BPMxFamily'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(DataStruct1));
2808 <span class="keyword">end</span>
2809 
2810 DataStruct2 = getappdata(handles.figure1, <span class="string">'BPMyFamily'</span>);
2811 <span class="keyword">if</span> strcmpi(DataStruct2.Units,<span class="string">'Physics'</span>)
2812     <span class="comment">% Hardware units requested, data is in Physics units</span>
2813     setappdata(handles.figure1, <span class="string">'BPMyFamily'</span>, <a href="physics2hw.html" class="code" title="function S = physics2hw(Family, Field, value, DeviceList, Energy)">physics2hw</a>(DataStruct2));
2814 <span class="keyword">end</span>
2815 
2816 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
2817 <a href="#_sub70" class="code" title="subfunction AutoScaleYLocal(handles)">AutoScaleYLocal</a>(handles);
2818 drawnow;
2819 
2820 
2821 <span class="comment">% --------------------------------------------------------------------</span>
2822 <a name="_sub54" href="#_subfunctions" class="code">function SaveOrbitToFile_Callback(hObject, eventdata, handles)</a>
2823 
2824 Data1 = getappdata(handles.figure1, <span class="string">'RawX'</span>);
2825 Data2 = getappdata(handles.figure1, <span class="string">'RawY'</span>);
2826 
2827 <span class="keyword">if</span> isfield(Data1,<span class="string">'TimeStamp'</span>)
2828     DirStart = pwd;
2829     
2830     FamilyName1 = Data1.FamilyName;
2831     FamilyName2 = Data2.FamilyName;
2832     <span class="keyword">if</span> strcmpi(FamilyName1, FamilyName2)
2833         FileName = appendtimestamp(FamilyName1, Data1.TimeStamp);
2834     <span class="keyword">else</span>
2835         FileName = appendtimestamp([FamilyName1,<span class="string">'_'</span>,FamilyName2], Data1.TimeStamp);
2836     <span class="keyword">end</span>
2837     DirectoryName = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Directory'</span>,<span class="string">'DataRoot'</span>);
2838     
2839     [FileName, DirectoryName] = uiputfile(<span class="string">'*.mat'</span>, <span class="string">'Select File (Cancel to not save to a file)'</span>, [DirectoryName FileName, <span class="string">'.mat'</span>]);
2840     <span class="keyword">if</span> FileName == 0 
2841         <span class="comment">%fprintf('   No data saved\n');</span>
2842         <span class="keyword">return</span>
2843     <span class="keyword">end</span>
2844     
2845     [DirectoryName, ErrorFlag] = gotodirectory(DirectoryName);
2846     save(FileName, <span class="string">'Data1'</span>, <span class="string">'Data2'</span>);
2847     cd(DirStart);
2848     fprintf(<span class="string">'   Data saved to %s\n'</span>, [DirectoryName FileName]);
2849 <span class="keyword">else</span>
2850     fprintf(<span class="string">'   No data to save \n'</span>);
2851 <span class="keyword">end</span>
2852 
2853 
2854 <span class="comment">% --------------------------------------------------------------------</span>
2855 <a name="_sub55" href="#_subfunctions" class="code">function Online_Callback(hObject, eventdata, handles)</a>
2856 set(handles.Online,  <span class="string">'Checked'</span>,<span class="string">'On'</span>);
2857 set(handles.Simulate,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2858 <a href="#_sub3" class="code" title="subfunction SetFigureTitle(h_fig, ModeString)">SetFigureTitle</a>(handles.figure1, <span class="string">'Online'</span>);
2859 <span class="comment">%switch2online;</span>
2860 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
2861 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
2862 
2863 <span class="comment">% --------------------------------------------------------------------</span>
2864 <a name="_sub56" href="#_subfunctions" class="code">function Simulate_Callback(hObject, eventdata, handles)</a>
2865 set(handles.Online,  <span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2866 set(handles.Simulate,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2867 <a href="#_sub3" class="code" title="subfunction SetFigureTitle(h_fig, ModeString)">SetFigureTitle</a>(handles.figure1, <span class="string">'Model'</span>);
2868 <span class="comment">%switch2sim;</span>
2869 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
2870 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
2871 
2872 <span class="comment">% --------------------------------------------------------------------</span>
2873 <a name="_sub57" href="#_subfunctions" class="code">function Sim2Machine_Callback(hObject, eventdata, handles)</a>
2874 <a href="sim2machine.html" class="code" title="function sim2machine">sim2machine</a>;
2875 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
2876 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
2877 
2878 <span class="comment">% --------------------------------------------------------------------</span>
2879 <a name="_sub58" href="#_subfunctions" class="code">function Machine2Sim_Callback(hObject, eventdata, handles)</a>
2880 <a href="machine2sim.html" class="code" title="function machine2sim(ZeroCMFlag)">machine2sim</a>;
2881 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
2882 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
2883 
2884 
2885 <span class="comment">% --------------------------------------------------------------------</span>
2886 <a name="_sub59" href="#_subfunctions" class="code">function HorizontalAxesScaling(hObject, eventdata, handles)</a>
2887 <span class="comment">% Graph 1, 2, 3, &amp; 4 axes scaling</span>
2888 py = 0.74;
2889 p1 = get(handles.Graph1,<span class="string">'Position'</span>);
2890 p2 = get(handles.Graph2,<span class="string">'Position'</span>);
2891 p3 = get(handles.Graph3,<span class="string">'Position'</span>);
2892 p4 = get(handles.Graph4,<span class="string">'Position'</span>);
2893 pa = get(handles.LatticeAxes,<span class="string">'Position'</span>);
2894 <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_Nothing,<span class="string">'Checked'</span>),<span class="string">'Off'</span>) || strcmpi(get(handles.AddPlot2_Nothing,<span class="string">'Checked'</span>),<span class="string">'Off'</span>)
2895     py = py*.93;
2896 <span class="keyword">end</span>
2897 set(handles.Graph1,     <span class="string">'Position'</span>, [p1(1) p1(2) py p1(4)]);
2898 set(handles.Graph2,     <span class="string">'Position'</span>, [p2(1) p2(2) py p2(4)]);
2899 set(handles.Graph3,     <span class="string">'Position'</span>, [p3(1) p3(2) py p3(4)]);
2900 set(handles.Graph4,     <span class="string">'Position'</span>, [p4(1) p4(2) py p4(4)]);
2901 set(handles.LatticeAxes,<span class="string">'Position'</span>, [pa(1) pa(2) py pa(4)]);
2902 
2903 <a href="#_sub11" class="code" title="subfunction plotappdatalocal(handles)">plotappdatalocal</a>(handles);
2904 
2905 
2906 <span class="comment">% --------------------------------------------------------------------</span>
2907 <a name="_sub60" href="#_subfunctions" class="code">function AddPlot_Nothing_Callback(hObject, eventdata, handles)</a>
2908 
2909 hp = get(hObject, <span class="string">'Parent'</span>);
2910 hp = get(hp, <span class="string">'Parent'</span>);
2911 <span class="keyword">if</span> strcmp(get(hp,<span class="string">'Label'</span>),<span class="string">'Graph #1'</span>)
2912     plot(handles.Graph3, NaN, NaN)
2913     set(handles.Graph3,<span class="string">'Visible'</span>,<span class="string">'Off'</span>);
2914     set(handles.Graph3,<span class="string">'color'</span>,<span class="string">'none'</span>);
2915     set(handles.AddPlot1_Nothing,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2916     set(handles.AddPlot1_BetaX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2917     set(handles.AddPlot1_BetaY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2918     set(handles.AddPlot1_DispX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2919     set(handles.AddPlot1_DispY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2920 <span class="keyword">else</span>
2921     plot(handles.Graph4, NaN, NaN)
2922     set(handles.Graph4,<span class="string">'Visible'</span>,<span class="string">'Off'</span>);
2923     set(handles.Graph4,<span class="string">'color'</span>,<span class="string">'none'</span>);
2924     set(handles.AddPlot2_Nothing,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2925     set(handles.AddPlot2_BetaX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2926     set(handles.AddPlot2_BetaY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2927     set(handles.AddPlot2_DispX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2928     set(handles.AddPlot2_DispY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2929 <span class="keyword">end</span>
2930 
2931 <a href="#_sub59" class="code" title="subfunction HorizontalAxesScaling(hObject, eventdata, handles)">HorizontalAxesScaling</a>(hObject, eventdata, handles);
2932 
2933 
2934 <span class="comment">% --------------------------------------------------------------------</span>
2935 <a name="_sub61" href="#_subfunctions" class="code">function AddPlot_Beta_Callback(hObject, eventdata, handles)</a>
2936 <span class="comment">% Plot Beta</span>
2937 LineColor = [0 .5 0];
2938 
2939 hp = get(hObject,<span class="string">'Parent'</span>);
2940 hp = get(hp,<span class="string">'Parent'</span>);
2941 hp = get(hp,<span class="string">'Parent'</span>);
2942 <span class="keyword">if</span> strcmp(get(hp,<span class="string">'Label'</span>),<span class="string">'Graph #1'</span>)
2943     hAxes = handles.Graph3;
2944 <span class="keyword">else</span>
2945     hAxes = handles.Graph4;
2946 <span class="keyword">end</span>
2947 [BetaX, BetaY, Sx, Sy] = modelbeta(<span class="string">'All'</span>,<span class="string">'All'</span>);
2948 <span class="keyword">if</span> strcmp(get(hObject,<span class="string">'Label'</span>),<span class="string">'Horizontal'</span>)
2949     plot(hAxes, Sx, BetaX, <span class="string">'Color'</span>,LineColor);
2950     ylabel(hAxes, <span class="string">'{\it\beta_x} [meters]'</span>, <span class="string">'Color'</span>,LineColor);
2951 <span class="keyword">else</span>
2952     plot(hAxes, Sy, BetaY, <span class="string">'Color'</span>,LineColor);
2953     ylabel(hAxes, <span class="string">'{\it\beta_y} [meters]'</span>, <span class="string">'Color'</span>,LineColor);
2954 <span class="keyword">end</span>
2955 
2956 <span class="keyword">if</span> strcmp(get(hp,<span class="string">'Label'</span>),<span class="string">'Graph #1'</span>)
2957     AxisRangeX = getappdata(handles.figure1, <span class="string">'AxisRange1X'</span>);
2958 <span class="keyword">else</span>
2959     AxisRangeX = getappdata(handles.figure1, <span class="string">'AxisRange2X'</span>);
2960 <span class="keyword">end</span>
2961 
2962 axis(hAxes, <span class="string">'auto'</span>);
2963 a = axis(hAxes);        
2964 del = a(4) - a(3);
2965 axis(hAxes, [AxisRangeX(1) AxisRangeX(2) a(3)-.4*del a(4)+.4*del]);
2966 <a href="#_sub68" class="code" title="subfunction AutoScaleVertical(h_axis, ScaleFactor)">AutoScaleVertical</a>(hAxes, .77);
2967 
2968 <span class="comment">% Set axes defaults</span>
2969 set(hAxes, <span class="string">'Color'</span>, <span class="string">'none'</span>);
2970 set(hAxes, <span class="string">'Visible'</span>, <span class="string">'On'</span>);  <span class="comment">% Off to hide axis</span>
2971 set(hAxes, <span class="string">'YAxisLocation'</span>, <span class="string">'Right'</span>);
2972 set(hAxes, <span class="string">'XGrid'</span>, <span class="string">'Off'</span>);
2973 set(hAxes, <span class="string">'YGrid'</span>, <span class="string">'Off'</span>);
2974 set(hAxes, <span class="string">'XMinorGrid'</span>, <span class="string">'Off'</span>);
2975 set(hAxes, <span class="string">'YMinorGrid'</span>, <span class="string">'Off'</span>);
2976 set(hAxes, <span class="string">'YMinorTick'</span>, <span class="string">'Off'</span>);
2977 set(hAxes, <span class="string">'XMinorTick'</span>, <span class="string">'Off'</span>);
2978 set(hAxes, <span class="string">'XAxisLocation'</span>, <span class="string">'Bottom'</span>);
2979 set(hAxes, <span class="string">'XTickLabel'</span>, <span class="string">''</span>);
2980 <span class="comment">% set(hAxes, 'YTickLabel', []);</span>
2981 <span class="comment">% set(hAxes, 'XTick', []);</span>
2982 <span class="comment">% set(hAxes, 'YTick', []);</span>
2983 
2984 YTick = get(handles.Graph1, <span class="string">'YTick'</span>);
2985 
2986 
2987 <span class="keyword">if</span> strcmp(get(hp,<span class="string">'Label'</span>),<span class="string">'Graph #1'</span>)
2988     set(handles.AddPlot1_Nothing,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2989     <span class="keyword">if</span> strcmp(get(hObject,<span class="string">'Label'</span>),<span class="string">'Horizontal'</span>)
2990         set(handles.AddPlot1_BetaX,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2991         set(handles.AddPlot1_BetaY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2992     <span class="keyword">else</span>
2993         set(handles.AddPlot1_BetaX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2994         set(handles.AddPlot1_BetaY,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
2995     <span class="keyword">end</span>
2996     set(handles.AddPlot1_DispX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2997     set(handles.AddPlot1_DispY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
2998     
2999     set(hAxes ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
3000     h = get(hAxes,<span class="string">'Children'</span>);
3001     <span class="keyword">for</span> i = 1:length(h)
3002         set(h(i) ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
3003     <span class="keyword">end</span>
3004 <span class="keyword">else</span>
3005     set(handles.AddPlot2_Nothing,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3006     <span class="keyword">if</span> strcmp(get(hObject,<span class="string">'Label'</span>),<span class="string">'Horizontal'</span>)
3007         set(handles.AddPlot2_BetaX,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3008         set(handles.AddPlot2_BetaY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3009     <span class="keyword">else</span>
3010         set(handles.AddPlot2_BetaX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3011         set(handles.AddPlot2_BetaY,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3012     <span class="keyword">end</span>
3013     set(handles.AddPlot2_DispX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3014     set(handles.AddPlot2_DispY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3015     
3016     set(hAxes ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph2_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
3017     h = get(hAxes,<span class="string">'Children'</span>);
3018     <span class="keyword">for</span> i = 1:length(h)
3019         set(h(i) ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph2_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
3020     <span class="keyword">end</span>
3021 <span class="keyword">end</span>
3022 
3023 <a href="#_sub59" class="code" title="subfunction HorizontalAxesScaling(hObject, eventdata, handles)">HorizontalAxesScaling</a>(hObject, eventdata, handles);
3024 
3025 
3026 <span class="comment">% --------------------------------------------------------------------</span>
3027 <a name="_sub62" href="#_subfunctions" class="code">function AddPlot_Dispersion_Callback(hObject, eventdata, handles)</a>
3028 <span class="comment">% Plot dispersion in physics units</span>
3029 LineColor = [0 .5 0];
3030 
3031 hp = get(hObject,<span class="string">'Parent'</span>);
3032 hp = get(hp,<span class="string">'Parent'</span>);
3033 hp = get(hp,<span class="string">'Parent'</span>);
3034 
3035 <span class="keyword">if</span> strcmp(get(hp,<span class="string">'Label'</span>),<span class="string">'Graph #1'</span>)
3036     hAxes = handles.Graph3;
3037 <span class="keyword">else</span>
3038     hAxes = handles.Graph4;
3039 <span class="keyword">end</span>
3040 
3041 [DispX, DispY, Sx, Sy] = modeldisp(<span class="string">'All'</span>,<span class="string">'All'</span>,<span class="string">'Physics'</span>);
3042 <span class="keyword">if</span> strcmp(get(hObject,<span class="string">'Label'</span>),<span class="string">'Horizontal'</span>)
3043     plot(hAxes, Sx, 100*DispX, <span class="string">'Color'</span>,LineColor);
3044     ylabel(hAxes, <span class="string">'{\it\eta_x} [cm]'</span>, <span class="string">'Color'</span>,LineColor);
3045 <span class="keyword">else</span>
3046     plot(hAxes, Sy, 100*DispY, <span class="string">'Color'</span>,LineColor);
3047     ylabel(hAxes, <span class="string">'{\it\eta_y} [cm]'</span>, <span class="string">'Color'</span>,LineColor);
3048 <span class="keyword">end</span>
3049 <span class="keyword">if</span> strcmp(get(hp,<span class="string">'Label'</span>),<span class="string">'Graph #1'</span>)
3050     AxisRangeX = getappdata(handles.figure1, <span class="string">'AxisRange1X'</span>);
3051 <span class="keyword">else</span>
3052     AxisRangeX = getappdata(handles.figure1, <span class="string">'AxisRange2X'</span>);
3053 <span class="keyword">end</span>
3054 
3055 axis(hAxes, <span class="string">'auto'</span>);
3056 a = axis(hAxes);        
3057 del = a(4) - a(3);
3058 axis(hAxes, [AxisRangeX(1) AxisRangeX(2) a(3)-.4*del a(4)+.4*del]);
3059 <a href="#_sub68" class="code" title="subfunction AutoScaleVertical(h_axis, ScaleFactor)">AutoScaleVertical</a>(hAxes, .77);
3060 
3061 <span class="comment">% Set axes defaults</span>
3062 set(hAxes, <span class="string">'Color'</span>, <span class="string">'none'</span>);
3063 set(hAxes, <span class="string">'Visible'</span>, <span class="string">'On'</span>);  <span class="comment">% Off to hide axis</span>
3064 set(hAxes, <span class="string">'YAxisLocation'</span>, <span class="string">'Right'</span>);
3065 set(hAxes, <span class="string">'XGrid'</span>, <span class="string">'Off'</span>);
3066 set(hAxes, <span class="string">'YGrid'</span>, <span class="string">'Off'</span>);
3067 set(hAxes, <span class="string">'XMinorGrid'</span>, <span class="string">'Off'</span>);
3068 set(hAxes, <span class="string">'YMinorGrid'</span>, <span class="string">'Off'</span>);
3069 set(hAxes, <span class="string">'YMinorTick'</span>, <span class="string">'Off'</span>);
3070 set(hAxes, <span class="string">'XMinorTick'</span>, <span class="string">'Off'</span>);
3071 set(hAxes, <span class="string">'XAxisLocation'</span>, <span class="string">'Bottom'</span>);
3072 set(hAxes, <span class="string">'XTickLabel'</span>, <span class="string">''</span>);
3073 <span class="comment">% set(hAxes, 'YTickLabel', []);</span>
3074 <span class="comment">% set(hAxes, 'XTick', []);</span>
3075 <span class="comment">% set(hAxes, 'YTick', []);</span>
3076 
3077 
3078 <span class="keyword">if</span> strcmp(get(hp,<span class="string">'Label'</span>),<span class="string">'Graph #1'</span>)
3079     set(handles.AddPlot1_Nothing,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3080     <span class="keyword">if</span> strcmp(get(hObject,<span class="string">'Label'</span>),<span class="string">'Horizontal'</span>)
3081         set(handles.AddPlot1_DispX,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3082         set(handles.AddPlot1_DispY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3083     <span class="keyword">else</span>
3084         set(handles.AddPlot1_DispX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3085         set(handles.AddPlot1_DispY,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3086     <span class="keyword">end</span>
3087     set(handles.AddPlot1_BetaX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3088     set(handles.AddPlot1_BetaY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3089     
3090     set(hAxes ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
3091     h = get(hAxes,<span class="string">'Children'</span>);
3092     <span class="keyword">for</span> i = 1:length(h)
3093         set(h(i) ,<span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph1_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
3094     <span class="keyword">end</span>
3095     
3096 <span class="keyword">else</span>
3097     set(handles.AddPlot2_Nothing,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3098     <span class="keyword">if</span> strcmp(get(hObject,<span class="string">'Label'</span>),<span class="string">'Horizontal'</span>)
3099         set(handles.AddPlot2_DispX,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3100         set(handles.AddPlot2_DispY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3101     <span class="keyword">else</span>
3102         set(handles.AddPlot2_DispX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3103         set(handles.AddPlot2_DispY,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3104     <span class="keyword">end</span>
3105     set(handles.AddPlot2_BetaX,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3106     set(handles.AddPlot2_BetaY,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3107     
3108     set(hAxes, <span class="string">'ButtonDownFcn'</span>,<span class="string">'plotfamily(''Graph2_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
3109     h = get(hAxes, <span class="string">'Children'</span>);
3110     <span class="keyword">for</span> i = 1:length(h)
3111         set(h(i), <span class="string">'ButtonDownFcn'</span>, <span class="string">'plotfamily(''Graph2_ButtonDown'',gcbo,[],guidata(gcbo))'</span>);
3112     <span class="keyword">end</span>
3113 <span class="keyword">end</span>
3114 
3115 <a href="#_sub59" class="code" title="subfunction HorizontalAxesScaling(hObject, eventdata, handles)">HorizontalAxesScaling</a>(hObject, eventdata, handles);
3116 
3117 
3118 <span class="comment">% --------------------------------------------------------------------</span>
3119 <a name="_sub63" href="#_subfunctions" class="code">function DrawLattice_Callback(hObject, eventdata, handles)</a>
3120 <span class="comment">% Graph size is determined here and in function HorizontalAxesScaling</span>
3121 CheckMark = get(handles.DrawLattice, <span class="string">'Checked'</span>);
3122 <span class="keyword">if</span> strcmpi(CheckMark, <span class="string">'On'</span>)
3123     <span class="comment">% Remove the lattice drawing</span>
3124     d = .015;
3125     p1 = [0.07    0.65-d/2    0.74    0.29+d];
3126     set(handles.Graph1, <span class="string">'Position'</span>, p1);
3127     set(handles.Graph3, <span class="string">'Position'</span>, p1);
3128 
3129     p2 = [0.07    0.27        0.74    0.29+d];
3130     set(handles.Graph2, <span class="string">'Position'</span>, p2);
3131     set(handles.Graph4, <span class="string">'Position'</span>, p2);
3132 
3133     set(handles.DrawLattice, <span class="string">'Checked'</span>, <span class="string">'Off'</span>);
3134     set(get(handles.LatticeAxes,<span class="string">'Children'</span>), <span class="string">'Visible'</span> , <span class="string">'Off'</span>);
3135 <span class="keyword">else</span>
3136     <span class="comment">% Add the lattice drawing</span>
3137     g = .01;
3138     p1 = [0.07    0.65+g    0.74    0.29-g];
3139     set(handles.Graph1, <span class="string">'Position'</span>, p1);
3140     set(handles.Graph3, <span class="string">'Position'</span>, p1);
3141 
3142     p2 = [0.07    0.27      0.74    0.29-g];
3143     set(handles.Graph2, <span class="string">'Position'</span>, p2);
3144     set(handles.Graph4, <span class="string">'Position'</span>, p2);
3145 
3146     set(handles.LatticeAxes, <span class="string">'Units'</span>, <span class="string">'Normalized'</span>);
3147     <span class="comment">%P = get(handles.LatticeAxes, 'Position');</span>
3148     set(handles.LatticeAxes, <span class="string">'Position'</span>, [0.07 0.5744-g 0.74 0.07+2*g]);  <span class="comment">% p4 was 0.065</span>
3149 
3150     set(handles.DrawLattice, <span class="string">'Checked'</span>, <span class="string">'On'</span>);
3151     set(get(handles.LatticeAxes,<span class="string">'Children'</span>), <span class="string">'Visible'</span> , <span class="string">'On'</span>);
3152 <span class="keyword">end</span>
3153 
3154 <a href="#_sub59" class="code" title="subfunction HorizontalAxesScaling(hObject, eventdata, handles)">HorizontalAxesScaling</a>(hObject, eventdata, handles);
3155 
3156 
3157 <span class="comment">% --------------------------------------------------------------------</span>
3158 <a name="_sub64" href="#_subfunctions" class="code">function Graph1_ButtonDown(hObject, eventdata, handles)</a>
3159 set(handles.figure1, <span class="string">'HandleVisibility'</span>,<span class="string">'Callback'</span>);
3160 CurrentPoint = get(gca, <span class="string">'CurrentPoint'</span>);
3161 SposMouse = CurrentPoint(1,1);
3162 SposData = getappdata(handles.figure1, <span class="string">'SPosX'</span>);
3163 
3164 MeritFcn = abs(SposData-SposMouse);
3165 i = find(min(MeritFcn) == MeritFcn);
3166 set(handles.DataList1, <span class="string">'value'</span>, i(1));
3167 set(handles.figure1, <span class="string">'HandleVisibility'</span>,<span class="string">'Off'</span>);
3168 
3169 <span class="comment">% --------------------------------------------------------------------</span>
3170 <a name="_sub65" href="#_subfunctions" class="code">function Graph2_ButtonDown(hObject, eventdata, handles)</a>
3171 set(handles.figure1, <span class="string">'HandleVisibility'</span>,<span class="string">'Callback'</span>);
3172 CurrentPoint = get(gca, <span class="string">'CurrentPoint'</span>);
3173 SposMouse = CurrentPoint(1,1);
3174 SposData = getappdata(handles.figure1, <span class="string">'SPosY'</span>);
3175 
3176 MeritFcn = abs(SposData-SposMouse);
3177 i = find(min(MeritFcn) == MeritFcn);
3178 set(handles.DataList2, <span class="string">'value'</span>, i(1));
3179 set(handles.figure1, <span class="string">'HandleVisibility'</span>,<span class="string">'Off'</span>);
3180 
3181 
3182 <span class="comment">% --- Executes on button press in AutoScale1.</span>
3183 <a name="_sub66" href="#_subfunctions" class="code">function AutoScale1_Callback(hObject, eventdata, handles)</a>
3184 <a href="#_sub68" class="code" title="subfunction AutoScaleVertical(h_axis, ScaleFactor)">AutoScaleVertical</a>(handles.Graph1, .95);
3185 <a href="#_sub68" class="code" title="subfunction AutoScaleVertical(h_axis, ScaleFactor)">AutoScaleVertical</a>(handles.Graph3, .77);
3186 
3187 <span class="comment">% --- Executes on button press in AutoScale2.</span>
3188 <a name="_sub67" href="#_subfunctions" class="code">function AutoScale2_Callback(hObject, eventdata, handles)</a>
3189 <a href="#_sub68" class="code" title="subfunction AutoScaleVertical(h_axis, ScaleFactor)">AutoScaleVertical</a>(handles.Graph2, .95);
3190 <a href="#_sub68" class="code" title="subfunction AutoScaleVertical(h_axis, ScaleFactor)">AutoScaleVertical</a>(handles.Graph4, .77);
3191 
3192 <span class="comment">%--------------------------------------------------------</span>
3193 <a name="_sub68" href="#_subfunctions" class="code">function AutoScaleVertical(h_axis, ScaleFactor)</a>
3194 <span class="comment">% Auto-scale y-axis</span>
3195 
3196 <span class="keyword">if</span> nargin &lt; 2
3197     ScaleFactor = 1;
3198 <span class="keyword">end</span>
3199 
3200 a = axis(h_axis);
3201 <span class="comment">% if strcmpi(get(handles.Graph2Line,'Checked'),'On')</span>
3202 <span class="comment">%     % Line</span>
3203 <span class="comment">%     axis(h_axis, 'auto');</span>
3204 <span class="comment">%     set(h_axis, 'XLim', a(1:2));</span>
3205 <span class="comment">% else</span>
3206     <span class="comment">% Bar</span>
3207     h = get(h_axis,<span class="string">'Children'</span>);
3208     <span class="keyword">if</span> length(h) &gt; 1
3209         h = sort(h(end-1:end));
3210         y1 = get(h(1),<span class="string">'YData'</span>);
3211         y2 = get(h(2),<span class="string">'YData'</span>);
3212     <span class="keyword">else</span>
3213         y1 = get(h(1),<span class="string">'YData'</span>);
3214         y2 = y1;
3215     <span class="keyword">end</span>
3216     x = get(h(1),<span class="string">'XData'</span>);
3217     i = find(x&gt;a(1) &amp; x&lt;a(2));
3218     <span class="keyword">if</span> ~isempty(i)
3219         <span class="comment">% Select within present x-axis</span>
3220         y1 = y1(i);
3221         y2 = y2(i);
3222     <span class="keyword">end</span>
3223     
3224     MaxY = max([y1(:); y2(:)]);
3225     MinY = min([y1(:); y2(:)]);
3226 
3227     <span class="keyword">if</span> isnan(MinY) || isnan(MaxY)
3228         axis(h_axis, <span class="string">'auto'</span>);
3229         set(h_axis, <span class="string">'XLim'</span>, a(1:2));
3230     <span class="keyword">else</span>
3231         <span class="comment">%if abs(MaxY-MinY) &lt; eps</span>
3232         <span class="comment">%    MaxY = MaxY + .5;</span>
3233         <span class="comment">%    MinY = MinY - .5;</span>
3234         <span class="comment">%else</span>
3235             <span class="comment">% Add a buffer</span>
3236             Delta = MaxY - MinY;
3237             <span class="keyword">if</span> Delta == 0
3238                 Delta = 1e-15; <span class="comment">%eps;</span>
3239             <span class="keyword">end</span>
3240             MaxY = MaxY + (1-ScaleFactor) * Delta;
3241             MinY = MinY - (1-ScaleFactor) * Delta;
3242         <span class="comment">%end</span>
3243         set(h_axis, <span class="string">'YLim'</span>, [MinY MaxY]);
3244     <span class="keyword">end</span>
3245 <span class="comment">%end</span>
3246  
3247 <span class="comment">% % Auto-scale y-axis</span>
3248 <span class="comment">% axis(handles.Graph2, 'auto');</span>
3249 <span class="comment">% a = axis(handles.Graph2);</span>
3250 <span class="comment">% axis(handles.Graph2, [AxisRange2X(1) AxisRange2X(2) a(3) a(4)]);</span>
3251 <span class="comment">% a = axis(handles.Graph4);</span>
3252 <span class="comment">% axis(handles.Graph4, [AxisRange2X(1) AxisRange2X(2) a(3) a(4)]);</span>
3253 
3254 
3255 
3256 <span class="comment">% --- Executes on button press in AutoScale1.</span>
3257 <a name="_sub69" href="#_subfunctions" class="code">function AutoScaleH_Callback(hObject, eventdata, handles)</a>
3258 
3259 <span class="comment">% Auto scale X-axis to the full range</span>
3260 L = <a href="getfamilydata.html" class="code" title="function [Data, ErrorFlag] = getfamilydata(Family, Field1, Field2, DeviceList)">getfamilydata</a>(<span class="string">'Circumference'</span>);
3261 <span class="keyword">if</span> isempty(L)
3262     DataStruct = getappdata(handles.figure1, <span class="string">'BPMxFamily'</span>);
3263     s = <a href="getspos.html" class="code" title="function S = getspos(Family, DeviceList)">getspos</a>(DataStruct);
3264     AxisRangeX = [min(s) max(s)];
3265 <span class="keyword">else</span>
3266     AxisRangeX = [0 L];
3267 <span class="keyword">end</span>
3268 setappdata(handles.figure1, <span class="string">'AxisRange1X'</span>, AxisRangeX);
3269 setappdata(handles.figure1, <span class="string">'AxisRange2X'</span>, AxisRangeX);
3270 
3271 
3272 <span class="comment">% Set x-axis for everybody else</span>
3273 set(handles.Graph1,      <span class="string">'XLim'</span>, AxisRangeX);
3274 set(handles.Graph2,      <span class="string">'XLim'</span>, AxisRangeX);
3275 set(handles.Graph3,      <span class="string">'XLim'</span>, AxisRangeX);
3276 set(handles.Graph4,      <span class="string">'XLim'</span>, AxisRangeX);
3277 set(handles.LatticeAxes, <span class="string">'XLim'</span>, AxisRangeX);
3278 
3279 <span class="comment">% % Auto scale X-axis to the full range</span>
3280 <span class="comment">% L = getfamilydata('Circumference');</span>
3281 <span class="comment">% if isempty(L)</span>
3282 <span class="comment">%     DataStruct = getappdata(handles.figure1, 'BPMyFamily');</span>
3283 <span class="comment">%     s = getspos(DataStruct);</span>
3284 <span class="comment">%     AxisRange2X = [min(s) max(s)];</span>
3285 <span class="comment">% else</span>
3286 <span class="comment">%     AxisRange2X = [0 L];</span>
3287 <span class="comment">% end</span>
3288 <span class="comment">% setappdata(handles.figure1, 'AxisRange2X', AxisRange2X);</span>
3289 <span class="comment">%</span>
3290 <span class="comment">% Set x-axis for everybody else</span>
3291 <span class="comment">%set(handles.Graph1,      'XLim', [AxisRange2X(1) AxisRange2X(2)]);</span>
3292 <span class="comment">%set(handles.Graph3,      'XLim', [AxisRange2X(1) AxisRange2X(2)]);</span>
3293 <span class="comment">%set(handles.LatticeAxes, 'XLim', [AxisRange2X(1) AxisRange2X(2)]);</span>
3294 
3295 
3296 <a name="_sub70" href="#_subfunctions" class="code">function AutoScaleYLocal(handles)</a>
3297 a = axis(handles.Graph1);
3298 axis(handles.Graph1, <span class="string">'auto'</span>);
3299 set(handles.Graph1, <span class="string">'XLim'</span>, a(1:2));
3300 
3301 a = axis(handles.Graph2);
3302 axis(handles.Graph2, <span class="string">'auto'</span>);
3303 set(handles.Graph2, <span class="string">'XLim'</span>, a(1:2));
3304 
3305 
3306 
3307 <span class="comment">% --- Executes on button press in Graph1ZoomInVertical.</span>
3308 <a name="_sub71" href="#_subfunctions" class="code">function Graph1ZoomInVertical_Callback(hObject, eventdata, handles)</a>
3309 a = axis(handles.Graph1);
3310 ChangeFactor = 1.15;
3311 del = (1/ChangeFactor-1)*(a(4)-a(3));
3312 axis((handles.Graph1), [a(1) a(2) a(3)-del/2 a(4)+del/2]);
3313 set(hObject, <span class="string">'Value'</span>, 0);
3314 
3315 
3316 <span class="comment">% --- Executes on button press in Graph1ZoomOutVertical.</span>
3317 <a name="_sub72" href="#_subfunctions" class="code">function Graph1ZoomOutVertical_Callback(hObject, eventdata, handles)</a>
3318 a = axis(handles.Graph1);
3319 ChangeFactor = 1.15;
3320 del = (ChangeFactor-1)*(a(4)-a(3));
3321 axis((handles.Graph1), [a(1) a(2) a(3)-del/2 a(4)+del/2]);
3322 set(hObject, <span class="string">'Value'</span>, 0);
3323 
3324 
3325 <span class="comment">% --- Executes on button press in Graph2ZoomInVertical.</span>
3326 <a name="_sub73" href="#_subfunctions" class="code">function Graph2ZoomInVertical_Callback(hObject, eventdata, handles)</a>
3327 a = axis(handles.Graph2);
3328 ChangeFactor = 1.15;
3329 del = (1/ChangeFactor-1)*(a(4)-a(3));
3330 axis((handles.Graph2), [a(1) a(2) a(3)-del/2 a(4)+del/2]);
3331 set(hObject, <span class="string">'Value'</span>, 0);
3332 
3333 
3334 <span class="comment">% --- Executes on button press in Graph2ZoomOutVertical.</span>
3335 <a name="_sub74" href="#_subfunctions" class="code">function Graph2ZoomOutVertical_Callback(hObject, eventdata, handles)</a>
3336 a = axis(handles.Graph2);
3337 ChangeFactor = 1.15;
3338 del = (ChangeFactor-1)*(a(4)-a(3));
3339 axis((handles.Graph2), [a(1) a(2) a(3)-del/2 a(4)+del/2]);
3340 set(hObject, <span class="string">'Value'</span>, 0);
3341 
3342 
3343 <span class="comment">% --- Executes on button press in Graph1ZoomInVertical.</span>
3344 <a name="_sub75" href="#_subfunctions" class="code">function Graph1OffsetUpVertical_Callback(hObject, eventdata, handles)</a>
3345 ChangeFactor = 1.1;
3346 a1 = axis(handles.Graph1);
3347 del1 = (ChangeFactor-1)*(a1(4)-a1(3));
3348 axis(handles.Graph1, [a1(1) a1(2) a1(3)+del1 a1(4)+del1]);
3349 set(hObject, <span class="string">'Value'</span>, 0);
3350 
3351 <span class="comment">% --- Executes on button press in Graph1ZoomOutVertical.</span>
3352 <a name="_sub76" href="#_subfunctions" class="code">function Graph1OffsetDownVertical_Callback(hObject, eventdata, handles)</a>
3353 ChangeFactor = 1.1;
3354 a1 = axis(handles.Graph1);
3355 del1 = (1/ChangeFactor-1)*(a1(4)-a1(3));
3356 axis(handles.Graph1, [a1(1) a1(2) a1(3)+del1 a1(4)+del1]);
3357 set(hObject, <span class="string">'Value'</span>, 0);
3358 
3359 
3360 <span class="comment">% --- Executes on button press in Graph1ZoomInVertical.</span>
3361 <a name="_sub77" href="#_subfunctions" class="code">function Graph2OffsetUpVertical_Callback(hObject, eventdata, handles)</a>
3362 ChangeFactor = 1.1;
3363 a1 = axis(handles.Graph2);
3364 del1 = (ChangeFactor-1)*(a1(4)-a1(3));
3365 axis(handles.Graph2, [a1(1) a1(2) a1(3)+del1 a1(4)+del1]);
3366 set(hObject, <span class="string">'Value'</span>, 0);
3367 
3368 <span class="comment">% --- Executes on button press in Graph1ZoomOutVertical.</span>
3369 <a name="_sub78" href="#_subfunctions" class="code">function Graph2OffsetDownVertical_Callback(hObject, eventdata, handles)</a>
3370 ChangeFactor = 1.1;
3371 a1 = axis(handles.Graph2);
3372 del1 = (1/ChangeFactor-1)*(a1(4)-a1(3));
3373 axis(handles.Graph2, [a1(1) a1(2) a1(3)+del1 a1(4)+del1]);
3374 set(hObject, <span class="string">'Value'</span>, 0);
3375 
3376 
3377 <span class="comment">% --- Executes on button press in HorizontalOffsetRight.</span>
3378 <a name="_sub79" href="#_subfunctions" class="code">function HorizontalOffsetRight_Callback(hObject, eventdata, handles)</a>
3379 ChangeFactor = 1.05;
3380 a1 = axis(handles.Graph1);
3381 a2 = axis(handles.Graph2);
3382 a3 = axis(handles.Graph3);
3383 a4 = axis(handles.Graph4);
3384 del1 = (ChangeFactor-1)*(a1(2)-a1(1));
3385 del2 = (ChangeFactor-1)*(a2(2)-a2(1));
3386 axis(handles.Graph1, [a1(1)+del1 a1(2)+del1 a1(3) a1(4)]);
3387 axis(handles.Graph3, [a1(1)+del1 a1(2)+del1 a3(3) a3(4)]);
3388 axis(handles.Graph2, [a2(1)+del2 a2(2)+del2 a2(3) a2(4)]);
3389 axis(handles.Graph4, [a2(1)+del2 a2(2)+del2 a4(3) a4(4)]);
3390 set(handles.LatticeAxes, <span class="string">'XLim'</span>, [a2(1)+del2 a2(2)+del2]);
3391 setappdata(handles.figure1, <span class="string">'AxisRange1X'</span>, [a1(1)+del1 a1(2)+del1]);
3392 setappdata(handles.figure1, <span class="string">'AxisRange2X'</span>, [a2(1)+del2 a2(2)+del2]);
3393 
3394 <a name="_sub80" href="#_subfunctions" class="code">function HorizontalOffsetLeft_Callback(hObject, eventdata, handles)</a>
3395 ChangeFactor = 1.05;
3396 a1 = axis(handles.Graph1);
3397 a2 = axis(handles.Graph2);
3398 a3 = axis(handles.Graph3);
3399 a4 = axis(handles.Graph4);
3400 del1 = (1/ChangeFactor-1)*(a1(2)-a1(1));
3401 del2 = (1/ChangeFactor-1)*(a2(2)-a2(1));
3402 axis(handles.Graph1, [a1(1)+del1 a1(2)+del1 a1(3) a1(4)]);
3403 axis(handles.Graph3, [a1(1)+del1 a1(2)+del1 a3(3) a3(4)]);
3404 axis(handles.Graph2, [a2(1)+del2 a2(2)+del2 a2(3) a2(4)]);
3405 axis(handles.Graph4, [a2(1)+del2 a2(2)+del2 a4(3) a4(4)]);
3406 set(handles.LatticeAxes, <span class="string">'XLim'</span>, [a2(1)+del2 a2(2)+del2]);
3407 setappdata(handles.figure1, <span class="string">'AxisRange1X'</span>, [a1(1)+del1 a1(2)+del1]);
3408 setappdata(handles.figure1, <span class="string">'AxisRange2X'</span>, [a2(1)+del2 a2(2)+del2]);
3409 
3410 <a name="_sub81" href="#_subfunctions" class="code">function Graph1ZoomInHorizontal_Callback(hObject, eventdata, handles)</a>
3411 ChangeFactor = 1.3;
3412 a1 = axis(handles.Graph1);
3413 a2 = axis(handles.Graph2);
3414 a3 = axis(handles.Graph3);
3415 a4 = axis(handles.Graph4);
3416 del1 = (1/ChangeFactor-1)*(a1(2)-a1(1));
3417 del2 = (1/ChangeFactor-1)*(a2(2)-a2(1));
3418 axis(handles.Graph1, [a1(1)-del1/2 a1(2)+del1/2 a1(3) a1(4)]);
3419 axis(handles.Graph3, [a1(1)-del1/2 a1(2)+del1/2 a3(3) a3(4)]);
3420 axis(handles.Graph2, [a2(1)-del2/2 a2(2)+del2/2 a2(3) a2(4)]);
3421 axis(handles.Graph4, [a2(1)-del2/2 a2(2)+del2/2 a4(3) a4(4)]);
3422 set(handles.LatticeAxes, <span class="string">'XLim'</span>, [a2(1)-del2/2 a2(2)+del2/2]);
3423 setappdata(handles.figure1, <span class="string">'AxisRange1X'</span>, [a1(1)-del1/2 a1(2)+del1/2]);
3424 setappdata(handles.figure1, <span class="string">'AxisRange2X'</span>, [a2(1)-del2/2 a2(2)+del2/2]);
3425 
3426 <a name="_sub82" href="#_subfunctions" class="code">function Graph1ZoomOutHorizontal_Callback(hObject, eventdata, handles)</a>
3427 ChangeFactor = 1.3;
3428 a1 = axis(handles.Graph1);
3429 a2 = axis(handles.Graph2);
3430 a3 = axis(handles.Graph3);
3431 a4 = axis(handles.Graph4);
3432 del1 = (ChangeFactor-1)*(a1(2)-a1(1));
3433 del2 = (ChangeFactor-1)*(a2(2)-a2(1));
3434 axis(handles.Graph1, [a1(1)-del1/2 a1(2)+del1/2 a1(3) a1(4)]);
3435 axis(handles.Graph3, [a1(1)-del1/2 a1(2)+del1/2 a3(3) a3(4)]);
3436 axis(handles.Graph2, [a2(1)-del2/2 a2(2)+del2/2 a2(3) a2(4)]);
3437 axis(handles.Graph4, [a2(1)-del2/2 a2(2)+del2/2 a4(3) a4(4)]);
3438 set(handles.LatticeAxes, <span class="string">'XLim'</span>, [a2(1)-del2/2 a2(2)+del2/2]);
3439 setappdata(handles.figure1, <span class="string">'AxisRange1X'</span>, [a1(1)-del1/2 a1(2)+del1/2]);
3440 setappdata(handles.figure1, <span class="string">'AxisRange2X'</span>, [a2(1)-del2/2 a2(2)+del2/2]);
3441 
3442 
3443 <span class="comment">% Just in Lattice menu (Not plotfamily)</span>
3444 <a name="_sub83" href="#_subfunctions" class="code">function Switch2HW_Callback(hObject, eventdata, handles)</a>
3445 <a href="switch2hw.html" class="code" title="function ErrorFlag = switch2hw(varargin)">switch2hw</a>;
3446 
3447 <a name="_sub84" href="#_subfunctions" class="code">function Switch2Physics_Callback(hObject, eventdata, handles)</a>
3448 <a href="switch2physics.html" class="code" title="function ErrorFlag = switch2physics(Family)">switch2physics</a>;
3449 
3450 <a name="_sub85" href="#_subfunctions" class="code">function Switch2Online_Callback(hObject, eventdata, handles)</a>
3451 <a href="switch2online.html" class="code" title="function ErrorFlag = switch2online(Family, DisplayFlag)">switch2online</a>;
3452 
3453 <a name="_sub86" href="#_subfunctions" class="code">function Switch2Sim_Callback(hObject, eventdata, handles)</a>
3454 <a href="switch2sim.html" class="code" title="function ErrorFlag = switch2sim(Family, DisplayFlag)">switch2sim</a>;
3455 
3456 
3457 
3458 
3459 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
3460 <span class="comment">% Setpoint change callbacks %</span>
3461 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
3462 
3463 <span class="comment">% --------------------------------------------------------------------</span>
3464 <a name="_sub87" href="#_subfunctions" class="code">function Lattice_ButtonDown(hObject, eventdata, handles)</a>
3465 <span class="comment">% Change setpoint request</span>
3466 ErrorFlag = 0;
3467 
3468 <span class="comment">% Only works on setpoint fields (at the moment)</span>
3469 Field = <span class="string">'Setpoint'</span>;
3470 
3471 <span class="keyword">try</span>
3472     ATIndex = get(hObject, <span class="string">'UserData'</span>);
3473 
3474     CurrentPoint = get(handles.LatticeAxes, <span class="string">'CurrentPoint'</span>);
3475     SposMouse = CurrentPoint(1,1);
3476     
3477     [Family, List] = atindex2family(ATIndex);
3478 
3479     <span class="keyword">if</span> isempty(Family) || isempty(List)
3480         ErrorFlag = 1;
3481     <span class="keyword">else</span>
3482 
3483         List = List(1,:);
3484 
3485         HCMFamily = <a href="gethcmfamily.html" class="code" title="function Family = gethcmfamily(OneHit)">gethcmfamily</a>;
3486         VCMFamily = <a href="getvcmfamily.html" class="code" title="function Family = getvcmfamily(OneHit)">getvcmfamily</a>;
3487         <span class="keyword">if</span> any(strcmpi(Family, {HCMFamily, VCMFamily}))
3488             <span class="comment">% A corrector was found (how do I know if it's a HCM or VCM?  AT does not differentiate)</span>
3489             <span class="keyword">if</span> strcmpi(Family, HCMFamily) &amp;&amp; CurrentPoint(1,2)&lt;0
3490                 <span class="comment">% It should be a VCM family</span>
3491                 DevList = <a href="family2dev.html" class="code" title="function DeviceList = family2dev(Family, varargin)">family2dev</a>(VCMFamily);
3492                 [i, col] = find(ATIndex == family2atindex(VCMFamily,DevList));
3493                 <span class="keyword">if</span> ~isempty(i)
3494                     Family = VCMFamily;
3495                     List = DevList(i,:);
3496                 <span class="keyword">end</span>
3497             <span class="keyword">elseif</span> strcmpi(Family, VCMFamily) &amp;&amp; CurrentPoint(1,2)&gt;0
3498                 <span class="comment">% It should be a HCM family</span>
3499                 DevList = <a href="family2dev.html" class="code" title="function DeviceList = family2dev(Family, varargin)">family2dev</a>(HCMFamily);
3500                 [i, col] = find(ATIndex == family2atindex(HCMFamily,DevList));
3501                 <span class="keyword">if</span> ~isempty(i)
3502                     Family = HCMFamily;
3503                     List = DevList(i,:);
3504                 <span class="keyword">end</span>
3505             <span class="keyword">end</span>
3506         <span class="keyword">end</span>
3507 
3508         [FamilyFlag,ao] = <a href="isfamily.html" class="code" title="function  [FamilyFlag, AO] = isfamily(Family, Field)">isfamily</a>(Family);
3509 
3510         <span class="keyword">if</span> isfield(ao, Field)
3511             <span class="comment">% Get/save the present setpoint then call the GUI for setpoint changes</span>
3512             <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3513                 Mode = <span class="string">'Simulator'</span>;
3514             <span class="keyword">else</span>
3515                 Mode = <span class="string">'Online'</span>;
3516             <span class="keyword">end</span>
3517             <span class="keyword">if</span> strcmpi(get(handles.PhysicsUnitsFlag,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3518                 <span class="comment">%if getappdata(handles.figure1,'UnitsFlag') == 1</span>
3519                 UnitsFlag = <span class="string">'Physics'</span>;
3520             <span class="keyword">else</span>
3521                 UnitsFlag = <span class="string">'Hardware'</span>;
3522             <span class="keyword">end</span>
3523 
3524             SP = <a href="getpv.html" class="code" title="function [AM, tout, DataTime, ErrorFlag] = getpv(varargin)">getpv</a>(Family, Field, List, Mode, UnitsFlag, <span class="string">'Struct'</span>);
3525             set(handles.SetpointSlider,     <span class="string">'UserData'</span>, SP);
3526             set(handles.SetpointPushButton, <span class="string">'UserData'</span>, SP);
3527             <a href="#_sub88" class="code" title="subfunction SetpointGUI_Callback(hObject, eventdata, handles)">SetpointGUI_Callback</a>(hObject, eventdata, handles);
3528         <span class="keyword">else</span>
3529             ErrorFlag = 1;
3530         <span class="keyword">end</span>
3531     <span class="keyword">end</span>
3532 <span class="keyword">catch</span>
3533     ErrorFlag = 1;
3534     fprintf(<span class="string">'\n%s\n'</span>, lasterr);
3535     fprintf(<span class="string">'There was a problem getting %s.%s(%d,%d)\n'</span>, Family, Field, List);
3536 <span class="keyword">end</span>
3537 
3538 <span class="keyword">if</span> ErrorFlag
3539     <span class="comment">% Turn off the setpoint GUI</span>
3540     <a href="#_sub99" class="code" title="subfunction TurnOffSetpointGUI_Callback(hObject, eventdata, handles)">TurnOffSetpointGUI_Callback</a>(hObject, eventdata, handles);
3541 <span class="keyword">end</span>
3542 
3543 
3544 <span class="comment">% --------------------------------------------------------------------</span>
3545 <a name="_sub88" href="#_subfunctions" class="code">function SetpointGUI_Callback(hObject, eventdata, handles)</a>
3546 
3547 <span class="keyword">if</span> strcmpi(get(handles.DisabledSetpointChanges,<span class="string">'Checked'</span>),<span class="string">'Off'</span>)
3548     SP = get(handles.SetpointSlider, <span class="string">'UserData'</span>);
3549 
3550     <span class="comment">% Use slider and edit box</span>
3551     set(handles.SetpointSlider, <span class="string">'UserData'</span>, SP);
3552     <span class="keyword">try</span>
3553         MaxPV = <a href="maxpv.html" class="code" title="function [Data, ErrorFlag] = maxpv(varargin)">maxpv</a>(SP);
3554         MinPV = <a href="minpv.html" class="code" title="function [Data, ErrorFlag] = minpv(varargin)">minpv</a>(SP);
3555         <span class="comment">%if isinf(MaxPV) &amp;&amp; ~isnan(MaxPV)</span>
3556         <span class="comment">%    MaxPV = 1e10; %SP.Data + abs(SP.Data);</span>
3557         <span class="comment">%end</span>
3558         <span class="comment">%if isinf(MinPV) &amp;&amp; ~isnan(MinPV)</span>
3559         <span class="comment">%    MinPV = -1e10; %SP.Data - abs(SP.Data);;</span>
3560         <span class="comment">%end</span>
3561 
3562         <span class="keyword">if</span> MaxPV &lt; MinPV
3563             tmp = MaxPV;
3564             MaxPV = MinPV;
3565             MinPV = tmp;
3566         <span class="keyword">end</span>
3567 
3568         <span class="keyword">if</span> isnumeric(MaxPV) &amp;&amp; isnumeric(MinPV) &amp;&amp; ~isinf(MaxPV) &amp;&amp; ~isinf(MinPV) &amp;&amp; ~isnan(MaxPV) &amp;&amp; ~isnan(MinPV) &amp;&amp; (MaxPV-MinPV)~=0
3569             Range = abs(MaxPV-MinPV);
3570             <span class="keyword">if</span> Range == 1
3571                 StepSize = 1;
3572             <span class="keyword">else</span>
3573                 StepSize = Range/5000;
3574             <span class="keyword">end</span>
3575         <span class="keyword">else</span>
3576             StepSize = 1;
3577         <span class="keyword">end</span>
3578         set(handles.SetpointStepSize, <span class="string">'String'</span>, num2str(StepSize));
3579         <span class="comment">%set(handles.SetpointStepSize, 'String', sprintf('%f',StepSize));</span>
3580     <span class="keyword">catch</span>
3581         MaxPV = Inf; <span class="comment">% 1e10; % SP.Data + abs(SP.Data);</span>
3582         MinPV =-Inf; <span class="comment">%-1e10; % SP.Data - abs(SP.Data);</span>
3583     <span class="keyword">end</span>
3584 
3585     set(handles.SetpointMax, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>,MaxPV));
3586     set(handles.SetpointMin, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>,MinPV));
3587 
3588     <span class="keyword">if</span> ~isinf(MaxPV) &amp;&amp; ~isnan(MaxPV) &amp;&amp; (MaxPV-MinPV)~=0
3589         set(handles.SetpointSlider, <span class="string">'Max'</span>, MaxPV);
3590     <span class="keyword">end</span>
3591     <span class="keyword">if</span> ~isinf(MinPV) &amp;&amp; ~isnan(MaxPV) &amp;&amp; (MaxPV-MinPV)~=0
3592         set(handles.SetpointSlider, <span class="string">'Min'</span>, MinPV);
3593     <span class="keyword">end</span>
3594     <a href="#_sub89" class="code" title="subfunction SetpointRange_Callback(hObject, eventdata, handles)">SetpointRange_Callback</a>(hObject, eventdata, handles);
3595 
3596     set(handles.SetpointFamily, <span class="string">'String'</span>, sprintf(<span class="string">'%s.%s'</span>, deblank(<a href="family2common.html" class="code" title="function [CommonNames, ErrorFlag] = family2common(Family, DeviceList)">family2common</a>(SP.FamilyName, SP.DeviceList)), SP.Field));
3597     <span class="comment">%set(handles.SetpointFamily, 'String', sprintf('%s.%s(%d,%d)', SP.FamilyName, SP.Field, SP.DeviceList));</span>
3598     <span class="keyword">try</span>
3599         set(handles.SetpointFamily,  <span class="string">'TooltipString'</span>, sprintf(<span class="string">'%s'</span>, <a href="family2channel.html" class="code" title="function [ChannelNames, ErrorFlag] = family2channel(varargin)">family2channel</a>(SP)));
3600     <span class="keyword">catch</span>
3601         set(handles.SetpointFamily,  <span class="string">'TooltipString'</span>, <span class="string">''</span>);
3602     <span class="keyword">end</span>
3603     set(handles.SetpointUnits,   <span class="string">'String'</span>, [SP.UnitsString, <span class="string">'/step'</span>]);
3604     set(handles.SetpointEditBox, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>, SP.Data));
3605     set(handles.SetpointEditBox, <span class="string">'TooltipString'</span>, sprintf(<span class="string">'New setpoint in %s'</span>, SP.UnitsString));
3606 
3607     set(handles.SetpointPushButton, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>, SP.Data));
3608     set(handles.SetpointPushButton, <span class="string">'TooltipString'</span>, sprintf(<span class="string">'Restore original setpoint to %f %s'</span>, SP.Data, SP.UnitsString));
3609 
3610 
3611     set(handles.SetpointEditBox,   <span class="string">'Visible'</span>, <span class="string">'On'</span>);
3612     set(handles.SetpointFamily,    <span class="string">'Visible'</span>, <span class="string">'On'</span>);
3613     set(handles.SetpointUnits,     <span class="string">'Visible'</span>, <span class="string">'On'</span>);
3614     set(handles.SetpointSlider,    <span class="string">'Visible'</span>, <span class="string">'On'</span>);
3615     set(handles.SetpointMax,       <span class="string">'Visible'</span>, <span class="string">'On'</span>);
3616     set(handles.SetpointMin,       <span class="string">'Visible'</span>, <span class="string">'On'</span>);
3617     set(handles.SetpointFrame,     <span class="string">'Visible'</span>, <span class="string">'On'</span>);
3618     set(handles.SetpointStepSize,  <span class="string">'Visible'</span>, <span class="string">'On'</span>);
3619     set(handles.SetpointPushButton,<span class="string">'Visible'</span>, <span class="string">'On'</span>);
3620 
3621     <span class="comment">% Change the save and file text to make room for the slider</span>
3622     p = get(handles.SaveTime, <span class="string">'Position'</span>);
3623     set(handles.SaveTime, <span class="string">'Position'</span>,  [p(1) p(2) .353*p(3) p(4)]);
3624     p = get(handles.FileNameX, <span class="string">'Position'</span>);
3625     set(handles.FileNameX, <span class="string">'Position'</span>, [p(1) p(2) .353*p(3) p(4)]);
3626     p = get(handles.FileNameY, <span class="string">'Position'</span>);
3627     set(handles.FileNameY, <span class="string">'Position'</span>, [p(1) p(2) .353*p(3) p(4)]);
3628 
3629     <span class="comment">% % Other method: use input dialog box</span>
3630     <span class="comment">% answer = inputdlg(sprintf('Enter new setpoint for %s.%s(%d,%d) in %s (%s):', SP.FamilyName, SP.Field, SP.DeviceList, SP.UnitsString, SP.Mode),'FAMILYPLOT',1,{sprintf('%s',num2str(SP.Data))});</span>
3631     <span class="comment">% if ~isempty(answer)</span>
3632     <span class="comment">%     NewSP = str2num(answer{1});</span>
3633     <span class="comment">%     if ~isempty(NewSP)</span>
3634     <span class="comment">%         SP.Data = NewSP</span>
3635     <span class="comment">%         set(handles.SetpointSlider,  'UserData', SP);</span>
3636     <span class="comment">%         ChangeSetpointPlotfamily(hObject, eventdata, handles);</span>
3637     <span class="comment">%         %setpv(Family, Field, NewSP, List, Mode);</span>
3638     <span class="comment">%     end</span>
3639     <span class="comment">% end</span>
3640 <span class="keyword">end</span>
3641 
3642 
3643 <span class="comment">% --------------------------------------------------------------------</span>
3644 <a name="_sub89" href="#_subfunctions" class="code">function SetpointRange_Callback(hObject, eventdata, handles)</a>
3645 
3646 MaxPV = str2num(get(handles.SetpointMax,<span class="string">'String'</span>));
3647 MinPV = str2num(get(handles.SetpointMin,<span class="string">'String'</span>));
3648 
3649 <span class="keyword">if</span> isnumeric(MaxPV) &amp;&amp; isnumeric(MinPV) &amp;&amp; ~isinf(MaxPV) &amp;&amp; ~isinf(MinPV) &amp;&amp; ~isnan(MaxPV) &amp;&amp; ~isnan(MinPV) &amp;&amp; (MaxPV-MinPV)~=0
3650     <span class="keyword">if</span> MaxPV &lt; MinPV
3651         fprintf(<span class="string">'   Maximum range must be greater than the minimum range.\n'</span>);
3652         MaxPV = get(handles.SetpointSlider, <span class="string">'Max'</span>);
3653         MinPV = get(handles.SetpointSlider, <span class="string">'Min'</span>);
3654         set(handles.SetpointMax, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>,MaxPV));
3655         set(handles.SetpointMin, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>,MinPV));
3656     <span class="keyword">else</span>
3657         StepSize = abs(str2num(get(handles.SetpointStepSize, <span class="string">'String'</span>)));
3658         Range = abs(MaxPV-MinPV);
3659         <span class="keyword">if</span> isempty(StepSize) || ~isnumeric(StepSize)
3660             fprintf(<span class="string">'   Step size is not a numeric value.  Overwriting with the default step size.\n'</span>);
3661             StepSize = Range/1000;
3662         <span class="keyword">end</span>
3663         set(handles.SetpointStepSize, <span class="string">'String'</span>, num2str(StepSize));
3664         <span class="comment">%set(handles.SetpointStepSize, 'String', sprintf('%f',StepSize));</span>
3665         Steps = Range/StepSize;
3666         <span class="keyword">if</span> Steps &lt; 10
3667             Steps = 10;
3668         <span class="keyword">end</span>
3669         set(handles.SetpointSlider, <span class="string">'Max'</span>, MaxPV);
3670         set(handles.SetpointSlider, <span class="string">'Min'</span>, MinPV);
3671         set(handles.SetpointSlider, <span class="string">'SliderStep'</span>, [1/Steps 10/Steps]);
3672         <span class="comment">%set(handles.SetpointSlider, 'SliderStep', [.001 .01]);</span>
3673 
3674         SP = get(handles.SetpointSlider, <span class="string">'UserData'</span>);
3675         set(handles.SetpointSlider,  <span class="string">'Value'</span>,  SP.Data);
3676         
3677         set(handles.SetpointSlider, <span class="string">'Enable'</span>, <span class="string">'On'</span>);
3678     <span class="keyword">end</span>
3679 <span class="keyword">else</span>
3680     set(handles.SetpointSlider, <span class="string">'Enable'</span>, <span class="string">'Off'</span>);
3681 <span class="keyword">end</span>
3682 
3683 
3684 
3685 <span class="comment">% --------------------------------------------------------------------</span>
3686 <a name="_sub90" href="#_subfunctions" class="code">function SetpointSlider_Callback(hObject, eventdata, handles)</a>
3687 
3688 <span class="comment">% Get setpoint from the slider</span>
3689 NewSP = get(handles.SetpointSlider, <span class="string">'Value'</span>);
3690 
3691 SP = get(handles.SetpointSlider, <span class="string">'UserData'</span>);
3692 SP.Data = NewSP;
3693 
3694 <span class="comment">% Update Slider</span>
3695 set(handles.SetpointSlider, <span class="string">'UserData'</span>, SP);
3696 set(handles.SetpointSlider, <span class="string">'Value'</span>, NewSP);
3697 
3698 <span class="comment">% Update EditBox</span>
3699 set(handles.SetpointEditBox, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>, SP.Data));
3700 
3701 <span class="comment">% Make setpoint change</span>
3702 <a href="#_sub93" class="code" title="subfunction ChangeSetpointPlotfamily(hObject, eventdata, handles)">ChangeSetpointPlotfamily</a>(hObject, eventdata, handles);
3703 
3704 
3705 <span class="comment">% --------------------------------------------------------------------</span>
3706 <a name="_sub91" href="#_subfunctions" class="code">function SetpointEditBox_Callback(hObject, eventdata, handles)</a>
3707 
3708 <span class="comment">% Get setpoint from the editbox</span>
3709 ValueStr = get(handles.SetpointEditBox, <span class="string">'String'</span>);
3710 
3711 <span class="keyword">if</span> ~isempty(ValueStr)
3712     NewSP = str2num(ValueStr);
3713 
3714     SP = get(handles.SetpointSlider, <span class="string">'UserData'</span>);
3715     SP.Data = NewSP;
3716 
3717     <span class="comment">% Check range (if slider is enabled)</span>
3718     ChangeFlag = 1;
3719     <span class="keyword">if</span> strcmpi(get(handles.SetpointSlider,<span class="string">'Enable'</span>), <span class="string">'On'</span>)
3720         MaxPV = str2num(get(handles.SetpointMax,<span class="string">'String'</span>));
3721         MinPV = str2num(get(handles.SetpointMin,<span class="string">'String'</span>));
3722         <span class="keyword">if</span> isnumeric(MaxPV) &amp;&amp; isnumeric(MinPV) &amp;&amp; ~isinf(MaxPV) &amp;&amp; ~isinf(MinPV) &amp;&amp; ~isnan(MaxPV) &amp;&amp; ~isnan(MinPV)
3723             <span class="keyword">if</span> MaxPV &lt; NewSP  || NewSP &lt; MinPV
3724                 fprintf(<span class="string">'   The requested setpoint is outside the limits.  Requested cancelled.\n'</span>);
3725                 ChangeFlag = 0;
3726                 OldSP = get(handles.SetpointSlider, <span class="string">'Value'</span>);
3727                 set(handles.SetpointEditBox, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>,OldSP));
3728             <span class="keyword">end</span>
3729         <span class="keyword">end</span>
3730     <span class="keyword">end</span>
3731 
3732     <span class="comment">% Update Slider</span>
3733     <span class="keyword">if</span> ChangeFlag
3734         set(handles.SetpointSlider, <span class="string">'UserData'</span>, SP);
3735 
3736         <span class="comment">% Don't change the slider if it's not enabled</span>
3737         <span class="keyword">if</span> strcmpi(get(handles.SetpointSlider,<span class="string">'Enable'</span>), <span class="string">'On'</span>)
3738             set(handles.SetpointSlider, <span class="string">'Value'</span>, NewSP);
3739         <span class="keyword">end</span>
3740 
3741         <span class="comment">% Make setpoint change</span>
3742         <a href="#_sub93" class="code" title="subfunction ChangeSetpointPlotfamily(hObject, eventdata, handles)">ChangeSetpointPlotfamily</a>(hObject, eventdata, handles);
3743     <span class="keyword">end</span>
3744 <span class="keyword">end</span>
3745 
3746 
3747 <span class="comment">% --------------------------------------------------------------------</span>
3748 <a name="_sub92" href="#_subfunctions" class="code">function SetpointPushButton_Callback(hObject, eventdata, handles)</a>
3749 
3750 <span class="comment">% Get setpoint from the pushbutton</span>
3751 SP = get(handles.SetpointPushButton, <span class="string">'UserData'</span>);
3752 
3753 <span class="comment">% Update Slider if it's enabled</span>
3754 <span class="keyword">if</span> strcmpi(get(handles.SetpointSlider,<span class="string">'Enable'</span>), <span class="string">'On'</span>)
3755     set(handles.SetpointSlider, <span class="string">'Value'</span>, SP.Data);
3756 <span class="keyword">end</span>
3757 
3758 <span class="comment">% Store the setpoint change and update the editbox</span>
3759 set(handles.SetpointSlider, <span class="string">'UserData'</span>, SP);
3760 set(handles.SetpointEditBox, <span class="string">'String'</span>, sprintf(<span class="string">'%f'</span>,SP.Data));
3761 
3762 <span class="comment">% Make setpoint change</span>
3763 <a href="#_sub93" class="code" title="subfunction ChangeSetpointPlotfamily(hObject, eventdata, handles)">ChangeSetpointPlotfamily</a>(hObject, eventdata, handles);
3764 
3765 
3766 <span class="comment">% --------------------------------------------------------------------</span>
3767 <a name="_sub93" href="#_subfunctions" class="code">function ChangeSetpointPlotfamily(hObject, eventdata, handles)</a>
3768 
3769 SP = get(handles.SetpointSlider, <span class="string">'UserData'</span>);
3770 
3771 <span class="comment">% Get the present mode (units are stored with the data)</span>
3772 <span class="keyword">if</span> strcmpi(get(handles.Simulate,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3773     Mode = <span class="string">'Simulator'</span>;
3774 <span class="keyword">else</span>
3775     Mode = <span class="string">'Online'</span>;
3776 <span class="keyword">end</span>
3777 
3778 
3779 <span class="comment">% Make the setpoint change</span>
3780 <a href="setpv.html" class="code" title="function ErrorFlag = setpv(varargin)">setpv</a>(SP, 0, Mode);
3781 
3782 
3783 <span class="comment">% Update plots</span>
3784 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
3785 
3786 <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_BetaX,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3787     <a href="#_sub61" class="code" title="subfunction AddPlot_Beta_Callback(hObject, eventdata, handles)">AddPlot_Beta_Callback</a>(handles.AddPlot1_BetaX, eventdata, handles);
3788 <span class="keyword">end</span>
3789 <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_BetaX,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3790     <a href="#_sub61" class="code" title="subfunction AddPlot_Beta_Callback(hObject, eventdata, handles)">AddPlot_Beta_Callback</a>(handles.AddPlot2_BetaX, eventdata, handles);
3791 <span class="keyword">end</span>
3792 <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_BetaY,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3793     <a href="#_sub61" class="code" title="subfunction AddPlot_Beta_Callback(hObject, eventdata, handles)">AddPlot_Beta_Callback</a>(handles.AddPlot1_BetaY, eventdata, handles);
3794 <span class="keyword">end</span>
3795 <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_BetaY,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3796     <a href="#_sub61" class="code" title="subfunction AddPlot_Beta_Callback(hObject, eventdata, handles)">AddPlot_Beta_Callback</a>(handles.AddPlot2_BetaY, eventdata, handles);
3797 <span class="keyword">end</span>
3798 
3799 <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_DispX,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3800     <a href="#_sub62" class="code" title="subfunction AddPlot_Dispersion_Callback(hObject, eventdata, handles)">AddPlot_Dispersion_Callback</a>(handles.AddPlot1_DispX, eventdata, handles);
3801 <span class="keyword">end</span>
3802 <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_DispX,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3803     <a href="#_sub62" class="code" title="subfunction AddPlot_Dispersion_Callback(hObject, eventdata, handles)">AddPlot_Dispersion_Callback</a>(handles.AddPlot2_DispX, eventdata, handles);
3804 <span class="keyword">end</span>
3805 <span class="keyword">if</span> strcmpi(get(handles.AddPlot1_DispY,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3806     <a href="#_sub62" class="code" title="subfunction AddPlot_Dispersion_Callback(hObject, eventdata, handles)">AddPlot_Dispersion_Callback</a>(handles.AddPlot1_DispY, eventdata, handles);
3807 <span class="keyword">end</span>
3808 <span class="keyword">if</span> strcmpi(get(handles.AddPlot2_DispY,<span class="string">'Checked'</span>),<span class="string">'On'</span>)
3809     <a href="#_sub62" class="code" title="subfunction AddPlot_Dispersion_Callback(hObject, eventdata, handles)">AddPlot_Dispersion_Callback</a>(handles.AddPlot2_DispY, eventdata, handles);
3810 <span class="keyword">end</span>
3811 
3812 
3813 
3814 <span class="comment">% --------------------------------------------------------------------</span>
3815 <a name="_sub94" href="#_subfunctions" class="code">function Graph1Line_Callback(hObject, eventdata, handles)</a>
3816 set(handles.Graph1Line,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3817 set(handles.Graph1Bar, <span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3818 cla(handles.Graph1);
3819 
3820 <span class="comment">% Update plot</span>
3821 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
3822 
3823 <span class="comment">% --------------------------------------------------------------------</span>
3824 <a name="_sub95" href="#_subfunctions" class="code">function Graph1Bar_Callback(hObject, eventdata, handles)</a>
3825 set(handles.Graph1Line,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3826 set(handles.Graph1Bar, <span class="string">'Checked'</span>,<span class="string">'On'</span>);
3827 cla(handles.Graph1);
3828 
3829 <span class="comment">% Make sure the scale is linear for bar plots</span>
3830 set(handles.Graph1,<span class="string">'YScale'</span>,<span class="string">'Linear'</span>);
3831 set(handles.YScaleLog1,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3832 set(handles.YScaleLinear1,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3833 
3834 <span class="comment">% Update plot</span>
3835 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
3836 
3837 
3838 <span class="comment">% --------------------------------------------------------------------</span>
3839 <a name="_sub96" href="#_subfunctions" class="code">function Graph2Line_Callback(hObject, eventdata, handles)</a>
3840 set(handles.Graph2Line,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3841 set(handles.Graph2Bar, <span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3842 cla(handles.Graph2);
3843 
3844 <span class="comment">% Update plot</span>
3845 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
3846 
3847 <span class="comment">% --------------------------------------------------------------------</span>
3848 <a name="_sub97" href="#_subfunctions" class="code">function Graph2Bar_Callback(hObject, eventdata, handles)</a>
3849 set(handles.Graph2Line,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3850 set(handles.Graph2Bar, <span class="string">'Checked'</span>,<span class="string">'On'</span>);
3851 cla(handles.Graph2);
3852 
3853 <span class="comment">% Make sure the scale is linear for bar plots</span>
3854 set(handles.Graph2,<span class="string">'YScale'</span>,<span class="string">'Linear'</span>);
3855 set(handles.YScaleLog2,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3856 set(handles.YScaleLinear2,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3857 
3858 <span class="comment">% Update plot</span>
3859 <a href="#_sub10" class="code" title="subfunction OneShot_Callback(hObject, eventdata, handles)">OneShot_Callback</a>(hObject, eventdata, handles);
3860 
3861 
3862 <span class="comment">% --------------------------------------------------------------------</span>
3863 <a name="_sub98" href="#_subfunctions" class="code">function DisabledSetpointChanges_Callback(hObject, eventdata, handles)</a>
3864 <span class="keyword">if</span> strcmpi(get(handles.DisabledSetpointChanges,<span class="string">'Checked'</span>),<span class="string">'Off'</span>)
3865     set(handles.DisabledSetpointChanges,<span class="string">'Checked'</span>,<span class="string">'On'</span>);
3866     <a href="#_sub99" class="code" title="subfunction TurnOffSetpointGUI_Callback(hObject, eventdata, handles)">TurnOffSetpointGUI_Callback</a>(hObject, eventdata, handles);
3867 <span class="keyword">else</span>
3868     set(handles.DisabledSetpointChanges,<span class="string">'Checked'</span>,<span class="string">'Off'</span>);
3869 <span class="keyword">end</span>
3870 
3871 
3872 <span class="comment">% --------------------------------------------------------------------</span>
3873 <a name="_sub99" href="#_subfunctions" class="code">function TurnOffSetpointGUI_Callback(hObject, eventdata, handles)</a>
3874 <span class="comment">% Turn off the setpoint GUI</span>
3875 <span class="keyword">if</span> strcmpi(get(handles.SetpointEditBox,<span class="string">'Visible'</span>),<span class="string">'On'</span>)
3876     set(handles.SetpointEditBox,   <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3877     set(handles.SetpointFamily,    <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3878     set(handles.SetpointUnits,     <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3879     set(handles.SetpointSlider,    <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3880     set(handles.SetpointMax,       <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3881     set(handles.SetpointMin,       <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3882     set(handles.SetpointFrame,     <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3883     set(handles.SetpointStepSize,  <span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3884     set(handles.SetpointPushButton,<span class="string">'Visible'</span>, <span class="string">'Off'</span>);
3885 
3886     <span class="comment">% Change the save and file text back to full size</span>
3887     p = get(handles.SaveTime, <span class="string">'Position'</span>);
3888     set(handles.SaveTime, <span class="string">'Position'</span>,  [p(1) p(2) p(3)/.353 p(4)]);
3889     p = get(handles.FileNameX, <span class="string">'Position'</span>);
3890     set(handles.FileNameX, <span class="string">'Position'</span>, [p(1) p(2) p(3)/.353 p(4)]);
3891     p = get(handles.FileNameY, <span class="string">'Position'</span>);
3892     set(handles.FileNameY, <span class="string">'Position'</span>, [p(1) p(2) p(3)/.353 p(4)]);
3893 
3894     drawnow;
3895 <span class="keyword">end</span>
3896</pre></div>
<hr><address>Generated on Fri 01-Aug-2008 10:57:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>