<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setoperationalmode</title>
  <meta name="keywords" content="setoperationalmode">
  <meta name="description" content="SETOPERATIONALMODE - Switches between the various operational modes">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">ALS</a> &gt; <a href="index.html">StorageRing</a> &gt; setoperationalmode.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ALS\StorageRing&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>setoperationalmode
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>SETOPERATIONALMODE - Switches between the various operational modes</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function setoperationalmode(ModeNumber) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">SETOPERATIONALMODE - Switches between the various operational modes
  setoperationalmode(ModeNumber)

  ModeNumber = 1. 1.9 GeV, Top Off
               2. 1.9 GeV, Ramping from 1.23 GeV
               3. 1.9 GeV, High Tune
               4. 1.9 GeV, Low  Tune
               5. 1.9 GeV, 2-Bunch
               6. 1.5 GeV, High Tune
               7. 1.5 GeV, Isochronous Sections
               8. 1.5 GeV, Ramping from 1.23 GeV
             101. 1.9 GeV, Model

             999. Greg's Mode
            9999. Tom's Mode
             100. Christoph's Mode
             200. Walter's Mode

  See also <a href="aoinit.html" class="code" title="function aoinit(SubMachineName)">aoinit</a>, <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>, <a href="alsinit.html" class="code" title="function alsinit(OperationalMode)">alsinit</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="alslat_MultipleRings.html" class="code" title="function varargout = alslat_MultipleRings(varargin)">alslat_MultipleRings</a>	Lattice definition file</li><li><a href="alslat_isochronous_sections_122bpms.html" class="code" title="function varargout = als_loco_3sb_disp(varargin)">alslat_isochronous_sections_122bpms</a>	Lattice definition file</li><li><a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>	Lattice definition file</li><li><a href="alslat_loco_3sb_disp_nuy9_122bpms_splitdipole.html" class="code" title="function varargout = alslat_loco_3sb_disp_nuy9_122bpms_splitdipole(varargin)">alslat_loco_3sb_disp_nuy9_122bpms_splitdipole</a>	Lattice definition file</li><li><a href="getbpmlist.html" class="code" title="function [DeviceList, Index] = getbpmlist(varargin)">getbpmlist</a>	GETBPMLIST - Return a BPM list based on key words and sector numbers</li><li><a href="setgainsandoffsets.html" class="code" title="function setgainsandoffsets">setgainsandoffsets</a>	</li><li><a href="setlocodata.html" class="code" title="function setlocodata(CommandInput, FileName)">setlocodata</a>	SETLOCODATA - Applies the LOCO calibration data to both the middle layer & the accelerator</li><li><a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>	UPDATEATINDEX - Updates the AT indices in the MiddleLayer with the present AT lattice (THERING)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="alsinit.html" class="code" title="function alsinit(OperationalMode)">alsinit</a>	ALSINIT</li><li><a href="pbpm_plotscanbump.html" class="code" title="">pbpm_plotscanbump</a>	if abs(y(1,1)-y(1,end)) < .1</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function BuildOffsetAndGoldenOrbits</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function setoperationalmode(ModeNumber)</a>
0002 <span class="comment">%SETOPERATIONALMODE - Switches between the various operational modes</span>
0003 <span class="comment">%  setoperationalmode(ModeNumber)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  ModeNumber = 1. 1.9 GeV, Top Off</span>
0006 <span class="comment">%               2. 1.9 GeV, Ramping from 1.23 GeV</span>
0007 <span class="comment">%               3. 1.9 GeV, High Tune</span>
0008 <span class="comment">%               4. 1.9 GeV, Low  Tune</span>
0009 <span class="comment">%               5. 1.9 GeV, 2-Bunch</span>
0010 <span class="comment">%               6. 1.5 GeV, High Tune</span>
0011 <span class="comment">%               7. 1.5 GeV, Isochronous Sections</span>
0012 <span class="comment">%               8. 1.5 GeV, Ramping from 1.23 GeV</span>
0013 <span class="comment">%             101. 1.9 GeV, Model</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%             999. Greg's Mode</span>
0016 <span class="comment">%            9999. Tom's Mode</span>
0017 <span class="comment">%             100. Christoph's Mode</span>
0018 <span class="comment">%             200. Walter's Mode</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%  See also aoinit, updateatindex, alsinit</span>
0021 
0022 
0023 <span class="keyword">global</span> THERING
0024 
0025 <span class="comment">% Check if the AO exists</span>
0026 checkforao;
0027 
0028 
0029 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0030 <span class="comment">% Accelerator Dependent Modes %</span>
0031 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0032 <span class="keyword">if</span> nargin &lt; 1
0033     ModeNumber = [];
0034 <span class="keyword">end</span>
0035 <span class="keyword">if</span> isempty(ModeNumber)
0036     ModeCell = {<span class="string">'1.9 GeV, Top Off'</span>, <span class="string">'1.9 GeV, Inject at 1.23 GeV'</span>, <span class="string">'1.9 Gev, High Tune'</span>, <span class="string">'1.9 Gev, Low Tune'</span>, <span class="string">'1.9 Gev, 2-Bunch'</span>,<span class="string">'1.5 Gev, High Tune'</span>, <span class="string">'1.5 GeV, Isochronous Sections'</span>, <span class="string">'1.5 GeV, Inject at 1.23 GeV'</span>, <span class="string">'1.9 GeV, Model'</span>, <span class="string">'Greg''s Mode'</span>, <span class="string">'Tom''s Mode'</span>, <span class="string">'Christoph''s Mode'</span>, <span class="string">'Walter''s Mode'</span>};
0037     [ModeNumber, OKFlag] = listdlg(<span class="string">'Name'</span>,<span class="string">'ALS'</span>,<span class="string">'PromptString'</span>,<span class="string">'Select the Operational Mode:'</span>, <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>, <span class="string">'ListString'</span>, ModeCell, <span class="string">'ListSize'</span>, [450 200]);
0038     <span class="keyword">if</span> OKFlag ~= 1
0039         fprintf(<span class="string">'   Operational mode not changed\n'</span>);
0040         <span class="keyword">return</span>
0041     <span class="keyword">end</span>
0042     <span class="keyword">if</span> ModeNumber == 9
0043         ModeNumber = 101;  <span class="comment">% Model</span>
0044     <span class="keyword">elseif</span> ModeNumber == 10
0045         ModeNumber = 999;  <span class="comment">% Greg</span>
0046     <span class="keyword">elseif</span> ModeNumber == 11
0047         ModeNumber = 9999; <span class="comment">% Tom</span>
0048     <span class="keyword">elseif</span> ModeNumber == 12
0049         ModeNumber = 100;  <span class="comment">% Christoph</span>
0050     <span class="keyword">elseif</span> ModeNumber == 13
0051         ModeNumber = 200;  <span class="comment">% Walter</span>
0052     <span class="keyword">end</span>
0053 <span class="keyword">end</span>
0054 
0055 
0056 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0057 <span class="comment">% Accelerator Data Structure %</span>
0058 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0059 AD = getad;
0060 AD.Machine = <span class="string">'ALS'</span>;               <span class="comment">% Will already be defined if setpathmml was used</span>
0061 AD.SubMachine = <span class="string">'StorageRing'</span>;    <span class="comment">% Will already be defined if setpathmml was used</span>
0062 AD.OperationalMode = <span class="string">''</span>;          <span class="comment">% Gets filled in later</span>
0063 AD.HarmonicNumber = 328;
0064 AD.BSCRampRate = 0.8;
0065 
0066 <span class="comment">% Defaults RF for disperion and chromaticity measurements (must be in Hardware units)</span>
0067 AD.DeltaRFDisp = 1000e-6;
0068 AD.DeltaRFChro = [-2000 -1000 0 1000 2000] * 1e-6;
0069 
0070 
0071 <span class="comment">% Tune processor delay: delay required to wait</span>
0072 <span class="comment">% to have a fresh tune measurement after changing</span>
0073 <span class="comment">% a variable like the RF frequency.  Setpv will wait</span>
0074 <span class="comment">% 2.2 * TuneDelay to be guaranteed a fresh data point.</span>
0075 AD.TuneDelay = 5.0;
0076 
0077 
0078 <span class="comment">% The offset and golden orbits are stored at the end of this file</span>
0079 <a href="#_sub1" class="code" title="subfunction BuildOffsetAndGoldenOrbits">BuildOffsetAndGoldenOrbits</a>;  <span class="comment">% Local function</span>
0080 
0081 
0082 <span class="comment">% SP-AM Error level</span>
0083 <span class="comment">% AD.ErrorWarningLevel = 0 -&gt; SP-AM errors are Matlab errors {Default}</span>
0084 <span class="comment">%                       -1 -&gt; SP-AM errors are Matlab warnings</span>
0085 <span class="comment">%                       -2 -&gt; SP-AM errors prompt a dialog box</span>
0086 <span class="comment">%                       -3 -&gt; SP-AM errors are ignored (ErrorFlag=-1 is returned)</span>
0087 AD.ErrorWarningLevel = 0;
0088 
0089 
0090 <span class="comment">% Set the status of all the corrector on</span>
0091 <span class="comment">% This is needed because some operational modes may have changed the .Status field</span>
0092 <span class="comment">%setfamilydata(ones(size(family2dev('HCM',0),1),1),'HCM','Status');   Remove the HCM converted to skew quad before uncommenting this.</span>
0093 <span class="comment">%setfamilydata(ones(size(family2dev('VCM',0),1),1),'VCM','Status');</span>
0094 
0095 <span class="comment">%i = findrowindex([3 10; 5 10; 10 10], HCMlist);</span>
0096 <span class="comment">% i = findrowindex([5 10], HCMlist);</span>
0097 <span class="comment">% AO.HCM.Status(i) = 0;</span>
0098 <span class="comment">% i = findrowindex([10 10], HCMlist);</span>
0099 <span class="comment">% AO.HCM.Status(i) = 0;</span>
0100 
0101 <span class="comment">%i = findrowindex([3 10; 5 10; 10 10], VCMlist);</span>
0102 <span class="comment">% i = findrowindex([5 10], VCMlist);</span>
0103 <span class="comment">% AO.VCM.Status(i) = 0;</span>
0104 <span class="comment">% i = findrowindex([10 10], VCMlist);</span>
0105 <span class="comment">% AO.VCM.Status(i) = 0;</span>
0106 
0107 
0108 
0109 <span class="comment">%%%%%%%%%%%%%%%%%%%%%</span>
0110 <span class="comment">% Operational Modes %</span>
0111 <span class="comment">%%%%%%%%%%%%%%%%%%%%%</span>
0112 
0113 <span class="comment">% Mode setup variables (mostly path and file names)</span>
0114 <span class="comment">% AD.OperationalMode - String used in titles</span>
0115 <span class="comment">% ModeName - String used for mode directory name off DataRoot/MachineName</span>
0116 <span class="comment">% OpsFileExtension - string add to default file names</span>
0117 MachineName = lower(AD.Machine);
0118 <span class="keyword">if</span> ModeNumber == 1
0119     <span class="comment">% User mode - High Tune, Top Off injection</span>
0120     AD.OperationalMode = <span class="string">'1.9 GeV, TopOff'</span>;
0121     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0122     AD.InjectionEnergy = 1.522;
0123     ModeName = <span class="string">'TopOff'</span>;
0124     OpsFileExtension = <span class="string">'_TopOff'</span>;
0125 
0126     <span class="comment">% AT lattice</span>
0127     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0128     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0129 
0130     <span class="comment">% Golden TUNE is with the TUNE family</span>
0131     <span class="comment">% 14.25 / 9.20</span>
0132     AO = getao;
0133     AO.TUNE.Monitor.Golden = [
0134         0.25
0135         0.20
0136         NaN];
0137     setao(AO);
0138 
0139     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0140     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0141 
0142     <span class="comment">% Hysteresis branch</span>
0143     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0144 
0145     switch2hw;
0146 
0147     <span class="comment">% Turn off chicane correctors when getting a response matrix</span>
0148     <span class="comment">%setfamilydata(0, 'HCM', 'Status', [6 1;10 8; 11 1]);</span>
0149 
0150 <span class="keyword">elseif</span> ModeNumber == 2
0151     <span class="comment">% High Tune, 1.23 Injection</span>
0152     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0153     AD.InjectionEnergy = 1.23;
0154     AD.OperationalMode = <span class="string">'1.9 GeV, Inject at 1.23'</span>;
0155     ModeName = <span class="string">'HighTuneLowEnergyInj'</span>;
0156     OpsFileExtension = <span class="string">'_LowEnergyInj'</span>;
0157 
0158     <span class="comment">% AT lattice</span>
0159     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0160     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0161 
0162     <span class="comment">% Golden TUNE is with the TUNE family</span>
0163     <span class="comment">% 14.25 / 9.20</span>
0164     AO = getao;
0165     AO.TUNE.Monitor.Golden = [
0166         0.25
0167         0.20
0168         NaN];
0169     setao(AO);
0170 
0171     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0172     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0173 
0174     <span class="comment">% Hysteresis branch</span>
0175     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0176 
0177     switch2hw;
0178 
0179     <span class="comment">% Turn off chicane correctors when getting a response matrix</span>
0180     <span class="comment">%setfamilydata(0, 'HCM', 'Status', [6 1;10 8; 11 1]);</span>
0181 
0182 <span class="keyword">elseif</span> ModeNumber == 3
0183     <span class="comment">% High Tune, 1.522 Injection</span>
0184     AD.OperationalMode = <span class="string">'1.9 GeV, High Tune'</span>;
0185     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0186     AD.InjectionEnergy = 1.522;
0187     ModeName = <span class="string">'HighTune'</span>;
0188     OpsFileExtension = <span class="string">'_HighTune'</span>;
0189 
0190     <span class="comment">% AT lattice</span>
0191     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0192     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0193 
0194     <span class="comment">%AD.ATModel = 'alslat_122bpmsInQuads';</span>
0195     <span class="comment">%alslat_122bpmsInQuads;</span>
0196 
0197     <span class="comment">% Golden TUNE is with the TUNE family</span>
0198     <span class="comment">% 14.25 / 9.20</span>
0199     AO = getao;
0200     AO.TUNE.Monitor.Golden = [
0201         0.25
0202         0.20
0203         NaN];
0204     setao(AO);
0205 
0206     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0207     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0208 
0209     <span class="comment">% Hysteresis branch</span>
0210     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0211 
0212     switch2hw;
0213 
0214     <span class="comment">% Turn off chicane correctors when getting a response matrix</span>
0215     <span class="comment">%setfamilydata(0, 'HCM', 'Status', [6 1;10 8; 11 1]);</span>
0216 
0217 <span class="keyword">elseif</span> ModeNumber == 4
0218     <span class="comment">% 1.9 GeV - Low Tune</span>
0219     AD.OperationalMode = <span class="string">'1.9 GeV, Low Tune'</span>;
0220     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0221     AD.InjectionEnergy = 1.522;
0222     ModeName = <span class="string">'LowTune'</span>;
0223     OpsFileExtension = <span class="string">'_LowTune'</span>;
0224 
0225     <span class="comment">% AT lattice</span>
0226     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0227     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0228 
0229     <span class="comment">% Golden TUNE is with the TUNE family (This could have been in alsphysdata)</span>
0230     <span class="comment">% 14.25 / 8.20</span>
0231     AO = getao;
0232     AO.TUNE.Monitor.Golden = [
0233         0.25
0234         0.20
0235         NaN];
0236     setao(AO);
0237 
0238 
0239     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0240     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0241 
0242     <span class="comment">% Hysteresis branch</span>
0243     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0244 
0245     switch2hw;
0246 
0247 <span class="keyword">elseif</span> ModeNumber == 5
0248     <span class="comment">% 1.9 GeV, 2-Bunch</span>
0249     AD.OperationalMode = <span class="string">'1.9 GeV, Two-Bunch'</span>;
0250     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0251     AD.InjectionEnergy = 1.23;
0252     ModeName = <span class="string">'TwoBunch'</span>;
0253     OpsFileExtension = <span class="string">'_TwoBunch'</span>;
0254 
0255     <span class="comment">% AT lattice</span>
0256     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0257     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0258 
0259     <span class="comment">% Golden TUNE is with the TUNE family</span>
0260     <span class="comment">% 14.25 / 9.20</span>
0261     AO = getao;
0262     AO.TUNE.Monitor.Golden = [
0263         0.25
0264         0.20
0265         NaN];
0266     setao(AO);
0267 
0268 
0269     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0270     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0271 
0272     <span class="comment">% Hysteresis branch</span>
0273     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0274 
0275     switch2hw;
0276 
0277 <span class="keyword">elseif</span> ModeNumber == 6
0278     <span class="comment">% 1.5 - High Tune</span>
0279     AD.OperationalMode = <span class="string">'1.5 GeV, High Tune'</span>;
0280     AD.Energy = 1.522;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0281     AD.InjectionEnergy = 1.522;
0282     ModeName = <span class="string">'1_5HighTune'</span>;
0283     OpsFileExtension = <span class="string">'_15HighTune'</span>;
0284 
0285     <span class="comment">% AT lattice</span>
0286     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0287     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0288 
0289     <span class="comment">% Golden TUNE is with the TUNE family</span>
0290     <span class="comment">% 14.25 / 9.20</span>
0291     AO = getao;
0292     AO.TUNE.Monitor.Golden = [
0293         0.25
0294         0.20
0295         NaN];
0296     setao(AO);
0297 
0298     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0299     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0300 
0301     <span class="comment">% Hysteresis branch</span>
0302     AD.HysteresisBranch = <span class="string">'Upper'</span>;
0303 
0304     switch2hw;
0305 
0306 <span class="keyword">elseif</span> ModeNumber == 7
0307     <span class="comment">% 1.522 GeV, Isochronous Sections</span>
0308     AD.OperationalMode = <span class="string">'1.5 GeV, Isochronous Sections'</span>;
0309     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0310     AD.InjectionEnergy = 1.522;
0311     ModeName = <span class="string">'IsochronousSections'</span>;
0312     OpsFileExtension = <span class="string">'_IsochronousSections'</span>;
0313 
0314     <span class="keyword">if</span> 1
0315         <span class="comment">% AT lattice</span>
0316         AD.ATModel = <span class="string">'alslat_isochronous_sections_122bpms'</span>;
0317         <a href="alslat_isochronous_sections_122bpms.html" class="code" title="function varargout = als_loco_3sb_disp(varargin)">alslat_isochronous_sections_122bpms</a>;
0318 
0319         <span class="comment">% Golden TUNE is with the TUNE family</span>
0320         <span class="comment">% 8.39 / 7.15</span>
0321         AO = getao;
0322         AO.TUNE.Monitor.Golden = [
0323             0.39
0324             0.15
0325             NaN];
0326         setao(AO);
0327 
0328     <span class="keyword">else</span>
0329         AD.ATModel = <span class="string">'alslat_isochronous_sections_122bpms_2520tune'</span>;
0330         alslat_isochronous_sections_122bpms_2520tune;
0331 
0332         <span class="comment">% Golden TUNE is with the TUNE family</span>
0333         <span class="comment">% 8.25 / 7.20</span>
0334         AO = getao;
0335         AO.TUNE.Monitor.Golden = [
0336             0.25
0337             0.20
0338             NaN];
0339         setao(AO);
0340     <span class="keyword">end</span>
0341 
0342     AD.Energy = 1.522;
0343     AD.InjectionEnergy = 1.522;
0344 
0345 
0346     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0347     AD.Chromaticity.Golden = [.4; 1];
0348 
0349     <span class="comment">% Hysteresis branch</span>
0350     AD.HysteresisBranch = <span class="string">'Upper'</span>;
0351 
0352     switch2hw;
0353 
0354 <span class="keyword">elseif</span> ModeNumber == 8
0355     <span class="comment">% 1.5 GeV High Tune, 1.23 Injection</span>
0356     AD.Energy = 1.52322;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0357     AD.InjectionEnergy = 1.23;
0358     AD.OperationalMode = <span class="string">'1.5 GeV, Inject at 1.23'</span>;
0359     ModeName = <span class="string">'15_HighTuneLowEnergyInj'</span>;
0360     OpsFileExtension = <span class="string">'_15LowEnergyInj'</span>;
0361 
0362     <span class="comment">% AT lattice</span>
0363     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0364     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0365 
0366     <span class="comment">% Golden TUNE is with the TUNE family</span>
0367     <span class="comment">% 14.25 / 9.20</span>
0368     AO = getao;
0369     AO.TUNE.Monitor.Golden = [
0370         0.25
0371         0.20
0372         NaN];
0373     setao(AO);
0374 
0375     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0376     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0377 
0378     <span class="comment">% Hysteresis branch</span>
0379     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0380 
0381     switch2hw;
0382 
0383     <span class="comment">% Turn off chicane correctors when getting a response matrix</span>
0384     <span class="comment">%setfamilydata(0, 'HCM', 'Status', [6 1;10 8; 11 1]);</span>
0385 
0386     
0387 <span class="keyword">elseif</span> ModeNumber == 101
0388     <span class="comment">% Model mode</span>
0389     AD.OperationalMode = <span class="string">'1.9 GeV, Model'</span>;
0390     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0391     AD.InjectionEnergy = 1.522;
0392     ModeName = <span class="string">'Model'</span>;
0393     OpsFileExtension = <span class="string">''</span>;
0394 
0395     <span class="comment">% AT lattice</span>
0396     <span class="comment">%AD.ATModel = 'alslat_loco_3sb_disp_nuy9_122bpms';</span>
0397     <span class="comment">%alslat_loco_3sb_disp_nuy9_122bpms;</span>
0398 
0399     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms_splitdipole'</span>;
0400     <a href="alslat_loco_3sb_disp_nuy9_122bpms_splitdipole.html" class="code" title="function varargout = alslat_loco_3sb_disp_nuy9_122bpms_splitdipole(varargin)">alslat_loco_3sb_disp_nuy9_122bpms_splitdipole</a>;
0401 
0402     <span class="comment">% Golden TUNE is with the TUNE family</span>
0403     <span class="comment">% 14.25 / 9.20</span>
0404     AO = getao;
0405     AO.TUNE.Monitor.Golden = [
0406         0.25
0407         0.20
0408         NaN];
0409     setao(AO);
0410 
0411 
0412     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0413     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0414 
0415     <span class="comment">% Hysteresis branch</span>
0416     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0417 
0418     AD.TuneDelay = 0.0;
0419 
0420     switch2hw;
0421 
0422 <span class="keyword">elseif</span> ModeNumber == 999
0423     <span class="comment">% Greg's mode</span>
0424     AD.OperationalMode = <span class="string">'1.9 GeV, Greg Mode'</span>;
0425     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0426     AD.InjectionEnergy = 1.522;
0427     ModeName = <span class="string">'Greg'</span>;
0428     OpsFileExtension = <span class="string">''</span>;
0429 
0430     <span class="comment">% AT lattice</span>
0431     <span class="comment">%AD.ATModel = 'alslat_loco_3sb_disp_nuy9_122bpms';</span>
0432     <span class="comment">%alslat_loco_3sb_disp_nuy9_122bpms;</span>
0433 
0434     AD.ATModel = <span class="string">'alslat_MultipleRings'</span>;
0435     <a href="alslat_MultipleRings.html" class="code" title="function varargout = alslat_MultipleRings(varargin)">alslat_MultipleRings</a>;
0436 
0437     <span class="comment">%AD.ATModel = 'alslat_symp_3sb_disp_ID';</span>
0438     <span class="comment">%alslat_symp_3sb_disp_ID</span>
0439 
0440     <span class="comment">% Golden TUNE is with the TUNE family</span>
0441     AO = getao;
0442     AO.TUNE.Monitor.Golden = [
0443         0.25
0444         0.20
0445         NaN];
0446     setao(AO);
0447 
0448 
0449     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0450     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0451 
0452     <span class="comment">% Hysteresis branch</span>
0453     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0454 
0455     AD.TuneDelay = 0.0;
0456 
0457     switch2hw;
0458 
0459     <span class="comment">% SP-AM Error level</span>
0460     <span class="comment">% AD.ErrorWarningLevel = 0 -&gt; SP-AM errors are Matlab errors {Default}</span>
0461     <span class="comment">%                       -1 -&gt; SP-AM errors are Matlab warnings</span>
0462     <span class="comment">%                       -2 -&gt; SP-AM errors prompt a dialog box</span>
0463     <span class="comment">%                       -3 -&gt; SP-AM errors are ignored</span>
0464     AD.ErrorWarningLevel = 0;
0465 
0466 <span class="keyword">elseif</span> ModeNumber == 9999
0467     <span class="comment">% Tom's mode</span>
0468     AD.OperationalMode = <span class="string">'1.9 GeV, Tom Mode'</span>;
0469     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0470     AD.InjectionEnergy = 1.522;
0471     ModeName = <span class="string">'Tom'</span>;
0472     OpsFileExtension = <span class="string">''</span>;
0473 
0474     <span class="comment">% AT lattice</span>
0475     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0476     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0477 
0478     <span class="comment">% Golden TUNE is with the TUNE family</span>
0479     AO = getao;
0480     AO.TUNE.Monitor.Golden = [
0481         0.25
0482         0.20
0483         NaN];
0484     setao(AO);
0485 
0486 
0487     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0488     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0489 
0490     <span class="comment">% Hysteresis branch</span>
0491     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0492 
0493     AD.TuneDelay = 0.0;
0494 
0495     switch2hw;
0496 
0497 <span class="keyword">elseif</span> ModeNumber == 100
0498     <span class="comment">% Christoph's mode</span>
0499     AD.OperationalMode = <span class="string">'1.9 GeV, Christoph Mode'</span>;
0500     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0501     AD.InjectionEnergy = 1.522;
0502     ModeName = <span class="string">'Christoph'</span>;
0503     OpsFileExtension = <span class="string">''</span>;
0504 
0505     <span class="comment">% AT lattice</span>
0506     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0507     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0508 
0509     <span class="comment">% Golden TUNE is with the TUNE family</span>
0510     AO = getao;
0511     AO.TUNE.Monitor.Golden = [
0512         0.25
0513         0.20
0514         NaN];
0515     setao(AO);
0516 
0517 
0518     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0519     AD.Chromaticity.Golden = [.4; 1];   <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0520 
0521     <span class="comment">% Hysteresis branch</span>
0522     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0523 
0524     AD.TuneDelay = 0.0;
0525 
0526     switch2hw;
0527 
0528 <span class="keyword">elseif</span> ModeNumber == 200
0529     <span class="comment">% Walter's mode</span>
0530 
0531     disp(<span class="string">'   This mode switches HCM(5,4) &amp; HCM(6,4) to SQSF(5,1) &amp; SQSF(6,1)'</span>);
0532 
0533     AD.OperationalMode = <span class="string">'1.9 GeV, Walter Mode'</span>;
0534     AD.Energy = 1.89086196873342;     <span class="comment">% Make sure this is the same as bend2gev at the production lattice!</span>
0535     AD.InjectionEnergy = 1.522;
0536     ModeName = <span class="string">'Walter'</span>;
0537     OpsFileExtension = <span class="string">'_HighTune'</span>;
0538 
0539     <span class="comment">% AT lattice</span>
0540     AD.ATModel = <span class="string">'alslat_loco_3sb_disp_nuy9_122bpms'</span>;
0541     <a href="alslat_loco_3sb_disp_nuy9_122bpms.html" class="code" title="function alslat_loco_3sb_disp_nuy9_122bpms(varargin)">alslat_loco_3sb_disp_nuy9_122bpms</a>;
0542 
0543     <span class="comment">% Golden TUNE is with the TUNE family</span>
0544     AO = getao;
0545     AO.TUNE.Monitor.Golden = [
0546         0.25
0547         0.20
0548         NaN];
0549     setao(AO);
0550 
0551 
0552     <span class="comment">% Golden chromaticity is in the AD (Physics units)</span>
0553     AD.Chromaticity.Golden = [.4; 1];  <span class="comment">% approx.  [-.6;-1.5] in hardware units</span>
0554 
0555     <span class="comment">% Hysteresis branch</span>
0556     AD.HysteresisBranch = <span class="string">'Lower'</span>;
0557 
0558     AD.TuneDelay = 0.0;
0559 
0560     switch2hw;
0561 
0562 <span class="keyword">else</span>
0563     error(<span class="string">'Operational mode unknown'</span>);
0564 <span class="keyword">end</span>
0565 
0566 
0567 
0568 <span class="comment">% Set the AD directory path</span>
0569 setad(AD);
0570 MMLROOT = setmmldirectories(AD.Machine, AD.SubMachine, ModeName, OpsFileExtension);
0571 AD = getad;
0572 
0573 
0574 <span class="comment">% ALS specific path changes</span>
0575 
0576 <span class="comment">% Hysteresis loop files</span>
0577 AD.OpsData.HysteresisLoopUpperLattice = [MMLROOT, <span class="string">'machine'</span>, filesep, AD.Machine, filesep, AD.SubMachine, <span class="string">'OpsData'</span>, filesep, ModeName, filesep, AD.OpsData.LatticeFile];
0578 AD.OpsData.HysteresisLoopLowerLattice = [MMLROOT, <span class="string">'machine'</span>, filesep, AD.Machine, filesep, AD.SubMachine, <span class="string">'OpsData'</span>, filesep, ModeName, filesep, AD.OpsData.InjectionFile];
0579 
0580 AD.Default.ChicaneRespFile  = <span class="string">'ChicaneRespMat'</span>; <span class="comment">% File in AD.Directory.BPMResponse    BPM/Chicane response matrice</span>
0581 AD.OpsData.ChicaneRespFile = [<span class="string">'GoldenChicaneResp'</span>, OpsFileExtension];
0582 AD.OpsData.RespFiles{length(AD.OpsData.RespFiles)+1} = {[AD.Directory.OpsData, AD.OpsData.ChicaneRespFile]};
0583 
0584 <span class="comment">% DataRoot Location</span>
0585 <span class="comment">% This is a bit of a cluge to know if the user is on the ALS filer</span>
0586 <span class="comment">% If so, the location of DataRoot will be different from the middle layer default</span>
0587 <span class="keyword">if</span> isempty(findstr(lower(MMLROOT),<span class="string">'physbase'</span>)) &amp; isempty(findstr(lower(MMLROOT),<span class="string">'n:\'</span>))
0588     <span class="comment">% Keep the normal middle layer directory structure</span>
0589     switch2sim;
0590 
0591 <span class="keyword">else</span>
0592     <span class="comment">% Use MMLROOT and DataRoot on the ALS filer</span>
0593     <span class="keyword">if</span> strcmp(computer,<span class="string">'PCWIN'</span>) == 1
0594         AD.Directory.DataRoot = [<span class="string">'\\Als-filer\physdata\matlab\'</span>, AD.SubMachine, <span class="string">'Data'</span>, filesep, ModeName, filesep];
0595     <span class="keyword">else</span>
0596         AD.Directory.DataRoot = [<span class="string">'/home/als/physdata/matlab/'</span>, AD.SubMachine, <span class="string">'Data'</span>, filesep, ModeName, filesep];
0597     <span class="keyword">end</span>
0598 
0599     <span class="comment">% Data Archive Directories</span>
0600     AD.Directory.BPMData        = [AD.Directory.DataRoot <span class="string">'BPM'</span>, filesep];
0601     AD.Directory.TuneData       = [AD.Directory.DataRoot <span class="string">'Tune'</span>, filesep];
0602     AD.Directory.ChroData       = [AD.Directory.DataRoot <span class="string">'Chromaticity'</span>, filesep];
0603     AD.Directory.DispData       = [AD.Directory.DataRoot <span class="string">'Dispersion'</span>, filesep];
0604     AD.Directory.ConfigData     = [AD.Directory.DataRoot <span class="string">'MachineConfig'</span>, filesep];
0605 
0606     <span class="comment">% Response Matrix Directories</span>
0607     AD.Directory.BPMResponse    = [AD.Directory.DataRoot <span class="string">'Response'</span>, filesep, <span class="string">'BPM'</span>, filesep];
0608     AD.Directory.TuneResponse   = [AD.Directory.DataRoot <span class="string">'Response'</span>, filesep, <span class="string">'Tune'</span>, filesep];
0609     AD.Directory.ChroResponse   = [AD.Directory.DataRoot <span class="string">'Response'</span>, filesep, <span class="string">'Chromaticity'</span>, filesep];
0610     AD.Directory.DispResponse   = [AD.Directory.DataRoot <span class="string">'Response'</span>, filesep, <span class="string">'Dispersion'</span>, filesep];
0611     AD.Directory.SkewResponse   = [AD.Directory.DataRoot <span class="string">'Response'</span>, filesep, <span class="string">'Skew'</span>, filesep];
0612 
0613     <span class="comment">% If using the ALS filer, I'm assuming you want to be online</span>
0614     switch2online;
0615 
0616     <span class="comment">% Change defaults for LabCA if using it</span>
0617     <span class="keyword">try</span>
0618         <span class="keyword">if</span> exist(<span class="string">'lcaSetRetryCount'</span>,<span class="string">'file'</span>)
0619             <span class="comment">% read dummy pv to initialize labca</span>
0620             <span class="comment">% ChannelName = family2channel('BPMx');</span>
0621             <span class="comment">% lcaGet(family2channel(ChannelName(1,:));</span>
0622 
0623             <span class="comment">% Retry count</span>
0624             RetryCountNew = 1000;  <span class="comment">% Default: 599-old labca, 299-labca_2_1_beta</span>
0625             RetryCount = lcaGetRetryCount;
0626             lcaSetRetryCount(RetryCountNew);
0627             <span class="keyword">if</span> RetryCount ~= RetryCountNew
0628                 fprintf(<span class="string">'   Setting LabCA retry count to %d (was %d) (LabCA)\n'</span>, RetryCountNew, RetryCount);
0629             <span class="keyword">end</span>
0630 
0631             <span class="comment">% Timeout</span>
0632             TimeoutNew = .005;  <span class="comment">% Default: .05-old labca, .1-labca_2_1_beta</span>
0633             Timeout = lcaGetTimeout;
0634             lcaSetTimeout(TimeoutNew);
0635             <span class="keyword">if</span> abs(Timeout - TimeoutNew) &gt; 1e-5
0636                 fprintf(<span class="string">'   Setting LabCA TimeOut to %f (was %f) (LabCA)\n'</span>, TimeoutNew, Timeout);
0637             <span class="keyword">end</span>
0638             
0639             <span class="comment">% To avoid UDF errors, set the WarnLevel to 4 (Default is 3)</span>
0640             lcaSetSeverityWarnLevel(4);
0641             fprintf(<span class="string">'   Setting lcaSetSeverityWarnLevel to 4 to avoid annoying UDF errors (LabCA).\n'</span>);
0642         <span class="keyword">end</span>
0643     <span class="keyword">catch</span>
0644         fprintf(<span class="string">'   LabCA Timeout not set, need to run lcaSetRetryCount(1000), lcaSetTimeout(.01).\n'</span>);
0645     <span class="keyword">end</span>
0646 <span class="keyword">end</span>
0647 
0648 
0649 
0650 <span class="comment">% Circumference</span>
0651 AD.Circumference = findspos(THERING,length(THERING)+1);
0652 setad(AD);
0653 
0654 
0655 <span class="comment">% Updates the AT indices in the MiddleLayer with the present AT lattice</span>
0656 <a href="updateatindex.html" class="code" title="function updateatindex">updateatindex</a>;
0657 
0658 
0659 <span class="comment">% Set the model energy</span>
0660 setenergymodel(AD.Energy);
0661 
0662 
0663 <span class="comment">% Cavity and radiation</span>
0664 setcavity off;
0665 setradiation off;
0666 fprintf(<span class="string">'   Radiation and cavities are off.  Use setradiation / setcavity to modify. \n'</span>);
0667 
0668 
0669 <span class="comment">% Momentum compaction factor</span>
0670 <span class="keyword">try</span>
0671     <span class="comment">%AD.MCF = 0.00137038;  % was 0.0013884;</span>
0672     MCF = getmcf(<span class="string">'Model'</span>);
0673     <span class="keyword">if</span> isnan(MCF)
0674         AD.MCF = 0.00137038;  <span class="comment">% was 0.0013884;</span>
0675         fprintf(<span class="string">'   Model alpha calculation failed, middlelayer alpha set to  %f\n'</span>, AD.MCF);
0676     <span class="keyword">else</span>
0677         AD.MCF = MCF;
0678         fprintf(<span class="string">'   Middlelayer alpha set to %f (AT model).\n'</span>, AD.MCF);
0679     <span class="keyword">end</span>
0680 <span class="keyword">catch</span>
0681     AD.MCF = 0.00137038;  <span class="comment">% was 0.0013884;</span>
0682     fprintf(<span class="string">'   Model alpha calculation failed, middlelayer alpha set to  %f\n'</span>, AD.MCF);
0683 <span class="keyword">end</span>
0684 setad(AD);
0685 
0686 
0687 
0688 <span class="comment">% Add Gain &amp; Offsets for magnet family</span>
0689 fprintf(<span class="string">'   Magnet gains set based on the production lattice settings.\n'</span>);
0690 <a href="setgainsandoffsets.html" class="code" title="function setgainsandoffsets">setgainsandoffsets</a>;
0691 
0692 
0693 
0694 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%</span>
0695 <span class="comment">% Final mode changes %</span>
0696 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%</span>
0697 <span class="keyword">if</span> any(ModeNumber == [1 2 3])
0698     <span class="comment">% User mode - 1.9 GeV, High Tune</span>
0699 
0700     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0701     <span class="comment">% Add LOCO Parameters to AO and AT-Model %</span>
0702     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0703     <span class="comment">%     'Nominal'    - Sets nominal gains (1) / rolls (0) to the model.</span>
0704     <span class="comment">%     'SetGains'   - Set gains/coupling from a LOCO file.</span>
0705     <span class="comment">%     'SetModel'   - Set the model from a LOCO file.  But it only changes</span>
0706     <span class="comment">%                    the part of the model that does not get corrected</span>
0707     <span class="comment">%                    in 'Symmetrize' (also does a SetGains).</span>
0708     <span class="comment">%     'LOCO2Model' - Set the model from a LOCO file (also does a SetGains).</span>
0709     <span class="comment">%                    This sets all lattice machines fit in the LOCO run to the model.</span>
0710     <span class="comment">%</span>
0711     <span class="comment">% Basically, use 'SetGains' or 'SetModel' if the LOCO run was applied to the accelerator</span>
0712     <span class="comment">%            use 'LOCO2Model' if the LOCO run was made after the final setup</span>
0713 
0714     <span class="comment">% Store the LOCO file in the opsdata directory</span>
0715     <span class="comment">%AD.OpsData.LOCOFile = [getfamilydata('Directory','OpsData'),'LOCO_Production_72SkewQuads_1Bend'];</span>
0716     AD.OpsData.LOCOFile = [getfamilydata(<span class="string">'Directory'</span>,<span class="string">'OpsData'</span>),<span class="string">'LOCO_Production_72SkewQuads_4Bends'</span>];
0717     
0718     setad(AD);
0719 
0720     <span class="keyword">try</span>
0721         <span class="comment">%setlocodata('SetGains', AD.OpsData.LOCOFile);</span>
0722         <span class="comment">%setlocodata('SetModel', AD.OpsData.LOCOFile);</span>
0723         <a href="setlocodata.html" class="code" title="function setlocodata(CommandInput, FileName)">setlocodata</a>(<span class="string">'LOCO2Model'</span>, AD.OpsData.LOCOFile);
0724         <span class="comment">%buildramptable;</span>
0725 
0726         <span class="comment">% setsp('SQSF', 0, 'Simulator', 'Physics');</span>
0727         <span class="comment">% setsp('SQSD', 0, 'Simulator', 'Physics');</span>
0728         <span class="comment">%</span>
0729         <span class="comment">% setsp('HCM', 0, 'Simulator', 'Physics');</span>
0730         <span class="comment">% setsp('VCM', 0, 'Simulator', 'Physics');</span>
0731     <span class="keyword">catch</span>
0732         fprintf(<span class="string">'\n%s\n\n'</span>, lasterr);
0733         fprintf(<span class="string">'   WARNING: there was a problem calibrating the model based on LOCO file %s.\n'</span>, AD.OpsData.LOCOFile);
0734     <span class="keyword">end</span>
0735 
0736     
0737 <span class="keyword">elseif</span> ModeNumber == 4
0738     <span class="comment">% 1.9 GeV, Low Tune</span>
0739 
0740     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0741     <span class="comment">% Add LOCO Parameters to AO and AT-Model %</span>
0742     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0743     <span class="comment">%setlocodata('Nominal');</span>
0744     <span class="comment">%LocoFileDirectory = getfamilydata('Directory','OpsData');</span>
0745     <span class="comment">%setlocodata('SetModel',[LocoFileDirectory,'LocoData']);</span>
0746 
0747     <span class="comment">%setsp('SQSF', 0, 'Simulator', 'Physics');</span>
0748     <span class="comment">%setsp('SQSD', 0, 'Simulator', 'Physics');</span>
0749     <span class="comment">%setsp('HCM',  0, 'Simulator', 'Physics');</span>
0750     <span class="comment">%setsp('VCM',  0, 'Simulator', 'Physics');</span>
0751 
0752 <span class="keyword">elseif</span> ModeNumber == 5
0753     <span class="comment">% 1.9 GeV, 2-Bunch</span>
0754 
0755     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0756     <span class="comment">% Add LOCO Parameters to AO and AT-Model %</span>
0757     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0758     LocoFileDirectory = getfamilydata(<span class="string">'Directory'</span>,<span class="string">'OpsData'</span>);
0759     <span class="comment">%setlocodata('SetModel',[LocoFileDirectory,'LocoData_PostSymmetrize']);</span>
0760     <a href="setlocodata.html" class="code" title="function setlocodata(CommandInput, FileName)">setlocodata</a>(<span class="string">'SetModel'</span>,[LocoFileDirectory,<span class="string">'LocoData'</span>]);
0761     <span class="comment">%buildramptable;</span>
0762 
0763     <span class="comment">%setsp('SQSF', 0, 'Simulator', 'Physics');</span>
0764     <span class="comment">%setsp('SQSD', 0, 'Simulator', 'Physics');</span>
0765     <span class="comment">%setsp('HCM',  0, 'Simulator', 'Physics');</span>
0766     <span class="comment">%setsp('VCM',  0, 'Simulator', 'Physics');</span>
0767 
0768 <span class="keyword">elseif</span> ModeNumber == 6
0769     <span class="comment">% 1.5 GeV, High Tune</span>
0770 
0771     <span class="comment">% Hysteresis loop files: 1.5 GeV modes use the 1.9 High Tune upper lattice</span>
0772     AD = getad;
0773     AD.OpsData.HysteresisLoopUpperLattice = [MMLROOT, <span class="string">'machine'</span>, filesep, MachineName, <span class="string">'opsdata'</span>, filesep, <span class="string">'HighTune'</span>, filesep, <span class="string">'GoldenConfig_HighTune'</span>];
0774     setad(AD);
0775 
0776     <span class="comment">%SP = getinjectionlattice;</span>
0777     <span class="comment">%SP = rmfield(SP, 'BEND');</span>
0778     <span class="comment">%setmachineconfig(SP, 'Simulator');</span>
0779 
0780     <span class="comment">% Set energy in the model</span>
0781     setenergymodel(1.522);
0782     setfamilydata(1.522, <span class="string">'Energy'</span>);
0783 
0784     <span class="comment">%setsp('SQSF', 0, 'Simulator', 'Physics');</span>
0785     <span class="comment">%setsp('SQSD', 0, 'Simulator', 'Physics');</span>
0786     setsp(<span class="string">'HCM'</span>, 0, <span class="string">'Simulator'</span>, <span class="string">'Physics'</span>);
0787     setsp(<span class="string">'VCM'</span>, 0, <span class="string">'Simulator'</span>, <span class="string">'Physics'</span>);
0788 
0789     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0790     <span class="comment">% Add LOCO Parameters to AO and AT-Model %</span>
0791     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0792     LocoFileDirectory = getfamilydata(<span class="string">'Directory'</span>,<span class="string">'OpsData'</span>);
0793     <span class="comment">%setlocodata('SetModel',[LocoFileDirectory,'LocoData_PostSymmetrize']);</span>
0794     <span class="comment">%setlocodata('SetModel',[LocoFileDirectory,'LocoData']);</span>
0795     <span class="comment">%buildramptable;</span>
0796 
0797 <span class="keyword">elseif</span> ModeNumber == 7
0798     <span class="comment">% Isochronous Sections</span>
0799 
0800     <span class="comment">% Hysteresis loop files: 1.5 GeV modes use the 1.9 High Tune upper lattice</span>
0801     AD = getad;
0802     AD.OpsData.HysteresisLoopUpperLattice = [MMLROOT, <span class="string">'machine'</span>, filesep, MachineName, <span class="string">'opsdata'</span>, filesep, <span class="string">'HighTune'</span>, filesep, <span class="string">'GoldenConfig_HighTune'</span>];
0803     setad(AD);
0804 
0805 
0806     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0807     <span class="comment">% Add LOCO Parameters to AO and AT-Model %</span>
0808     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0809 
0810     <span class="comment">% Change the response matrix kicks</span>
0811 
0812     <span class="comment">% Start with nominal gains</span>
0813     <a href="setlocodata.html" class="code" title="function setlocodata(CommandInput, FileName)">setlocodata</a>(<span class="string">'Nominal'</span>);
0814 
0815     AO = getao;
0816     AO.HCM.Setpoint.DeltaRespMat = physics2hw(<span class="string">'HCM'</span>,<span class="string">'Setpoint'</span>, .15e-3 / 3 / 1, AO.HCM.DeviceList);
0817     AO.VCM.Setpoint.DeltaRespMat = physics2hw(<span class="string">'VCM'</span>,<span class="string">'Setpoint'</span>, .15e-3 / 3 / 2, AO.VCM.DeviceList);
0818     <span class="comment">%AO.HCM.Setpoint.DeltaRespMat = AO.HCM.Setpoint.DeltaRespMat/4;</span>
0819     <span class="comment">%AO.VCM.Setpoint.DeltaRespMat = AO.VCM.Setpoint.DeltaRespMat/4;</span>
0820     setao(AO);
0821 
0822     setfamilydata(200e-6,<span class="string">'DeltaRFDisp'</span>);
0823 
0824 
0825     <span class="comment">% Set the gains from LOCO data</span>
0826     LocoFileDirectory = getfamilydata(<span class="string">'Directory'</span>,<span class="string">'OpsData'</span>);
0827     <a href="setlocodata.html" class="code" title="function setlocodata(CommandInput, FileName)">setlocodata</a>(<span class="string">'SetGains'</span>,[LocoFileDirectory,<span class="string">'LocoData_IsochronousSections'</span>]);
0828 
0829     <span class="comment">%     %setenergy(1.522,'Simulator');</span>
0830     <span class="comment">%     %setsp('BEND', gev2bend(1.522), 'Simulator');</span>
0831     <span class="comment">%     SP = getinjectionlattice;</span>
0832     <span class="comment">%     SP = rmfield(SP, 'BEND');</span>
0833 
0834     <span class="comment">% Set energy in the model</span>
0835     setenergymodel(1.522);
0836     setfamilydata(1.522, <span class="string">'Energy'</span>);
0837 
0838     <span class="comment">%     setmachineconfig(SP, 'Simulator');</span>
0839     <span class="comment">%</span>
0840     <span class="comment">%     %setsp('SQSF', 0, 'Simulator', 'Physics');</span>
0841     <span class="comment">%     %setsp('SQSD', 0, 'Simulator', 'Physics');</span>
0842     <span class="comment">%     setsp('HCM', 0, 'Simulator', 'Physics');</span>
0843     <span class="comment">%     setsp('VCM', 0, 'Simulator', 'Physics');</span>
0844 
0845 <span class="keyword">elseif</span> ModeNumber == 101
0846     <span class="comment">% Model mode</span>
0847 
0848     <span class="comment">% Activate all HCMs</span>
0849     Status = getfamilydata(<span class="string">'HCM'</span>, <span class="string">'Status'</span>);
0850     setfamilydata(ones(size(Status)), <span class="string">'HCM'</span>, <span class="string">'Status'</span>);
0851 
0852     <span class="comment">% Set gains, offsets, and golden values</span>
0853     <a href="setlocodata.html" class="code" title="function setlocodata(CommandInput, FileName)">setlocodata</a>(<span class="string">'Nominal'</span>);
0854     setfamilydata(0,<span class="string">'BPMx'</span>,<span class="string">'Offset'</span>);
0855     setfamilydata(0,<span class="string">'BPMy'</span>,<span class="string">'Offset'</span>);
0856     setfamilydata(0,<span class="string">'BPMx'</span>,<span class="string">'Golden'</span>);
0857     setfamilydata(0,<span class="string">'BPMy'</span>,<span class="string">'Golden'</span>);
0858 
0859     setfamilydata(0,<span class="string">'TuneDelay'</span>);
0860 
0861     setsp(<span class="string">'SQSF'</span>, 0, <span class="string">'Simulator'</span>, <span class="string">'Physics'</span>);
0862     setsp(<span class="string">'SQSD'</span>, 0, <span class="string">'Simulator'</span>, <span class="string">'Physics'</span>);
0863     setsp(<span class="string">'HCM'</span>,  0, <span class="string">'Simulator'</span>, <span class="string">'Physics'</span>);
0864     setsp(<span class="string">'VCM'</span>,  0, <span class="string">'Simulator'</span>, <span class="string">'Physics'</span>);
0865 
0866     <span class="comment">% Default to simulator mode</span>
0867     switch2sim;
0868 
0869 <span class="keyword">elseif</span> ModeNumber == 999
0870     <span class="comment">% Greg's mode</span>
0871 
0872     <span class="comment">% SP = getproductionlattice;</span>
0873     <span class="comment">% SP = rmfield(SP, 'BEND');</span>
0874     <span class="comment">% SP = rmfield(SP, 'RF');</span>
0875     <span class="comment">% SP = rmfield(SP, 'HCMCHICANE');</span>
0876     <span class="comment">% SP = rmfield(SP, 'VCMCHICANE');</span>
0877     <span class="comment">% SP = rmfield(SP, 'HCMCHICANEM');</span>
0878     <span class="comment">% setmachineconfig(SP, 'Simulator');</span>
0879 
0880 <span class="keyword">elseif</span> ModeNumber == 200
0881     <span class="comment">% Walter's mode</span>
0882     LocoFileDirectory = getfamilydata(<span class="string">'Directory'</span>,<span class="string">'OpsData'</span>);
0883     <a href="setlocodata.html" class="code" title="function setlocodata(CommandInput, FileName)">setlocodata</a>(<span class="string">'SetGains'</span>,[LocoFileDirectory,<span class="string">'LocoData'</span>]);
0884 
0885 <span class="keyword">else</span>
0886     <a href="setlocodata.html" class="code" title="function setlocodata(CommandInput, FileName)">setlocodata</a>(<span class="string">'Nominal'</span>);
0887     <span class="comment">%LocoFileDirectory = getfamilydata('Directory','OpsData');</span>
0888     <span class="comment">%setlocodata('SetModel',[LocoFileDirectory,'LocoData_PostSymmetrize']);</span>
0889     <span class="comment">%setlocodata('SetModel',[LocoFileDirectory,'LocoData']);</span>
0890 <span class="keyword">end</span>
0891 
0892 
0893 
0894 <span class="comment">% Build a new ramp table to force the present AT-model</span>
0895 <span class="comment">% to be matched to the production and injection lattice files</span>
0896 <span class="comment">%buildramptable;</span>
0897 fprintf(<span class="string">'   Remember to run buildramptable if the production and/or injection\n'</span>);
0898 fprintf(<span class="string">'   lattice files have changed or if the AT lattice has changed.\n'</span>);
0899 
0900 
0901 fprintf(<span class="string">'   Middlelayer setup for operational mode: %s\n'</span>, AD.OperationalMode);
0902 
0903 
0904 
0905 
0906 <a name="_sub1" href="#_subfunctions" class="code">function BuildOffsetAndGoldenOrbits</a>
0907 
0908 <span class="comment">%  2005-07-27 Changed the [5 11] &amp; [5 12] offset and golden orbits to values during a user run. (GJP)</span>
0909 <span class="comment">%             The offsets were zero and the golden values were:</span>
0910 <span class="comment">%             5  11   -2.371746    0.318056</span>
0911 <span class="comment">%             5  12   -1.915190    0.482681</span>
0912 <span class="comment">%</span>
0913 <span class="comment">%             The golden orbit agreement with the old middle layer is not as good as</span>
0914 <span class="comment">%             it needs to be.  For instance, [6 1] horizontal is .67 new and 1.016 old.</span>
0915 <span class="comment">%</span>
0916 <span class="comment">%  2006-01-06 New offsets measured.  The large difference in location 4 and 7 is due to new buttons.</span>
0917 <span class="comment">%</span>
0918 
0919 <span class="comment">% Note: you can view this by &gt;&gt; help setoperationalmode&gt;BuildOffsetAndGoldenOrbits</span>
0920 
0921 <span class="comment">%                           2007-06-15           2007-01-06       2005-05-12</span>
0922 <span class="comment">%      DeviceList        Xnew      Ynew      Xold      Yold     Xoldold   Yoldold</span>
0923 Offset = [
0924     1.0000    2.0000   -0.1540    1.0386   -0.3029    0.9601   -0.3332    0.9621
0925     1.0000    3.0000   -0.1214   -0.3793   -0.0804   -0.1250   -0.0213   -0.1887
0926     1.0000    4.0000    0.1899   -0.2022    0.6410   -0.2695    0.6410   -0.7228
0927     1.0000    5.0000       NaN       NaN   -0.3117    1.2317   -0.3117    1.2317
0928     1.0000    6.0000       NaN       NaN    0.2868    0.1347    0.2868    0.1347
0929     1.0000    7.0000   -0.0219   -0.0720    0.1294   -0.3856    0.1294    0.2557
0930     1.0000    8.0000   -0.1808   -0.2673   -0.2606   -0.3423   -0.2235   -0.1922
0931     1.0000    9.0000    0.0986    0.2805   -0.0144    0.3451   -0.0639    0.3583
0932     1.0000   10.0000       NaN       NaN    1.4372   -0.1518    1.4372   -0.1518
0933     2.0000    1.0000       NaN       NaN    0.3365    0.0489    0.3365    0.0489
0934     2.0000    2.0000    0.3321   -0.6269    0.3349   -0.4719    0.3029   -0.4988
0935     2.0000    3.0000    0.2252    0.2625    0.3260    0.2452    0.2920    0.1946
0936     2.0000    4.0000    0.0382   -0.1314    0.3743   -0.1043    0.3743    0.5221
0937     2.0000    5.0000       NaN       NaN   -0.0128   -0.0542   -0.0128   -0.0542
0938     2.0000    6.0000       NaN       NaN    1.0025   -1.0075    1.0025   -1.0075
0939     2.0000    7.0000    0.1653   -0.2635   -0.0173   -0.2703   -0.0173    0.5229
0940     2.0000    8.0000    0.0736   -0.3550    0.1902   -0.2211    0.2433   -0.1423
0941     2.0000    9.0000   -0.0113    0.3960   -0.2460    0.3486   -0.1620    0.2160
0942     3.0000    2.0000   -0.2045    0.1067   -0.3086    0.0952   -0.2826    0.1080
0943     3.0000    3.0000    0.2871    0.2895    0.3677    0.3745    0.3313    0.3497
0944     3.0000    4.0000    0.3965   -0.3447   -0.3568   -0.8973   -0.3568    0.2155
0945     3.0000    5.0000       NaN       NaN   -0.0402    0.0603   -0.0402    0.0603
0946     3.0000    6.0000       NaN       NaN    0.2722    0.0824    0.2722    0.0824
0947     3.0000    7.0000    0.7024   -0.1234    0.3131   -0.3190    0.3131    0.7647
0948     3.0000    8.0000   -0.0985    0.4559   -0.1004    0.5151    0.0275    0.5267
0949     3.0000    9.0000    0.5186   -0.0231    0.4228    0.1727    0.4782    0.0919
0950     3.0000   10.0000       NaN       NaN    0.7001    0.2774    0.7001    0.2774
0951     3.0000   11.0000       NaN       NaN   -0.5243   -0.4578   -0.5243   -0.4578
0952     3.0000   12.0000       NaN       NaN   -0.1391    0.0454   -0.1391    0.0454
0953     4.0000    1.0000       NaN       NaN    0.9000    0.8040    0.9000    0.8040
0954     4.0000    2.0000   -0.2236    0.9806   -0.2389    0.9517   -0.2736    1.0024
0955     4.0000    3.0000    0.6484   -0.3606    0.5399   -0.3708    0.5481   -0.3316
0956     4.0000    4.0000    0.2514    0.2447   -0.6150    0.4217   -0.6150    0.2945
0957     4.0000    5.0000   -0.0899   -0.1984    0.1066   -0.1455   -0.1270    0.1668
0958     4.0000    6.0000    0.9420    0.4485    1.0549    0.5268    0.8027    0.7899
0959     4.0000    7.0000   -0.0272   -0.8070   -0.5092   -0.2730   -0.5092    0.1823
0960     4.0000    8.0000   -0.6642    0.3888   -0.6119    0.6313   -0.4890    0.5291
0961     4.0000    9.0000   -0.6090   -0.3532   -0.5624   -0.3060   -0.4998   -0.3415
0962     4.0000   10.0000       NaN       NaN   -0.4352    1.3991   -0.4352    1.3991
0963     5.0000    1.0000       NaN       NaN    0.6527    0.2707    0.6527    0.2707
0964     5.0000    2.0000   -0.0489    0.6029    0.0368    0.6351   -0.0318    0.6071
0965     5.0000    3.0000    0.1164    0.5500    0.2613    0.5279    0.1690    0.4812
0966     5.0000    4.0000   -0.0824    0.4140   -0.2422    0.1545   -0.2422    0.6403
0967     5.0000    5.0000       NaN       NaN   -0.3649    0.5744   -0.3649    0.5744
0968     5.0000    6.0000       NaN       NaN   -0.3961    0.5409   -0.3961    0.5409
0969     5.0000    7.0000   -0.2576   -0.8496    0.1861   -0.6341    0.1861    0.4875
0970     5.0000    8.0000   -0.5953    0.6480   -0.4308    0.6563   -0.4611    0.5928
0971     5.0000    9.0000    0.3942    0.7882    0.2031    0.9099    0.4392    0.7018
0972     5.0000   10.0000       NaN       NaN    0.4052    0.9371    0.4052    0.9371
0973     5.0000   11.0000       NaN       NaN    0.2860    0.4667    0.2860    0.4667
0974     5.0000   12.0000       NaN       NaN    0.7625    0.4750    0.7625    0.4750
0975     6.0000    1.0000       NaN       NaN   -0.1765    0.4277   -0.1765    0.4277
0976     6.0000    2.0000       NaN       NaN   -0.5470    0.1162   -0.4925    0.1608
0977     6.0000    3.0000    0.6580   -0.0962    0.5579   -0.0764    0.4926   -0.0228
0978     6.0000    4.0000    0.0950    0.2593    0.1200    0.1259    0.1200    0.9682
0979     6.0000    5.0000       NaN       NaN    0.0815   -0.2318    0.0815   -0.2318
0980     6.0000    6.0000       NaN       NaN   -0.5071    0.4360   -0.5071    0.4360
0981     6.0000    7.0000    0.3660   -0.1818   -0.0400   -0.3844   -0.0400    0.5079
0982     6.0000    8.0000   -0.0038    0.8238    0.0326    0.8366    0.0851    0.7527
0983     6.0000    9.0000   -0.3228    0.6993   -0.3196    0.7598   -0.2962    0.7587
0984     6.0000   10.0000       NaN       NaN    0.4473   -0.1545    0.4473   -0.1545
0985     7.0000    1.0000       NaN       NaN    0.6227    0.3264    0.6227    0.3264
0986     7.0000    2.0000   -0.1331    0.5823   -0.1306    0.5463   -0.1513    0.6347
0987     7.0000    3.0000    0.4716    0.6017    0.4098    0.6411    0.2288    0.5024
0988     7.0000    4.0000   -0.1470    0.3133   -0.2808    0.0358   -0.2808    0.5664
0989     7.0000    5.0000       NaN       NaN    0.2972    0.3924    0.2972    0.3924
0990     7.0000    6.0000       NaN       NaN   -0.1378    0.6702   -0.1378    0.6702
0991     7.0000    7.0000    0.0756    0.4459    0.0613    0.5088    0.0613    0.8434
0992     7.0000    8.0000   -0.1205    0.6658    0.0291    0.6676   -0.0196    0.6397
0993     7.0000    9.0000   -1.4073   -0.6661   -1.3782   -0.6406    0.1663    0.8314
0994     7.0000   10.0000       NaN       NaN    0.4593    0.2569    0.4593    0.2569
0995     8.0000    1.0000       NaN       NaN    0.2270    0.4960    0.2270    0.4960
0996     8.0000    2.0000   -0.1114    0.0405   -0.1231    0.0635   -0.1059    0.0297
0997     8.0000    3.0000    0.0862    1.4383    0.2116    1.3395    0.1908    1.0542
0998     8.0000    4.0000   -0.8683   -0.1559    0.0812   -0.5635    0.0812    0.6840
0999     8.0000    5.0000   -0.1542    0.3089   -0.1798    0.4131   -0.0830    0.6125
1000     8.0000    6.0000   -0.1743    0.3894   -0.1083    0.3420   -0.2474    0.8791
1001     8.0000    7.0000    0.6952    0.2835    0.3828    0.0519    0.3828    1.7969
1002     8.0000    8.0000   -0.2045    1.5762   -0.0812    1.6180   -0.0460    1.7202
1003     8.0000    9.0000   -1.8191   -0.3515   -1.6868   -0.3611   -1.5201   -0.3296
1004     8.0000   10.0000       NaN       NaN    0.5377   -0.0202    0.5377   -0.0202
1005     9.0000    1.0000       NaN       NaN    0.1161   -0.0240    0.1161   -0.0240
1006     9.0000    2.0000    1.4939    1.0447    1.7898    1.3374    0.4622    0.0734
1007     9.0000    3.0000    0.2326    0.4554    0.4083    0.5453    0.3516    0.4305
1008     9.0000    4.0000    0.1507    0.1189    0.1929   -0.3953    0.1929   -0.0981
1009     9.0000    5.0000       NaN       NaN   -0.3339    0.0797   -0.3339    0.0797
1010     9.0000    6.0000       NaN       NaN    0.1332   -0.0086    0.1332   -0.0086
1011     9.0000    7.0000    0.1835    0.6688    0.3534    0.5847    0.3534   -0.0021
1012     9.0000    8.0000    0.9189    0.2861    1.0863    0.2838    1.0286    0.2349
1013     9.0000    9.0000    0.7994    0.1987    0.9717    0.2159    0.8841    0.3314
1014     9.0000   10.0000       NaN       NaN    0.3272   -0.0581    0.3272   -0.0581
1015    10.0000    1.0000       NaN       NaN    0.4990    0.4044    0.4990    0.4044
1016    10.0000    2.0000    0.2261   -1.3064    0.3332   -1.2594    0.3588   -1.2207
1017    10.0000    3.0000   -0.1474    0.1990   -0.0812    0.2540    0.0714    0.1528
1018    10.0000    4.0000    0.0750    0.0609   -0.2064    0.1349   -0.2064    0.9781
1019    10.0000    5.0000       NaN       NaN   -0.5240    0.7222   -0.5240    0.7222
1020    10.0000    6.0000       NaN       NaN    0.4499    0.7862    0.4499    0.7862
1021    10.0000    7.0000    0.7592   -0.3641    0.3624   -0.2649    0.3624    0.5027
1022    10.0000    8.0000    0.5239    0.4681    0.7216    0.4301    0.7240    0.5122
1023    10.0000    9.0000    0.7038    0.4284    0.8702    0.4267    0.7826    0.4394
1024    10.0000   10.0000       NaN       NaN    0.4979   -0.1694    0.4979   -0.1694
1025    10.0000   11.0000       NaN       NaN    0.6556   -0.4005    0.6556   -0.4005
1026    10.0000   12.0000       NaN       NaN    0.7335   -0.2444    0.7335   -0.2444
1027    11.0000    1.0000       NaN       NaN    0.6382   -0.2382    0.6382   -0.2382
1028    11.0000    2.0000    0.7680   -0.0261    0.8438   -0.1025    0.8078   -0.1432
1029    11.0000    3.0000    0.0039    0.9302    0.1660    0.7432    0.2741    0.7241
1030    11.0000    4.0000    0.9590   -0.8161   -0.2598   -0.6969   -0.2598    0.3842
1031    11.0000    5.0000       NaN       NaN    0.0997    0.5364    0.0997    0.5364
1032    11.0000    6.0000       NaN       NaN    0.7115    0.5330    0.7115    0.5330
1033    11.0000    7.0000    0.5438   -0.2171    0.5070   -0.2151    0.5070    0.5740
1034    11.0000    8.0000    0.0503   -0.1881   -0.1281   -0.0106   -0.0038   -0.0113
1035    11.0000    9.0000    0.1907   -0.3105    0.0638   -0.5505   -0.0390   -0.5956
1036    11.0000   10.0000       NaN       NaN    0.7015   -0.2305    0.7015   -0.2305
1037    12.0000    1.0000       NaN       NaN   -0.2370   -0.4183   -0.2370   -0.4183
1038    12.0000    2.0000    0.1341   -1.2611    0.1376   -1.0998    0.3036   -1.1286
1039    12.0000    3.0000    0.1835   -0.0610    0.1754    0.0098    0.3032   -0.0342
1040    12.0000    4.0000    0.9430   -1.8453   -0.0736   -1.7539   -0.0736   -0.7078
1041    12.0000    5.0000   -0.7679   -0.6057   -0.6584   -0.5037   -0.6623   -0.1190
1042    12.0000    6.0000    0.3659   -0.0725    0.4741    0.0259    0.2439    0.4729
1043    12.0000    7.0000    0.2231   -0.1530   -0.0655   -0.1893   -0.0655   -0.0279
1044    12.0000    8.0000   -0.0373   -0.5285    0.0293   -0.1884   -0.0317   -0.1047
1045    12.0000    9.0000    0.2502   -0.2326    0.2470   -0.2015    0.2964   -0.0672];
1046 
1047 
1048 <span class="comment">% iNoOffset = find(isnan(Offset(:,3)));</span>
1049 <span class="comment">% Offset(iNoOffset,3) = Offset(iNoOffset,5);</span>
1050 <span class="comment">%</span>
1051 <span class="comment">% iNoOffset = find(isnan(Offset(:,4)));</span>
1052 <span class="comment">% Offset(iNoOffset,4) = Offset(iNoOffset,6);</span>
1053 
1054 
1055 <span class="comment">% L = getfamilydata('Circumference');</span>
1056 <span class="comment">% figure;</span>
1057 <span class="comment">% subplot(2,2,1);</span>
1058 <span class="comment">% plot(getspos('BPMx', Offset(:,1:2)), [Offset(:,3) Offset(:,5) Offset(:,7)]);</span>
1059 <span class="comment">% ylabel('Horizontal [mm]');</span>
1060 <span class="comment">% xaxis([0 L]);</span>
1061 <span class="comment">% title('BPM Offset');</span>
1062 <span class="comment">%</span>
1063 <span class="comment">% subplot(2,2,2);</span>
1064 <span class="comment">% plot(getspos('BPMx', Offset(:,1:2)), [Offset(:,3)-Offset(:,5) Offset(:,3)-Offset(:,7)]);</span>
1065 <span class="comment">% ylabel('Horizontal Difference[mm]');</span>
1066 <span class="comment">% xaxis([0 L]);</span>
1067 <span class="comment">% title('BPM Offset');</span>
1068 <span class="comment">%</span>
1069 <span class="comment">% subplot(2,2,3);</span>
1070 <span class="comment">% plot(getspos('BPMy', Offset(:,1:2)), [Offset(:,4) Offset(:,6) Offset(:,8)]);</span>
1071 <span class="comment">% xlabel('BPM Position [meters]');</span>
1072 <span class="comment">% ylabel('Vertical [mm]');</span>
1073 <span class="comment">% xaxis([0 L]);</span>
1074 <span class="comment">%</span>
1075 <span class="comment">% subplot(2,2,4);</span>
1076 <span class="comment">% plot(getspos('BPMy', Offset(:,1:2)), [Offset(:,4)-Offset(:,6) Offset(:,4)-Offset(:,8)]);</span>
1077 <span class="comment">% xlabel('BPM Position [meters]');</span>
1078 <span class="comment">% ylabel('Vertical Difference [mm]');</span>
1079 <span class="comment">% xaxis([0 L]);</span>
1080 <span class="comment">%</span>
1081 <span class="comment">% addlabel(0,0,'Blue-&gt;2007-06-15   Green-&gt;2007-01-06   Red-&gt;2005-05-12');</span>
1082 <span class="comment">% addlabel(1,0,'Blue-&gt;(2007-06-15)-(2007-01-06)   Green-&gt;(2007-06-15)-(2005-05-12');</span>
1083 <span class="comment">% orient landscape</span>
1084 
1085 
1086 <span class="comment">%                          2007-06-15           2007-01-06</span>
1087 <span class="comment">%      DeviceList        Xnew      Ynew      Xold      Yold</span>
1088 Golden = [
1089     1.0000    2.0000   -0.1164    1.1118   -0.0905    0.9270
1090     1.0000    3.0000   -0.3206   -0.2798   -0.1560   -0.1728
1091     1.0000    4.0000   -0.2206    0.1521   -0.0075   -0.0597
1092     1.0000    5.0000   -0.3231    0.6461   -0.3723    1.4058
1093     1.0000    6.0000    0.0209    0.0860    0.1567    0.3048 <span class="comment">% three broken BPM cables fixed 7-23-07 - T.Scarvie Xold=0.0235, Yold=0.0991</span>
1094     1.0000    7.0000   -0.6995    0.0287   -0.3353   -0.0694
1095     1.0000    8.0000   -0.2767   -0.7159   -0.3620   -0.4516
1096     1.0000    9.0000    0.1418    0.2101    0.2470    0.3653
1097     1.0000   10.0000   -1.2077    6.6760    1.4424   -0.2583
1098     2.0000    1.0000    0.1813    0.1247    0.3866   -0.1324
1099     2.0000    2.0000    0.3349   -0.5164    0.5617   -0.5684
1100     2.0000    3.0000    0.2200    0.4180    0.2629    0.1806
1101     2.0000    4.0000   -0.4819    0.0637   -0.1558    0.1406
1102     2.0000    5.0000    0.0124   -0.0094   -0.0634    0.1124
1103     2.0000    6.0000    0.8025   -0.9006    1.0105   -0.8803 <span class="comment">% one broken BPM cable fixed 7-23-07 - T.Scarvie Xold=0.8090, Yold=-1.0049</span>
1104     2.0000    7.0000   -0.4425    0.0289   -0.2299    0.2139
1105     2.0000    8.0000    0.0140   -0.5773    0.1148   -0.2362
1106     2.0000    9.0000   -0.0024    0.0779   -0.1342    0.0144
1107     3.0000    2.0000   -0.1644    0.0590   -0.1886    0.0369
1108     3.0000    3.0000    0.1728    0.0144    0.1387    0.1647
1109     3.0000    4.0000   -0.2566   -0.1845   -0.0843   -0.3441
1110     3.0000    5.0000   -0.2174   -0.2986   -0.1278   -0.1503
1111     3.0000    6.0000   -0.0498   -0.1577    0.0638    0.0034
1112     3.0000    7.0000    0.1708    0.0183    0.5082   -0.3062
1113     3.0000    8.0000   -0.0608    0.7555   -0.1019    0.6271
1114     3.0000    9.0000    0.5188   -0.0548    0.4280   -0.0073
1115     3.0000   10.0000    0.6894    0.1611    0.6763    0.1403
1116     3.0000   11.0000    0.0267   -0.3336    0.0245   -0.4586
1117     3.0000   12.0000    0.1506    0.0429    0.1478   -0.0725
1118     4.0000    1.0000    0.8131    0.0974    0.7799    0.0331
1119     4.0000    2.0000   -0.1926    0.8527   -0.2336    0.9362
1120     4.0000    3.0000    0.5383   -0.7841    0.5620   -0.4577
1121     4.0000    4.0000    0.1399    0.2569   -0.1769    0.5789
1122     4.0000    5.0000   -0.0579   -0.1571    0.1013   -0.0718
1123     4.0000    6.0000    0.6769    0.4766    1.0632    0.6690
1124     4.0000    7.0000   -0.3127   -0.1996    0.0751    0.3001
1125     4.0000    8.0000   -0.8090    0.2218   -0.6185    0.3929
1126     4.0000    9.0000   -0.5722   -0.3312   -0.5918   -0.4112
1127     4.0000   10.0000   -0.3650    1.1224   -0.4259    1.2825
1128     5.0000    1.0000    0.5914    0.2199    1.0252    0.1134
1129     5.0000    2.0000   -0.0654    0.7898    0.1353    0.6211
1130     5.0000    3.0000    0.0109    0.6031   -0.0297    0.4792
1131     5.0000    4.0000   -0.6197    0.3611   -0.7689    0.3487
1132     5.0000    5.0000   -0.2871    0.3102   -0.6357    0.7139
1133     5.0000    6.0000   -0.8664    0.2819   -0.2995    0.6825
1134     5.0000    7.0000   -1.4360   -0.1984   -0.2062   -0.1643
1135     5.0000    8.0000   -0.6783   -0.0500   -0.5811    0.4796
1136     5.0000    9.0000    0.4560    0.5540    0.2395    0.7904
1137     5.0000   10.0000    0.0030    1.0187   -0.0983    1.1972
1138     5.0000   11.0000    0.8074    0.6420    0.3662    0.2982
1139     5.0000   12.0000    1.2291    0.6390    0.8378    0.2751
1140     6.0000    1.0000    1.2242    0.3311    1.1062    0.3945
1141     6.0000    2.0000    0.7337   -0.6179   -0.4532    0.1640
1142     6.0000    3.0000    0.6009   -0.1658    0.4640   -0.2254
1143     6.0000    4.0000   -0.3989    0.4334    0.0279    0.4018
1144     6.0000    5.0000   -0.0950   -0.4062   -0.0122   -0.4458
1145     6.0000    6.0000   -0.3644    0.1094   -0.4341    0.3551
1146     6.0000    7.0000   -0.3061    0.2173    0.0505    0.0695
1147     6.0000    8.0000   -0.0087    0.6355    0.0724    0.6455
1148     6.0000    9.0000   -0.3327    0.7777   -0.2040    0.6862
1149     6.0000   10.0000    0.4036   -0.4307    0.5751   -0.3754
1150     7.0000    1.0000    0.7321    0.0467    0.9940    0.1602
1151     7.0000    2.0000   -0.0733    0.4845    0.1602    0.5734
1152     7.0000    3.0000    0.3613    0.2853    0.3448    0.5149
1153     7.0000    4.0000   -0.5473    0.3019   -0.2024    0.2997
1154     7.0000    5.0000    0.4386    0.3786    0.3256    0.4723
1155     7.0000    6.0000   -0.1010    0.7061   -0.2265    0.7548
1156     7.0000    7.0000   -0.4437    0.6924   -0.2314    0.4434
1157     7.0000    8.0000   -0.1459    0.8676    0.0055    0.7587
1158     7.0000    9.0000   -1.4295   -0.5051   -1.0471   -0.6419
1159     7.0000   10.0000    0.5307    0.0572    0.7784    0.0477
1160     8.0000    1.0000    0.1367    0.3429    0.4653    0.3253
1161     8.0000    2.0000   -0.1248    0.1270    0.2355    0.0610
1162     8.0000    3.0000    0.0487    0.9742    0.1225    1.0581
1163     8.0000    4.0000   -1.5810    0.0980   -1.2181   -0.2084
1164     8.0000    5.0000   -0.3341    0.2824   -0.2268    0.5857
1165     8.0000    6.0000   -0.3421    0.7272   -0.1818    0.8391
1166     8.0000    7.0000    0.3349    0.3401    0.5672   -0.0758
1167     8.0000    8.0000   -0.2651    1.4210   -0.0246    1.6463
1168     8.0000    9.0000   -1.8364   -0.4120   -1.5009   -0.4652
1169     8.0000   10.0000    0.2715   -0.2286    0.6915   -0.3086
1170     9.0000    1.0000   -0.0777   -0.0662    0.3128   -0.0750
1171     9.0000    2.0000    1.5025    1.2110    2.0458    1.3817
1172     9.0000    3.0000    0.1389    0.5968    0.3151    0.5734
1173     9.0000    4.0000   -0.3410    0.3957   -0.1206   -0.2816
1174     9.0000    5.0000   -1.2782    0.8355   -0.3879    0.1111
1175     9.0000    6.0000    0.1340   -0.0589    0.0292   -0.0051
1176     9.0000    7.0000   -0.3855    0.4947   -0.3161    0.4980
1177     9.0000    8.0000    0.9610    0.0456    1.0139    0.2976
1178     9.0000    9.0000    0.7791    0.0588    1.0325    0.3200
1179     9.0000   10.0000    0.0948   -0.0164    0.4193   -0.0683
1180    10.0000    1.0000    0.3913    0.4174    0.4968    0.1272
1181    10.0000    2.0000    0.2516   -1.2953    0.3301   -1.3297
1182    10.0000    3.0000   -0.1787    0.2017   -0.2107    0.0034
1183    10.0000    4.0000   -0.3542    0.3949   -0.2981    0.6957
1184    10.0000    5.0000   -0.5252    0.3975   -0.5290    0.7303
1185    10.0000    6.0000   -0.2114    0.3008    0.3664    0.6748
1186    10.0000    7.0000   -0.0283   -0.2467    0.4620   -0.1321
1187    10.0000    8.0000    0.4726    0.3341    0.6358    0.3907
1188    10.0000    9.0000    0.7135    0.3762    0.8666    0.3835
1189    10.0000   10.0000    0.6035   -0.1710    0.6846   -0.1846
1190    10.0000   11.0000    0.7857   -0.3919    0.7601   -0.3101
1191    10.0000   12.0000    0.9208   -0.3487    0.8949   -0.2490
1192    11.0000    1.0000    0.5366   -0.4139    0.5186   -0.2121
1193    11.0000    2.0000    0.8223   -0.1215    0.8820   -0.0889
1194    11.0000    3.0000   -0.0889    0.5780    0.1352    0.5922
1195    11.0000    4.0000    0.3019   -0.6016    0.4249   -0.4161
1196    11.0000    5.0000    0.0179    0.2657   -0.0124    0.8161
1197    11.0000    6.0000    0.6549    0.2317    0.6921    0.6852
1198    11.0000    7.0000    0.2079    0.2648    0.0476    0.2143
1199    11.0000    8.0000    0.0910   -0.1828   -0.0686   -0.1559
1200    11.0000    9.0000    0.2325   -0.0519    0.1918   -0.5955
1201    11.0000   10.0000    0.6873   -0.0136    0.7356   -0.3074
1202    12.0000    1.0000   -0.6645   -0.3193   -0.3790   -0.4959
1203    12.0000    2.0000    0.1340   -1.4477    0.3250   -1.1212
1204    12.0000    3.0000    0.1950   -0.4437    0.2516   -0.0820
1205    12.0000    4.0000    0.5128   -1.8074    0.5054   -1.7032
1206    12.0000    5.0000   -0.5833   -0.4367   -0.6323   -0.2853
1207    12.0000    6.0000    0.2588    0.1180    0.2759    0.3523
1208    12.0000    7.0000   -0.3140    0.3242   -0.2178    0.0293
1209    12.0000    8.0000    0.0463   -0.8258    0.0065   -0.9847
1210    12.0000    9.0000    0.2396   -0.2649    0.5101   -0.5973];
1211    
1212    
1213 <span class="comment">% Golden = [</span>
1214 <span class="comment">%   1   2   -0.040511-0.05    1.006040-0.079 %adjusted values for (1 2,1 5,1 6,1 10,11 10,12 1,11 10,12 1,12 5,12 6,12 9) due to tightening BPM fittings 2-25-07, T.Scarvie</span>
1215 <span class="comment">%   1   3   -0.155995   -0.172802</span>
1216 <span class="comment">%   1   4   -0.007489   -0.059690</span>
1217 <span class="comment">%   1   5   -0.382271+0.01    1.420774-0.015</span>
1218 <span class="comment">%   1   6    0.132685+0.024    0.319805-0.015</span>
1219 <span class="comment">%   1   7   -0.335328   -0.069386</span>
1220 <span class="comment">%   1   8   -0.361984   -0.451644</span>
1221 <span class="comment">%   1   9    0.247050    0.365270</span>
1222 <span class="comment">%   1  10    1.448368-0.006   -0.186320-0.072</span>
1223 <span class="comment">%   2   1    0.386556   -0.132429</span>
1224 <span class="comment">%   2   2    0.561730   -0.568448</span>
1225 <span class="comment">%   2   3    0.262944    0.180594</span>
1226 <span class="comment">%   2   4   -0.155815    0.140550</span>
1227 <span class="comment">%   2   5   -0.063373    0.112443</span>
1228 <span class="comment">%   2   6    1.010452   -0.880251</span>
1229 <span class="comment">%   2   7   -0.229883    0.213915</span>
1230 <span class="comment">%   2   8    0.114837   -0.236195</span>
1231 <span class="comment">%   2   9   -0.134172    0.014436</span>
1232 <span class="comment">%   3   2   -0.188554    0.036926</span>
1233 <span class="comment">%   3   3    0.138737    0.164742</span>
1234 <span class="comment">%   3   4   -0.084294   -0.344108</span>
1235 <span class="comment">%   3   5   -0.127760   -0.150261</span>
1236 <span class="comment">%   3   6    0.063810    0.003429</span>
1237 <span class="comment">%   3   7    0.508240   -0.306222</span>
1238 <span class="comment">%   3   8   -0.101938    0.627142</span>
1239 <span class="comment">%   3   9    0.427999   -0.007273</span>
1240 <span class="comment">%   3  10    0.676310    0.140286</span>
1241 <span class="comment">%   3  11    0.024469   -0.458603</span>
1242 <span class="comment">%   3  12    0.147821   -0.072459</span>
1243 <span class="comment">%   4   1    0.779875    0.033131</span>
1244 <span class="comment">%   4   2   -0.233599    0.936216</span>
1245 <span class="comment">%   4   3    0.562033   -0.457749</span>
1246 <span class="comment">%   4   4   -0.176911    0.578941</span>
1247 <span class="comment">%   4   5    0.101312   -0.071837</span>
1248 <span class="comment">%   4   6    1.063168    0.668993</span>
1249 <span class="comment">%   4   7    0.075097    0.300069</span>
1250 <span class="comment">%   4   8   -0.618454    0.392932</span>
1251 <span class="comment">%   4   9   -0.591781   -0.411174</span>
1252 <span class="comment">%   4  10   -0.425909    1.282475</span>
1253 <span class="comment">%   5   1    1.025209    0.113385</span>
1254 <span class="comment">%   5   2    0.135306    0.621053</span>
1255 <span class="comment">%   5   3   -0.029729    0.479160</span>
1256 <span class="comment">%   5   4   -0.768940    0.348716</span>
1257 <span class="comment">%   5   5   -0.635675    0.713942</span>
1258 <span class="comment">%   5   6   -0.299507    0.682519</span>
1259 <span class="comment">%   5   7   -0.206233   -0.164313</span>
1260 <span class="comment">%   5   8   -0.581095    0.479630</span>
1261 <span class="comment">%   5   9    0.239507    0.790378</span>
1262 <span class="comment">%   5  10   -0.098328    1.197237</span>
1263 <span class="comment">%   5  11    0.366152    0.298180</span>
1264 <span class="comment">%   5  12    0.837822    0.275068</span>
1265 <span class="comment">%   6   1    1.106152    0.394482</span>
1266 <span class="comment">%   6   2   -0.453220    0.163968</span>
1267 <span class="comment">%   6   3    0.464006   -0.225373</span>
1268 <span class="comment">%   6   4    0.027866    0.401828</span>
1269 <span class="comment">%   6   5   -0.012178   -0.445797</span>
1270 <span class="comment">%   6   6   -0.434149    0.355110</span>
1271 <span class="comment">%   6   7    0.050542    0.069546</span>
1272 <span class="comment">%   6   8    0.072386    0.645455</span>
1273 <span class="comment">%   6   9   -0.204027    0.686178</span>
1274 <span class="comment">%   6  10    0.575066   -0.375350</span>
1275 <span class="comment">%   7   1    0.993970    0.160223</span>
1276 <span class="comment">%   7   2    0.160180    0.573360</span>
1277 <span class="comment">%   7   3    0.344765    0.514882</span>
1278 <span class="comment">%   7   4   -0.202377    0.299711</span>
1279 <span class="comment">%   7   5    0.325589    0.472323</span>
1280 <span class="comment">%   7   6   -0.226487    0.754825</span>
1281 <span class="comment">%   7   7   -0.231378    0.443379</span>
1282 <span class="comment">%   7   8    0.005455    0.758709</span>
1283 <span class="comment">%   7   9   -1.047132   -0.641851</span>
1284 <span class="comment">%   7  10    0.778378    0.047654</span>
1285 <span class="comment">%   8   1    0.465304    0.325339</span>
1286 <span class="comment">%   8   2    0.235478    0.060970</span>
1287 <span class="comment">%   8   3    0.122504    1.058132</span>
1288 <span class="comment">%   8   4   -1.218061   -0.208418</span>
1289 <span class="comment">%   8   5   -0.226804    0.585689</span>
1290 <span class="comment">%   8   6   -0.181759    0.839125</span>
1291 <span class="comment">%   8   7    0.567193   -0.075760</span>
1292 <span class="comment">%   8   8   -0.024555    1.646280</span>
1293 <span class="comment">%   8   9   -1.500939   -0.465201</span>
1294 <span class="comment">%   8  10    0.691539   -0.308552</span>
1295 <span class="comment">%   9   1    0.312845   -0.074984</span>
1296 <span class="comment">%   9   2    2.045828    1.381672</span>
1297 <span class="comment">%   9   3    0.315071    0.573403</span>
1298 <span class="comment">%   9   4   -0.120628   -0.281603</span>
1299 <span class="comment">%   9   5   -0.387893    0.111066</span>
1300 <span class="comment">%   9   6    0.029225   -0.005092</span>
1301 <span class="comment">%   9   7   -0.316135    0.498034</span>
1302 <span class="comment">%   9   8    1.013853    0.297556</span>
1303 <span class="comment">%   9   9    1.032522    0.320033</span>
1304 <span class="comment">%   9  10    0.419298   -0.068294</span>
1305 <span class="comment">%  10   1    0.496764    0.127194</span>
1306 <span class="comment">%  10   2    0.330079   -1.329703</span>
1307 <span class="comment">%  10   3   -0.210684    0.003378</span>
1308 <span class="comment">%  10   4   -0.298091    0.695728</span>
1309 <span class="comment">%  10   5   -0.528987    0.730280</span>
1310 <span class="comment">%  10   6    0.366418    0.674756</span>
1311 <span class="comment">%  10   7    0.462025   -0.132051</span>
1312 <span class="comment">%  10   8    0.635811    0.390677</span>
1313 <span class="comment">%  10   9    0.866625    0.383491</span>
1314 <span class="comment">%  10  10    0.684558   -0.184594</span>
1315 <span class="comment">%  10  11    0.760086   -0.310084</span>
1316 <span class="comment">%  10  12    0.894935   -0.249016</span>
1317 <span class="comment">%  11   1    0.518637   -0.212083</span>
1318 <span class="comment">%  11   2    0.881954   -0.088936</span>
1319 <span class="comment">%  11   3    0.135216    0.592178</span>
1320 <span class="comment">%  11   4    0.424927   -0.416077</span>
1321 <span class="comment">%  11   5   -0.012425    0.816148</span>
1322 <span class="comment">%  11   6    0.692062    0.685239</span>
1323 <span class="comment">%  11   7    0.047561    0.214277</span>
1324 <span class="comment">%  11   8   -0.068567   -0.155911</span>
1325 <span class="comment">%  11   9    0.191816   -0.595530</span>
1326 <span class="comment">%  11  10    0.770551-0.035   -0.363433+0.056</span>
1327 <span class="comment">%  12   1   -0.348044-0.031   -0.484946-0.011</span>
1328 <span class="comment">%  12   2    0.324973   -1.121244</span>
1329 <span class="comment">%  12   3    0.251555   -0.081986</span>
1330 <span class="comment">%  12   4    0.505429   -1.703241</span>
1331 <span class="comment">%  12   5   -0.620302-0.012   -0.268309-0.017</span>
1332 <span class="comment">%  12   6    0.243871+0.032    0.352266</span>
1333 <span class="comment">%  12   7   -0.217819    0.029310</span>
1334 <span class="comment">%  12   8    0.006538   -0.9847 %-0.133392 looks like this BPM took a jump - changed value to prevent orbit correction from distorting 12,9 orbit</span>
1335 <span class="comment">%  12   9    0.535114-0.025   -0.570344-0.027</span>
1336 <span class="comment">%  ];</span>
1337 
1338 
1339 <span class="comment">% Make the offset equal to the golden for BPMs without an offset measurement</span>
1340 Dev = <a href="getbpmlist.html" class="code" title="function [DeviceList, Index] = getbpmlist(varargin)">getbpmlist</a>(<span class="string">'BPMx'</span>,<span class="string">'NoXoffset'</span>, <span class="string">'IgnoreStatus'</span>);
1341 i = findrowindex(Dev, Offset(:,1:2));
1342 Offset(i,3) = Golden(i,3);
1343 
1344 Dev = <a href="getbpmlist.html" class="code" title="function [DeviceList, Index] = getbpmlist(varargin)">getbpmlist</a>(<span class="string">'BPMy'</span>,<span class="string">'NoYoffset'</span>, <span class="string">'IgnoreStatus'</span>);
1345 i = findrowindex(Dev, Offset(:,1:2));
1346 Offset(i,4) = Golden(i,4);
1347 
1348 <span class="comment">% Convert NaN to zeroes</span>
1349 Offset(isnan(Offset(:,3)),3) = 0;
1350 Offset(isnan(Offset(:,4)),4) = 0;
1351 
1352 
1353 
1354 <span class="comment">% fprintf('%3d %3d  %10.6f  %10.6f\n', [family2dev('BPMx'), getgolden('BPMx'), getgolden('BPMy')]');</span>
1355 <span class="comment">% Golden = [</span>
1356 <span class="comment">%     1   2   -0.2896      0.9742    %-0.0318      0.5181</span>
1357 <span class="comment">%     1   3   -0.152378   -0.241254  %-0.152484   -0.241162</span>
1358 <span class="comment">%     1   4    0.579553   -0.643002  % 0.579841   -0.643067</span>
1359 <span class="comment">%     1   5   -0.2628      1.1619    %-0.264224    1.161546</span>
1360 <span class="comment">%     1   6    0.3215      0.2230    % 0.323280    0.223281</span>
1361 <span class="comment">%     1   7    0.083640    0.196757  % 0.082737    0.196420</span>
1362 <span class="comment">%     1   8   -0.368952   -0.196831  %-0.368819   -0.196855</span>
1363 <span class="comment">%     1   9   -0.003805    0.407082  %-0.003357    0.406456</span>
1364 <span class="comment">%     1  10    1.3079     -0.1676    % 1.309478   -0.167377</span>
1365 <span class="comment">%     2   1    0.1588      0.1513    % 0.160261    0.151036</span>
1366 <span class="comment">%     2   2    0.344356   -0.520547  % 0.345754   -0.518623</span>
1367 <span class="comment">%     2   3    0.187703    0.164975  % 0.187703    0.166062</span>
1368 <span class="comment">%     2   4    0.352522    0.222951  % 0.351916    0.223096</span>
1369 <span class="comment">%     2   5   -0.0208      0.1188    %-0.019400    0.119447</span>
1370 <span class="comment">%     2   6    1.0050     -0.9880    % 1.007835   -0.988796</span>
1371 <span class="comment">%     2   7   -0.030978    0.423587  %-0.030932    0.423312</span>
1372 <span class="comment">%     2   8    0.133789   -0.6375    % 0.133789   -0.027414  % 0.135450   -0.027403</span>
1373 <span class="comment">%     2   9   -0.2203     -0.1107    %-0.1255     -0.0075</span>
1374 <span class="comment">%     3   2   -0.2273      0.1911    %-0.2273      0.1911</span>
1375 <span class="comment">%     3   3    0.165441    0.436316  % 0.165322    0.434830</span>
1376 <span class="comment">%     3   4   -0.343977    0.091995  %-0.344303    0.091896</span>
1377 <span class="comment">%     3   5    0.0739     -0.0736    %-0.051844   -0.073605</span>
1378 <span class="comment">%     3   6    0.2514      0.0204    % 0.6153      0.1983    % 0.614787    0.197967</span>
1379 <span class="comment">%     3   7    0.304507    0.697537  % 0.305512    0.697387</span>
1380 <span class="comment">%     3   8   -0.069038    0.528654  %-0.069111    0.528689</span>
1381 <span class="comment">%     3   9    0.517497    0.228419  % 0.516663    0.229043</span>
1382 <span class="comment">%     3  10    0.7444      0.2539    % 0.744410    0.253550</span>
1383 <span class="comment">%     3  11    0.0840     -0.3383    % 0.082091   -0.337858</span>
1384 <span class="comment">%     3  12    0.2215      0.0236    % 0.3156     -0.1570    % 0.313468   -0.156351</span>
1385 <span class="comment">%     4   1    0.8042      0.2195    % 0.803902    0.219844</span>
1386 <span class="comment">%     4   2   -0.240661    0.988501  %-0.242393    0.988339</span>
1387 <span class="comment">%     4   3    0.454354   -0.226890  % 0.453473   -0.226213</span>
1388 <span class="comment">%     4   4   -0.601477    0.102367  %-0.602129    0.102499</span>
1389 <span class="comment">%     4   5   -0.2014     -0.0041    %-0.202549   -0.004284</span>
1390 <span class="comment">%     4   6    0.8830      0.7256    % 0.882781    0.725510</span>
1391 <span class="comment">%     4   7   -0.387219    0.086077  %-0.587016    0.426245</span>
1392 <span class="comment">%     4   8   -0.545459    0.480851  %-0.547100    0.420096</span>
1393 <span class="comment">%     4   9   -0.479635   -0.288631  %-0.480664   -0.288543</span>
1394 <span class="comment">%     4  10   -0.4402      1.3105    %-0.440489    1.310593</span>
1395 <span class="comment">%     5   1    0.8685      0.1611    % 0.868568    0.161346</span>
1396 <span class="comment">%     5   2    0.021439    0.674611  % 0.021244    0.674683</span>
1397 <span class="comment">%     5   3    0.047640    0.440063  % 0.047743    0.439180</span>
1398 <span class="comment">%     5   4    0.190253    0.186037  % 0.190435    0.186583</span>
1399 <span class="comment">%     5   5   -0.3593      0.5678    %-0.359901    0.567948</span>
1400 <span class="comment">%     5   6   -0.3847      0.5690    %-0.383517    0.569024</span>
1401 <span class="comment">%     5   7    0.171261    0.457279  % 0.170336    0.455384</span>
1402 <span class="comment">%     5   8   -0.519706    0.591800  %-0.519345    0.591021</span>
1403 <span class="comment">%     5   9    0.465190    0.700225  % 0.465078    0.700237</span>
1404 <span class="comment">%     5  10   -0.2465      1.3429    %-0.2465      1.3429</span>
1405 <span class="comment">%     5  11    0.2855      0.4594    % 0.2855      0.4594</span>
1406 <span class="comment">%     5  12    0.7634      0.4516    % 0.7634      0.4516</span>
1407 <span class="comment">%     6   1    1.0160      0.5698    % 1.0160      0.5698</span>
1408 <span class="comment">%     6   2   -0.476022    0.231231  %-0.472465    0.231270</span>
1409 <span class="comment">%     6   3    0.397318    0.004102  % 0.398645    0.004417</span>
1410 <span class="comment">%     6   4    0.094072    0.862693  % 0.093460    0.862800</span>
1411 <span class="comment">%     6   5    0.0295     -0.2916    % 0.030714   -0.291520</span>
1412 <span class="comment">%     6   6   -0.4953      0.4451    %-0.494434    0.445159</span>
1413 <span class="comment">%     6   7   -0.089162    0.484128  %-0.089119    0.484474</span>
1414 <span class="comment">%     6   8    0.019608    0.759533  % 0.020663    0.759064</span>
1415 <span class="comment">%     6   9   -0.271687    0.768308  %-0.269637    0.767830</span>
1416 <span class="comment">%     6  10    0.4992     -0.4132    % 0.4992     -0.4132</span>
1417 <span class="comment">%     7   1    0.6804      0.2674    % 0.681440    0.267552</span>
1418 <span class="comment">%     7   2   -0.159098    0.658741  %-0.158171    0.658387</span>
1419 <span class="comment">%     7   3    0.228716    0.502839  % 0.228906    0.502007</span>
1420 <span class="comment">%     7   4   -0.295639    0.529897  %-0.295833    0.528664</span>
1421 <span class="comment">%     7   5    0.3000      0.3931    % 0.300789    0.393356</span>
1422 <span class="comment">%     7   6   -0.1463      0.6520    %-0.146880    0.651975</span>
1423 <span class="comment">%     7   7    0.060125    0.793967  % 0.060168    0.794162</span>
1424 <span class="comment">%     7   8   -0.086876    0.650777  %-0.087694    0.650625</span>
1425 <span class="comment">%     7   9   -1.325525   -0.647836  %-0.0869      0.6508</span>
1426 <span class="comment">%     7  10    0.4586      0.0892    % 0.458855    0.089469</span>
1427 <span class="comment">%     8   1    0.1198      0.3707    % 0.119673    0.370762</span>
1428 <span class="comment">%     8   2   -0.050046    0.096356  %-0.053612    0.096084</span>
1429 <span class="comment">%     8   3    0.073770    0.994688  % 0.071804    0.994555</span>
1430 <span class="comment">%     8   4    0.080614    0.692844  % 0.080223    0.692561</span>
1431 <span class="comment">%     8   5   -0.0318      0.5181    %-0.083167    0.645776</span>
1432 <span class="comment">%     8   6   -0.2839      0.9567    %-0.284171    0.956662</span>
1433 <span class="comment">%     8   7    0.391907    1.953947  % 0.391689    1.951550</span>
1434 <span class="comment">%     8   8   -0.140246    1.639606  %-0.140449    1.639649</span>
1435 <span class="comment">%     8   9   -1.502310   -0.207432  %-1.504134   -0.207754</span>
1436 <span class="comment">%     8  10    0.6255     -0.1201    % 0.625154   -0.120320</span>
1437 <span class="comment">%     9   1    0.1121     -0.0814    % 0.111942   -0.081206</span>
1438 <span class="comment">%     9   2    1.786463    1.335916  % 1.8313      1.3063</span>
1439 <span class="comment">%     9   3    0.215602    0.387373  % 0.214896    0.387126</span>
1440 <span class="comment">%     9   4    0.158785   -0.031891  % 0.159954   -0.031512</span>
1441 <span class="comment">%     9   5   -0.3181      0.0526    %-0.318482    0.051950</span>
1442 <span class="comment">%     9   6    0.1714     -0.0078    % 0.172962   -0.007577</span>
1443 <span class="comment">%     9   7    0.316691   -0.006804  % 0.316407   -0.006569</span>
1444 <span class="comment">%     9   8    0.880731    0.214732  % 0.880147    0.215338</span>
1445 <span class="comment">%     9   9    0.949231    0.310896  % 0.950156    0.311014</span>
1446 <span class="comment">%     9  10    0.2967     -0.0239    % 0.2967     -0.0239</span>
1447 <span class="comment">%     10   1    0.5232      0.1526    % 0.523894    0.152474</span>
1448 <span class="comment">%     10   2    0.437599   -1.142640  % 0.439782   -1.142138</span>
1449 <span class="comment">%     10   3   -0.113803    0.135020  %-0.113791    0.135007</span>
1450 <span class="comment">%     10   4   -0.199668    0.928557  %-0.199348    0.928702</span>
1451 <span class="comment">%     10   5   -0.5163      0.7165    %-0.514913    0.715788</span>
1452 <span class="comment">%     10   6    0.4600      0.7018    % 0.461318    0.702045</span>
1453 <span class="comment">%     10   7    0.344444    0.464383  % 0.344225    0.464196</span>
1454 <span class="comment">%     10   8    0.634820    0.560750  % 0.638157    0.563323</span>
1455 <span class="comment">%     10   9    0.829263    0.420337  % 0.828490    0.420643</span>
1456 <span class="comment">%     10  10    0.6593     -0.0171    % 0.659822   -0.017003</span>
1457 <span class="comment">%     10  11    0.6464     -0.1530    % 0.647259   -0.152731</span>
1458 <span class="comment">%     10  12    0.7818     -0.0988    % 0.782518   -0.098612</span>
1459 <span class="comment">%     11   1    0.5147     -0.0634    % 0.515164   -0.063664</span>
1460 <span class="comment">%     11   2    0.865802   -0.047039  % 0.865700   -0.047061</span>
1461 <span class="comment">%     11   3    0.129104    0.657485  % 0.129908    0.656617</span>
1462 <span class="comment">%     11   4   -0.245201    0.492669  %-0.246788    0.492489</span>
1463 <span class="comment">%     11   5    0.0853      0.7688    % 0.0853      0.5688 % Y raised when fittings were tightened    % 0.086654    0.568875</span>
1464 <span class="comment">%     11   6    0.7299      0.5752    % 0.729126    0.575185</span>
1465 <span class="comment">%     11   7    0.488272    0.561293  % 0.489058    0.561000</span>
1466 <span class="comment">%     11   8   -0.123974   -0.074137  %-0.124343   -0.072658</span>
1467 <span class="comment">%     11   9    0.009679   -0.533941  % 0.010739   -0.533760</span>
1468 <span class="comment">%     11  10    0.6304     -0.2759    % 0.630879   -0.275475</span>
1469 <span class="comment">%     12   1   -0.3235     -0.3509    %-0.323108   -0.351090</span>
1470 <span class="comment">%     12   2    0.315783   -1.050641  % 0.312953   -1.050924</span>
1471 <span class="comment">%     12   3    0.262078   -0.018282  % 0.261234   -0.018941</span>
1472 <span class="comment">%     12   4   -0.169038   -0.768199  %-0.168877   -0.767095</span>
1473 <span class="comment">%     12   5   -0.6095     -0.2389    %-0.610702   -0.238594</span>
1474 <span class="comment">%     12   6    0.2802      0.4385    % 0.279390    0.438482</span>
1475 <span class="comment">%     12   7   -0.146203   -0.021551  %-0.146113   -0.020954</span>
1476 <span class="comment">%     12   8   -0.133978   -0.059753  %-0.134942   -0.059710</span>
1477 <span class="comment">%     12   9    0.3541     -0.1237</span>
1478 <span class="comment">%     ];</span>
1479 
1480 
1481 <span class="comment">% Save the data</span>
1482 AO = getao;
1483 
1484 
1485 <span class="comment">% Offset orbits</span>
1486 [i, iNotFound, iFoundList] = findrowindex(Offset(:,1:2), AO.BPMx.DeviceList);
1487 <span class="keyword">if</span> ~isempty(iNotFound)
1488     fprintf(<span class="string">'\n   Warning:  BPMx offsets are specified that are not in the family (setoperationalmode)\n'</span>);
1489 <span class="keyword">end</span>
1490 <span class="keyword">if</span> size(AO.BPMx.DeviceList,1) ~= length(i)
1491     fprintf(<span class="string">'\n   Warning:  Not all the offsets in the BPMx family are being specified (setoperationalmode)\n'</span>);
1492 <span class="keyword">end</span>
1493 AO.BPMx.Offset = zeros(size(AO.BPMx.DeviceList,1),1);
1494 AO.BPMx.Offset(i) = Offset(iFoundList,3);
1495 
1496 [i, iNotFound, iFoundList] = findrowindex(Offset(:,1:2), AO.BPMy.DeviceList);
1497 <span class="keyword">if</span> ~isempty(iNotFound)
1498     fprintf(<span class="string">'\n   Warning:  BPMy offsets are specified that are not in the family (setoperationalmode)\n'</span>);
1499 <span class="keyword">end</span>
1500 <span class="keyword">if</span> size(AO.BPMy.DeviceList,1) ~= length(i)
1501     fprintf(<span class="string">'\n   Warning:  Not all the offsets in the BPMy family are being specified (setoperationalmode)\n'</span>);
1502 <span class="keyword">end</span>
1503 AO.BPMy.Offset = zeros(size(AO.BPMy.DeviceList,1),1);
1504 AO.BPMy.Offset(i) = Offset(iFoundList,4);
1505 
1506 
1507 <span class="comment">% Golden orbits</span>
1508 [i, iNotFound, iFoundList] = findrowindex(Golden(:,1:2), AO.BPMx.DeviceList);
1509 <span class="keyword">if</span> ~isempty(iNotFound)
1510     fprintf(<span class="string">'\n   Warning:  BPMx golden values are specified that are not in the family (setoperationalmode)\n'</span>);
1511 <span class="keyword">end</span>
1512 <span class="keyword">if</span> size(AO.BPMx.DeviceList,1) ~= length(i)
1513     fprintf(<span class="string">'\n   Warning:  Not all the golden orbits in the BPMx family are being specified (setoperationalmode)\n'</span>);
1514 <span class="keyword">end</span>
1515 AO.BPMx.Golden = zeros(size(AO.BPMx.DeviceList,1),1);
1516 AO.BPMx.Golden(i) = Golden(iFoundList,3);
1517 
1518 [i, iNotFound, iFoundList] = findrowindex(Golden(:,1:2), AO.BPMy.DeviceList);
1519 <span class="keyword">if</span> ~isempty(iNotFound)
1520     fprintf(<span class="string">'\n   Warning:  BPMy golden values are specified that are not in the family (setoperationalmode)\n'</span>);
1521 <span class="keyword">end</span>
1522 <span class="keyword">if</span> size(AO.BPMy.DeviceList,1) ~= length(i)
1523     fprintf(<span class="string">'\n   Warning:  Not all the golden orbits in the BPMy family are being specified (setoperationalmode)\n'</span>);
1524 <span class="keyword">end</span>
1525 AO.BPMy.Golden = zeros(size(AO.BPMy.DeviceList,1),1);
1526 AO.BPMy.Golden(i) = Golden(iFoundList,4);
1527 
1528 setao(AO);</pre></div>
<hr><address>Generated on Thu 02-Aug-2007 13:16:07 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>