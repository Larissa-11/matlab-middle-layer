function [model, model_length] = sirius_si_bc_segmented_model(passmethod, m_accep_fam_name)

types = {};
bc_hf   = 1; types{end+1} = struct('fam_name', 'bc_hf', 'passmethod', passmethod);
bc_lf   = 2; types{end+1} = struct('fam_name', 'bc_lf', 'passmethod', passmethod);
bc_edge = 3; types{end+1} = struct('fam_name', 'bc_edge', 'passmethod', 'IdentityPass');
m_accep = 4; types{end+1} = struct('fam_name', m_accep_fam_name, 'passmethod', 'IdentityPass');

% dipole model 2015-11-03
% =======================
% this (half) model is based on fieldmap
% /home/fac_files/data/sirius/si/magnet_modelling/si-bc/bc-model6
% '2015-10-26_Dipolo_Anel_BC_B3_Modelo5_gap_lateral_0.25mm_peca_3.5mm_-90_12mm_-2000_2000mm.txt'

monomials = [0,1,2,3,4,5,6,7,8,10];
segmodel = [ ...
%type    len[m]    angle[deg]               PolynomB(n=0)            PolynomB(n=1)            PolynomB(n=2)            PolynomB(n=3)            PolynomB(n=4)           PolynomB(n=5)           PolynomB(n=6)           PolynomB(n=7)           PolynomB(n=8)          PolynomB(n=10)      
bc_hf,   0.00500  +9.0408642344322485e-02 +0.0000000000000000e+00 +1.0805784519281249e-03 -3.8875825199783421e+01 +3.7014800414067032e+01 +7.4548843862429901e+04 -2.9299107777839638e+06 -1.3694877971594578e+10 +2.0451545640001316e+10 +1.0664461755314095e+14 -3.6650260721037126e+17 
bc_hf,   0.00500  +8.0742383569631232e-02 +0.0000000000000000e+00 -2.0917810857616036e-02 -2.2716568780567254e+01 +1.4587997013780108e+02 -2.6596383444674400e+05 -3.7088475050058304e+06 -2.3193744182057762e+09 +2.7031018705533455e+10 +2.6676116017123555e+13 -1.5523965156972109e+17 
bc_hf,   0.00500  +6.8927778364262449e-02 +0.0000000000000000e+00 -2.3781218809940448e-02 -1.4657792199568078e+01 -1.6535986734120462e+02 -8.5246604529097880e+04 +3.5304187382959956e+06 -2.1759838238414564e+09 -1.8850917531190090e+10 +2.6346936261088859e+13 -1.1716626870742637e+17 
bc_hf,   0.00500  +5.9619412241716165e-02 +0.0000000000000000e+00 -2.7315769564043413e-02 -9.9136101462980317e+00 +2.4513347271591552e+01 -7.0314624305304649e+04 +9.6426779600563514e+03 -3.6716642000657588e+07 +2.4269584501224375e+08 +2.5872268195722700e+12 -2.0944329246293820e+16 
bc_hf,   0.01000  +9.8131349083242919e-02 +0.0000000000000000e+00 -2.6509400726179289e-02 -6.4399320515132583e+00 +2.7096563205257745e+01 -5.0977111608712381e+04 -2.4363699799700713e+05 +5.6438303201951611e+08 +1.2160017964904776e+09 -5.3722766237958086e+12 +1.7520065329357290e+16 
bc_hf,   0.01000  +7.5659783021191265e-02 +0.0000000000000000e+00 -2.6311133298874786e-02 -4.6550829338031106e+00 -8.1898480156510423e-01 +2.6287264134802731e+03 +1.2380875305500187e+05 -2.7242849167862928e+08 -6.5167912580422819e+08 +2.6737722844811729e+12 -9.4289420513003360e+15 
bc_hf,   0.01000  +5.6788924927502933e-02 +0.0000000000000000e+00 -2.5693471981893444e-02 -3.1264027995339845e+00 -2.2685590483534783e+00 +2.5988738776259037e+04 +9.0988844300084398e+04 -7.4852943963224339e+08 -4.4268636390366209e+08 +7.9813953727725781e+12 -2.9965467766227120e+16 
bc_hf,   0.01000  +4.2555030010772495e-02 +0.0000000000000000e+00 -1.8516364144225868e-02 -1.6302561504430992e+00 +1.4528505086965037e+01 +2.1501876450567692e+04 -2.0655892303991821e+05 -5.0086452507643390e+08 +1.2025763982171872e+09 +4.7054586831906367e+12 -1.5878319403650300e+16 
m_accep, 0,0,0,0,0,0,0,0,0,0,0,0;...
bc_lf,   0.06400  +2.1469660408303565e-01 +0.0000000000000000e+00 -6.7794010172993441e-02 +3.1444735751357124e-02 +7.9999264487663457e-01 +6.5909775962410322e+03 +1.1010521612856031e+05 -1.7715108730378148e+08 -6.1124639864300120e+08 +1.9099728883651162e+12 -7.2684714345873540e+15 
m_accep, 0,0,0,0,0,0,0,0,0,0,0,0;...
bc_lf,   0.16000  +6.2430529426130144e-01 +0.0000000000000000e+00 -9.1756945496967535e-01 +3.8351515602962005e-01 +2.3330286988274327e+01 +3.7753399667972349e+02 -4.4309609975032836e+04 -4.0129030795520055e+06 +2.9746966838618064e+08 +8.0090768998549179e+10 -4.1229140228856281e+14 
m_accep, 0,0,0,0,0,0,0,0,0,0,0,0;...
bc_lf,   0.16000  +6.2466485975022035e-01 +0.0000000000000000e+00 -9.2883311566012594e-01 +3.3290348109673448e-02 +1.6103499783154284e+01 -6.7789849991586470e+02 +1.1015472204927091e+04 +3.0557868857985154e+07 +4.1919745967594162e+06 -3.5615743790524469e+11 +1.4634050301888275e+15 
bc_lf,   0.01200  +3.7498726768294167e-02 +0.0000000000000000e+00 -4.8182269434972336e-01 -6.2160990262631559e+00 -2.3409844385142126e+01 +1.3070106536191370e+04 +2.9458984287736786e+05 -2.6290182072273925e+08 -1.5873090074330323e+09 +2.2890619404023154e+12 -6.9346226602529350e+15 
bc_edge, 0,0,0,0,0,0,0,0,0,0,0,0;...
bc_lf,   0.01400  +2.8343147000704141e-02 +0.0000000000000000e+00 -1.3922852062803509e-01 -4.2103016511936433e+00 -5.2655397667515778e+01 +2.0023780693449726e+03 +1.6672081040936281e+05 -8.4906335861628041e+07 -9.8377788457326365e+08 +1.2042678516858003e+12 -5.6146885980116460e+15 
bc_lf,   0.01600  +1.8239908134759814e-02 +0.0000000000000000e+00 -4.2403581732348511e-02 -1.8651038462533531e+00 -1.3159960344862661e+01 -6.5179451629315017e+03 +3.8766049720555107e+04 +1.5489837430868322e+08 -3.5702916203644168e+08 -1.6169243604248799e+12 +5.9375142798992300e+15 
bc_lf,   0.03500  +2.7718156439042629e-02 -4.7233384667507859e-04 -1.1007825749773534e-02 -1.1801863308341429e+00 +2.1744920469812810e+00 +1.1086962568082074e+03 -4.1563594835017815e+04 -2.7346461625440784e+07 +2.1601108679737544e+08 +2.9386540077385516e+11 -1.1510230984022198e+15 
];


% % dipole model 2015-10-27
% % =======================
% % this (half) model is based on fieldmap
% % /home/fac_files/data/sirius/si/magnet_modelling/si-bc/bc-model5
% % '2015-10-26_Dipolo_Anel_BC_B3_Modelo5_gap_lateral_0.25mm_peca_3.5mm_-90_12mm_-2000_2000mm.txt'
% 
% monomials = [0,1,2,3,4,5,6,7,8,10];
% segmodel = [ ...
% %type    len[m]    angle[deg]               PolynomB(n=0)            PolynomB(n=1)            PolynomB(n=2)            PolynomB(n=3)            PolynomB(n=4)           PolynomB(n=5)           PolynomB(n=6)           PolynomB(n=7)           PolynomB(n=8)          PolynomB(n=10)      
% bc_hf,   0.00500,  +9.0422547934608036e-02, +0.0000000000000000e+00, +1.6561279928435787e-03, -3.8635102770266840e+01, +1.9799838007583221e+00, +5.9142930617311067e+04, -2.3305532644109009e+06, -1.3307147432627836e+10, +1.7359198612372101e+10, +1.0252680450327594e+14, -3.5093500128006522e+17;... 
% bc_hf,   0.00500,  +8.0758431643953799e-02, +0.0000000000000000e+00, -2.0903676504604431e-02, -2.2702568070088319e+01, +1.4458119648419139e+02, -2.6646305391284678e+05, -3.6857518202011138e+06, -2.3106186377990789e+09, +2.6921474787375134e+10, +2.6620270071919512e+13, -1.5513808575817158e+17;... 
% bc_hf,   0.00500,  +6.8945936554505274e-02, +0.0000000000000000e+00, -2.3783484246212603e-02, -1.4656043218180633e+01, -1.6540736507600374e+02, -8.5192774826686655e+04, +3.5314984296880653e+06, -2.1773195650338092e+09, -1.8854035837515739e+10, +2.6361796741709301e+13, -1.1722681242408355e+17;... 
% bc_hf,   0.00500,  +5.9638111977626050e-02, +0.0000000000000000e+00, -2.7327097383913031e-02, -9.9166707084254302e+00, +2.4429667067945029e+01, -7.0084006027048628e+04, +1.3445919048467744e+04, -4.1702366841366008e+07, +2.1265425230801362e+08, +2.6338328064194175e+12, -2.1107080596575184e+16;... 
% bc_hf,   0.01000,  +9.8158051792883727e-02, +0.0000000000000000e+00, -2.6534257289669964e-02, -6.4387824972092691e+00, +2.6348399196444120e+01, -5.0916075692931183e+04, -2.3188712883498441e+05, +5.6004196191402411e+08, +1.1637591856594622e+09, -5.2978932516412520e+12, +1.7147670705566452e+16;... 
% bc_hf,   0.01000,  +7.5633667090819492e-02, +0.0000000000000000e+00, -2.6409656954669659e-02, -4.6438801732611275e+00, -9.1067244808440861e-01, +2.4617675782323390e+03, +1.2719147568578293e+05, -2.6880190906564468e+08, -6.7552679229492307e+08, +2.6444000230142295e+12, -9.3558861138943840e+15;... 
% bc_hf,   0.01000,  +5.6667191990155803e-02, +0.0000000000000000e+00, -2.5758769525181791e-02, -3.1417659494792733e+00, -2.1984432707591490e+00, +2.8204152736840158e+04, +9.6021653622038182e+04, -7.9585436517169988e+08, -4.9875968852969640e+08, +8.4330130753745986e+12, -3.1547100791949620e+16;... 
% bc_hf,   0.01000,  +4.2518183670394671e-02, +0.0000000000000000e+00, -1.7901519850398690e-02, -1.6068666179296018e+00, +1.5749332075496348e+01, +2.2249629396559372e+04, -2.2799932382150227e+05, -5.1151276780732208e+08, +1.3033731927250462e+09, +4.7794425389891797e+12, -1.6060237462297156e+16;... 
% m_accep, 0,0,0,0,0,0,0,0,0,0,0,0;...
% bc_lf,   0.06400,  +2.1926765559733227e-01, +0.0000000000000000e+00, -6.3575058971078000e-02, +5.7552096864411206e-02, -6.1029870852386248e-01, +6.3916159115248693e+03, +1.1541752602750805e+05, -1.7052182891828227e+08, -6.3818038047387326e+08, +1.8345588994951411e+12, -6.9669856612719380e+15;... 
% m_accep, 0,0,0,0,0,0,0,0,0,0,0,0;...
% bc_lf,   0.16000,  +6.2740395177249542e-01, +0.0000000000000000e+00, -9.2106552053603707e-01, +3.7647151209247032e-01, +2.3040612235933114e+01, +3.7489709435214905e+02, -4.3028586111107048e+04, -3.9564097394172037e+06, +2.9250143761053407e+08, +7.9113730235646133e+10, -4.0789959301350775e+14;... 
% m_accep, 0,0,0,0,0,0,0,0,0,0,0,0;...
% bc_lf,   0.16000,  +6.2785342551080536e-01, +0.0000000000000000e+00, -9.3283631421853341e-01, +1.9939285149027961e-02, +1.6088661085707052e+01, -6.7782512676166402e+02, +9.6831520405249539e+03, +3.0342076799674477e+07, +1.2629537257322352e+07, -3.5182321602417853e+11, +1.4392589157007770e+15;... 
% bc_lf,   0.01200,  +3.7433423366223684e-02, +0.0000000000000000e+00, -4.8446877432302532e-01, -6.2904784695128635e+00, -2.6448770987803265e+01, +1.5099630249097117e+04, +3.2041042214380478e+05, -3.2151790795382023e+08, -1.7296198998471317e+09, +2.9683186337765649e+12, -9.6872876048203320e+15;... 
% bc_edge, 0,0,0,0,0,0,0,0,0,0,0,0;...
% bc_lf,   0.01400,  +2.7735002654968963e-02, +0.0000000000000000e+00, -1.4114654416046352e-01, -4.1872290260829699e+00, -5.3964210249114615e+01, +2.8115430232918284e+03, +1.6760442725036910e+05, -1.1300511931505170e+08, -9.8905066298100698e+08, +1.5724686164790283e+12, -7.2638745935471830e+15;... 
% bc_lf,   0.01600,  +1.6858462139756988e-02, +0.0000000000000000e+00, -4.3915793851809062e-02, -1.7249251586261864e+00, -1.3797673428608025e+01, -6.9074423403550873e+03, +4.8507983042934757e+04, +1.6330701912266961e+08, -4.2935521064516783e+08, -1.6924523966197566e+12, +6.1627050288660720e+15;... 
% bc_lf,   0.03500,  +1.9005956303470142e-02, -2.89115434188739e-04*0, -1.2111051363762683e-02, -8.4000797435596442e-01, +2.8602281278739254e+00, +1.2362305859215139e+03, -4.4648734696774685e+04, -3.3848435935284138e+07, +2.1947381750349617e+08, +3.8525756521465143e+11, -1.5642868102512230e+15;... 
% ];


% builds half of the magnet model
d2r = pi/180.0;
b = zeros(1,size(segmodel,1));
maxorder = 1+max(monomials);
for i=1:size(segmodel,1)
    type = types{segmodel(i,1)};
    if strcmpi(type.passmethod, 'IdentityPass')
        b(i) = marker(type.fam_name, 'IdentityPass');
    else
        PolyB = zeros(1,maxorder); PolyA = zeros(1,maxorder);
        PolyB(monomials+1) = segmodel(i,4:end); 
        PolyB(1) = 0.0; PolyA(1) = 0.0; % convenience of a nominal lattice with zero 4D closed-orbit.
        b(i) = rbend_sirius(type.fam_name, segmodel(i,2), d2r * segmodel(i,3), 0, 0, 0, 0, 0, PolyA, PolyB, passmethod);
    end
end

% builds entire magnet model, inserting additional markers
model_length = 2*sum(segmodel(:,2));
mc = marker('mc', 'IdentityPass');
m_accep = marker(types{m_accep}.fam_name, 'IdentityPass');
model = [fliplr(b), mc, m_accep, b];
